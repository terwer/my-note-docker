{"ast":null,"code":"var events = require('events');\n\nmodule.exports = function () {\n  var listeners = {};\n  var that = new events.EventEmitter();\n\n  that.watch = function (key, cb) {\n    if (!listeners[key]) {\n      listeners[key] = new events.EventEmitter();\n      listeners[key].setMaxListeners(0);\n    }\n\n    if (cb) listeners[key].on('change', cb);\n    return listeners[key];\n  };\n\n  that.watcher = function (key, cb) {\n    var watcher = new events.EventEmitter();\n\n    var onchange = function () {\n      watcher.emit('change', 'change', key);\n    };\n\n    that.watch(key, onchange);\n    if (cb) watcher.on('change', cb);\n\n    watcher.close = function () {\n      that.unwatch(key, onchange);\n    };\n\n    return watcher;\n  };\n\n  that.unwatch = function (key, cb) {\n    if (!listeners[key]) return;\n    if (cb) listeners[key].removeListener('change', cb);else listeners[key].removeAllListeners('change');\n    if (!listeners[key].listeners('change').length) delete listeners[key];\n    ;\n  };\n\n  that.change = function (key) {\n    if (listeners[key]) listeners[key].emit('change');\n    that.emit('change', key);\n  };\n\n  that.cb = function (key, cb) {\n    return function (err, val) {\n      if (key) that.change(key);\n      if (cb) cb(err, val);\n    };\n  };\n\n  return that;\n};","map":{"version":3,"names":["events","require","module","exports","listeners","that","EventEmitter","watch","key","cb","setMaxListeners","on","watcher","onchange","emit","close","unwatch","removeListener","removeAllListeners","length","change","err","val"],"sources":["/Users/terwer/Documents/mydocs/my-note-docker/workspace/SiYuan/data/widgets/publisher/src/publisher/node_modules/level-filesystem/watchers.js"],"sourcesContent":["var events = require('events');\n\nmodule.exports = function() {\n\tvar listeners = {};\n\tvar that = new events.EventEmitter();\n\n\tthat.watch = function(key, cb) {\n\t\tif (!listeners[key]) {\n\t\t\tlisteners[key] = new events.EventEmitter();\n\t\t\tlisteners[key].setMaxListeners(0);\n\t\t}\n\n\t\tif (cb) listeners[key].on('change', cb);\n\t\treturn listeners[key];\n\t};\n\n\tthat.watcher = function(key, cb) {\n\t\tvar watcher = new events.EventEmitter();\n\t\tvar onchange = function() {\n\t\t\twatcher.emit('change', 'change', key);\n\t\t};\n\n\t\tthat.watch(key, onchange);\n\t\tif (cb) watcher.on('change', cb);\n\t\twatcher.close = function() {\n\t\t\tthat.unwatch(key, onchange);\n\t\t};\n\n\t\treturn watcher;\n\t};\n\n\tthat.unwatch = function(key, cb) {\n\t\tif (!listeners[key]) return;\n\t\tif (cb) listeners[key].removeListener('change', cb);\n\t\telse listeners[key].removeAllListeners('change');\n\t\tif (!listeners[key].listeners('change').length) delete listeners[key];;\n\t};\n\n\tthat.change = function(key) {\n\t\tif (listeners[key]) listeners[key].emit('change');\n\t\tthat.emit('change', key);\n\t};\n\n\tthat.cb = function(key, cb) {\n\t\treturn function(err, val) {\n\t\t\tif (key) that.change(key);\n\t\t\tif (cb) cb(err, val);\n\t\t};\n\t};\n\n\treturn that;\n};"],"mappings":"AAAA,IAAIA,MAAM,GAAGC,OAAO,CAAC,QAAD,CAApB;;AAEAC,MAAM,CAACC,OAAP,GAAiB,YAAW;EAC3B,IAAIC,SAAS,GAAG,EAAhB;EACA,IAAIC,IAAI,GAAG,IAAIL,MAAM,CAACM,YAAX,EAAX;;EAEAD,IAAI,CAACE,KAAL,GAAa,UAASC,GAAT,EAAcC,EAAd,EAAkB;IAC9B,IAAI,CAACL,SAAS,CAACI,GAAD,CAAd,EAAqB;MACpBJ,SAAS,CAACI,GAAD,CAAT,GAAiB,IAAIR,MAAM,CAACM,YAAX,EAAjB;MACAF,SAAS,CAACI,GAAD,CAAT,CAAeE,eAAf,CAA+B,CAA/B;IACA;;IAED,IAAID,EAAJ,EAAQL,SAAS,CAACI,GAAD,CAAT,CAAeG,EAAf,CAAkB,QAAlB,EAA4BF,EAA5B;IACR,OAAOL,SAAS,CAACI,GAAD,CAAhB;EACA,CARD;;EAUAH,IAAI,CAACO,OAAL,GAAe,UAASJ,GAAT,EAAcC,EAAd,EAAkB;IAChC,IAAIG,OAAO,GAAG,IAAIZ,MAAM,CAACM,YAAX,EAAd;;IACA,IAAIO,QAAQ,GAAG,YAAW;MACzBD,OAAO,CAACE,IAAR,CAAa,QAAb,EAAuB,QAAvB,EAAiCN,GAAjC;IACA,CAFD;;IAIAH,IAAI,CAACE,KAAL,CAAWC,GAAX,EAAgBK,QAAhB;IACA,IAAIJ,EAAJ,EAAQG,OAAO,CAACD,EAAR,CAAW,QAAX,EAAqBF,EAArB;;IACRG,OAAO,CAACG,KAAR,GAAgB,YAAW;MAC1BV,IAAI,CAACW,OAAL,CAAaR,GAAb,EAAkBK,QAAlB;IACA,CAFD;;IAIA,OAAOD,OAAP;EACA,CAbD;;EAeAP,IAAI,CAACW,OAAL,GAAe,UAASR,GAAT,EAAcC,EAAd,EAAkB;IAChC,IAAI,CAACL,SAAS,CAACI,GAAD,CAAd,EAAqB;IACrB,IAAIC,EAAJ,EAAQL,SAAS,CAACI,GAAD,CAAT,CAAeS,cAAf,CAA8B,QAA9B,EAAwCR,EAAxC,EAAR,KACKL,SAAS,CAACI,GAAD,CAAT,CAAeU,kBAAf,CAAkC,QAAlC;IACL,IAAI,CAACd,SAAS,CAACI,GAAD,CAAT,CAAeJ,SAAf,CAAyB,QAAzB,EAAmCe,MAAxC,EAAgD,OAAOf,SAAS,CAACI,GAAD,CAAhB;IAAsB;EACtE,CALD;;EAOAH,IAAI,CAACe,MAAL,GAAc,UAASZ,GAAT,EAAc;IAC3B,IAAIJ,SAAS,CAACI,GAAD,CAAb,EAAoBJ,SAAS,CAACI,GAAD,CAAT,CAAeM,IAAf,CAAoB,QAApB;IACpBT,IAAI,CAACS,IAAL,CAAU,QAAV,EAAoBN,GAApB;EACA,CAHD;;EAKAH,IAAI,CAACI,EAAL,GAAU,UAASD,GAAT,EAAcC,EAAd,EAAkB;IAC3B,OAAO,UAASY,GAAT,EAAcC,GAAd,EAAmB;MACzB,IAAId,GAAJ,EAASH,IAAI,CAACe,MAAL,CAAYZ,GAAZ;MACT,IAAIC,EAAJ,EAAQA,EAAE,CAACY,GAAD,EAAMC,GAAN,CAAF;IACR,CAHD;EAIA,CALD;;EAOA,OAAOjB,IAAP;AACA,CAjDD"},"metadata":{},"sourceType":"script"}