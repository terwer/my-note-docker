{"ast":null,"code":"import { getPage, getWidgetId } from \"../lib/siyuanUtil\";\nimport { getConf, setConf } from \"../lib/config\";\nimport { getApiParams } from \"../lib/publish/publishUtil\";\nimport { slugify } from 'transliteration';\nimport jsYaml from \"js-yaml\";\n/**\n * 获取本地缓存的思源笔记页面ID\n * @param force\n * true 强制调用查询不获取缓存\n * false 优先读取本地缓存，缓存不存在再去查询\n * @returns {Promise<*|string>}\n */\n\nexport async function getSiyuanPageId(force) {\n  const page = await getSiyuanPage(force);\n  const pageId = page.root_id || \"\";\n  console.log(\"获取思源笔记页面ID=>\", pageId);\n  return pageId;\n}\n/**\n * 获取本地缓存的思源笔记页面信息（不是实时的）\n * @param force true代表强制调用查询不获取缓存\n * @returns {Promise<any>}\n */\n\nexport async function getSiyuanPage(force) {\n  const widgetId = await getWidgetId(); // 默认读取缓存\n\n  const pageObj = getConf(widgetId);\n\n  if (!force && pageObj) {\n    console.log(\"获取本地缓存的思源笔记页面信息（不是实时的）=>\", pageObj);\n    return pageObj;\n  } // 如果本地不存在，或者需要强制读取，调用api查询\n\n\n  const page = await getPage(widgetId);\n\n  if (page) {\n    await setConf(widgetId, page);\n    console.warn(\"调用API设置查询思源页面信息并更新本地缓存\", page);\n  }\n\n  return page;\n}\n/**\n * 根据平台类型获取发布状态\n * @param apiType 平台类型\n * @param meta 元数据\n */\n\nexport function getPublishStatus(apiType, meta) {\n  const postidKey = getApiParams(apiType).postidKey;\n  const postId = meta[postidKey] || \"\";\n  return postId === \"\";\n}\n/**\n * 中文翻译成英文别名\n * @param q\n * @returns {Promise<unknown>}\n */\n\nexport async function zhSlugify(q) {\n  const v = await fetch('https://clients5.google.com/translate_a/t?client=dict-chrome-ex&sl=auto&tl=en-US&q=' + q);\n  let json = await v.json();\n  let res = json[0][0];\n  res = res.replaceAll(/-/g, \"\");\n  console.log(\"res=>\", res);\n  return slugify(res);\n}\nexport function yaml2Obj(yaml) {\n  let doc = \"\"; // Get document, or throw exception on error\n\n  try {\n    yaml = yaml.replace(\"---\\n\", \"\");\n    yaml = yaml.replace(\"---\", \"\");\n    doc = jsYaml.load(yaml); // console.log(doc);\n  } catch (e) {\n    console.error(e);\n  }\n\n  return doc;\n}\nexport function obj2yaml(obj) {\n  // https://npmmirror.com/package/js-yaml\n  let res = jsYaml.dump(obj);\n  res = \"---\\n\" + res + \"---\";\n  return res;\n} // function test() {\n//     const obj = {\n//         title: \"把npm依赖转换为本地依赖\",\n//         date: \"2022-07-09 15:16:00\",\n//         permalink: \"/post/convert-npm-dependencies-to-local.html\",\n//         meta: [\n//             {\n//                 name: \"keywords\",\n//                 content: \"npm dependency\"\n//             },\n//             {\n//                 name: \"description\",\n//                 content: \"把npm依赖转换为本地依赖有的时候，当我们要使用额第三方库停止维护之后，我们想自己修改代码才能达到某个需求。但是npm默认是只读的，下次运行依赖管理会覆盖代码。缘由要在上面陈述的情况，我们可以把npm依赖库转换为本地依赖，这样就不再受包管理器约束，我们就可以自定义修改代码了方案先删除npm中依赖yarnremove@oaktreehouse/vuepresspluginencrypt森岛帆高\"\n//             }\n//         ],\n//         categories: [\n//             \"博文\", \"实用技巧\"\n//         ],\n//         tags: [\n//             \"npm\", \"dependency\"\n//         ],\n//         author: {\n//             name: \"terwer\",\n//             link: \"https://github.com/terwer\"\n//         }\n//     };\n//     const yamlResult = obj2yaml(obj)\n//     console.log(\"yamlResult=>\")\n//     console.log(yamlResult)\n//\n//     const objResult = yaml2Obj(yamlResult)\n//     console.log(\"objResult=>\")\n//     console.log(objResult)\n// }\n//\n// test()\n// babel-node src/lib/util.js","map":{"version":3,"names":["getPage","getWidgetId","getConf","setConf","getApiParams","slugify","jsYaml","getSiyuanPageId","force","page","getSiyuanPage","pageId","root_id","console","log","widgetId","pageObj","warn","getPublishStatus","apiType","meta","postidKey","postId","zhSlugify","q","v","fetch","json","res","replaceAll","yaml2Obj","yaml","doc","replace","load","e","error","obj2yaml","obj","dump"],"sources":["/Users/terwer/Documents/mydocs/my-note-docker/workspace/SiYuan/data/widgets/publisher/src/publisher/src/lib/util.js"],"sourcesContent":["import {getPage, getWidgetId} from \"../lib/siyuanUtil\";\nimport {getConf, setConf} from \"../lib/config\";\nimport {getApiParams} from \"../lib/publish/publishUtil\";\nimport {slugify} from 'transliteration';\nimport jsYaml from \"js-yaml\";\n\n/**\n * 获取本地缓存的思源笔记页面ID\n * @param force\n * true 强制调用查询不获取缓存\n * false 优先读取本地缓存，缓存不存在再去查询\n * @returns {Promise<*|string>}\n */\nexport async function getSiyuanPageId(force) {\n    const page = await getSiyuanPage(force);\n\n    const pageId = page.root_id || \"\"\n    console.log(\"获取思源笔记页面ID=>\", pageId)\n    return pageId\n}\n\n/**\n * 获取本地缓存的思源笔记页面信息（不是实时的）\n * @param force true代表强制调用查询不获取缓存\n * @returns {Promise<any>}\n */\nexport async function getSiyuanPage(force) {\n    const widgetId = await getWidgetId()\n    // 默认读取缓存\n    const pageObj = getConf(widgetId);\n    if (!force && pageObj) {\n        console.log(\"获取本地缓存的思源笔记页面信息（不是实时的）=>\", pageObj)\n        return pageObj;\n    }\n\n    // 如果本地不存在，或者需要强制读取，调用api查询\n    const page = await getPage(widgetId);\n    if (page) {\n        await setConf(widgetId, page)\n        console.warn(\"调用API设置查询思源页面信息并更新本地缓存\", page)\n    }\n    return page;\n}\n\n/**\n * 根据平台类型获取发布状态\n * @param apiType 平台类型\n * @param meta 元数据\n */\nexport function getPublishStatus(apiType, meta) {\n    const postidKey = getApiParams(apiType).postidKey;\n    const postId = meta[postidKey] || \"\";\n    return postId === \"\";\n}\n\n/**\n * 中文翻译成英文别名\n * @param q\n * @returns {Promise<unknown>}\n */\nexport async function zhSlugify(q) {\n    const v = await fetch('https://clients5.google.com/translate_a/t?client=dict-chrome-ex&sl=auto&tl=en-US&q=' + q);\n    let json = await v.json()\n    let res = json[0][0];\n    res = res.replaceAll(/-/g, \"\");\n    console.log(\"res=>\", res)\n    return slugify(res);\n}\n\nexport function yaml2Obj(yaml) {\n    let doc = \"\";\n    // Get document, or throw exception on error\n    try {\n        yaml = yaml.replace(\"---\\n\", \"\")\n        yaml = yaml.replace(\"---\", \"\")\n        doc = jsYaml.load(yaml);\n        // console.log(doc);\n    } catch (e) {\n        console.error(e);\n    }\n    return doc;\n}\n\nexport function obj2yaml(obj) {\n    // https://npmmirror.com/package/js-yaml\n    let res = jsYaml.dump(obj);\n\n    res = \"---\\n\" + res + \"---\"\n    return res;\n}\n\n// function test() {\n//     const obj = {\n//         title: \"把npm依赖转换为本地依赖\",\n//         date: \"2022-07-09 15:16:00\",\n//         permalink: \"/post/convert-npm-dependencies-to-local.html\",\n//         meta: [\n//             {\n//                 name: \"keywords\",\n//                 content: \"npm dependency\"\n//             },\n//             {\n//                 name: \"description\",\n//                 content: \"把npm依赖转换为本地依赖有的时候，当我们要使用额第三方库停止维护之后，我们想自己修改代码才能达到某个需求。但是npm默认是只读的，下次运行依赖管理会覆盖代码。缘由要在上面陈述的情况，我们可以把npm依赖库转换为本地依赖，这样就不再受包管理器约束，我们就可以自定义修改代码了方案先删除npm中依赖yarnremove@oaktreehouse/vuepresspluginencrypt森岛帆高\"\n//             }\n//         ],\n//         categories: [\n//             \"博文\", \"实用技巧\"\n//         ],\n//         tags: [\n//             \"npm\", \"dependency\"\n//         ],\n//         author: {\n//             name: \"terwer\",\n//             link: \"https://github.com/terwer\"\n//         }\n//     };\n//     const yamlResult = obj2yaml(obj)\n//     console.log(\"yamlResult=>\")\n//     console.log(yamlResult)\n//\n//     const objResult = yaml2Obj(yamlResult)\n//     console.log(\"objResult=>\")\n//     console.log(objResult)\n// }\n//\n// test()\n\n// babel-node src/lib/util.js\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}