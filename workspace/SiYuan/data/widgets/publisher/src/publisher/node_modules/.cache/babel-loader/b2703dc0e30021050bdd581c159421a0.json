{"ast":null,"code":"import { getBlockByID, sql } from './siYuanApi.js';\n/**\n * 获取当前文档\n * @returns {Promise<*>}\n */\n\nexport async function getPage() {\n  const self = window.frameElement.parentElement.parentElement;\n  return await getBlockByID(self.getAttribute('data-node-id'));\n}\n/**\n * 获取文档ID\n * @returns {Promise<*|string>}\n */\n// eslint-disable-next-line no-unused-vars\n\nasync function getPageId() {\n  const self = window.frameElement.parentElement.parentElement;\n  const page = await get_page(self.getAttribute('data-node-id'));\n\n  if (!page) {\n    alert(\"未获取到文档信息，请等待几秒再试。。。\");\n  }\n\n  return page.root_id || \"\";\n}\n/**\n * 获取文档中的所有块\n * @returns {Promise<*|null>}\n */\n// eslint-disable-next-line no-unused-vars\n\n\nasync function getInfoBlocks() {\n  // eslint-disable-next-line no-undef\n  let page_id = await get_page_id();\n  const sql_sentence = \"select * from blocks where type = 'p' and (root_id = \" + \"'\" + page_id + \"'\" + \" or path like '%\" + page_id + \"%')\"; //console.log(sql_sentence);\n  //console.log(res);\n\n  return await sql(sql_sentence);\n}\n/**\n * 获取文档中的所有信息\n * @returns {Promise<string>}\n */\n// eslint-disable-next-line no-unused-vars\n\n\nasync function getPageContent() {\n  // 获取当前块信息和文字\n  // eslint-disable-next-line no-undef\n  const res = await info_present_blocks();\n  const resLength = res.length;\n  let all_character = '';\n\n  for (let i = 0; i < resLength; i++) {\n    if (res[i].content) {\n      all_character += res[i].content + '\\n';\n    }\n  }\n\n  return all_character;\n}","map":{"version":3,"names":["getBlockByID","sql","getPage","self","window","frameElement","parentElement","getAttribute","getPageId","page","get_page","alert","root_id","getInfoBlocks","page_id","get_page_id","sql_sentence","getPageContent","res","info_present_blocks","resLength","length","all_character","i","content"],"sources":["/Users/terwer/Documents/mydocs/my-note-docker/workspace/SiYuan/data/widgets/publisher/src/publisher/src/lib/siyuanUtil.js"],"sourcesContent":["import {getBlockByID, sql} from './siYuanApi.js';\n\n/**\n * 获取当前文档\n * @returns {Promise<*>}\n */\nexport async function getPage() {\n    const self = window.frameElement.parentElement.parentElement;\n    return await getBlockByID(self.getAttribute('data-node-id'));\n}\n\n/**\n * 获取文档ID\n * @returns {Promise<*|string>}\n */\n// eslint-disable-next-line no-unused-vars\nasync function getPageId() {\n    const self = window.frameElement.parentElement.parentElement;\n    const page = await get_page(self.getAttribute('data-node-id'))\n    if (!page) {\n        alert(\"未获取到文档信息，请等待几秒再试。。。\");\n    }\n    return page.root_id || \"\";\n}\n\n/**\n * 获取文档中的所有块\n * @returns {Promise<*|null>}\n */\n// eslint-disable-next-line no-unused-vars\nasync function getInfoBlocks() {\n    // eslint-disable-next-line no-undef\n    let page_id = await get_page_id();\n\n    const sql_sentence = \"select * from blocks where type = 'p' and (root_id = \" + \"'\" + page_id + \"'\" + \" or path like '%\" + page_id + \"%')\";\n    //console.log(sql_sentence);\n    //console.log(res);\n    return await sql(sql_sentence);\n}\n\n/**\n * 获取文档中的所有信息\n * @returns {Promise<string>}\n */\n// eslint-disable-next-line no-unused-vars\nasync function getPageContent() {\n    // 获取当前块信息和文字\n    // eslint-disable-next-line no-undef\n    const res = await info_present_blocks()\n    const resLength = res.length;\n    let all_character = '';\n    for (let i = 0; i < resLength; i++) {\n        if (res[i].content) {\n            all_character += res[i].content + '\\n';\n        }\n    }\n    return all_character;\n}"],"mappings":"AAAA,SAAQA,YAAR,EAAsBC,GAAtB,QAAgC,gBAAhC;AAEA;AACA;AACA;AACA;;AACA,OAAO,eAAeC,OAAf,GAAyB;EAC5B,MAAMC,IAAI,GAAGC,MAAM,CAACC,YAAP,CAAoBC,aAApB,CAAkCA,aAA/C;EACA,OAAO,MAAMN,YAAY,CAACG,IAAI,CAACI,YAAL,CAAkB,cAAlB,CAAD,CAAzB;AACH;AAED;AACA;AACA;AACA;AACA;;AACA,eAAeC,SAAf,GAA2B;EACvB,MAAML,IAAI,GAAGC,MAAM,CAACC,YAAP,CAAoBC,aAApB,CAAkCA,aAA/C;EACA,MAAMG,IAAI,GAAG,MAAMC,QAAQ,CAACP,IAAI,CAACI,YAAL,CAAkB,cAAlB,CAAD,CAA3B;;EACA,IAAI,CAACE,IAAL,EAAW;IACPE,KAAK,CAAC,qBAAD,CAAL;EACH;;EACD,OAAOF,IAAI,CAACG,OAAL,IAAgB,EAAvB;AACH;AAED;AACA;AACA;AACA;AACA;;;AACA,eAAeC,aAAf,GAA+B;EAC3B;EACA,IAAIC,OAAO,GAAG,MAAMC,WAAW,EAA/B;EAEA,MAAMC,YAAY,GAAG,0DAA0D,GAA1D,GAAgEF,OAAhE,GAA0E,GAA1E,GAAgF,kBAAhF,GAAqGA,OAArG,GAA+G,KAApI,CAJ2B,CAK3B;EACA;;EACA,OAAO,MAAMb,GAAG,CAACe,YAAD,CAAhB;AACH;AAED;AACA;AACA;AACA;AACA;;;AACA,eAAeC,cAAf,GAAgC;EAC5B;EACA;EACA,MAAMC,GAAG,GAAG,MAAMC,mBAAmB,EAArC;EACA,MAAMC,SAAS,GAAGF,GAAG,CAACG,MAAtB;EACA,IAAIC,aAAa,GAAG,EAApB;;EACA,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,SAApB,EAA+BG,CAAC,EAAhC,EAAoC;IAChC,IAAIL,GAAG,CAACK,CAAD,CAAH,CAAOC,OAAX,EAAoB;MAChBF,aAAa,IAAIJ,GAAG,CAACK,CAAD,CAAH,CAAOC,OAAP,GAAiB,IAAlC;IACH;EACJ;;EACD,OAAOF,aAAP;AACH"},"metadata":{},"sourceType":"module"}