{"ast":null,"code":"var EventEmitter = require('events').EventEmitter;\n\nvar next = process.nextTick;\n\nvar SubDb = require('./sub');\n\nvar Batch = require('./batch');\n\nvar fixRange = require('level-fix-range');\n\nvar Hooks = require('level-hooks');\n\nmodule.exports = function (_db, options) {\n  function DB() {}\n\n  DB.prototype = _db;\n  var db = new DB();\n  if (db.sublevel) return db;\n  options = options || {}; //use \\xff (255) as the seperator,\n  //so that sections of the database will sort after the regular keys\n\n  var sep = options.sep = options.sep || '\\xff';\n  db._options = options;\n  Hooks(db);\n  db.sublevels = {};\n\n  db.sublevel = function (prefix, options) {\n    if (db.sublevels[prefix]) return db.sublevels[prefix];\n    return new SubDb(db, prefix, options || this._options);\n  };\n\n  db.methods = {};\n\n  db.prefix = function (key) {\n    return '' + (key || '');\n  };\n\n  db.pre = function (range, hook) {\n    if (!hook) hook = range, range = {\n      max: sep\n    };\n    return db.hooks.pre(range, hook);\n  };\n\n  db.post = function (range, hook) {\n    if (!hook) hook = range, range = {\n      max: sep\n    };\n    return db.hooks.post(range, hook);\n  };\n\n  function safeRange(fun) {\n    return function (opts) {\n      opts = opts || {};\n      opts = fixRange(opts);\n      if (opts.reverse) opts.start = opts.start || sep;else opts.end = opts.end || sep;\n      return fun.call(db, opts);\n    };\n  }\n\n  db.readStream = db.createReadStream = safeRange(db.createReadStream);\n  db.keyStream = db.createKeyStream = safeRange(db.createKeyStream);\n  db.valuesStream = db.createValueStream = safeRange(db.createValueStream);\n  var batch = db.batch;\n\n  db.batch = function (changes, opts, cb) {\n    if (!Array.isArray(changes)) return new Batch(db);\n    changes.forEach(function (e) {\n      if (e.prefix) {\n        if ('function' === typeof e.prefix.prefix) e.key = e.prefix.prefix(e.key);else if ('string' === typeof e.prefix) e.key = e.prefix + e.key;\n      }\n    });\n    batch.call(db, changes, opts, cb);\n  };\n\n  return db;\n};","map":{"version":3,"names":["EventEmitter","require","next","process","nextTick","SubDb","Batch","fixRange","Hooks","module","exports","_db","options","DB","prototype","db","sublevel","sep","_options","sublevels","prefix","methods","key","pre","range","hook","max","hooks","post","safeRange","fun","opts","reverse","start","end","call","readStream","createReadStream","keyStream","createKeyStream","valuesStream","createValueStream","batch","changes","cb","Array","isArray","forEach","e"],"sources":["/Users/terwer/Documents/mydocs/my-note-docker/workspace/SiYuan/data/widgets/publisher/src/publisher/node_modules/level-sublevel/index.js"],"sourcesContent":["var EventEmitter = require('events').EventEmitter\nvar next         = process.nextTick\nvar SubDb        = require('./sub')\nvar Batch        = require('./batch')\nvar fixRange     = require('level-fix-range')\n\nvar Hooks   = require('level-hooks')\n\nmodule.exports   = function (_db, options) {\n  function DB () {}\n  DB.prototype = _db\n  var db = new DB()\n\n  if (db.sublevel) return db\n\n  options = options || {}\n\n  //use \\xff (255) as the seperator,\n  //so that sections of the database will sort after the regular keys\n  var sep = options.sep = options.sep || '\\xff'\n  db._options = options\n\n  Hooks(db)\n\n  db.sublevels = {}\n\n  db.sublevel = function (prefix, options) {\n    if(db.sublevels[prefix])\n      return db.sublevels[prefix]\n    return new SubDb(db, prefix, options || this._options)\n  }\n\n  db.methods = {}\n\n  db.prefix = function (key) {\n    return '' + (key || '')\n  }\n\n  db.pre = function (range, hook) {\n    if(!hook)\n      hook = range, range = {\n        max  : sep\n      }\n    return db.hooks.pre(range, hook)\n  }\n\n  db.post = function (range, hook) {\n    if(!hook)\n      hook = range, range = {\n        max : sep\n      }\n    return db.hooks.post(range, hook)\n  }\n\n  function safeRange(fun) {\n    return function (opts) {\n      opts = opts || {}\n      opts = fixRange(opts)\n\n      if(opts.reverse) opts.start = opts.start || sep\n      else             opts.end   = opts.end || sep\n\n      return fun.call(db, opts)\n    }\n  }\n\n  db.readStream =\n  db.createReadStream  = safeRange(db.createReadStream)\n  db.keyStream =\n  db.createKeyStream   = safeRange(db.createKeyStream)\n  db.valuesStream =\n  db.createValueStream = safeRange(db.createValueStream)\n\n  var batch = db.batch\n  db.batch = function (changes, opts, cb) {\n    if(!Array.isArray(changes))\n      return new Batch(db)\n    changes.forEach(function (e) {\n      if(e.prefix) {\n        if('function' === typeof e.prefix.prefix)\n          e.key = e.prefix.prefix(e.key)\n        else if('string'  === typeof e.prefix)\n          e.key = e.prefix + e.key\n      }\n    })\n    batch.call(db, changes, opts, cb)\n  }\n  return db\n}\n\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}