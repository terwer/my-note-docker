{"ast":null,"code":"var xmlBuilder = require('xmlbuilder'),\n    dateFormatter = require('./date_formatter'),\n    CustomType = require('./customtype');\n/**\n * Creates the XML for an XML-RPC method call.\n *\n * @param {String} method     - The method name.\n * @param {Array} params      - Params to pass in the call.\n * @param {Function} callback - function (error, xml) { ... }\n *   - {Object|null} error    - Any errors that occurred while building the XML,\n *                              otherwise null.\n *   - {String} xml           - The method call XML.\n */\n\n\nexports.serializeMethodCall = function (method, params, encoding) {\n  var params = params || [];\n  var options = {\n    version: '1.0',\n    allowSurrogateChars: true\n  };\n\n  if (encoding) {\n    options.encoding = encoding;\n  }\n\n  var xml = xmlBuilder.create('methodCall', options).ele('methodName').txt(method).up().ele('params');\n  params.forEach(function (param) {\n    serializeValue(param, xml.ele('param'));\n  }); // Includes the <?xml ...> declaration\n\n  return xml.doc().toString();\n};\n/**\n * Creates the XML for an XML-RPC method response.\n *\n * @param {mixed} value       - The value to pass in the response.\n * @param {Function} callback - function (error, xml) { ... }\n *   - {Object|null} error    - Any errors that occurred while building the XML,\n *                              otherwise null.\n *   - {String} xml           - The method response XML.\n */\n\n\nexports.serializeMethodResponse = function (result) {\n  var xml = xmlBuilder.create('methodResponse', {\n    version: '1.0',\n    allowSurrogateChars: true\n  }).ele('params').ele('param');\n  serializeValue(result, xml); // Includes the <?xml ...> declaration\n\n  return xml.doc().toString();\n};\n\nexports.serializeFault = function (fault) {\n  var xml = xmlBuilder.create('methodResponse', {\n    version: '1.0',\n    allowSurrogateChars: true\n  }).ele('fault');\n  serializeValue(fault, xml); // Includes the <?xml ...> declaration\n\n  return xml.doc().toString();\n};\n\nfunction serializeValue(value, xml) {\n  var stack = [{\n    value: value,\n    xml: xml\n  }],\n      current = null,\n      valueNode = null,\n      next = null;\n\n  while (stack.length > 0) {\n    current = stack[stack.length - 1];\n\n    if (current.index !== undefined) {\n      // Iterating a compound\n      next = getNextItemsFrame(current);\n\n      if (next) {\n        stack.push(next);\n      } else {\n        stack.pop();\n      }\n    } else {\n      // we're about to add a new value (compound or simple)\n      valueNode = current.xml.ele('value');\n\n      switch (typeof current.value) {\n        case 'boolean':\n          appendBoolean(current.value, valueNode);\n          stack.pop();\n          break;\n\n        case 'string':\n          appendString(current.value, valueNode);\n          stack.pop();\n          break;\n\n        case 'number':\n          appendNumber(current.value, valueNode);\n          stack.pop();\n          break;\n\n        case 'object':\n          if (current.value === null) {\n            valueNode.ele('nil');\n            stack.pop();\n          } else if (current.value instanceof Date) {\n            appendDatetime(current.value, valueNode);\n            stack.pop();\n          } else if (Buffer.isBuffer(current.value)) {\n            appendBuffer(current.value, valueNode);\n            stack.pop();\n          } else if (current.value instanceof CustomType) {\n            current.value.serialize(valueNode);\n            stack.pop();\n          } else {\n            if (Array.isArray(current.value)) {\n              current.xml = valueNode.ele('array').ele('data');\n            } else {\n              current.xml = valueNode.ele('struct');\n              current.keys = Object.keys(current.value);\n            }\n\n            current.index = 0;\n            next = getNextItemsFrame(current);\n\n            if (next) {\n              stack.push(next);\n            } else {\n              stack.pop();\n            }\n          }\n\n          break;\n\n        default:\n          stack.pop();\n          break;\n      }\n    }\n  }\n}\n\nfunction getNextItemsFrame(frame) {\n  var nextFrame = null;\n\n  if (frame.keys) {\n    if (frame.index < frame.keys.length) {\n      var key = frame.keys[frame.index++],\n          member = frame.xml.ele('member').ele('name').text(key).up();\n      nextFrame = {\n        value: frame.value[key],\n        xml: member\n      };\n    }\n  } else if (frame.index < frame.value.length) {\n    nextFrame = {\n      value: frame.value[frame.index],\n      xml: frame.xml\n    };\n    frame.index++;\n  }\n\n  return nextFrame;\n}\n\nfunction appendBoolean(value, xml) {\n  xml.ele('boolean').txt(value ? 1 : 0);\n}\n\nvar illegalChars = /^(?![^<&]*]]>[^<&]*)[^<&]*$/;\n\nfunction appendString(value, xml) {\n  if (value.length === 0) {\n    xml.ele('string');\n  } else if (!illegalChars.test(value)) {\n    xml.ele('string').d(value);\n  } else {\n    xml.ele('string').txt(value);\n  }\n}\n\nfunction appendNumber(value, xml) {\n  if (value % 1 == 0) {\n    xml.ele('int').txt(value);\n  } else {\n    xml.ele('double').txt(value);\n  }\n}\n\nfunction appendDatetime(value, xml) {\n  xml.ele('dateTime.iso8601').txt(dateFormatter.encodeIso8601(value));\n}\n\nfunction appendBuffer(value, xml) {\n  xml.ele('base64').txt(value.toString('base64'));\n}","map":{"version":3,"names":["xmlBuilder","require","dateFormatter","CustomType","exports","serializeMethodCall","method","params","encoding","options","version","allowSurrogateChars","xml","create","ele","txt","up","forEach","param","serializeValue","doc","toString","serializeMethodResponse","result","serializeFault","fault","value","stack","current","valueNode","next","length","index","undefined","getNextItemsFrame","push","pop","appendBoolean","appendString","appendNumber","Date","appendDatetime","Buffer","isBuffer","appendBuffer","serialize","Array","isArray","keys","Object","frame","nextFrame","key","member","text","illegalChars","test","d","encodeIso8601"],"sources":["/Users/terwer/Documents/mydocs/my-note-docker/workspace/SiYuan/data/widgets/publisher/src/publisher/node_modules/xmlrpc/lib/serializer.js"],"sourcesContent":["var xmlBuilder    = require('xmlbuilder')\n  , dateFormatter = require('./date_formatter')\n  , CustomType    = require('./customtype')\n\n/**\n * Creates the XML for an XML-RPC method call.\n *\n * @param {String} method     - The method name.\n * @param {Array} params      - Params to pass in the call.\n * @param {Function} callback - function (error, xml) { ... }\n *   - {Object|null} error    - Any errors that occurred while building the XML,\n *                              otherwise null.\n *   - {String} xml           - The method call XML.\n */\nexports.serializeMethodCall = function(method, params, encoding) {\n  var params = params || []\n\n  var options = { version: '1.0', allowSurrogateChars: true }\n\n  if (encoding) {\n    options.encoding = encoding\n  }\n\n  var xml = xmlBuilder.create('methodCall', options)\n    .ele('methodName')\n      .txt(method)\n    .up()\n    .ele('params')\n\n  params.forEach(function(param) {\n    serializeValue(param, xml.ele('param'))\n  })\n\n  // Includes the <?xml ...> declaration\n  return xml.doc().toString()\n}\n\n/**\n * Creates the XML for an XML-RPC method response.\n *\n * @param {mixed} value       - The value to pass in the response.\n * @param {Function} callback - function (error, xml) { ... }\n *   - {Object|null} error    - Any errors that occurred while building the XML,\n *                              otherwise null.\n *   - {String} xml           - The method response XML.\n */\nexports.serializeMethodResponse = function(result) {\n  var xml = xmlBuilder.create('methodResponse', { version: '1.0', allowSurrogateChars: true })\n    .ele('params')\n      .ele('param')\n\n  serializeValue(result, xml)\n\n  // Includes the <?xml ...> declaration\n  return xml.doc().toString()\n}\n\nexports.serializeFault = function(fault) {\n  var xml = xmlBuilder.create('methodResponse', { version: '1.0', allowSurrogateChars: true })\n    .ele('fault')\n\n  serializeValue(fault, xml)\n\n  // Includes the <?xml ...> declaration\n  return xml.doc().toString()\n}\n\nfunction serializeValue(value, xml) {\n  var stack     = [ { value: value, xml: xml } ]\n    , current   = null\n    , valueNode = null\n    , next      = null\n\n  while (stack.length > 0) {\n    current = stack[stack.length - 1]\n\n    if (current.index !== undefined) {\n      // Iterating a compound\n      next = getNextItemsFrame(current)\n      if (next) {\n        stack.push(next)\n      }\n      else {\n        stack.pop()\n      }\n    }\n    else {\n      // we're about to add a new value (compound or simple)\n      valueNode = current.xml.ele('value')\n      switch(typeof current.value) {\n        case 'boolean':\n          appendBoolean(current.value, valueNode)\n          stack.pop()\n          break\n        case 'string':\n          appendString(current.value, valueNode)\n          stack.pop()\n          break\n        case 'number':\n          appendNumber(current.value, valueNode)\n          stack.pop()\n          break\n        case 'object':\n          if (current.value === null) {\n            valueNode.ele('nil')\n            stack.pop()\n          }\n          else if (current.value instanceof Date) {\n            appendDatetime(current.value, valueNode)\n            stack.pop()\n          }\n          else if (Buffer.isBuffer(current.value)) {\n            appendBuffer(current.value, valueNode)\n            stack.pop()\n          }\n          else if (current.value instanceof CustomType) {\n            current.value.serialize(valueNode)\n            stack.pop()\n          }\n          else {\n            if (Array.isArray(current.value)) {\n              current.xml = valueNode.ele('array').ele('data')\n            }\n            else {\n              current.xml = valueNode.ele('struct')\n              current.keys = Object.keys(current.value)\n            }\n            current.index = 0\n            next = getNextItemsFrame(current)\n            if (next) {\n              stack.push(next)\n            }\n            else {\n              stack.pop()\n            }\n          }\n          break\n        default:\n          stack.pop()\n          break\n      }\n    }\n  }\n}\n\nfunction getNextItemsFrame(frame) {\n  var nextFrame = null\n\n  if (frame.keys) {\n    if (frame.index < frame.keys.length) {\n      var key    = frame.keys[frame.index++]\n        , member = frame.xml.ele('member').ele('name').text(key).up()\n      nextFrame = {\n        value: frame.value[key]\n      , xml: member\n      }\n    }\n  }\n  else if (frame.index < frame.value.length) {\n    nextFrame = {\n      value: frame.value[frame.index]\n    , xml: frame.xml\n    }\n    frame.index++\n  }\n\n  return nextFrame\n}\n\nfunction appendBoolean(value, xml) {\n  xml.ele('boolean').txt(value ? 1 : 0)\n}\n\nvar illegalChars = /^(?![^<&]*]]>[^<&]*)[^<&]*$/\nfunction appendString(value, xml) {\n  if (value.length === 0) {\n    xml.ele('string')\n  }\n  else if (!illegalChars.test(value)) {\n    xml.ele('string').d(value)\n  }\n  else {\n    xml.ele('string').txt(value)\n  }\n}\n\nfunction appendNumber(value, xml) {\n  if (value % 1 == 0) {\n    xml.ele('int').txt(value)\n  }\n  else {\n    xml.ele('double').txt(value)\n  }\n}\n\nfunction appendDatetime(value, xml) {\n  xml.ele('dateTime.iso8601').txt(dateFormatter.encodeIso8601(value))\n}\n\nfunction appendBuffer(value, xml) {\n  xml.ele('base64').txt(value.toString('base64'))\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}