{"ast":null,"code":"require(\"core-js/modules/web.immediate.js\");\n\n/* Copyright (c) 2012-2014 LevelUP contributors\n * See list at <https://github.com/rvagg/node-levelup#contributing>\n * MIT License\n * <https://github.com/rvagg/node-levelup/blob/master/LICENSE.md>\n */\nvar Stream = require('stream').Stream,\n    inherits = require('util').inherits,\n    extend = require('xtend'),\n    bl = require('bl'),\n    setImmediate = global.setImmediate || process.nextTick,\n    getOptions = require('./util').getOptions,\n    defaultOptions = {\n  type: 'put'\n};\n\nfunction WriteStream(options, db) {\n  if (!(this instanceof WriteStream)) return new WriteStream(options, db);\n  Stream.call(this);\n  this._options = extend(defaultOptions, getOptions(db, options));\n  this._db = db;\n  this._buffer = [];\n  this._status = 'init';\n  this._end = false;\n  this.writable = true;\n  this.readable = false;\n\n  var self = this,\n      ready = function () {\n    if (!self.writable) return;\n    self._status = 'ready';\n    self.emit('ready');\n\n    self._process();\n  };\n\n  if (db.isOpen()) setImmediate(ready);else db.once('ready', ready);\n}\n\ninherits(WriteStream, Stream);\n\nWriteStream.prototype.write = function (data) {\n  if (!this.writable) return false;\n\n  this._buffer.push(data);\n\n  if (this._status != 'init') this._processDelayed();\n\n  if (this._options.maxBufferLength && this._buffer.length > this._options.maxBufferLength) {\n    this._writeBlock = true;\n    return false;\n  }\n\n  return true;\n};\n\nWriteStream.prototype.end = function (data) {\n  var self = this;\n  if (data) this.write(data);\n  setImmediate(function () {\n    self._end = true;\n\n    self._process();\n  });\n};\n\nWriteStream.prototype.destroy = function () {\n  this.writable = false;\n  this.end();\n};\n\nWriteStream.prototype.destroySoon = function () {\n  this.end();\n};\n\nWriteStream.prototype.add = function (entry) {\n  if (!entry.props) return;\n  if (entry.props.Directory) entry.pipe(this._db.writeStream(this._options));else if (entry.props.File || entry.File || entry.type == 'File') this._write(entry);\n  return true;\n};\n\nWriteStream.prototype._processDelayed = function () {\n  var self = this;\n  setImmediate(function () {\n    self._process();\n  });\n};\n\nWriteStream.prototype._process = function () {\n  var buffer,\n      self = this,\n      cb = function (err) {\n    if (!self.writable) return;\n    if (self._status != 'closed') self._status = 'ready';\n\n    if (err) {\n      self.writable = false;\n      return self.emit('error', err);\n    }\n\n    self._process();\n  };\n\n  if (self._status != 'ready' && self.writable) {\n    if (self._buffer.length && self._status != 'closed') self._processDelayed();\n    return;\n  }\n\n  if (self._buffer.length && self.writable) {\n    self._status = 'writing';\n    buffer = self._buffer;\n    self._buffer = [];\n\n    self._db.batch(buffer.map(function (d) {\n      return {\n        type: d.type || self._options.type,\n        key: d.key,\n        value: d.value,\n        keyEncoding: d.keyEncoding || self._options.keyEncoding,\n        valueEncoding: d.valueEncoding || d.encoding || self._options.valueEncoding\n      };\n    }), cb);\n\n    if (self._writeBlock) {\n      self._writeBlock = false;\n      self.emit('drain');\n    } // don't allow close until callback has returned\n\n\n    return;\n  }\n\n  if (self._end && self._status != 'closed') {\n    self._status = 'closed';\n    self.writable = false;\n    self.emit('close');\n  }\n};\n\nWriteStream.prototype._write = function (entry) {\n  var key = entry.path || entry.props.path,\n      self = this;\n  if (!key) return;\n  entry.pipe(bl(function (err, data) {\n    if (err) {\n      self.writable = false;\n      return self.emit('error', err);\n    }\n\n    if (self._options.fstreamRoot && key.indexOf(self._options.fstreamRoot) > -1) key = key.substr(self._options.fstreamRoot.length + 1);\n    self.write({\n      key: key,\n      value: data.slice(0)\n    });\n  }));\n};\n\nWriteStream.prototype.toString = function () {\n  return 'LevelUP.WriteStream';\n};\n\nmodule.exports = WriteStream;","map":{"version":3,"names":["Stream","require","inherits","extend","bl","setImmediate","global","process","nextTick","getOptions","defaultOptions","type","WriteStream","options","db","call","_options","_db","_buffer","_status","_end","writable","readable","self","ready","emit","_process","isOpen","once","prototype","write","data","push","_processDelayed","maxBufferLength","length","_writeBlock","end","destroy","destroySoon","add","entry","props","Directory","pipe","writeStream","File","_write","buffer","cb","err","batch","map","d","key","value","keyEncoding","valueEncoding","encoding","path","fstreamRoot","indexOf","substr","slice","toString","module","exports"],"sources":["/Users/terwer/Documents/mydocs/my-note-docker/workspace/SiYuan/data/widgets/publisher/src/publisher/node_modules/levelup/lib/write-stream.js"],"sourcesContent":["/* Copyright (c) 2012-2014 LevelUP contributors\n * See list at <https://github.com/rvagg/node-levelup#contributing>\n * MIT License\n * <https://github.com/rvagg/node-levelup/blob/master/LICENSE.md>\n */\n\nvar Stream       = require('stream').Stream\n  , inherits     = require('util').inherits\n  , extend       = require('xtend')\n  , bl           = require('bl')\n\n  , setImmediate = global.setImmediate || process.nextTick\n\n  , getOptions   = require('./util').getOptions\n\n  , defaultOptions = { type: 'put' }\n\nfunction WriteStream (options, db) {\n  if (!(this instanceof WriteStream))\n    return new WriteStream(options, db)\n\n  Stream.call(this)\n  this._options = extend(defaultOptions, getOptions(db, options))\n  this._db      = db\n  this._buffer  = []\n  this._status  = 'init'\n  this._end     = false\n  this.writable = true\n  this.readable = false\n\n  var self = this\n    , ready = function () {\n        if (!self.writable)\n          return\n        self._status = 'ready'\n        self.emit('ready')\n        self._process()\n      }\n\n  if (db.isOpen())\n    setImmediate(ready)\n  else\n    db.once('ready', ready)\n}\n\ninherits(WriteStream, Stream)\n\nWriteStream.prototype.write = function (data) {\n  if (!this.writable)\n    return false\n  this._buffer.push(data)\n  if (this._status != 'init')\n    this._processDelayed()\n  if (this._options.maxBufferLength &&\n      this._buffer.length > this._options.maxBufferLength) {\n    this._writeBlock = true\n    return false\n  }\n  return true\n}\n\nWriteStream.prototype.end = function (data) {\n  var self = this\n  if (data)\n    this.write(data)\n  setImmediate(function () {\n    self._end = true\n    self._process()\n  })\n}\n\nWriteStream.prototype.destroy = function () {\n  this.writable = false\n  this.end()\n}\n\nWriteStream.prototype.destroySoon = function () {\n  this.end()\n}\n\nWriteStream.prototype.add = function (entry) {\n  if (!entry.props)\n    return\n  if (entry.props.Directory)\n    entry.pipe(this._db.writeStream(this._options))\n  else if (entry.props.File || entry.File || entry.type == 'File')\n    this._write(entry)\n  return true\n}\n\nWriteStream.prototype._processDelayed = function () {\n  var self = this\n  setImmediate(function () {\n    self._process()\n  })\n}\n\nWriteStream.prototype._process = function () {\n  var buffer\n    , self = this\n\n    , cb = function (err) {\n        if (!self.writable)\n          return\n        if (self._status != 'closed')\n          self._status = 'ready'\n        if (err) {\n          self.writable = false\n          return self.emit('error', err)\n        }\n        self._process()\n      }\n\n  if (self._status != 'ready' && self.writable) {\n    if (self._buffer.length && self._status != 'closed')\n      self._processDelayed()\n    return\n  }\n\n  if (self._buffer.length && self.writable) {\n    self._status = 'writing'\n    buffer       = self._buffer\n    self._buffer = []\n\n    self._db.batch(buffer.map(function (d) {\n      return {\n          type          : d.type || self._options.type\n        , key           : d.key\n        , value         : d.value\n        , keyEncoding   : d.keyEncoding || self._options.keyEncoding\n        , valueEncoding : d.valueEncoding\n            || d.encoding\n            || self._options.valueEncoding\n      }\n    }), cb)\n\n    if (self._writeBlock) {\n      self._writeBlock = false\n      self.emit('drain')\n    }\n\n    // don't allow close until callback has returned\n    return\n  }\n\n  if (self._end && self._status != 'closed') {\n    self._status  = 'closed'\n    self.writable = false\n    self.emit('close')\n  }\n}\n\nWriteStream.prototype._write = function (entry) {\n  var key = entry.path || entry.props.path\n    , self = this\n\n  if (!key)\n    return\n\n  entry.pipe(bl(function (err, data) {\n    if (err) {\n      self.writable = false\n      return self.emit('error', err)\n    }\n\n    if (self._options.fstreamRoot &&\n        key.indexOf(self._options.fstreamRoot) > -1)\n      key = key.substr(self._options.fstreamRoot.length + 1)\n\n    self.write({ key: key, value: data.slice(0) })\n  }))\n}\n\nWriteStream.prototype.toString = function () {\n  return 'LevelUP.WriteStream'\n}\n\nmodule.exports = WriteStream\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}