{"ast":null,"code":"require(\"core-js/modules/es.error.cause.js\");\n\nvar util = require('util');\n\nvar AbstractIterator = require('abstract-leveldown').AbstractIterator;\n\nvar ltgt = require('ltgt');\n\nmodule.exports = Iterator;\n\nfunction Iterator(db, options) {\n  if (!options) options = {};\n  this.options = options;\n  AbstractIterator.call(this, db);\n  this._order = options.reverse ? 'DESC' : 'ASC';\n  this._limit = options.limit;\n  this._count = 0;\n  this._done = false;\n  var lower = ltgt.lowerBound(options);\n  var upper = ltgt.upperBound(options);\n\n  try {\n    this._keyRange = lower || upper ? this.db.makeKeyRange({\n      lower: lower,\n      upper: upper,\n      excludeLower: ltgt.lowerBoundExclusive(options),\n      excludeUpper: ltgt.upperBoundExclusive(options)\n    }) : null;\n  } catch (e) {\n    // The lower key is greater than the upper key.\n    // IndexedDB throws an error, but we'll just return 0 results.\n    this._keyRangeError = true;\n  }\n\n  this.callback = null;\n}\n\nutil.inherits(Iterator, AbstractIterator);\n\nIterator.prototype.createIterator = function () {\n  var self = this;\n  self.iterator = self.db.iterate(function () {\n    self.onItem.apply(self, arguments);\n  }, {\n    keyRange: self._keyRange,\n    autoContinue: false,\n    order: self._order,\n    onError: function (err) {\n      console.log('horrible error', err);\n    }\n  });\n}; // TODO the limit implementation here just ignores all reads after limit has been reached\n// it should cancel the iterator instead but I don't know how\n\n\nIterator.prototype.onItem = function (value, cursor, cursorTransaction) {\n  if (!cursor && this.callback) {\n    this.callback();\n    this.callback = false;\n    return;\n  }\n\n  var shouldCall = true;\n  if (!!this._limit && this._limit > 0 && this._count++ >= this._limit) shouldCall = false;\n  if (shouldCall) this.callback(false, cursor.key, cursor.value);\n  if (cursor) cursor['continue']();\n};\n\nIterator.prototype._next = function (callback) {\n  if (!callback) return new Error('next() requires a callback argument');\n  if (this._keyRangeError) return callback();\n\n  if (!this._started) {\n    this.createIterator();\n    this._started = true;\n  }\n\n  this.callback = callback;\n};","map":{"version":3,"names":["util","require","AbstractIterator","ltgt","module","exports","Iterator","db","options","call","_order","reverse","_limit","limit","_count","_done","lower","lowerBound","upper","upperBound","_keyRange","makeKeyRange","excludeLower","lowerBoundExclusive","excludeUpper","upperBoundExclusive","e","_keyRangeError","callback","inherits","prototype","createIterator","self","iterator","iterate","onItem","apply","arguments","keyRange","autoContinue","order","onError","err","console","log","value","cursor","cursorTransaction","shouldCall","key","_next","Error","_started"],"sources":["/Users/terwer/Documents/mydocs/my-note-docker/workspace/SiYuan/data/widgets/publisher/src/publisher/node_modules/level-js/iterator.js"],"sourcesContent":["var util = require('util')\nvar AbstractIterator  = require('abstract-leveldown').AbstractIterator\nvar ltgt = require('ltgt')\n\nmodule.exports = Iterator\n\nfunction Iterator (db, options) {\n  if (!options) options = {}\n  this.options = options\n  AbstractIterator.call(this, db)\n  this._order = options.reverse ? 'DESC': 'ASC'\n  this._limit = options.limit\n  this._count = 0\n  this._done  = false\n  var lower = ltgt.lowerBound(options)\n  var upper = ltgt.upperBound(options)\n  try {\n    this._keyRange = lower || upper ? this.db.makeKeyRange({\n      lower: lower,\n      upper: upper,\n      excludeLower: ltgt.lowerBoundExclusive(options),\n      excludeUpper: ltgt.upperBoundExclusive(options)\n    }) : null\n  } catch (e) {\n    // The lower key is greater than the upper key.\n    // IndexedDB throws an error, but we'll just return 0 results.\n    this._keyRangeError = true\n  }\n  this.callback = null\n}\n\nutil.inherits(Iterator, AbstractIterator)\n\nIterator.prototype.createIterator = function() {\n  var self = this\n\n  self.iterator = self.db.iterate(function () {\n    self.onItem.apply(self, arguments)\n  }, {\n    keyRange: self._keyRange,\n    autoContinue: false,\n    order: self._order,\n    onError: function(err) { console.log('horrible error', err) },\n  })\n}\n\n// TODO the limit implementation here just ignores all reads after limit has been reached\n// it should cancel the iterator instead but I don't know how\nIterator.prototype.onItem = function (value, cursor, cursorTransaction) {\n  if (!cursor && this.callback) {\n    this.callback()\n    this.callback = false\n    return\n  }\n  var shouldCall = true\n\n  if (!!this._limit && this._limit > 0 && this._count++ >= this._limit)\n    shouldCall = false\n\n  if (shouldCall) this.callback(false, cursor.key, cursor.value)\n  if (cursor) cursor['continue']()\n}\n\nIterator.prototype._next = function (callback) {\n  if (!callback) return new Error('next() requires a callback argument')\n  if (this._keyRangeError) return callback()\n  if (!this._started) {\n    this.createIterator()\n    this._started = true\n  }\n  this.callback = callback\n}\n"],"mappings":";;AAAA,IAAIA,IAAI,GAAGC,OAAO,CAAC,MAAD,CAAlB;;AACA,IAAIC,gBAAgB,GAAID,OAAO,CAAC,oBAAD,CAAP,CAA8BC,gBAAtD;;AACA,IAAIC,IAAI,GAAGF,OAAO,CAAC,MAAD,CAAlB;;AAEAG,MAAM,CAACC,OAAP,GAAiBC,QAAjB;;AAEA,SAASA,QAAT,CAAmBC,EAAnB,EAAuBC,OAAvB,EAAgC;EAC9B,IAAI,CAACA,OAAL,EAAcA,OAAO,GAAG,EAAV;EACd,KAAKA,OAAL,GAAeA,OAAf;EACAN,gBAAgB,CAACO,IAAjB,CAAsB,IAAtB,EAA4BF,EAA5B;EACA,KAAKG,MAAL,GAAcF,OAAO,CAACG,OAAR,GAAkB,MAAlB,GAA0B,KAAxC;EACA,KAAKC,MAAL,GAAcJ,OAAO,CAACK,KAAtB;EACA,KAAKC,MAAL,GAAc,CAAd;EACA,KAAKC,KAAL,GAAc,KAAd;EACA,IAAIC,KAAK,GAAGb,IAAI,CAACc,UAAL,CAAgBT,OAAhB,CAAZ;EACA,IAAIU,KAAK,GAAGf,IAAI,CAACgB,UAAL,CAAgBX,OAAhB,CAAZ;;EACA,IAAI;IACF,KAAKY,SAAL,GAAiBJ,KAAK,IAAIE,KAAT,GAAiB,KAAKX,EAAL,CAAQc,YAAR,CAAqB;MACrDL,KAAK,EAAEA,KAD8C;MAErDE,KAAK,EAAEA,KAF8C;MAGrDI,YAAY,EAAEnB,IAAI,CAACoB,mBAAL,CAAyBf,OAAzB,CAHuC;MAIrDgB,YAAY,EAAErB,IAAI,CAACsB,mBAAL,CAAyBjB,OAAzB;IAJuC,CAArB,CAAjB,GAKZ,IALL;EAMD,CAPD,CAOE,OAAOkB,CAAP,EAAU;IACV;IACA;IACA,KAAKC,cAAL,GAAsB,IAAtB;EACD;;EACD,KAAKC,QAAL,GAAgB,IAAhB;AACD;;AAED5B,IAAI,CAAC6B,QAAL,CAAcvB,QAAd,EAAwBJ,gBAAxB;;AAEAI,QAAQ,CAACwB,SAAT,CAAmBC,cAAnB,GAAoC,YAAW;EAC7C,IAAIC,IAAI,GAAG,IAAX;EAEAA,IAAI,CAACC,QAAL,GAAgBD,IAAI,CAACzB,EAAL,CAAQ2B,OAAR,CAAgB,YAAY;IAC1CF,IAAI,CAACG,MAAL,CAAYC,KAAZ,CAAkBJ,IAAlB,EAAwBK,SAAxB;EACD,CAFe,EAEb;IACDC,QAAQ,EAAEN,IAAI,CAACZ,SADd;IAEDmB,YAAY,EAAE,KAFb;IAGDC,KAAK,EAAER,IAAI,CAACtB,MAHX;IAID+B,OAAO,EAAE,UAASC,GAAT,EAAc;MAAEC,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA8BF,GAA9B;IAAoC;EAJ5D,CAFa,CAAhB;AAQD,CAXD,C,CAaA;AACA;;;AACApC,QAAQ,CAACwB,SAAT,CAAmBK,MAAnB,GAA4B,UAAUU,KAAV,EAAiBC,MAAjB,EAAyBC,iBAAzB,EAA4C;EACtE,IAAI,CAACD,MAAD,IAAW,KAAKlB,QAApB,EAA8B;IAC5B,KAAKA,QAAL;IACA,KAAKA,QAAL,GAAgB,KAAhB;IACA;EACD;;EACD,IAAIoB,UAAU,GAAG,IAAjB;EAEA,IAAI,CAAC,CAAC,KAAKpC,MAAP,IAAiB,KAAKA,MAAL,GAAc,CAA/B,IAAoC,KAAKE,MAAL,MAAiB,KAAKF,MAA9D,EACEoC,UAAU,GAAG,KAAb;EAEF,IAAIA,UAAJ,EAAgB,KAAKpB,QAAL,CAAc,KAAd,EAAqBkB,MAAM,CAACG,GAA5B,EAAiCH,MAAM,CAACD,KAAxC;EAChB,IAAIC,MAAJ,EAAYA,MAAM,CAAC,UAAD,CAAN;AACb,CAbD;;AAeAxC,QAAQ,CAACwB,SAAT,CAAmBoB,KAAnB,GAA2B,UAAUtB,QAAV,EAAoB;EAC7C,IAAI,CAACA,QAAL,EAAe,OAAO,IAAIuB,KAAJ,CAAU,qCAAV,CAAP;EACf,IAAI,KAAKxB,cAAT,EAAyB,OAAOC,QAAQ,EAAf;;EACzB,IAAI,CAAC,KAAKwB,QAAV,EAAoB;IAClB,KAAKrB,cAAL;IACA,KAAKqB,QAAL,GAAgB,IAAhB;EACD;;EACD,KAAKxB,QAAL,GAAgBA,QAAhB;AACD,CARD"},"metadata":{},"sourceType":"script"}