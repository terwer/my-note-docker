{"ast":null,"code":"/* Copyright (c) 2012-2014 LevelUP contributors\n * See list at <https://github.com/rvagg/node-levelup#contributing>\n * MIT License\n * <https://github.com/rvagg/node-levelup/blob/master/LICENSE.md>\n */\nvar util = require('./util'),\n    WriteError = require('./errors').WriteError,\n    getOptions = util.getOptions,\n    dispatchError = util.dispatchError;\n\nfunction Batch(levelup) {\n  this._levelup = levelup;\n  this.batch = levelup.db.batch();\n  this.ops = [];\n}\n\nBatch.prototype.put = function (key_, value_, options) {\n  options = getOptions(this._levelup, options);\n  var key = util.encodeKey(key_, options),\n      value = util.encodeValue(value_, options);\n\n  try {\n    this.batch.put(key, value);\n  } catch (e) {\n    throw new WriteError(e);\n  }\n\n  this.ops.push({\n    type: 'put',\n    key: key,\n    value: value\n  });\n  return this;\n};\n\nBatch.prototype.del = function (key_, options) {\n  options = getOptions(this._levelup, options);\n  var key = util.encodeKey(key_, options);\n\n  try {\n    this.batch.del(key);\n  } catch (err) {\n    throw new WriteError(err);\n  }\n\n  this.ops.push({\n    type: 'del',\n    key: key\n  });\n  return this;\n};\n\nBatch.prototype.clear = function () {\n  try {\n    this.batch.clear();\n  } catch (err) {\n    throw new WriteError(err);\n  }\n\n  this.ops = [];\n  return this;\n};\n\nBatch.prototype.write = function (callback) {\n  var levelup = this._levelup,\n      ops = this.ops;\n\n  try {\n    this.batch.write(function (err) {\n      if (err) return dispatchError(levelup, new WriteError(err), callback);\n      levelup.emit('batch', ops);\n      if (callback) callback();\n    });\n  } catch (err) {\n    throw new WriteError(err);\n  }\n};\n\nmodule.exports = Batch;","map":{"version":3,"names":["util","require","WriteError","getOptions","dispatchError","Batch","levelup","_levelup","batch","db","ops","prototype","put","key_","value_","options","key","encodeKey","value","encodeValue","e","push","type","del","err","clear","write","callback","emit","module","exports"],"sources":["/Users/terwer/Documents/mydocs/my-note-docker/workspace/SiYuan/data/widgets/publisher/src/publisher/node_modules/levelup/lib/batch.js"],"sourcesContent":["/* Copyright (c) 2012-2014 LevelUP contributors\n * See list at <https://github.com/rvagg/node-levelup#contributing>\n * MIT License\n * <https://github.com/rvagg/node-levelup/blob/master/LICENSE.md>\n */\n\nvar util          = require('./util')\n  , WriteError    = require('./errors').WriteError\n\n  , getOptions    = util.getOptions\n  , dispatchError = util.dispatchError\n\nfunction Batch (levelup) {\n  this._levelup = levelup\n  this.batch = levelup.db.batch()\n  this.ops = []\n}\n\nBatch.prototype.put = function (key_, value_, options) {\n  options = getOptions(this._levelup, options)\n\n  var key   = util.encodeKey(key_, options)\n    , value = util.encodeValue(value_, options)\n\n  try {\n    this.batch.put(key, value)\n  } catch (e) {\n    throw new WriteError(e)\n  }\n  this.ops.push({ type : 'put', key : key, value : value })\n\n  return this\n}\n\nBatch.prototype.del = function (key_, options) {\n  options = getOptions(this._levelup, options)\n\n  var key = util.encodeKey(key_, options)\n\n  try {\n    this.batch.del(key)\n  } catch (err) {\n    throw new WriteError(err)\n  }\n  this.ops.push({ type : 'del', key : key })\n\n  return this\n}\n\nBatch.prototype.clear = function () {\n  try {\n    this.batch.clear()\n  } catch (err) {\n    throw new WriteError(err)\n  }\n\n  this.ops = []\n  return this\n}\n\nBatch.prototype.write = function (callback) {\n  var levelup = this._levelup\n    , ops     = this.ops\n\n  try {\n    this.batch.write(function (err) {\n      if (err)\n        return dispatchError(levelup, new WriteError(err), callback)\n      levelup.emit('batch', ops)\n      if (callback)\n        callback()\n    })\n  } catch (err) {\n    throw new WriteError(err)\n  }\n}\n\nmodule.exports = Batch\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}