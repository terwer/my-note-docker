{"ast":null,"code":"require(\"core-js/modules/es.error.cause.js\");\n\nvar fixRange = require('level-fix-range'); //get the first/last record in a range\n\n\nexports = module.exports = peek;\nexports.first = first;\nexports.last = last;\n\nfunction once(emitter, events, listener) {\n  var remove = [];\n  events.forEach(function (e) {\n    function onEvent(arg) {\n      if (listener(e, arg) === false) return;\n      remove.forEach(function (r) {\n        r();\n      });\n    }\n\n    emitter.on(e, onEvent);\n    remove.push(function () {\n      emitter.removeListener(e, onEvent);\n    });\n  });\n  return emitter;\n}\n\nfunction peek(db, opts, cb) {\n  opts.limit = opts.reverse ? 2 : 1;\n  var stream = once(db.createReadStream(opts), ['data', 'error', 'end'], function (event, data) {\n    if (opts.reverse && data && opts.start && data.key.toString() > opts.start) return false;\n    if (event == 'error') cb(data);else if (event == 'end') cb(new Error('range not found'), null, null);else cb(null, data.key, data.value);\n  });\n}\n\nfunction first(db, opts, cb) {\n  if (!cb) {\n    cb = opts;\n    opts = {};\n  }\n\n  opts.reverse = false;\n  return peek(db, fixRange(opts), cb);\n} //SO, this is pretty horrible,\n//but it's works around an issue here\n//https://github.com/rvagg/node-levelup/issues/110\n\n\nfunction last(db, opts, cb) {\n  if (!cb) {\n    cb = opts;\n    opts = {};\n  }\n\n  var start = opts.start;\n  opts.reverse = true;\n  return peek(db, fixRange(opts), function (err, key, value) {\n    if (err) {\n      var _start = opts.start;\n      opts.start = null;\n      peek(db, opts, function (_, key, value) {\n        if (!key) return cb(err, null, null);\n\n        var _key = key.toString();\n\n        if (_key <= _start && (!opts.end || _key >= opts.end)) cb(_, key, value);else cb(err, null, null);\n      });\n    } else cb(err, key, value);\n  });\n}","map":{"version":3,"names":["fixRange","require","exports","module","peek","first","last","once","emitter","events","listener","remove","forEach","e","onEvent","arg","r","on","push","removeListener","db","opts","cb","limit","reverse","stream","createReadStream","event","data","start","key","toString","Error","value","err","_start","_","_key","end"],"sources":["/Users/terwer/Documents/mydocs/my-note-docker/workspace/SiYuan/data/widgets/publisher/src/publisher/node_modules/level-peek/index.js"],"sourcesContent":["var fixRange = require('level-fix-range')\n//get the first/last record in a range\n\nexports = module.exports = peek\nexports.first    = first\nexports.last     = last\n\nfunction once(emitter, events, listener) {\n  var remove = []\n  events.forEach(function (e) {\n    function onEvent (arg) {\n      if(listener(e, arg) === false) return\n      remove.forEach(function (r) {\n        r()\n      })\n    }\n    emitter.on(e, onEvent)\n    remove.push(function () {\n      emitter.removeListener(e, onEvent)\n    })\n  })\n  return emitter\n}\n\n\nfunction peek (db, opts, cb) {\n  opts.limit = opts.reverse ? 2 : 1\n  var stream = once(db.createReadStream(opts), \n    ['data', 'error', 'end'],\n    function (event, data) {\n      if(opts.reverse && data && opts.start \n        && (data.key.toString() > opts.start))\n        return false\n      if(event == 'error') cb(data)\n      else if(event == 'end') cb(new Error('range not found'), null, null)\n      else cb(null, data.key, data.value)\n    })\n}\n\nfunction first (db, opts, cb) {\n  if (!cb) {\n    cb = opts;\n    opts = {};\n  }\n  opts.reverse = false\n  return peek(db, fixRange(opts), cb)  \n}\n\n//SO, this is pretty horrible,\n//but it's works around an issue here\n//https://github.com/rvagg/node-levelup/issues/110\n\nfunction last (db, opts, cb) {\n  if (!cb) {\n    cb = opts;\n    opts = {};\n  }\n  var start = opts.start\n  opts.reverse = true\n  return peek(db, fixRange(opts), function (err, key, value) {\n    if(err) {\n      var _start = opts.start\n      opts.start = null\n      peek (db, opts, function (_, key, value) {\n        if(!key) return cb(err, null, null)\n        var _key = key.toString()\n        if(_key <= _start && (!opts.end || _key >= opts.end))\n          cb(_, key, value)\n        else cb(err, null, null)\n      })\n    }\n    else cb(err, key, value)\n  })\n}\n\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}