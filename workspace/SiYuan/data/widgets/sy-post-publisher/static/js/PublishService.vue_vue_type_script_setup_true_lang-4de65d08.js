var ga=Object.defineProperty;var ma=(n,o,l)=>o in n?ga(n,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[o]=l;var me=(n,o,l)=>(ma(n,typeof o!="symbol"?o+"":o,l),l);import{p as St,q as kt,f as Oe,a as Re,h as Me,g as Be,r as ut,e as We,b as fa,k as ya,l as ba,n as Tt,o as vt,E as K,d as at,s as nt,t as va,u as _a,v as Vt,w as $t,x as It,y as Dt,z as Pt,A as At,B as aa,C as Ut}from"./vendor_element-plus-93a388b3.js";import{L as we,j as Ye,k as ke,D as tt,l as Xt,n as Qt,o as ha,s as Zt,q as xe,t as wa,u as Ct,d as st,v as he,w as Xe,x as Ca,y as $e,z as Ea,A as Sa,B as ka,a as _t,E as se,F as lt,G as ot,H as Qe,I as it,J as _e,K as Ne,P as Bt,M as Je,N as rt,V as Ta,O as te,Q as la,R as Ft,T as Kt,U as Yt,W as Ot,X as Mt,Y as Lt,Z as xt,$ as Nt,r as Rt,C as Ht,m as oa,a0 as ua,e as Va,a1 as $a,a2 as Ia,a3 as Da}from"./api-3ee276f0.js";import{u as He}from"./vendor_vue-i18n-5b80ab8c.js";import{M as ue,bH as Pa,bI as Aa,A as Fe,O as u,P as de,a1 as e,U as t,a0 as Ce,ao as Ee,y as N,_ as Y,$ as I,u as p,ac as Te,T as i,Z as h,z as pt,F as Ue,W as je,K as na,V as Ua,a2 as Ba,ap as Gt,a8 as bt}from"./vendor-a9bad54d.js";import{d as Fa}from"./vendor_pinia-306dd1ce.js";import{d as jt}from"./vendor_shorthash2-e60185c0.js";import{j as sa}from"./vendor_js-yaml-c400b4ba.js";import{c as Ka}from"./vendor_copy-to-clipboard-a51858f9.js";import{f as Ya}from"./vendor_rollup-plugin-node-polyfills-2747d496.js";import{f as Oa}from"./vendor_cross-fetch-e4e57030.js";const qe=we.getLogger(),Et=function(n,o){return n.setTime(n.getTime()+o*60*60*1e3),n},Ma=(n,o)=>{if(!n)return"";let l=n;const d=/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(.\d{3})Z$/gm,g=l.match(d);if(g==null)return"";for(let w=0;w<g.length;w++){const y=g[w];let T=y;o&&(qe.debug("\u4FEE\u590D\u65F6\u533A\uFF0CISO\u65E5\u671F\u9ED8\u8BA4\u665A8\u5C0F\u65F6"),qe.debug(Et(new Date(y),8)),T=Et(new Date(y),8).toISOString());const A=T.split("T"),c=A[0].replaceAll(/-/g,""),V=A[1].split(".")[0].replaceAll(/:/g,""),$=c+V;l=l.replace(y,$),qe.debug("formatIsoDate match=>",y),qe.debug("formatIsoDate result=>",$)}return l},ea=(n,o,l)=>{if(!n)return"";let d=n;const g=/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(.\d{3})Z$/gm,w=d.match(g);if(w==null)return"";for(let y=0;y<w.length;y++){const T=w[y];let A=T;o&&(A=Et(new Date(T),8).toISOString());const c=A.split("T"),V=c[0],$=c[1].split(".")[0];let D=V+" "+$;l&&(D=V),d=d.replace(T,D)}return d},ht=n=>{if(!n)return"";const l=n.replace(/\D/g,""),d=l.slice(0,4),g=l.slice(4,6),w=l.slice(6,8),y=l.slice(8,10),T=l.slice(10,12),A=l.slice(12,14);let c=d;return g?w?y?T?A?c=d+"-"+g+"-"+w+" "+y+":"+T+":"+A:c=d+"-"+g+"-"+w+" "+y+":"+T:c=d+"-"+g+"-"+w+" "+y:c=d+"-"+g+"-"+w:c=d+"-"+g:c=d,qe.debug("formatNumToZhDate str=>",n),qe.debug("formatNumToZhDate datestr=>",c),c},La=(n,o)=>typeof n=="string"?new Date(new Date(n).toLocaleString("zh-CN",{timeZone:o})):new Date(n.toLocaleString("zh-CN",{timeZone:o})),ia=n=>{const o=ht(n);return qe.debug("datestr=>",o),La(o,"Asia/Shanghai")},Na=function(n){const o=Ma(n,!0),l=ia(o),g=(new Date().getTime()-l.getTime())/1e3;return parseInt(g.toString())},Ra={class:"locale-changer"},Ha=ue({__name:"ChangeLocale",setup(n){const o=we.getLogger("components/publish/tab/ChangeLocale.vue"),{locale:l}=He(),d=[{value:"zh_CN",label:"\u7B80\u4F53\u4E2D\u6587"},{value:"en_US",label:"English"}],g=Pa(),w=Aa(g),y=T=>{o.debug("langChanged=>",T),localStorage.Lang=T,l.value=T};return Fe(()=>{localStorage.Lang!=null&&(l.value=localStorage.Lang)}),(T,A)=>{const c=St,V=kt,$=Oe,D=Re,W=Me;return u(),de("div",Ra,[e(W,{"label-width":"120px"},{default:t(()=>[e($,{label:T.$t("lang.choose")},{default:t(()=>[e(V,{placeholder:T.$t("lang.choose.placeholder"),modelValue:T.$i18n.locale,"onUpdate:modelValue":A[0]||(A[0]=R=>T.$i18n.locale=R),onChange:y},{default:t(()=>[(u(),de(Ce,null,Ee(d,(R,G)=>e(c,{key:G,label:R.label,value:R.value},null,8,["label","value"])),64))]),_:1},8,["placeholder","modelValue"])]),_:1},8,["label"]),e($,{label:T.$t("theme.mode.choose")},{default:t(()=>[e(D,{type:"primary",onClick:A[1]||(A[1]=R=>N(w)())},{default:t(()=>[Y(I(N(g)?T.$t("theme.mode.light"):T.$t("theme.mode.dark")),1)]),_:1})]),_:1},8,["label"])]),_:1})])}}}),Ga=ue({__name:"DynamicPlatform",setup(n){const o=we.getLogger("components/publish/tab/DynamicPlatform.vue"),{t:l}=He(),d=p(!0),g=Ye.Github_Jekyll,w=p(),y=Te({subtype:g,ptype:ke.Github,dynCfg:new tt(ke.Github,Xt(ke.Github,g),"Jekyll-1"),subtypeOptions:[],dynamicConfigArray:[]}),T=Te({platformName:[{required:!0,message:()=>l("form.validate.name.required")}]}),A=f=>{y.subtype=f,o.debug(y.subtype),c(y.ptype)},c=f=>{y.ptype=f,y.subtypeOptions=Qt(f);const a=ha(f,y.subtype,y.subtypeOptions.length>0&&y.subtype!==Ye.NONE);y.dynCfg=new tt(f,Xt(f,y.subtypeOptions.length>0?y.subtype:Ye.NONE),a),d.value=y.ptype!==ke.Custom,o.debug(y.ptype)},V=f=>{if(y.ptype===ke.Custom)return K.error(l("dynamic.platform.opt.noselect")),!1;const a=y.dynCfg.platformKey;if(o.debug("\u5C06\u8981\u4FDD\u5B58\u7684\u5E73\u53F0key",a),wa(y.dynamicConfigArray,a))return K.error(l("dynamic.platform.opt.key.exist")),!1;const b="switch-"+a,r="custom-"+a+"-post-id";return Ct(a)||Ct(b)||Ct(r)?(K.error(l("dynamic.platform.opt.key.exist")),!1):!0},$=async f=>{if(!f||!V()||!await f.validate((r,C)=>{r?o.debug("\u6821\u9A8C\u6210\u529F"):o.error(l("main.opt.failure"),C)}))return;const b=new tt(y.ptype,y.dynCfg.platformKey,y.dynCfg.platformName);b.subPlatformType=y.subtype,y.dynamicConfigArray.push(b),Zt(y.dynamicConfigArray),v(),K.success(l("main.opt.success"))},D=[],W=p(0),R=p(),G=p(l("dynamic.platform.opt.item.select")),M=f=>{R.value=f,G.value=l("dynamic.platform.opt.item.select.tip")+R.value.plantformName,o.debug(R.value)},X=async()=>{at.confirm(l("dynamic.platform.opt.del.confirm"),l("main.opt.warning"),{confirmButtonText:l("main.opt.ok"),cancelButtonText:l("main.opt.cancel"),type:"warning"}).then(async()=>{if(!R.value||!R.value.plantformKey){K.error(l("dynamic.platform.opt.item.no.select.tip"));return}for(let f=0;f<y.dynamicConfigArray.length;f++)R.value.plantformKey===y.dynamicConfigArray[f].plantformKey&&y.dynamicConfigArray.splice(f,1);Zt(y.dynamicConfigArray),v(),K.success(l("main.opt.success"))}).catch(()=>{})},v=()=>{D.length=0;for(let f=0;f<y.dynamicConfigArray.length;f++)D.push(y.dynamicConfigArray[f]);W.value=y.dynamicConfigArray.length},s=async()=>{y.subtypeOptions=Qt(ke.Github),y.dynamicConfigArray=xe().totalCfg||[],v(),o.debug("dynamic init page=>",y.dynamicConfigArray)};return Fe(async()=>{await s()}),(f,a)=>{const b=Be,r=Re,C=ut,x=Oe,ve=St,S=kt,P=We,U=Me,q=fa,L=ya,ee=ba,ce=Tt,J=vt;return u(),i(J,null,{default:t(()=>[e(q,{height:"300px",class:"publish-dyn-header"},{default:t(()=>[e(U,{"label-width":"165px",ref_key:"formRef",ref:w,model:y.dynCfg,rules:T},{default:t(()=>[e(b,{class:"top-version-tip",title:f.$t("dynamic.platform.tip"),type:"info",closable:!1},null,8,["title"]),e(x,{label:f.$t("dynamic.platform.type")},{default:t(()=>[e(C,null,{default:t(()=>[e(r,{type:y.ptype===N(ke).Github?"primary":"",onClick:a[0]||(a[0]=ge=>c(N(ke).Github))},{default:t(()=>[Y(I(f.$t("dynamic.platform.type.github")),1)]),_:1},8,["type"]),e(r,{type:y.ptype===N(ke).Metaweblog?"primary":"",onClick:a[1]||(a[1]=ge=>c(N(ke).Metaweblog))},{default:t(()=>[Y(I(f.$t("dynamic.platform.type.metaweblog")),1)]),_:1},8,["type"]),e(r,{type:y.ptype===N(ke).Wordpress?"primary":"",onClick:a[2]||(a[2]=ge=>c(N(ke).Wordpress))},{default:t(()=>[Y(I(f.$t("dynamic.platform.type.wordpress")),1)]),_:1},8,["type"]),e(r,{type:y.ptype===N(ke).Custom?"primary":"",onClick:a[3]||(a[3]=ge=>c(N(ke).Custom))},{default:t(()=>[Y(I(f.$t("dynamic.platform.type.custom")),1)]),_:1},8,["type"])]),_:1})]),_:1},8,["label"]),d.value?h("",!0):(u(),i(x,{key:0},{default:t(()=>[e(b,{title:"\u656C\u8BF7\u671F\u5F85",type:"info",closable:!1})]),_:1})),y.subtypeOptions.length>0&&d.value?(u(),i(x,{key:1},{default:t(()=>[e(S,{modelValue:y.subtype,"onUpdate:modelValue":a[4]||(a[4]=ge=>y.subtype=ge),class:"m-2",placeholder:"Select",onChange:A},{default:t(()=>[(u(!0),de(Ce,null,Ee(y.subtypeOptions,ge=>(u(),i(ve,{key:ge,label:ge,value:ge},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):h("",!0),d.value?(u(),i(x,{key:2,label:y.ptype+f.$t("dynamic.platform.name"),prop:"platformName"},{default:t(()=>[e(P,{modelValue:y.dynCfg.platformName,"onUpdate:modelValue":a[5]||(a[5]=ge=>y.dynCfg.platformName=ge),placeholder:f.$t("dynamic.platform.name.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):h("",!0),h("",!0),d.value?(u(),i(x,{key:4},{default:t(()=>[e(r,{type:"primary",onClick:a[6]||(a[6]=ge=>$(w.value))},{default:t(()=>[Y(I(f.$t("dynamic.platform.opt.add")),1)]),_:1})]),_:1})):h("",!0)]),_:1},8,["model","rules"])]),_:1}),e(ce,{class:"dyn-table-list"},{default:t(()=>[e(x,null,{default:t(()=>[(u(),i(ee,{data:D,key:W.value,border:"",stripe:"","highlight-current-row":"","empty-text":"\u6682\u65E0\u6570\u636E",onCurrentChange:M},{default:t(()=>[e(L,{prop:"platformType",label:f.$t("dynamic.platform.type")},null,8,["label"]),e(L,{prop:"subPlatformType",label:f.$t("dynamic.platform.subtype")},null,8,["label"]),e(L,{prop:"platformKey",label:f.$t("dynamic.platform.key")},null,8,["label"]),e(L,{prop:"platformName",label:f.$t("dynamic.platform.name")},null,8,["label"])]),_:1}))]),_:1}),e(x,null,{default:t(()=>[R.value?(u(),i(b,{key:0,class:"top-version-tip",title:G.value,type:"info",closable:!1},null,8,["title"])):h("",!0),e(r,{type:"danger",onClick:X},{default:t(()=>[Y(I(f.$t("dynamic.platform.opt.del.select")),1)]),_:1})]),_:1})]),_:1})]),_:1})}}});const ja=st(Ga,[["__scopeId","data-v-1d4ce42b"]]),Wa=Fa("tabCount",()=>{const n=p(0);function o(){n.value=0}function l(d){d&&n.value++}return{tabCount:n,resetCount:o,incrementIf:l}}),qa="switch-vuepress",Ja="switch-hugo",za="switch-hexo",Xa="switch-jekyll",Qa="switch-jvue",Za="switch-conf",xa="switch-cnblogs",el="switch-wordpress",tl="switch-liandi",al="switch-yuque",ll="switch-kms",fe={SWITCH_VUEPRESS_KEY:qa,SWITCH_HUGO_KEY:Ja,SWITCH_HEXO_KEY:za,SWITCH_JEKYLL_KEY:Xa,SWITCH_JVUE_KEY:Qa,SWITCH_CONF_KEY:Za,SWITCH_CNBLOGS_KEY:xa,SWITCH_WORDPRESS_KEY:el,SWITCH_LIANDI_KEY:tl,SWITCH_YUQUE_KEY:al,SWITCH_KMS_KEY:ll};function wt(){const n=Wa(),o=p(!1),l=p(!1),d=p(!1),g=p(!1),w=p(!1),y=p(!1),T=p(!1),A=p(!1),c=p(!1),V=p(!1),$=p(!1),D=Te({dynamicConfigArray:[]});function W(){n.resetCount(),o.value=he(fe.SWITCH_VUEPRESS_KEY),n.incrementIf(o.value),l.value=he(fe.SWITCH_HUGO_KEY),n.incrementIf(l.value),d.value=he(fe.SWITCH_HEXO_KEY),n.incrementIf(d.value),g.value=he(fe.SWITCH_JEKYLL_KEY),n.incrementIf(g.value),w.value=he(fe.SWITCH_JVUE_KEY),n.incrementIf(w.value),y.value=he(fe.SWITCH_CONF_KEY),n.incrementIf(y.value),T.value=he(fe.SWITCH_CNBLOGS_KEY),n.incrementIf(T.value),A.value=he(fe.SWITCH_WORDPRESS_KEY),n.incrementIf(A.value),c.value=he(fe.SWITCH_LIANDI_KEY),n.incrementIf(c.value),V.value=he(fe.SWITCH_YUQUE_KEY),n.incrementIf(V.value),$.value=he(fe.SWITCH_KMS_KEY),n.incrementIf($.value);const G=xe().totalCfg||[];D.dynamicConfigArray=[],G.forEach(M=>{const X=Xe(M.platformKey),v=he(X);M.modelValue=Ca({switchKey:M.platformKey,switchValue:v}),n.incrementIf(v),D.dynamicConfigArray.push(M)})}return{tabCountStore:n,vuepressEnabled:o,hugoEnabled:l,hexoEnabled:d,jekyllEnabled:g,jvueEnabled:w,confEnabled:y,cnblogsEnabled:T,wordpressEnabled:A,liandiEnabled:c,yuqueEnabled:V,kmsEnabled:$,switchFormData:D,doCount:W}}const ol={key:0},ul=ue({__name:"ServiceSwitch",props:{isReload:{type:Boolean,default:!1}},setup(n){const o=n,l=we.getLogger("components/publish/tab/ServiceSwitch.vue"),{tabCountStore:d,vuepressEnabled:g,hugoEnabled:w,hexoEnabled:y,jekyllEnabled:T,jvueEnabled:A,confEnabled:c,cnblogsEnabled:V,wordpressEnabled:$,liandiEnabled:D,yuqueEnabled:W,kmsEnabled:R,switchFormData:G,doCount:M}=wt(),X=p(!1),v=L=>{$e(fe.SWITCH_VUEPRESS_KEY,L),q()},s=L=>{$e(fe.SWITCH_HUGO_KEY,L),q()},f=L=>{$e(fe.SWITCH_HEXO_KEY,L),q()},a=L=>{$e(fe.SWITCH_JEKYLL_KEY,L),q()},b=L=>{$e(fe.SWITCH_JVUE_KEY,L),q()},r=L=>{$e(fe.SWITCH_CONF_KEY,L),q()},C=L=>{$e(fe.SWITCH_CNBLOGS_KEY,L),q()},x=L=>{$e(fe.SWITCH_WORDPRESS_KEY,L),q()},ve=L=>{$e(fe.SWITCH_LIANDI_KEY,L),q()},S=L=>{$e(fe.SWITCH_YUQUE_KEY,L),q()},P=L=>{$e(fe.SWITCH_KMS_KEY,L),q()},U=L=>{l.warn("dynamicOnChange,val=>",L);const ee=ka(L);$e(ee.switchKey,ee.switchValue),q()},q=()=>{M(),d.tabCount===0?X.value=!0:X.value=!1};return pt(()=>o.isReload,async(L,ee)=>{q()}),Fe(()=>{q()}),(L,ee)=>{const ce=nt,J=Oe,ge=Be,Pe=Me;return u(),i(Pe,{class:"switch-form",inline:""},{default:t(()=>[e(J,{label:L.$t("service.switch.vuepress")},{default:t(()=>[e(ce,{modelValue:N(g),"onUpdate:modelValue":ee[0]||(ee[0]=le=>Ue(g)?g.value=le:null),onChange:v},null,8,["modelValue"])]),_:1},8,["label"]),e(J,{label:L.$t("service.switch.hugo")},{default:t(()=>[e(ce,{modelValue:N(w),"onUpdate:modelValue":ee[1]||(ee[1]=le=>Ue(w)?w.value=le:null),onChange:s},null,8,["modelValue"])]),_:1},8,["label"]),e(J,{label:L.$t("service.switch.hexo")},{default:t(()=>[e(ce,{modelValue:N(y),"onUpdate:modelValue":ee[2]||(ee[2]=le=>Ue(y)?y.value=le:null),onChange:f},null,8,["modelValue"])]),_:1},8,["label"]),e(J,{label:L.$t("service.switch.jekyll")},{default:t(()=>[e(ce,{modelValue:N(T),"onUpdate:modelValue":ee[3]||(ee[3]=le=>Ue(T)?T.value=le:null),onChange:a},null,8,["modelValue"])]),_:1},8,["label"]),e(J,{label:L.$t("service.switch.jvue")},{default:t(()=>[e(ce,{modelValue:N(A),"onUpdate:modelValue":ee[4]||(ee[4]=le=>Ue(A)?A.value=le:null),onChange:b},null,8,["modelValue"])]),_:1},8,["label"]),e(J,{label:L.$t("service.switch.conf")},{default:t(()=>[e(ce,{modelValue:N(c),"onUpdate:modelValue":ee[5]||(ee[5]=le=>Ue(c)?c.value=le:null),onChange:r},null,8,["modelValue"])]),_:1},8,["label"]),e(J,{label:L.$t("service.switch.cnblogs")},{default:t(()=>[e(ce,{modelValue:N(V),"onUpdate:modelValue":ee[6]||(ee[6]=le=>Ue(V)?V.value=le:null),onChange:C},null,8,["modelValue"])]),_:1},8,["label"]),e(J,{label:L.$t("service.switch.wordpress")},{default:t(()=>[e(ce,{modelValue:N($),"onUpdate:modelValue":ee[7]||(ee[7]=le=>Ue($)?$.value=le:null),onChange:x},null,8,["modelValue"])]),_:1},8,["label"]),e(J,{label:L.$t("service.switch.liandi")},{default:t(()=>[e(ce,{modelValue:N(D),"onUpdate:modelValue":ee[8]||(ee[8]=le=>Ue(D)?D.value=le:null),onChange:ve},null,8,["modelValue"])]),_:1},8,["label"]),e(J,{label:L.$t("service.switch.yuque")},{default:t(()=>[e(ce,{modelValue:N(W),"onUpdate:modelValue":ee[9]||(ee[9]=le=>Ue(W)?W.value=le:null),onChange:S},null,8,["modelValue"])]),_:1},8,["label"]),e(J,{label:L.$t("service.switch.kms")},{default:t(()=>[e(ce,{modelValue:N(R),"onUpdate:modelValue":ee[10]||(ee[10]=le=>Ue(R)?R.value=le:null),onChange:P},null,8,["modelValue"])]),_:1},8,["label"]),(u(!0),de(Ce,null,Ee(N(G).dynamicConfigArray,le=>(u(),i(J,{key:le.posid,label:le.platformName},{default:t(()=>[e(ce,{modelValue:le.modelValue,"onUpdate:modelValue":Ke=>le.modelValue=Ke,"active-value":N(Ea)(le.platformKey),"inactive-value":N(Sa)(le.platformKey),onChange:U},null,8,["modelValue","onUpdate:modelValue","active-value","inactive-value"])]),_:2},1032,["label"]))),128)),X.value?(u(),de("div",ol,[je("p",null,[e(ge,{title:L.$t("platform.must.select.one"),type:"error",closable:!1},null,8,["title"])])])):h("",!0)]),_:1})}}});const nl=st(ul,[["__scopeId","data-v-498a279c"]]),sl={key:1},il={name:"PostBind"},rl=ue({...il,props:{isReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(n){const o=n,l=we.getLogger("components/publish/tab/PostBind.vue"),{t:d}=He(),{tabCountStore:g,vuepressEnabled:w,hugoEnabled:y,hexoEnabled:T,jekyllEnabled:A,jvueEnabled:c,confEnabled:V,cnblogsEnabled:$,wordpressEnabled:D,liandiEnabled:W,yuqueEnabled:R,kmsEnabled:G,doCount:M}=wt(),X=Te({dynamicConfigArray:[]}),v=()=>{M();const P=xe().totalCfg||[];X.dynamicConfigArray.length=0,P.forEach(U=>{const q=Xe(U.platformKey);U.modelValue=he(q),X.dynamicConfigArray.push(U)}),l.debug(X.dynamicConfigArray)};pt(()=>o.isReload,async(S,P)=>{v(),await r()}),na(async()=>{v(),await r()}),Fe(()=>{});const s={pageId:"",meta:{}},f=p(),a=Te({vuepressSlug:"",hugoSlug:"",hexoSlug:"",jekyllSlug:"",jvuePostid:"",cnblogsPostid:"",confPostid:"",wordpressPostid:"",liandiPostid:"",yuquePostid:"",kmsPostid:""}),b=Te({});async function r(){const S=await _t(!0,o.pageId);if(l.debug("PostBind pageId=>",S),!S||S==="")return;const U=await new ot().getBlockAttrs(S);s.pageId=S,s.meta=U,a.vuepressSlug=U[se.VUEPRESS_POSTID_KEY],a.hugoSlug=U[se.HUGO_POSTID_KEY],a.hexoSlug=U[se.HEXO_POSTID_KEY],a.jekyllSlug=U[se.JEKYLL_POSTID_KEY],a.jvuePostid=U[se.JVUE_POSTID_KEY],a.confPostid=U[se.CONFLUENCE_POSTID_KEY],a.cnblogsPostid=U[se.CNBLOGS_POSTID_KEY],a.wordpressPostid=U[se.WORDPRESS_POSTID_KEY],a.liandiPostid=U[se.LIANDI_POSTID_KEY],a.yuquePostid=U[se.YUQUE_POSTID_KEY],a.kmsPostid=U[se.KMS_POSTID_KEY];const q=X.dynamicConfigArray;X.dynamicConfigArray=[],q.forEach(L=>{const ee=lt(L.platformKey);L.posid=U[ee]||"",X.dynamicConfigArray.push(L)})}const C=(S,P,U,q)=>{S&&!Qe(q)?Object.assign(P,{[U]:q}):Object.assign(P,{[U]:""})},x=async S=>{if(!(!S||!await S.validate((U,q)=>{U?l.debug("\u6821\u9A8C\u6210\u529F"):l.error(d("main.opt.failure"),q)})))try{const U={};C(w.value,U,se.VUEPRESS_POSTID_KEY,a.vuepressSlug),C(y.value,U,se.HUGO_POSTID_KEY,a.hugoSlug),C(T.value,U,se.HEXO_POSTID_KEY,a.hexoSlug),C(A.value,U,se.JEKYLL_POSTID_KEY,a.jekyllSlug),C(c.value,U,se.JVUE_POSTID_KEY,a.jvuePostid),C(V.value,U,se.CONFLUENCE_POSTID_KEY,a.confPostid),C($.value,U,se.CNBLOGS_POSTID_KEY,a.cnblogsPostid),C(D.value,U,se.WORDPRESS_POSTID_KEY,a.wordpressPostid),C(W.value,U,se.LIANDI_POSTID_KEY,a.liandiPostid),C(R.value,U,se.YUQUE_POSTID_KEY,a.yuquePostid),C(G.value,U,se.KMS_POSTID_KEY,a.kmsPostid),X.dynamicConfigArray.forEach(L=>{const ee=lt(L.plantformKey);C(L.modelValue,U,ee,L.posid)}),l.debug("PostBind\u4FDD\u5B58\u5C5E\u6027\u5230\u601D\u6E90\u7B14\u8BB0,meta=>",U),await new ot().setBlockAttrs(s.pageId,U),K.success(d("main.opt.success"))}catch(U){l.error("\u4FDD\u5B58\u5F02\u5E38",U);let q="\u4FDD\u5B58\u5F02\u5E38";U&&(q=U.toString()),K.error({dangerouslyUseHTMLString:!0,message:d("main.opt.failure")+"=>"+q})}},ve=S=>{!S||S.resetFields()};return(S,P)=>{const U=We,q=Oe,L=Re,ee=Me,ce=Be;return N(g).tabCount>0?(u(),i(ee,{key:0,"label-width":"85px",class:"post-bind-form",ref_key:"ruleFormRef",ref:f,model:a,rules:b,"status-icon":""},{default:t(()=>[N(w)?(u(),i(q,{key:0,label:S.$t("post.bind.vuepress.slug"),prop:"vuepressSlug"},{default:t(()=>[e(U,{modelValue:a.vuepressSlug,"onUpdate:modelValue":P[0]||(P[0]=J=>a.vuepressSlug=J)},null,8,["modelValue"])]),_:1},8,["label"])):h("",!0),N(y)?(u(),i(q,{key:1,label:S.$t("post.bind.hugo.slug"),prop:"hugoSlug"},{default:t(()=>[e(U,{modelValue:a.hugoSlug,"onUpdate:modelValue":P[1]||(P[1]=J=>a.hugoSlug=J)},null,8,["modelValue"])]),_:1},8,["label"])):h("",!0),N(T)?(u(),i(q,{key:2,label:S.$t("post.bind.hexo.slug"),prop:"hexosSlug"},{default:t(()=>[e(U,{modelValue:a.hexoSlug,"onUpdate:modelValue":P[2]||(P[2]=J=>a.hexoSlug=J)},null,8,["modelValue"])]),_:1},8,["label"])):h("",!0),N(A)?(u(),i(q,{key:3,label:S.$t("post.bind.jekyll.slug"),prop:"jekyllSlug"},{default:t(()=>[e(U,{modelValue:a.jekyllSlug,"onUpdate:modelValue":P[3]||(P[3]=J=>a.jekyllSlug=J)},null,8,["modelValue"])]),_:1},8,["label"])):h("",!0),N(c)?(u(),i(q,{key:4,label:S.$t("post.bind.jvue.postid"),prop:"jvuePostid"},{default:t(()=>[e(U,{modelValue:a.jvuePostid,"onUpdate:modelValue":P[4]||(P[4]=J=>a.jvuePostid=J)},null,8,["modelValue"])]),_:1},8,["label"])):h("",!0),N(V)?(u(),i(q,{key:5,label:S.$t("post.bind.conf.postid"),prop:"confPostid"},{default:t(()=>[e(U,{modelValue:a.confPostid,"onUpdate:modelValue":P[5]||(P[5]=J=>a.confPostid=J)},null,8,["modelValue"])]),_:1},8,["label"])):h("",!0),N($)?(u(),i(q,{key:6,label:S.$t("post.bind.cnblogs.postid"),prop:"cnblogsPostid"},{default:t(()=>[e(U,{modelValue:a.cnblogsPostid,"onUpdate:modelValue":P[6]||(P[6]=J=>a.cnblogsPostid=J)},null,8,["modelValue"])]),_:1},8,["label"])):h("",!0),N(D)?(u(),i(q,{key:7,label:S.$t("post.bind.wordpress.postid"),prop:"wordpressPostid"},{default:t(()=>[e(U,{modelValue:a.wordpressPostid,"onUpdate:modelValue":P[7]||(P[7]=J=>a.wordpressPostid=J)},null,8,["modelValue"])]),_:1},8,["label"])):h("",!0),N(W)?(u(),i(q,{key:8,label:S.$t("post.bind.liandi.postid"),prop:"liandiPostid"},{default:t(()=>[e(U,{modelValue:a.liandiPostid,"onUpdate:modelValue":P[8]||(P[8]=J=>a.liandiPostid=J)},null,8,["modelValue"])]),_:1},8,["label"])):h("",!0),N(R)?(u(),i(q,{key:9,label:S.$t("post.bind.yuque.postid"),prop:"yuquePostid"},{default:t(()=>[e(U,{modelValue:a.yuquePostid,"onUpdate:modelValue":P[9]||(P[9]=J=>a.yuquePostid=J)},null,8,["modelValue"])]),_:1},8,["label"])):h("",!0),N(G)?(u(),i(q,{key:10,label:S.$t("post.bind.kms.postid"),prop:"kmsPostid"},{default:t(()=>[e(U,{modelValue:a.kmsPostid,"onUpdate:modelValue":P[10]||(P[10]=J=>a.kmsPostid=J)},null,8,["modelValue"])]),_:1},8,["label"])):h("",!0),(u(!0),de(Ce,null,Ee(X.dynamicConfigArray,(J,ge)=>Ua((u(),i(q,{key:ge,label:J.platformName},{default:t(()=>[e(U,{modelValue:J.posid,"onUpdate:modelValue":Pe=>J.posid=Pe},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])),[[Ba,J.modelValue]])),128)),e(q,null,{default:t(()=>[e(L,{type:"primary",onClick:P[11]||(P[11]=J=>x(f.value))},{default:t(()=>[Y(I(S.$t("post.bind.conf.save")),1)]),_:1}),e(L,{onClick:P[12]||(P[12]=J=>ve(f.value))},{default:t(()=>[Y(I(S.$t("post.bind.conf.cancel")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])):(u(),de("div",sl,[e(ce,{class:"top-version-tip",title:S.$t("config.platform.none"),type:"error",closable:!1},null,8,["title"])]))}}});const pl=st(rl,[["__scopeId","data-v-18a3a586"]]);class dl extends it{constructor(o){switch(super("","","",""),this.previewUrl="/post/[postid].html",this.posidKey=lt(o.platformKey),o.subPlatformType){case Ye.Github_Vuepress:this.defaultPath="docs";break;case Ye.Github_Hugo:this.defaultPath="content/post";break;case Ye.Github_Hexo:this.defaultPath="source/_posts",this.previewUrl="/[date]/[postid]/";break;case Ye.Github_Jekyll:this.defaultPath="_posts",this.previewUrl="/[cats]/[date]/[postid].html";break;case Ye.Github_Vitepress:this.defaultPath="docs";break;case Ye.Github_Nuxt:this.defaultPath="content";break;case Ye.Github_Next:this.defaultPath="pages";break}}}var Se=(n=>(n[n.Markdown=0]="Markdown",n[n.Html=1]="Html",n))(Se||{});class ze{constructor(o,l,d,g){me(this,"home");me(this,"apiUrl");me(this,"username");me(this,"password");me(this,"apiStatus");me(this,"blogName");me(this,"posidKey");me(this,"previewUrl");me(this,"pageType");this.home=o,this.apiUrl=l,this.username=d,this.password=g,this.apiStatus=!1,this.blogName="",this.posidKey="",this.previewUrl="",this.pageType=Se.Markdown}}class cl extends ze{constructor(o){super("","","",""),this.posidKey=o,this.previewUrl="/p/[postid].html",this.pageType=Se.Html}}class gl extends ze{constructor(o){super("http://localhost:8000","http://localhost:8000/xmlrpc.php","",""),this.posidKey=o,this.previewUrl="/?p=[postid]",this.pageType=Se.Html}}const ml={class:"github-setting-basic"},fl={href:"https://github.com/settings/tokens/new",target:"_blank"},yl={key:0,class:"github-setting-advanced"},dt=ue({__name:"GithubSetting",props:{isReload:{type:Boolean,default:!1},apiType:{type:String,default:""},cfg:{type:it,default:null}},setup(n){const o=n,l=we.getLogger("components/publish/tab/setting/GithubSetting.vue"),{t:d}=He(),g=p(!1),w=p(!1),y=p(!1),T=p(!0),A=p(),c=Te({githubUser:"",githubRepo:"",githubToken:"",defaultBranch:"main",defaultPath:"docs/_posts",msg:"auto published by sy-post-publisher",author:"terwer",email:"youweics@163.com",previewUrl:""}),V=Te({githubUser:[{required:!0,message:()=>d("form.validate.name.required")}],githubRepo:[{required:!0,message:()=>d("form.validate.name.required")}],githubToken:[{required:!0,message:()=>d("form.validate.name.required")}],defaultBranch:[{required:!0,message:()=>d("form.validate.name.required")}],defaultPath:[{required:!0,message:()=>d("form.validate.name.required")}],msg:[{required:!0,message:()=>d("form.validate.name.required")}],author:[{required:!0,message:()=>d("form.validate.name.required")}],email:[{required:!0,message:()=>d("form.validate.name.required")}]}),$=()=>{g.value=!1},D=()=>{g.value=!0},W=s=>{T.value=s},R=s=>{!s||s.resetFields()},G=async s=>{!s||!await s.validate((a,b)=>{a?l.debug("\u6821\u9A8C\u6210\u529F"):l.error(d("main.opt.failure"),b)})||X(!1)},M=async()=>{w.value=!0,X(!0);const s=_e(o.apiType);let f;try{const a=new Ne(o.apiType),b=new Bt;b.postid="content/post/test.md",b.description="# Hello world";let r;try{r=await a.newPost(b)}catch(C){f=C,s.apiStatus=!1,y.value=!1}r?(s.apiStatus=!0,y.value=!0):(s.apiStatus=!1,y.value=!1),T.value&&await a.deletePost(b.postid)}catch(a){s.apiStatus=!1,y.value=!1,l.error(a)}Je(o.apiType,s),y.value?K.success(d("main.opt.success")):f?K.error(d("setting.blog.vali.error")+"=>"+f):K.error(d("setting.blog.vali.error")),w.value=!1},X=s=>{const f=o.cfg;f.githubUser=c.githubUser,f.githubRepo=c.githubRepo,f.githubToken=c.githubToken,f.defaultPath=c.defaultPath,f.defaultBranch=c.defaultBranch,f.defaultMsg=c.msg,f.author=c.author,f.email=c.email,f.previewUrl=c.previewUrl,f.apiStatus=y.value,Je(o.apiType,f),s!==!0&&K.success(d("main.opt.success"))},v=()=>{let s=_e(o.apiType);rt(s)&&(s=o.cfg),s&&(c.githubUser=s.githubUser,c.githubRepo=s.githubRepo,c.githubToken=s.githubToken,c.defaultPath=s.defaultPath,c.defaultBranch=s.defaultBranch,c.msg=s.defaultMsg,c.author=s.author,c.email=s.email,c.previewUrl=s.previewUrl,y.value=s.apiStatus)};return Fe(async()=>{v()}),(s,f)=>{const a=Re,b=ut,r=Oe,C=We,x=nt,ve=Be,S=Me;return u(),i(S,{"label-width":"120px",ref_key:"formRef",ref:A,model:c,rules:V,"status-icon":""},{default:t(()=>[e(r,{label:s.$t("main.publish.editmode")},{default:t(()=>[e(b,null,{default:t(()=>[e(a,{type:g.value?"default":"primary",onClick:$},{default:t(()=>[Y(I(s.$t("main.publish.editmode.simple")),1)]),_:1},8,["type"]),e(a,{type:g.value?"primary":"default",onClick:D},{default:t(()=>[Y(I(s.$t("main.publish.editmode.complex")),1)]),_:1},8,["type"])]),_:1})]),_:1},8,["label"]),je("div",ml,[e(r,{label:s.$t("setting.blog.type.github.user"),prop:"githubUser"},{default:t(()=>[e(C,{modelValue:c.githubUser,"onUpdate:modelValue":f[0]||(f[0]=P=>c.githubUser=P),placeholder:s.$t("setting.blog.type.github.user.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(r,{label:s.$t("setting.blog.type.github.repo"),prop:"githubRepo"},{default:t(()=>[e(C,{modelValue:c.githubRepo,"onUpdate:modelValue":f[1]||(f[1]=P=>c.githubRepo=P),placeholder:s.$t("setting.blog.type.github.repo.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(r,{label:s.$t("setting.blog.type.github.token"),prop:"githubToken"},{default:t(()=>[e(C,{type:"password",modelValue:c.githubToken,"onUpdate:modelValue":f[2]||(f[2]=P=>c.githubToken=P),placeholder:s.$t("setting.blog.type.github.token.tip"),"show-password":""},null,8,["modelValue","placeholder"]),je("a",fl,I(s.$t("setting.blog.type.github.token.gen")),1)]),_:1},8,["label"])]),g.value?(u(),de("div",yl,[e(r,{label:s.$t("setting.blog.type.github.default.path"),prop:"defaultPath"},{default:t(()=>[e(C,{modelValue:c.defaultPath,"onUpdate:modelValue":f[3]||(f[3]=P=>c.defaultPath=P),placeholder:s.$t("setting.blog.type.github.default.path.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(r,{label:s.$t("setting.blog.type.github.default.branch"),prop:"defaultBranch"},{default:t(()=>[e(C,{modelValue:c.defaultBranch,"onUpdate:modelValue":f[4]||(f[4]=P=>c.defaultBranch=P),placeholder:s.$t("setting.blog.type.github.default.branch.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(r,{label:s.$t("setting.blog.type.github.msg"),prop:"msg"},{default:t(()=>[e(C,{modelValue:c.msg,"onUpdate:modelValue":f[5]||(f[5]=P=>c.msg=P),placeholder:s.$t("setting.blog.type.github.msg.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(r,{label:s.$t("setting.blog.type.github.author"),prop:"author"},{default:t(()=>[e(C,{modelValue:c.author,"onUpdate:modelValue":f[6]||(f[6]=P=>c.author=P),placeholder:s.$t("setting.blog.type.github.author.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(r,{label:s.$t("setting.blog.type.github.email"),prop:"email"},{default:t(()=>[e(C,{modelValue:c.email,"onUpdate:modelValue":f[7]||(f[7]=P=>c.email=P),placeholder:s.$t("setting.blog.type.github.email.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(r,{label:s.$t("setting.blog.previewUrl")},{default:t(()=>[e(C,{modelValue:c.previewUrl,"onUpdate:modelValue":f[8]||(f[8]=P=>c.previewUrl=P)},null,8,["modelValue"])]),_:1},8,["label"])])):h("",!0),e(r,{label:s.$t("form.validate.github.auto.delete")},{default:t(()=>[e(x,{modelValue:T.value,"onUpdate:modelValue":f[9]||(f[9]=P=>T.value=P),onChange:W},null,8,["modelValue"])]),_:1},8,["label"]),e(r,null,{default:t(()=>[e(a,{type:"primary",onClick:M,loading:w.value},{default:t(()=>[Y(I(w.value?s.$t("setting.blog.vali.ing"):s.$t("setting.blog.vali")),1)]),_:1},8,["loading"]),y.value?h("",!0):(u(),i(ve,{key:0,title:s.$t("setting.blog.vali.tip"),type:"warning",closable:!1},null,8,["title"])),y.value?(u(),i(ve,{key:1,title:s.$t("setting.blog.vali.ok"),type:"success",closable:!1},null,8,["title"])):h("",!0)]),_:1}),e(r,null,{default:t(()=>[e(a,{type:"primary",onClick:f[10]||(f[10]=P=>G(A.value))},{default:t(()=>[Y(I(s.$t("setting.blog.save")),1)]),_:1}),e(a,{onClick:f[11]||(f[11]=P=>R(A.value))},{default:t(()=>[Y(I(s.$t("setting.blog.cancel")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])}}}),bl=ue({__name:"VuepressSetting",setup(n){const o=p(te.API_TYPE_VUEPRESS),l=new Ta,d=p(l);return(g,w)=>(u(),i(dt,{"api-type":o.value,cfg:d.value},null,8,["api-type","cfg"]))}});class vl extends it{constructor(){super("","","",""),this.defaultPath="content/post",this.posidKey=se.HUGO_POSTID_KEY,this.home="",this.previewUrl="/post/[postid].html"}}const _l=ue({__name:"HugoSetting",setup(n){const o=p(te.API_TYPE_HUGO),l=new vl,d=p(l);return(g,w)=>(u(),i(dt,{"api-type":o.value,cfg:d.value},null,8,["api-type","cfg"]))}});class hl extends it{constructor(){super("","","",""),this.defaultPath="source/_posts",this.posidKey=se.HEXO_POSTID_KEY,this.previewUrl="/[date]/[postid]/"}}const wl=ue({__name:"HexoSetting",setup(n){const o=p(te.API_TYPE_HEXO),l=new hl,d=p(l);return(g,w)=>(u(),i(dt,{"api-type":o.value,cfg:d.value},null,8,["api-type","cfg"]))}});class Cl extends it{constructor(){super("","","",""),this.defaultPath="_posts",this.posidKey=se.JEKYLL_POSTID_KEY,this.previewUrl="/[cats]/[date]/[postid].html"}}const El=ue({__name:"JekyllSetting",setup(n){const o=p(te.API_TYPE_JEKYLL),l=new Cl,d=p(l);return(g,w)=>(u(),i(dt,{"api-type":o.value,cfg:d.value},null,8,["api-type","cfg"]))}});class Sl extends ze{constructor(){super("https://[your-jvue-site]","https://[your-jvue-site]/xmlrpc","",""),this.posidKey=se.JVUE_POSTID_KEY,this.previewUrl="/post/[postid].html",this.pageType=Se.Markdown}}const ct=ue({__name:"MetaweblogSetting",props:{isReload:{type:Boolean,default:!1},apiType:{type:String,default:""},cfg:{type:ze,default:null}},setup(n){const o=n,l=we.getLogger("components/publish/tab/setting/MetaweblogSetting.vue"),{t:d}=He(),g=parseInt(Se.Markdown.toString()),w=p(""),y=p(""),T=p(""),A=p(""),c=p(""),V=p(g),$=p(!1),D=p(!1),W=p(""),R=p(d("setting.blog.platform.support.metaweblog")+o.apiType+" "),G=async()=>{$.value=!0;try{M(!0);const v=_e(o.apiType),f=await new Ne(o.apiType).getUsersBlogs();if(f&&f.length>0){const a=f[0];v.blogName=a.blogName,W.value=a.blogName,v.apiStatus=!0,D.value=!0}else v.apiStatus=!1,D.value=!1;Je(o.apiType,v)}catch(v){console.error(v)}D.value?K.success(d("main.opt.success")):K.error(d("setting.blog.vali.error")),$.value=!1,l.debug("Metaweblog\u901A\u7528Setting\u9A8C\u8BC1\u5B8C\u6BD5")},M=v=>{l.debug("Metaweblog\u901A\u7528Setting\u4FDD\u5B58\u914D\u7F6E");const s=o.cfg;s.home=w.value,s.username=A.value,s.password=c.value,s.apiUrl=y.value,s.previewUrl=T.value,s.blogName=W.value,s.pageType=V.value,s.apiStatus=D.value,Je(o.apiType,s),v!==!0&&K.success(d("main.opt.success"))},X=()=>{l.debug("Metaweblog\u901A\u7528Setting\u914D\u7F6E\u521D\u59CB\u5316");let v=_e(o.apiType);rt(v)&&(v=o.cfg),v&&(l.debug("get setting conf=>",v),w.value=v.home,y.value=v.apiUrl,T.value=v.previewUrl,A.value=v.username,c.value=v.password,W.value=v.blogName,V.value=v.pageType,D.value=v.apiStatus)};return Fe(async()=>{X()}),(v,s)=>{const f=Be,a=We,b=Oe,r=va,C=_a,x=Re,ve=Me;return u(),i(ve,{"label-width":"120px"},{default:t(()=>[e(f,{class:"top-version-tip",title:R.value+W.value,type:"info",closable:!1},null,8,["title"]),e(b,{label:v.$t("setting.blog.url")},{default:t(()=>[e(a,{modelValue:w.value,"onUpdate:modelValue":s[0]||(s[0]=S=>w.value=S)},null,8,["modelValue"])]),_:1},8,["label"]),e(b,{label:v.$t("setting.blog.username")},{default:t(()=>[e(a,{modelValue:A.value,"onUpdate:modelValue":s[1]||(s[1]=S=>A.value=S)},null,8,["modelValue"])]),_:1},8,["label"]),e(b,{label:v.$t("setting.blog.password")},{default:t(()=>[e(a,{type:"password",modelValue:c.value,"onUpdate:modelValue":s[2]||(s[2]=S=>c.value=S),"show-password":""},null,8,["modelValue"])]),_:1},8,["label"]),e(b,{label:v.$t("setting.blog.apiurl")},{default:t(()=>[e(a,{modelValue:y.value,"onUpdate:modelValue":s[3]||(s[3]=S=>y.value=S)},null,8,["modelValue"])]),_:1},8,["label"]),e(b,{label:v.$t("setting.blog.previewUrl")},{default:t(()=>[e(a,{modelValue:T.value,"onUpdate:modelValue":s[4]||(s[4]=S=>T.value=S)},null,8,["modelValue"])]),_:1},8,["label"]),e(b,{label:v.$t("setting.blog.pageType")},{default:t(()=>[e(C,{modelValue:V.value,"onUpdate:modelValue":s[5]||(s[5]=S=>V.value=S),class:"ml-4"},{default:t(()=>[e(r,{label:0,size:"large"},{default:t(()=>[Y("Markdown")]),_:1}),e(r,{label:1,size:"large"},{default:t(()=>[Y("HTML")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),e(b,null,{default:t(()=>[e(x,{type:"primary",onClick:G,loading:$.value},{default:t(()=>[Y(I($.value?v.$t("setting.blog.vali.ing"):v.$t("setting.blog.vali")),1)]),_:1},8,["loading"]),D.value?h("",!0):(u(),i(f,{key:0,title:v.$t("setting.blog.vali.tip.metaweblog"),type:"warning",closable:!1},null,8,["title"])),D.value?(u(),i(f,{key:1,title:v.$t("setting.blog.vali.ok.metaweblog"),type:"success",closable:!1},null,8,["title"])):h("",!0)]),_:1}),e(b,null,{default:t(()=>[e(x,{type:"primary",onClick:M},{default:t(()=>[Y(I(v.$t("setting.blog.save")),1)]),_:1}),e(x,null,{default:t(()=>[Y(I(v.$t("setting.blog.cancel")),1)]),_:1})]),_:1})]),_:1})}}}),kl=ue({__name:"JVueSetting",setup(n){const o=p(te.API_TYPE_JVUE),l=p(new Sl);return(d,g)=>(u(),i(ct,{"api-type":o.value,cfg:l.value},null,8,["api-type","cfg"]))}});class Tl extends ze{constructor(){super("https://youweics.atlassian.net/wiki/spaces/[spaceKey]","http://localhost:3000/api/xmlrpc","",""),this.posidKey=se.CONFLUENCE_POSTID_KEY,this.previewUrl="pages/[postid]",this.pageType=Se.Html}}const Vl=ue({__name:"ConfluenceSetting",setup(n){const o=p(te.API_TYPE_CONFLUENCE),l=p(new Tl);return(d,g)=>(u(),i(ct,{"api-type":o.value,cfg:l.value},null,8,["api-type","cfg"]))}});class $l extends ze{constructor(){super("https://www.cnblogs.com/[yourblog]","https://rpc.cnblogs.com/metaweblog/[yourblog]","",""),this.posidKey=se.CNBLOGS_POSTID_KEY,this.previewUrl="/p/[postid].html",this.pageType=Se.Markdown}}const Il=ue({__name:"CnblogsSetting",setup(n){const o=p(te.API_TYPE_CNBLOGS),l=new $l,d=p(l);return(g,w)=>(u(),i(ct,{"api-type":o.value,cfg:d.value},null,8,["api-type","cfg"]))}});class Dl extends ze{constructor(){super("http://localhost:8000","http://localhost:8000/xmlrpc.php","",""),this.posidKey=se.WORDPRESS_POSTID_KEY,this.previewUrl="/?p=[postid]",this.pageType=Se.Markdown}}const ta=ue({__name:"WordpressSetting",setup(n){const o=p(te.API_TYPE_WORDPRESS),l=p(new Dl);return(d,g)=>(u(),i(ct,{"api-type":o.value,cfg:l.value},null,8,["api-type","cfg"]))}});class gt{constructor(){me(this,"home");me(this,"apiUrl");me(this,"username");me(this,"password");me(this,"token");me(this,"apiStatus");me(this,"blogName");me(this,"blogid");me(this,"posidKey");me(this,"previewUrl");me(this,"pageType");me(this,"tokenSettingUrl");this.home="",this.apiUrl="",this.username="",this.password="",this.token="",this.apiStatus=!1,this.blogName="",this.blogid="",this.posidKey="",this.previewUrl="",this.pageType=Se.Markdown,this.tokenSettingUrl=""}}class Pl extends gt{constructor(){super(),this.home="https://ld246.com/",this.apiUrl="https://ld246.com/api/v2",this.tokenSettingUrl="https://ld246.com/settings/account",this.posidKey=se.LIANDI_POSTID_KEY,this.previewUrl="/article/[postid]",this.pageType=Se.Markdown}}const Al=["href"],Ul=["href"],Wt=ue({__name:"CommonBlogSetting",props:{isReload:{type:Boolean,default:!1},apiType:{type:String,default:""},cfg:{type:gt,default:null},usernameEnabled:{type:Boolean,default:!1},passwordEnabled:{type:Boolean,default:!1},tokenEnabled:{type:Boolean,default:!1}},setup(n){const o=n,l=we.getLogger("components/publish/tab/setting/CommonBlogSetting.vue"),{t:d}=He(),g=p(""),w=p(""),y=p(""),T=p(""),A=p(""),c=p(!1),V=p(!1),$=p(""),D=p(""),W=p(""),R=p(d("setting.blog.platform.support.common")+o.apiType+" "),G=async()=>{c.value=!0;try{M(!0);const v=_e(o.apiType),f=await new Ne(o.apiType).getUsersBlogs();if(f&&f.length>0){const a=f[0];v.apiStatus=!0,V.value=!0,v.blogName=a.blogName,$.value=a.blogName,v.blogid=a.blogid,D.value=a.blogid,Je(o.apiType,v)}else v.apiStatus=!1,V.value=!1,Je(o.apiType,v)}catch(v){console.error(v)}V.value?K.success(d("main.opt.success")):K.error(d("setting.blog.vali.error")),c.value=!1,l.debug("\u901A\u7528Setting\u9A8C\u8BC1\u5B8C\u6BD5")},M=v=>{l.debug("Metaweblog\u901A\u7528Setting\u4FDD\u5B58\u914D\u7F6E");const s=o.cfg;s.home=g.value,s.username=y.value,s.password=T.value,s.token=A.value,s.apiUrl=w.value,s.apiStatus=V.value,s.blogName=$.value,s.blogid=D.value,Je(o.apiType,s),v!==!0&&K.success(d("main.opt.success"))},X=()=>{l.debug("\u901A\u7528Setting\u914D\u7F6E\u521D\u59CB\u5316");let v=_e(o.apiType);rt(v)&&(v=o.cfg),v&&(l.debug("get setting conf=>",v),g.value=v.home||"",w.value=v.apiUrl||"",y.value=v.username||"",T.value=v.password||"",A.value=v.token||"",V.value=v.apiStatus||!1,$.value=v.blogName||"",D.value=v.blogid||"",W.value=v.tokenSettingUrl||"")};return Fe(async()=>{X()}),(v,s)=>{const f=Be,a=We,b=Oe,r=Re,C=Me;return u(),i(C,{"label-width":"120px"},{default:t(()=>[e(f,{class:"top-version-tip",title:R.value+$.value,type:"info",closable:!1},null,8,["title"]),e(b,{label:v.$t("setting.common.home")},{default:t(()=>[e(a,{modelValue:g.value,"onUpdate:modelValue":s[0]||(s[0]=x=>g.value=x)},null,8,["modelValue"])]),_:1},8,["label"]),o.usernameEnabled?(u(),i(b,{key:0,label:v.$t("setting.common.username")},{default:t(()=>[e(a,{modelValue:y.value,"onUpdate:modelValue":s[1]||(s[1]=x=>y.value=x)},null,8,["modelValue"])]),_:1},8,["label"])):h("",!0),o.passwordEnabled?(u(),i(b,{key:1,label:v.$t("setting.common.password")},{default:t(()=>[e(a,{type:"password",modelValue:T.value,"onUpdate:modelValue":s[2]||(s[2]=x=>T.value=x),"show-password":""},null,8,["modelValue"]),je("a",{href:W.value,target:"_blank"},I(v.$t("setting.common.username.gen"))+"\uFF1A"+I(W.value),9,Al)]),_:1},8,["label"])):h("",!0),o.tokenEnabled?(u(),i(b,{key:2,label:v.$t("setting.common.token")},{default:t(()=>[e(a,{type:"password",modelValue:A.value,"onUpdate:modelValue":s[3]||(s[3]=x=>A.value=x),"show-password":""},null,8,["modelValue"]),je("a",{href:W.value,target:"_blank"},I(v.$t("setting.common.token.gen"))+"\uFF1A"+I(W.value),9,Ul)]),_:1},8,["label"])):h("",!0),e(b,{label:v.$t("setting.common.apiurl")},{default:t(()=>[e(a,{modelValue:w.value,"onUpdate:modelValue":s[4]||(s[4]=x=>w.value=x)},null,8,["modelValue"])]),_:1},8,["label"]),e(b,null,{default:t(()=>[e(r,{type:"primary",onClick:G,loading:c.value},{default:t(()=>[Y(I(c.value?v.$t("setting.blog.vali.ing"):v.$t("setting.blog.vali")),1)]),_:1},8,["loading"]),V.value?h("",!0):(u(),i(f,{key:0,title:v.$t("setting.blog.vali.tip.metaweblog"),type:"warning",closable:!1},null,8,["title"])),V.value?(u(),i(f,{key:1,title:v.$t("setting.blog.vali.ok.metaweblog"),type:"success",closable:!1},null,8,["title"])):h("",!0)]),_:1}),e(b,null,{default:t(()=>[e(r,{type:"primary",onClick:M},{default:t(()=>[Y(I(v.$t("setting.blog.save")),1)]),_:1}),e(r,null,{default:t(()=>[Y(I(v.$t("setting.blog.cancel")),1)]),_:1})]),_:1})]),_:1})}}}),Bl=ue({__name:"LiandiSetting",setup(n){const o=p(te.API_TYPE_LIANDI),l=new Pl,d=p(l);return(g,w)=>(u(),i(Wt,{"api-type":o.value,"username-enabled":!0,"token-enabled":!0,cfg:d.value},null,8,["api-type","cfg"]))}});class Fl extends gt{constructor(){super(),this.home="https://www.yuque.com/",this.apiUrl="https://www.yuque.com/api/v2",this.tokenSettingUrl="https://www.yuque.com/settings/tokens",this.posidKey=se.YUQUE_POSTID_KEY,this.previewUrl="/[notebook]/[postid]",this.pageType=Se.Markdown}}const Kl=ue({__name:"YuqueSetting",setup(n){const o=p(te.API_TYPE_YUQUE),l=new Fl,d=p(l);return(g,w)=>(u(),i(Wt,{"api-type":o.value,"username-enabled":!0,"token-enabled":!0,cfg:d.value},null,8,["api-type","cfg"]))}});class Yl extends gt{constructor(){super(),this.home="http://localhost:9564/kms16_release/kms/multidoc",this.apiUrl="http://localhost:9564/kms16_release/api/kms-multidoc/kmsMultidocKnowledgeRestService",this.tokenSettingUrl="http://localhost:9564/kms16_release/sys/profile/index.jsp#integrate/RestService/",this.posidKey=se.KMS_POSTID_KEY,this.previewUrl="/kms_multidoc_knowledge/kmsMultidocKnowledge.do?method=view&fdId=[postid]",this.pageType=Se.Html}}const Ol=ue({__name:"KmsSetting",setup(n){const o=p(te.API_TYPE_KMS),l=new Yl,d=p(l);return(g,w)=>(u(),i(Wt,{"api-type":o.value,"username-enabled":!0,"password-enabled":!0,cfg:d.value},null,8,["api-type","cfg"]))}}),Ml={key:1},Ll=ue({__name:"PlatformSetting",props:{isReload:{type:Boolean,default:!1}},setup(n){const o=n,l=we.getLogger("components/publish/tab/PlatformSetting.vue"),{tabCountStore:d,vuepressEnabled:g,hugoEnabled:w,hexoEnabled:y,jekyllEnabled:T,jvueEnabled:A,confEnabled:c,cnblogsEnabled:V,wordpressEnabled:$,liandiEnabled:D,yuqueEnabled:W,kmsEnabled:R,doCount:G}=wt(),M=Te({dynamicConfigArray:[],githubArray:[],metaweblogArray:[],wordpressArray:[]}),X=p(b=>new dl(b)),v=p(b=>new cl(lt(b.plantformKey))),s=p(b=>new gl(lt(b.plantformKey))),f=b=>{const r=[];return b.forEach(C=>{const x=new tt(C.plantformType,C.plantformKey,C.plantformName);x.subPlatformType=C.subPlantformType;const ve=Xe(C.plantformKey),S=he(ve);x.modelValue=S,S&&r.push(x)}),r},a=()=>{G();const b=xe();M.dynamicConfigArray=f(b.totalCfg||[]),M.githubArray=f(b.githubCfg||[]),M.metaweblogArray=f(b.metaweblogCfg||[]),M.wordpressArray=f(b.wordpressCfg||[]),l.debug("dynamicJsonCfg=>",JSON.stringify(b))};return pt(()=>o.isReload,(b,r)=>{a(),l.debug("platform-setting\u521D\u59CB\u5316")}),(b,r)=>{const C=Vt,x=$t,ve=Be;return N(d).tabCount>0?(u(),i(x,{key:0,type:"border-card"},{default:t(()=>[N(g)?(u(),i(C,{key:0,label:b.$t("setting.vuepress")+b.$t("setting.blog.setting")},{default:t(()=>[e(bl)]),_:1},8,["label"])):h("",!0),N(w)?(u(),i(C,{key:1,label:b.$t("setting.hugo")+b.$t("setting.blog.setting")},{default:t(()=>[e(_l)]),_:1},8,["label"])):h("",!0),N(y)?(u(),i(C,{key:2,label:b.$t("setting.hexo")+b.$t("setting.blog.setting")},{default:t(()=>[e(wl)]),_:1},8,["label"])):h("",!0),N(T)?(u(),i(C,{key:3,label:b.$t("setting.jekyll")+b.$t("setting.blog.setting")},{default:t(()=>[e(El)]),_:1},8,["label"])):h("",!0),N(A)?(u(),i(C,{key:4,label:b.$t("setting.jvue")+b.$t("setting.blog.setting")},{default:t(()=>[e(kl)]),_:1},8,["label"])):h("",!0),N(c)?(u(),i(C,{key:5,label:b.$t("setting.conf")+b.$t("setting.blog.setting")},{default:t(()=>[e(Vl)]),_:1},8,["label"])):h("",!0),N(V)?(u(),i(C,{key:6,label:b.$t("setting.cnblogs")+b.$t("setting.blog.setting")},{default:t(()=>[e(Il)]),_:1},8,["label"])):h("",!0),N($)?(u(),i(C,{key:7,label:b.$t("setting.wordpress")+b.$t("setting.blog.setting")},{default:t(()=>[e(ta)]),_:1},8,["label"])):h("",!0),N(D)?(u(),i(C,{key:8,label:b.$t("setting.liandi")+b.$t("setting.blog.setting")},{default:t(()=>[e(Bl)]),_:1},8,["label"])):h("",!0),N(W)?(u(),i(C,{key:9,label:b.$t("setting.yuque")+b.$t("setting.blog.setting")},{default:t(()=>[e(Kl)]),_:1},8,["label"])):h("",!0),N(R)?(u(),i(C,{key:10,label:b.$t("setting.kms")+b.$t("setting.blog.setting")},{default:t(()=>[e(Ol)]),_:1},8,["label"])):h("",!0),(u(!0),de(Ce,null,Ee(M.githubArray,S=>(u(),i(C,{key:S.platformKey,label:S.platformName+b.$t("setting.blog.setting")},{default:t(()=>[e(dt,{"api-type":S.platformKey,cfg:X.value(S)},null,8,["api-type","cfg"])]),_:2},1032,["label"]))),128)),(u(!0),de(Ce,null,Ee(M.metaweblogArray,S=>(u(),i(C,{key:S.platformKey,label:S.platformName+b.$t("setting.blog.setting")},{default:t(()=>[e(ct,{"api-type":S.platformKey,cfg:v.value(S)},null,8,["api-type","cfg"])]),_:2},1032,["label"]))),128)),(u(!0),de(Ce,null,Ee(M.wordpressArray,S=>(u(),i(C,{key:S.platformKey,label:S.platformName+b.$t("setting.blog.setting")},{default:t(()=>[e(ta,{"api-type":S.platformKey,cfg:s.value(S)},null,8,["api-type","cfg"])]),_:2},1032,["label"]))),128))]),_:1})):(u(),de("div",Ml,[e(ve,{class:"top-version-tip",title:b.$t("config.platform.none"),type:"error",closable:!1},null,8,["title"])]))}}}),Ie=we.getLogger("utils/publishUtil.ts");function yt(n){return _e(n)}const qt=(n,o)=>{const l=[te.API_TYPE_VUEPRESS,te.API_TYPE_HUGO,te.API_TYPE_HEXO,te.API_TYPE_JEKYLL],d=[te.API_TYPE_JVUE,te.API_TYPE_CONFLUENCE,te.API_TYPE_CNBLOGS,te.API_TYPE_WORDPRESS],g=[te.API_TYPE_LIANDI,te.API_TYPE_YUQUE,te.API_TYPE_KMS],w=xe(),y=w.githubCfg||[],T=w.metaweblogCfg||[],A=w.wordpressCfg||[];if(y.forEach(c=>{const V=c.platformKey,$=Xe(c.platformKey);he($)&&l.push(V)}),T.forEach(c=>{const V=c.platformKey,$=Xe(c.platformKey);he($)&&d.push(V)}),A.forEach(c=>{const V=c.platformKey,$=Xe(c.platformKey);he($)&&d.push(V)}),l.includes(n)){const c=yt(n).posidKey,V=o[c]||"";return Ie.debug("\u5E73\u53F0=>",n),Ie.debug("meta=>",o),Ie.debug("postidKey=>",c),Ie.debug("postidKey\u7684\u503C=>",V),V!==""}else if(d.includes(n)){const c=yt(n).posidKey,V=o[c]||"";return Ie.debug("\u5E73\u53F0=>",n),Ie.debug("meta=>",o),Ie.debug("postidKey=>",c),Ie.debug("postidKey\u7684\u503C=>",V),V!==""}else if(g.includes(n)){const c=yt(n).posidKey,V=o[c!=null?c:""]||"";return Ie.debug("\u5E73\u53F0=>",n),Ie.debug("meta=>",o),Ie.debug("postidKey=>",c),Ie.debug("postidKey\u7684\u503C=>",V),V!==""}return!1},Nl="custom-slug",Rl="custom-desc",De={SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY:Nl,SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY:Rl},Hl=n=>(n=n.replace(`---
`,""),n=n.replace("---",""),sa.load(n,{})),Gl=n=>{let o=sa.dump(n,{});return o=la(`---
`,o,"---"),o},jl={class:"normal-mode"},Wl=["href","title"],ql=["href","title"],Jl={class:"source-mode"},mt=ue({__name:"GithubMain",props:{isReload:{type:Boolean,default:!1},apiType:{type:String,default:""},pageId:{type:String,default:void 0}},setup(n){const o=n,l=we.getLogger("components/publish/tab/main/GithubMain.vue"),d=new ot,{t:g}=He(),w=p(!1),y=p(!1),T=p(!1),A=p(!1),c=p(!1),V=p(!1),$=p(!1),D=p(!1),W=p(!1),R=p(!1),G=p(!0),M=p(!1),X=p(""),v=p(""),s=p(!1),f=p(!1),a=p({title:"",customSlug:"",desc:"",created:"",checkList:[],tag:{inputValue:"",dynamicTags:[],inputVisible:!1},customPath:"",categories:["\u9ED8\u8BA4\u5206\u7C7B"]}),b=p({pageId:"",meta:{tags:""}}),r=p({yamlObj:{title:"",date:new Date,permalink:"",meta:[{name:"keywords",content:""},{name:"description",content:""}],categories:[],tags:[],author:{name:"terwer",link:"https://github.com/terwer"}},formatter:"",vuepressContent:"",vuepressFullContent:""}),C=()=>{D.value=!1},x=()=>{D.value=!0},ve=m=>{const E=m.split("/");if(E.length>1){a.value.categories=[];for(let j=1;j<E.length-1;j++){const Q=Rt(E[j]);a.value.categories.push(Q)}}};function S(){const m=yt(te.API_TYPE_VUEPRESS).posidKey;return b.value.meta[m]||""}function P(){return Qe(a.value.customSlug)||s.value?!0:(l.debug(g("main.force.refresh.tip")),!1)}async function U(m){if(!P())return;w.value=!0;const E=await d.getBlockByID(b.value.pageId);l.debug("page=>",E);let j=E.content;if(j=Ke(j),l.debug("fmtTitle=>",j),a.value.checkList.length>0){const Q=await Ft(j);l.debug("result=>",Q),Q?a.value.customSlug=Q:K.success(g("main.opt.failure"))}else a.value.customSlug=await Kt(j);if(W.value){const Q=E.content+new Date().toISOString(),be="-"+jt(Q).toLowerCase();a.value.customSlug+=be}w.value=!1,m!==!0&&K.success(g("main.opt.success"))}async function q(m){y.value=!0;const j=(await d.exportMdContent(b.value.pageId)).content,Q=Yt(j);a.value.desc=Ot(Q,Ht.MAX_PREVIEW_LENGTH,!0),y.value=!1,m!==!0&&K.success(g("main.opt.success"))}const L=m=>{},ee=m=>{a.value.tag.dynamicTags.splice(a.value.tag.dynamicTags.indexOf(m),1)},ce=p(),J=()=>{a.value.tag.inputVisible=!0,bt(()=>{ce.value.focus()})},ge=()=>{a.value.tag.inputValue&&a.value.tag.dynamicTags.push(a.value.tag.inputValue),a.value.tag.inputVisible=!1,a.value.tag.inputValue=""};async function Pe(m){if(!f.value){K.warning(g("main.tag.auto.switch.no.tip"));return}T.value=!0;const j=(await d.exportMdContent(b.value.pageId)).content,Q=await Mt(j);l.debug("genTags=>",Q);const be=Lt(Q,5);l.debug("hotTags=>",be);for(let F=0;F<be.length;F++)a.value.tag.dynamicTags.includes(be[F])||a.value.tag.dynamicTags.push(be[F]);T.value=!1,m!==!0&&K.success(g("main.opt.success"))}async function le(m){const E={[De.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY]:a.value.customSlug,[De.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY]:a.value.desc,tags:a.value.tag.dynamicTags.join(",")};await d.setBlockAttrs(b.value.pageId,E),l.debug("VuepressMain\u4FDD\u5B58\u5C5E\u6027\u5230\u601D\u6E90\u7B14\u8BB0,meta=>",E),m!==!0&&(await oe(),K.success(g("main.opt.success")))}const Ke=m=>(m.indexOf(".md")>-1&&(m=m.replace(/\.md/g,"")),m.indexOf(".")>-1&&(m=m.replace(/\d*\./g,"")),m),Ge=()=>{l.debug("convertAttrToYAML,formData=>",a);let m=a.value.title;m=Ke(m),r.value.yamlObj.title=m,r.value.yamlObj.permalink="/post/"+a.value.customSlug+".html",r.value.yamlObj.date=ia(a.value.created);const E=[{name:"keywords",content:a.value.tag.dynamicTags.join(" ")},{name:"description",content:a.value.desc}];r.value.yamlObj.meta=E,r.value.yamlObj.tags=a.value.tag.dynamicTags,r.value.yamlObj.categories=a.value.categories;let j=Gl(r.value.yamlObj);j=ea(j,!0),r.value.formatter=j,r.value.vuepressFullContent=r.value.formatter},et=()=>{r.value.formatter=r.value.vuepressFullContent,r.value.yamlObj=Hl(r.value.formatter),l.debug("convertYAMLToAttr,yamlObj=>",r.value.yamlObj),a.value.title=r.value.yamlObj.title+".md",a.value.customSlug=r.value.yamlObj.permalink.replace("/pages/","").replace("/post/","").replace(".html","").replace("/",""),a.value.created=ea(r.value.yamlObj.date.toISOString(),!1);const m=r.value.yamlObj.meta;for(let E=0;E<m.length;E++){const j=m[E];if(j.name==="description"){a.value.desc=j.content;break}}for(let E=0;E<r.value.yamlObj.tags.length;E++){const j=r.value.yamlObj.tags[E];!a.value.tag.dynamicTags.includes(j)&&j!==""&&a.value.tag.dynamicTags.push(j)}a.value.categories=r.value.yamlObj.categories},k=p(),Z=()=>{bt(()=>{k.value.focus(),Ka(r.value.vuepressFullContent),K.success(g("main.opt.success"))})},ne=m=>{m.target.select()},_=m=>{W.value=m,R.value=m},O=m=>{G.value=m},B={label:"label",children:"children",isLeaf:"isLeaf"},H=async(m,E)=>{if(m.isLeaf)return E([]);l.debug("\u76EE\u524D\u5DF2\u4FDD\u5B58\u8DEF\u5F84=>",a.value.customPath),l.debug("\u5F53\u524D\u8282\u70B9=>",m.data);const j=_e(te.API_TYPE_VUEPRESS),Q=new xt(j);let be,F=m.data.value||"";F===""&&a.value.customPath!==""?be=a.value.customPath:(F===""&&(F="docs/"),be=F);const Ae=await Q.getGithubPageTreeNode(be);E(Ae)};async function pe(){c.value=!0,await ie(!1);const m=Ke(a.value.title);if(/[\s*|\\.]/g.test(m)){l.debug("fmtTitle=>",m),K.error("\u6587\u4EF6\u540D\u4E0D\u80FD\u5305\u542B\u7A7A\u683C\u6216\u8005\u7279\u6B8A\u5B57\u7B26");return}if(await z(!0),R.value){await oe(),c.value=!1,K.error("\u68C0\u6D4B\u5230api\u4E0D\u53EF\u7528\u6216\u8005\u914D\u7F6E\u9519\u8BEF\uFF0C\u65E0\u6CD5\u53D1\u5E03\u5230Github\uFF0C\u8BF7\u81EA\u884C\u590D\u5236\u6587\u672C");return}else await oe();l.debug("\u53D1\u5E03\u5185\u5BB9\u5B8C\u6210"),c.value=!1,K.success(g("main.opt.status.publish"))}async function z(m){A.value=!0,await U(!0),await q(!0),await Pe(!0),Ge(),await le(!0),l.debug("\u53D1\u5E03\u5C5E\u6027\u5B8C\u6210"),A.value=!1,m!==!0&&K.success(g("main.publish.oneclick.attr.finish"))}async function ye(){V.value=!0,at.confirm(g("main.opt.warning.tip"),g("main.opt.warning"),{confirmButtonText:g("main.opt.ok"),cancelButtonText:g("main.opt.cancel"),type:"warning"}).then(async()=>{await ie(!0),V.value=!1,K.warning(g("main.opt.status.cancel"))}).catch(()=>{V.value=!1})}async function ie(m){const E=_e(te.API_TYPE_VUEPRESS),j=new xt(E),Q=S();l.debug("\u51C6\u5907\u53D6\u6D88\u53D1\u5E03\uFF0CdocPath=>",Q),await j.deleteGithubPage(Q);const be={[se.VUEPRESS_POSTID_KEY]:""};await d.setBlockAttrs(b.value.pageId,be),l.debug("VuepressMain\u53D6\u6D88\u53D1\u5E03,meta=>",be),m&&await oe()}async function oe(){$.value=!0;const m=await _t(!0,o.pageId);if(l.debug("VuepressMain pageId=>",m),!m||m===""){$.value=!1;return}const E=await d.getBlockByID(m);if(!E)throw $.value=!1,K.error(g("config.error.msg")+"_vuepress"),new Error(g("config.error.msg")+"_vuepress");l.debug("VuepressMain\u83B7\u53D6\u4E3B\u6587\u6863",E),b.value.pageId=m,b.value.meta=await d.getBlockAttrs(m),a.value.title=E.content+".md",a.value.customSlug=b.value.meta[De.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY],a.value.desc=b.value.meta[De.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY],a.value.created=ht(E.created),a.value.tag.dynamicTags=[];const Q=(b.value.meta.tags||"").split(",");for(let Ve=0;Ve<Q.length;Ve++)Q[Ve]!==""&&a.value.tag.dynamicTags.push(Q[Ve]);const F=_e(te.API_TYPE_VUEPRESS).apiStatus;if(R.value=F,W.value=!0,l.info("Vuepress\u7684api\u72B6\u6001=>",F),M.value=qt(te.API_TYPE_VUEPRESS,b.value.meta),M.value){const Ve=_e(te.API_TYPE_VUEPRESS),ae=S();G.value=!1,a.value.customPath=ae,ve(ae),Ge();const ft="https://terwer.space/";X.value="https://github.com/"+Ve.githubUser+"/"+Ve.githubRepo+"/blob/"+Ve.defaultBranch+"/"+ae,v.value=ft+r.value.yamlObj.permalink}else Ge();const Le=(await d.exportMdContent(b.value.pageId)).content;r.value.vuepressContent=Nt(Le),r.value.vuepressFullContent=r.value.formatter+`
`+r.value.vuepressContent,$.value=!1}return pt(()=>o.isReload,async(m,E)=>{await oe(),l.debug("VuepressMain\u68C0\u6D4B\u5230\u66F4\u65B0\u64CD\u4F5C\uFF0C\u5237\u65B0\u9875\u9762")}),na(async()=>{await oe()}),(m,E)=>{const j=Be,Q=Re,be=ut,F=Oe,Ae=nt,Le=We,Ve=It,ae=Dt,ft=Pt,ra=At,pa=aa,zt=Me,da=vt,ca=Ut;return u(),de("div",null,[je("div",null,"github main=>"+I(o.apiType+":"+o.pageId),1),$.value?h("",!0):(u(),i(da,{key:0},{default:t(()=>[je("div",jl,[e(j,{closable:!1,title:m.$t("main.publish.vuepress.tip"),class:"top-version-tip",type:"info"},null,8,["title"]),h("",!0),e(zt,{"label-width":"100px"},{default:t(()=>[e(F,{label:m.$t("main.publish.vuepress.editmode")},{default:t(()=>[e(be,null,{default:t(()=>[e(Q,{type:D.value?"default":"primary",onClick:C},{default:t(()=>[Y(I(m.$t("main.publish.vuepress.editmode.simple")),1)]),_:1},8,["type"]),e(Q,{type:D.value?"primary":"default",onClick:x},{default:t(()=>[Y(I(m.$t("main.publish.vuepress.editmode.complex")),1)]),_:1},8,["type"])]),_:1})]),_:1},8,["label"]),D.value?(u(),i(F,{key:0,label:m.$t("main.force.refresh")},{default:t(()=>[e(Ae,{modelValue:s.value,"onUpdate:modelValue":E[0]||(E[0]=re=>s.value=re)},null,8,["modelValue"]),s.value?h("",!0):(u(),i(j,{key:0,closable:!1,title:m.$t("main.force.refresh.tip"),type:"warning"},null,8,["title"]))]),_:1},8,["label"])):h("",!0),D.value?(u(),i(F,{key:1,label:m.$t("main.slug")},{default:t(()=>[e(Le,{modelValue:a.value.customSlug,"onUpdate:modelValue":E[1]||(E[1]=re=>a.value.customSlug=re)},null,8,["modelValue"])]),_:1},8,["label"])):h("",!0),D.value?(u(),i(F,{key:2},{default:t(()=>[e(ae,{modelValue:a.value.checkList,"onUpdate:modelValue":E[2]||(E[2]=re=>a.value.checkList=re)},{default:t(()=>[e(Ve,{label:"1"},{default:t(()=>[Y(I(m.$t("main.use.google.translate")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})):h("",!0),D.value?(u(),i(F,{key:3,label:m.$t("main.use.hash")},{default:t(()=>[e(Ae,{modelValue:W.value,"onUpdate:modelValue":E[3]||(E[3]=re=>W.value=re)},null,8,["modelValue"]),W.value?h("",!0):(u(),i(j,{key:0,closable:!1,title:m.$t("main.use.hash.tip"),type:"warning"},null,8,["title"]))]),_:1},8,["label"])):h("",!0),D.value?(u(),i(F,{key:4},{default:t(()=>[e(Q,{loading:w.value,class:"make-slug-btn",type:"primary",onClick:U},{default:t(()=>[Y(I(w.value?m.$t("main.opt.loading"):m.$t("main.auto.fetch.slug")),1)]),_:1},8,["loading"])]),_:1})):h("",!0),D.value?(u(),i(F,{key:5,label:m.$t("main.desc")},{default:t(()=>[e(Le,{modelValue:a.value.desc,"onUpdate:modelValue":E[4]||(E[4]=re=>a.value.desc=re),type:"textarea"},null,8,["modelValue"])]),_:1},8,["label"])):h("",!0),D.value?(u(),i(F,{key:6},{default:t(()=>[e(Q,{loading:y.value,type:"primary",onClick:q},{default:t(()=>[Y(I(y.value?m.$t("main.opt.loading"):m.$t("main.auto.fetch.desc")),1)]),_:1},8,["loading"])]),_:1})):h("",!0),D.value?(u(),i(F,{key:7,label:m.$t("main.create.time")},{default:t(()=>[e(ft,{modelValue:a.value.created,"onUpdate:modelValue":E[5]||(E[5]=re=>a.value.created=re),placeholder:m.$t("main.create.time.placeholder"),format:"YYYY-MM-DD HH:mm:ss",type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss",onChange:L},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):h("",!0),e(F,{label:m.$t("main.tag")},{default:t(()=>[(u(!0),de(Ce,null,Ee(a.value.tag.dynamicTags,re=>(u(),i(ra,{key:re,"disable-transitions":!1,class:"mx-1",closable:"",onClose:yo=>ee(re)},{default:t(()=>[Y(I(re),1)]),_:2},1032,["onClose"]))),128)),a.value.tag.inputVisible?(u(),i(Le,{key:0,ref_key:"tagRefInput",ref:ce,modelValue:a.value.tag.inputValue,"onUpdate:modelValue":E[6]||(E[6]=re=>a.value.tag.inputValue=re),class:"ml-1 w-20",size:"small",onBlur:ge,onKeyup:Gt(ge,["enter"])},null,8,["modelValue","onKeyup"])):(u(),i(Q,{key:1,class:"button-new-tag ml-1 el-tag",size:"small",onClick:J},{default:t(()=>[Y(I(m.$t("main.tag.new")),1)]),_:1}))]),_:1},8,["label"]),D.value?(u(),i(F,{key:8},{default:t(()=>[e(Q,{loading:T.value,type:"primary",onClick:Pe},{default:t(()=>[Y(I(T.value?m.$t("main.opt.loading"):m.$t("main.auto.fetch.tag")),1)]),_:1},8,["loading"])]),_:1})):h("",!0),e(F,{label:m.$t("main.tag.auto.switch")},{default:t(()=>[e(Ae,{modelValue:f.value,"onUpdate:modelValue":E[7]||(E[7]=re=>f.value=re)},null,8,["modelValue"])]),_:1},8,["label"]),e(F,{label:m.$t("main.opt.quick")},{default:t(()=>[e(Q,{loading:A.value,type:"primary",onClick:z},{default:t(()=>[Y(I(A.value?m.$t("main.opt.loading"):m.$t("main.publish.oneclick.attr")),1)]),_:1},8,["loading"])]),_:1},8,["label"]),e(F,null,{default:t(()=>[e(Q,{type:"primary",onClick:le},{default:t(()=>[Y(I(m.$t("main.save.attr.to.siyuan")),1)]),_:1})]),_:1}),e(F,{label:m.$t("main.publish.vuepress.github")},{default:t(()=>[e(Ae,{modelValue:R.value,"onUpdate:modelValue":E[8]||(E[8]=re=>R.value=re),onChange:_},null,8,["modelValue"]),R.value?(u(),i(j,{key:0,closable:!1,title:m.$t("main.publish.vuepress.github.tip"),type:"info"},null,8,["title"])):h("",!0),R.value?h("",!0):(u(),i(j,{key:1,closable:!1,title:m.$t("main.publish.vuepress.github.no.tip"),type:"warning"},null,8,["title"]))]),_:1},8,["label"]),R.value?(u(),i(F,{key:9,label:m.$t("main.publish.vuepress.choose.path.use.default")},{default:t(()=>[e(Ae,{modelValue:G.value,"onUpdate:modelValue":E[9]||(E[9]=re=>G.value=re),onChange:O},null,8,["modelValue"]),G.value?(u(),i(j,{key:0,closable:!1,title:m.$t("main.publish.vuepress.choose.path.use.default.tip"),type:"info"},null,8,["title"])):h("",!0)]),_:1},8,["label"])):h("",!0),R.value&&!G.value?(u(),i(F,{key:10,label:m.$t("main.publish.vuepress.choose.path")},{default:t(()=>[e(pa,{modelValue:a.value.customPath,"onUpdate:modelValue":E[10]||(E[10]=re=>a.value.customPath=re),"check-strictly":!0,"empty-text":m.$t("main.cat.empty"),load:H,"no-data-text":m.$t("main.cat.empty"),placeholder:m.$t("main.cat.select"),props:B,lazy:""},null,8,["modelValue","empty-text","no-data-text","placeholder"])]),_:1},8,["label"])):h("",!0),R.value?(u(),i(F,{key:11,label:m.$t("main.publish.vuepress.choose.title")},{default:t(()=>[e(Le,{modelValue:a.value.title,"onUpdate:modelValue":E[11]||(E[11]=re=>a.value.title=re)},null,8,["modelValue"]),R.value?(u(),i(j,{key:0,closable:!1,title:m.$t("main.publish.vuepress.choose.title.tip"),type:"error"},null,8,["title"])):h("",!0)]),_:1},8,["label"])):h("",!0),e(F,null,{default:t(()=>[e(Q,{loading:c.value,type:"primary",onClick:pe},{default:t(()=>[Y(I(c.value?m.$t("main.publish.loading"):M.value?m.$t("main.update"):m.$t("main.publish")),1)]),_:1},8,["loading"])]),_:1}),e(F,null,{default:t(()=>[e(Q,{loading:V.value,onClick:ye},{default:t(()=>[Y(I(m.$t("main.cancel")),1)]),_:1},8,["loading"])]),_:1}),e(F,null,{default:t(()=>[e(Q,{disabled:"",text:"",type:"danger"},{default:t(()=>[Y(I(M.value?m.$t("main.publish.status.published"):m.$t("main.publish.status.unpublish")),1)]),_:1}),M.value?(u(),de("a",{key:0,href:X.value,title:X.value,target:"_blank"},I(m.$t("main.publish.vuepress.see.md.preview")),9,Wl)):h("",!0)]),_:1}),e(F,null,{default:t(()=>[M.value?(u(),de("a",{key:0,href:v.value,title:v.value,target:"_blank"},I(m.$t("main.publish.vuepress.see.real.preview")),9,ql)):h("",!0)]),_:1})]),_:1})]),je("div",Jl,[e(zt,{"label-width":"75px"},{default:t(()=>[e(F,null,{default:t(()=>[e(j,{closable:!1,title:m.$t("main.yaml.formatter"),class:"top-data-tip",type:"info"},null,8,["title"])]),_:1}),e(F,null,{default:t(()=>[e(Le,{ref_key:"fmtRefInput",ref:k,modelValue:r.value.vuepressFullContent,"onUpdate:modelValue":E[12]||(E[12]=re=>r.value.vuepressFullContent=re),autosize:{minRows:5,maxRows:8},type:"textarea",onFocus:ne},null,8,["modelValue"])]),_:1}),e(F,null,{default:t(()=>[e(Q,{type:"primary",onClick:Ge},{default:t(()=>[Y(I(m.$t("main.siyuan.to.yaml")),1)]),_:1})]),_:1}),e(F,null,{default:t(()=>[e(Q,{type:"primary",onClick:et},{default:t(()=>[Y(I(m.$t("main.yaml.to.siyuan")),1)]),_:1})]),_:1}),e(F,null,{default:t(()=>[e(Q,{type:"primary",onClick:Z},{default:t(()=>[Y(I(m.$t("main.copy")),1)]),_:1})]),_:1})]),_:1})])]),_:1})),e(ca,{loading:$.value,rows:5,animated:""},null,8,["loading"])])}}}),zl=ue({__name:"VuepressMain",props:{pageId:{type:String,default:void 0}},setup(n){const o=n,l=p(te.API_TYPE_VUEPRESS);return(d,g)=>(u(),i(mt,{"api-type":l.value,"page-id":o.pageId},null,8,["api-type","page-id"]))}}),Xl=ue({__name:"HugoMain",props:{pageId:{type:String,default:void 0}},setup(n){const o=n,l=p(te.API_TYPE_HUGO);return(d,g)=>(u(),i(mt,{"api-type":l.value,"page-id":o.pageId},null,8,["api-type","page-id"]))}}),Ql=ue({__name:"HexoMain",props:{pageId:{type:String,default:void 0}},setup(n){const o=n,l=p(te.API_TYPE_HEXO);return(d,g)=>(u(),i(mt,{"api-type":l.value,"page-id":o.pageId},null,8,["api-type","page-id"]))}}),Zl=ue({__name:"JekyllMain",props:{pageId:{type:String,default:void 0}},setup(n){const o=n,l=p(te.API_TYPE_JEKYLL);return(d,g)=>(u(),i(mt,{"api-type":l.value,"page-id":o.pageId},null,8,["api-type","page-id"]))}}),xl=["href","title"],eo=ue({__name:"MetaweblogMain",props:{isReload:{type:Boolean,default:!1},apiType:{type:String,default:""},useAdaptor:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(n){const o=n,l=we.getLogger("components/publish/tab/main/MetaweblogMain.vue"),d=new ot,{t:g}=He(),w=p(""),y=p(g("setting.blog.platform.support.metaweblog")+o.apiType+" "),T=p(!1),A=p(!1),c=p(!1),V=p(!1),$=p(!1),D=p(!1),W=p(!1),R=p(!1),G=p(!1),M=p(!1),X=p(!1),v=p(!1),s=p(""),f=p(!1),a=Te({postid:"",title:"",customSlug:"",desc:"",created:"",checkList:["1"],tag:{inputValue:"",dynamicTags:[],inputVisible:!1},cat:{categorySelected:[],categoryList:[]},categories:["\u9ED8\u8BA4\u5206\u7C7B"]}),b=Te({pageId:"",meta:{tags:""}}),r=()=>{G.value=!1},C=()=>{G.value=!0},x=async()=>{R.value=!0;const k=await _t(!0,o.pageId);if(!k||k==="")return;const Z=_e(o.apiType);rt(Z)||(w.value=Z.blogName),X.value=!0,b.pageId=k,b.meta=await d.getBlockAttrs(k);const ne=await d.getBlockByID(k);if(!ne)throw R.value=!1,K.error(g("config.error.msg")+"_"+o.apiType),new Error(g("config.error.msg")+"_"+o.apiType);l.debug("MetaweblogMain\u521D\u59CB\u5316\u9875\u9762,meta=>",b.meta),a.title=ne.content,a.customSlug=b.meta[De.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY],a.desc=b.meta[De.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY],a.created=ht(ne.created),a.tag.dynamicTags=[];const O=(b.meta.tags||"").split(",");for(let ie=0;ie<O.length;ie++)O[ie]!==""&&a.tag.dynamicTags.push(O[ie]);v.value=qt(o.apiType,b.meta);const B=_e(o.apiType),H=new Ne(o.apiType);let pe=[];if(v.value){const ie=b.meta;a.postid=ie[B.posidKey],s.value=await H.getPreviewUrl(a.postid.toString());try{const oe=await H.getPost(a.postid.toString());pe=oe.categories,l.debug("postid=>",a.postid),l.debug("post=>",oe),l.debug("\u521D\u59CB\u5316\u9009\u62E9\u8FC7\u7684\u5206\u7C7B,catData=>",pe)}catch(oe){K.error(g("post.delete.by.platform")),R.value=!1,l.error("\u6587\u7AE0\u65B0\u83B7\u53D6\u5931\u8D25",oe)}}let z=[];try{z=await H.getCategories()}catch(ie){R.value=!1,l.error("\u5206\u7C7B\u83B7\u53D6\u5931\u8D25",ie)}const ye=[];z&&z.length&&z.length>0&&(z.forEach(ie=>{const oe={value:ie.description,label:ie.description};ye.push(oe)}),a.cat.categoryList=ye),a.cat.categorySelected=pe,a.categories=pe,T.value=Z.apiStatus,R.value=!1};Fe(async()=>{await x()});function ve(){return Qe(a.customSlug)||M.value?!0:(l.debug(g("main.force.refresh.tip")),!1)}const S=async k=>{if(!ve())return;A.value=!0;const Z=await d.getBlockByID(b.pageId);l.debug("page=>",Z);let ne=Z.content;if(ne.indexOf(".")>-1&&(ne=ne.replace(/\d*\./g,"")),l.debug("fmtTitle=>",ne),a.checkList.length>0){const _=await Ft(ne);l.debug("result=>",_),_?a.customSlug=_:K.success(g("main.opt.failure"))}else a.customSlug=await Kt(ne);if(X.value){const _=Z.content+new Date().toISOString(),O="-"+jt(_).toLowerCase();a.customSlug+=O}A.value=!1,k!==!0&&K.success(g("main.opt.success"))},P=async k=>{c.value=!0;const ne=(await d.exportMdContent(b.pageId)).content,_=Yt(ne);a.desc=Ot(_,Ht.MAX_PREVIEW_LENGTH,!0),c.value=!1,k!==!0&&K.success(g("main.opt.success"))},U=k=>{a.tag.dynamicTags.splice(a.tag.dynamicTags.indexOf(k),1)},q=p(),L=()=>{a.tag.inputVisible=!0,bt(()=>{q.value.focus()})},ee=()=>{a.tag.inputValue&&a.tag.dynamicTags.push(a.tag.inputValue),a.tag.inputVisible=!1,a.tag.inputValue=""};async function ce(k){if(!f.value){K.warning(g("main.tag.auto.switch.no.tip"));return}V.value=!0;const ne=(await d.exportMdContent(b.pageId)).content,_=await Mt(ne);l.debug("genTags=>",_);const O=Lt(_,5);l.debug("hotTags=>",O);for(let B=0;B<O.length;B++)a.tag.dynamicTags.includes(O[B])||a.tag.dynamicTags.push(O[B]);V.value=!1,k!==!0&&K.success(g("main.opt.success"))}const J=async k=>{const Z={[De.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY]:a.customSlug,[De.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY]:a.desc,tags:a.tag.dynamicTags.join(",")};await d.setBlockAttrs(b.pageId,Z),l.debug("MetaweblogMain\u4FDD\u5B58\u5C5E\u6027\u5230\u601D\u6E90\u7B14\u8BB0,meta=>",Z),k!==!0&&(await x(),K.success(g("main.opt.success")))},ge=(k,Z,ne,_)=>{},Pe=(k,Z)=>{console.log("data=>",k),console.log("status=>",Z);const ne=[];Z.checkedKeys.forEach(O=>{ne.push(O.toString())}),a.categories=ne,l.debug(" formData.categories=>",a.categories)},le=async k=>{$.value=!0,await S(!0),await P(!0),await ce(!0),await J(!0),l.debug("\u53D1\u5E03\u5C5E\u6027\u5B8C\u6210"),$.value=!1,k!==!0&&K.success(g("main.publish.oneclick.attr.finish"))},Ke=async()=>{if(!T.value){K.error(g("setting.blog.vali.tip.metaweblog"));return}D.value=!0;try{await le(!0);const k=_e(o.apiType),Z=new Ne(o.apiType),ne=Rt(a.title);let _;const B=(await d.exportMdContent(b.pageId)).content;if(Se.Html===k.pageType){const ye=oa(B);_=ua(ye)}else _=Nt(B);const H=new Bt;H.title=ne,H.wp_slug=a.customSlug,H.description=_,H.categories=a.categories,H.mt_keywords=a.tag.dynamicTags.join(","),o.apiType===te.API_TYPE_CNBLOGS&&H.categories.push("[Markdown]"),H.dateCreated=new Date;const pe=!0;let z;if(v.value){if(z=a.postid,!await Z.editPost(z,H,!0))throw K.error("\u6587\u7AE0\u66F4\u65B0\u5931\u8D25"),new Error("\u6587\u7AE0\u66F4\u65B0\u5931\u8D25=>"+z);l.debug("\u6587\u7AE0\u5DF2\u66F4\u65B0\uFF0Cpostid=>",z)}else{z=await Z.newPost(H,pe),l.debug("\u5F53\u524D\u4FDD\u5B58\u7684posidKey=>",k.posidKey);const ye={[k.posidKey]:z};await d.setBlockAttrs(b.pageId,ye),l.debug("MetaweblogMain\u53D1\u5E03\u6210\u529F\uFF0C\u4FDD\u5B58postid,meta=>",ye),l.info("\u6587\u7AE0\u53D1\u5E03\u6210\u529F\uFF0Cpostid=>",z)}await x(),K.success(g("main.opt.success"))}catch(k){throw l.error("\u53D1\u5E03\u5F02\u5E38"),K.error(g("main.opt.failure")),k}D.value=!1},Ge=async()=>{W.value=!0,at.confirm(g("main.opt.warning.tip"),g("main.opt.warning"),{confirmButtonText:g("main.opt.ok"),cancelButtonText:g("main.opt.cancel"),type:"warning"}).then(async()=>{await et(!0),W.value=!1,K.warning(g("main.opt.status.cancel"))}).catch(k=>{throw K({type:"error",message:g("main.opt.failure")}),W.value=!1,new Error(k)})},et=async k=>{const Z=_e(o.apiType);l.debug("\u51C6\u5907\u53D6\u6D88\u53D1\u5E03\uFF0Cpostid=>",a.postid);const ne={[Z.posidKey]:""};await d.setBlockAttrs(b.pageId,ne),l.debug("MetaweblogMain\u53D6\u6D88\u53D1\u5E03,meta=>",ne);try{await new Ne(o.apiType).deletePost(a.postid)||K.error("\u6587\u7AE0\u5220\u9664\u5931\u8D25")}catch(_){l.error("\u5F3A\u884C\u5220\u9664\u4E00\u6B21",_)}k&&await x()};return(k,Z)=>{const ne=Be,_=Re,O=ut,B=Oe,H=nt,pe=We,z=It,ye=Dt,ie=Pt,oe=At,m=aa,E=Me,j=Tt,Q=Ut,be=vt;return u(),i(be,null,{default:t(()=>[R.value?h("",!0):(u(),i(j,{key:0,class:"blog-main"},{default:t(()=>[e(ne,{class:"top-version-tip",title:y.value+w.value,type:"info",closable:!1},null,8,["title"]),T.value?h("",!0):(u(),i(ne,{key:0,class:"top-version-tip",title:k.$t("setting.blog.vali.tip.metaweblog"),type:"error",closable:!1},null,8,["title"])),n.useAdaptor?(u(),i(ne,{key:1,class:"top-version-tip",title:k.$t("setting.conf.tip"),type:"info",closable:!1},null,8,["title"])):h("",!0),e(E,{"label-width":"120px"},{default:t(()=>[e(B,{label:k.$t("main.publish.editmode")},{default:t(()=>[e(O,null,{default:t(()=>[e(_,{type:G.value?"default":"primary",onClick:r},{default:t(()=>[Y(I(k.$t("main.publish.editmode.simple")),1)]),_:1},8,["type"]),e(_,{type:G.value?"primary":"default",onClick:C},{default:t(()=>[Y(I(k.$t("main.publish.editmode.complex")),1)]),_:1},8,["type"])]),_:1})]),_:1},8,["label"]),G.value?(u(),i(B,{key:0,label:k.$t("main.force.refresh")},{default:t(()=>[e(H,{modelValue:M.value,"onUpdate:modelValue":Z[0]||(Z[0]=F=>M.value=F)},null,8,["modelValue"]),M.value?h("",!0):(u(),i(ne,{key:0,title:k.$t("main.force.refresh.tip"),type:"warning",closable:!1},null,8,["title"]))]),_:1},8,["label"])):h("",!0),G.value?(u(),i(B,{key:1,label:k.$t("main.slug")},{default:t(()=>[e(pe,{modelValue:a.customSlug,"onUpdate:modelValue":Z[1]||(Z[1]=F=>a.customSlug=F)},null,8,["modelValue"])]),_:1},8,["label"])):h("",!0),G.value?(u(),i(B,{key:2},{default:t(()=>[e(ye,{modelValue:a.checkList,"onUpdate:modelValue":Z[2]||(Z[2]=F=>a.checkList=F)},{default:t(()=>[e(z,{label:"1"},{default:t(()=>[Y(I(k.$t("main.use.google.translate")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})):h("",!0),G.value?(u(),i(B,{key:3},{default:t(()=>[e(_,{type:"primary",class:"make-slug-btn",onClick:S,loading:A.value},{default:t(()=>[Y(I(A.value?k.$t("main.opt.loading"):k.$t("main.auto.fetch.slug")),1)]),_:1},8,["loading"])]),_:1})):h("",!0),G.value?(u(),i(B,{key:4,label:k.$t("main.use.hash")},{default:t(()=>[e(H,{modelValue:X.value,"onUpdate:modelValue":Z[3]||(Z[3]=F=>X.value=F)},null,8,["modelValue"]),X.value?h("",!0):(u(),i(ne,{key:0,title:k.$t("main.use.hash.tip"),type:"warning",closable:!1},null,8,["title"]))]),_:1},8,["label"])):h("",!0),G.value?(u(),i(B,{key:5,label:k.$t("main.desc")},{default:t(()=>[e(pe,{type:"textarea",modelValue:a.desc,"onUpdate:modelValue":Z[4]||(Z[4]=F=>a.desc=F)},null,8,["modelValue"])]),_:1},8,["label"])):h("",!0),G.value?(u(),i(B,{key:6},{default:t(()=>[e(_,{type:"primary",onClick:P,loading:c.value},{default:t(()=>[Y(I(c.value?k.$t("main.opt.loading"):k.$t("main.auto.fetch.desc")),1)]),_:1},8,["loading"])]),_:1})):h("",!0),G.value?(u(),i(B,{key:7,label:k.$t("main.create.time")},{default:t(()=>[e(ie,{type:"datetime",modelValue:a.created,"onUpdate:modelValue":Z[5]||(Z[5]=F=>a.created=F),format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:k.$t("main.create.time.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):h("",!0),e(B,{label:k.$t("main.tag")},{default:t(()=>[(u(!0),de(Ce,null,Ee(a.tag.dynamicTags,F=>(u(),i(oe,{key:F,class:"mx-1",closable:"","disable-transitions":!1,onClose:Ae=>U(F)},{default:t(()=>[Y(I(F),1)]),_:2},1032,["onClose"]))),128)),a.tag.inputVisible?(u(),i(pe,{key:0,ref_key:"tagRefInput",ref:q,modelValue:a.tag.inputValue,"onUpdate:modelValue":Z[6]||(Z[6]=F=>a.tag.inputValue=F),class:"ml-1 w-20",size:"small",onKeyup:Gt(ee,["enter"]),onBlur:ee},null,8,["modelValue","onKeyup"])):(u(),i(_,{key:1,class:"button-new-tag ml-1 el-tag",size:"small",onClick:L},{default:t(()=>[Y(I(k.$t("main.tag.new")),1)]),_:1}))]),_:1},8,["label"]),G.value?(u(),i(B,{key:8},{default:t(()=>[e(_,{type:"primary",onClick:ce,loading:V.value},{default:t(()=>[Y(I(V.value?k.$t("main.opt.loading"):k.$t("main.auto.fetch.tag")),1)]),_:1},8,["loading"])]),_:1})):h("",!0),e(B,{label:k.$t("main.tag.auto.switch")},{default:t(()=>[e(H,{modelValue:f.value,"onUpdate:modelValue":Z[7]||(Z[7]=F=>f.value=F)},null,8,["modelValue"])]),_:1},8,["label"]),e(B,{label:k.$t("main.cat"),style:{width:"100%"}},{default:t(()=>[e(m,{style:{width:"100%"},modelValue:a.cat.categorySelected,"onUpdate:modelValue":Z[8]||(Z[8]=F=>a.cat.categorySelected=F),data:a.cat.categoryList,multiple:"","tag-type":"info","check-on-click-node":!0,"render-after-expand":!1,"show-checkbox":"",placeholder:k.$t("main.cat.select"),"empty-text":k.$t("main.cat.empty"),"no-data-text":k.$t("main.cat.empty"),onNodeClick:ge,onCheck:Pe},null,8,["modelValue","data","placeholder","empty-text","no-data-text"])]),_:1},8,["label"]),e(B,{label:k.$t("main.opt.quick")},{default:t(()=>[e(_,{type:"primary",onClick:le,loading:$.value},{default:t(()=>[Y(I($.value?k.$t("main.opt.loading"):k.$t("main.publish.oneclick.attr")),1)]),_:1},8,["loading"])]),_:1},8,["label"]),e(B,null,{default:t(()=>[e(_,{type:"primary",onClick:J},{default:t(()=>[Y(I(k.$t("main.save.attr.to.siyuan")),1)]),_:1})]),_:1}),e(B,{label:""},{default:t(()=>[e(_,{type:"primary",onClick:Ke,loading:D.value},{default:t(()=>[Y(I(D.value?k.$t("main.publish.loading"):v.value?k.$t("main.update"):k.$t("main.publish")),1)]),_:1},8,["loading"]),e(_,{onClick:Ge,loading:W.value},{default:t(()=>[Y(I(k.$t("main.cancel")),1)]),_:1},8,["loading"])]),_:1}),e(B,null,{default:t(()=>[e(_,{type:"danger",text:"",disabled:""},{default:t(()=>[Y(I(v.value?k.$t("main.publish.status.published"):k.$t("main.publish.status.unpublish")),1)]),_:1}),v.value?(u(),de("a",{key:0,href:s.value,title:s.value,target:"_blank"},I(k.$t("main.publish.vuepress.see.preview")),9,xl)):h("",!0)]),_:1})]),_:1})]),_:1})),e(Q,{loading:R.value,rows:5,animated:""},null,8,["loading"])]),_:1})}}});const Ze=st(eo,[["__scopeId","data-v-8e723bdb"]]),to=ue({__name:"JVueMain",props:{pageId:{type:String,default:void 0}},setup(n){const o=n,l=p(te.API_TYPE_JVUE);return(d,g)=>(u(),i(Ze,{"api-type":l.value,"page-id":o.pageId},null,8,["api-type","page-id"]))}}),ao=ue({__name:"ConfluenceMain",props:{pageId:{type:String,default:void 0}},setup(n){const o=n,l=p(te.API_TYPE_CONFLUENCE);return(d,g)=>(u(),i(Ze,{"api-type":l.value,"use-adaptor":!0,"page-id":o.pageId},null,8,["api-type","page-id"]))}}),lo=ue({__name:"CnblogsMain",props:{pageId:{type:String,default:void 0}},setup(n){const o=n,l=p(te.API_TYPE_CNBLOGS);return(d,g)=>(u(),i(Ze,{"api-type":l.value,"page-id":o.pageId},null,8,["api-type","page-id"]))}}),oo=ue({__name:"WordpressMain",props:{pageId:{type:String,default:void 0}},setup(n){const o=n,l=p(te.API_TYPE_WORDPRESS);return(d,g)=>(u(),i(Ze,{"api-type":l.value,"page-id":o.pageId},null,8,["api-type","page-id"]))}}),uo=/.(gif|jpe?g|tiff?|png|webp|bmp|ico)$/i;async function no(n){let o="";if(n.uri){const l=new URL(n.uri);o=(await(await Oa(l)).buffer()).toString("base64")}else if(n.path&&uo.test(n.path))(await(void 0)(n.path)).isFile()&&(o=(await(void 0)(Ya(n.path))).toString("base64"));else throw new Error("Didn't get an image or a good uri for the appropriate param");return{base64:o}}class so{constructor(){me(this,"logger",we.getLogger("utils/parser/imageParser.ts"))}hasExternalImages(o){const d=/!\[.*]\((http|https):\/.*\/.*\)/g,g=o.match(d);if(g!=null&&g.length>0)return!0;const w=/!\[.*]\((data:image):\/.*\/.*\)/g,y=o.match(w);return y!=null&&y.length>0}removeImages(o){let l=o;return l=l.replace(/!\[.*]\((http|https):\/.*\/.*\)/g,""),l}async replaceImagesWithBase64(o){var w,y,T;let l=o;const d=/!\[.*]\((http|https):\/.*\/.*\)/g,g=l.match(d);if(g==null||g.length===0)return l;for(let A=0;A<g.length;A++){const c=g[A];this.logger.debug("img=>",c);const V=c.replace(/!\[]\(/g,"").replace(/\)/,"");this.logger.debug("src=>",V);let $;if(Va()){const D=await no({uri:V});$=(w=D==null?void 0:D.base64)!=null?w:"no pic"}else{const W=$a("VITE_MIDDLEWARE_URL","/api/middleware")+"/imageToBase64",R={fetchParams:{imgUrl:V}},G={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(R)};this.logger.debug("middleApiUrl=>",W),this.logger.debug("middleFetchOption=>",G);const X=await(await fetch(W,G)).json();this.logger.debug("resJson=>",X),$=(T=(y=X==null?void 0:X.body)==null?void 0:y.base64str)!=null?T:"parse error"}$=la('<img src="data:image/png;base64,',$,'"  alt="base64Image"/>'),l=l.replace(c,$)}return l}replaceImagesWithAscii(o){return o}replaceImagesWithColorAscii(o){return o}async uploadImageToBeds(o){return o}async downloadMdWithImages(){}async downloadImagesToSiyuan(){throw new Error("\u601D\u6E90\u7B14\u8BB0\u5DF2\u7ECF\u6709\u6B64\u529F\u80FD\uFF0C\u65E0\u9700\u91CD\u65B0\u5B9E\u73B0")}}const io=["href","title"],ro=ue({__name:"CommonBlogMain",props:{isReload:{type:Boolean,default:!1},useCat:{type:Boolean,default:!1},apiType:{type:String,default:""},cfg:{type:gt,default:null},pageId:{type:String,default:void 0},limitRate:{type:Boolean,default:!1},limitSeconds:{type:Number,default:5},imageToBase64:{type:Boolean,default:!1},removeImage:{type:Boolean,default:!1}},setup(n){const o=n,l=we.getLogger("components/publish/tab/main/CommonBlogMain.vue"),d=new ot,g=new so,{t:w}=He(),y=p(""),T=p(w("setting.blog.platform.support.common")+o.apiType+" "),A=p(!1),c=p(!1),V=p(!1),$=p(!1),D=p(!1),W=p(!1),R=p(!1),G=p(!1),M=p(!1),X=p(!1),v=p(!1),s=p(!1),f=p(""),a=p(!1),b=p(!1),r=Te({postid:"",title:"",customSlug:"",desc:"",created:"",checkList:["1"],tag:{inputValue:"",dynamicTags:[],inputVisible:!1},cat:{categorySelected:"",categoryList:[]},categories:["\u9ED8\u8BA4\u5206\u7C7B"],cat_slugs:[]}),C=Te({pageId:"",meta:{tags:""}}),x=()=>{M.value=!1},ve=()=>{M.value=!0},S=async()=>{G.value=!0;const _=await _t(!0,o.pageId);if(!_||_==="")return;const O=_e(o.apiType);rt(O)||(y.value=O.blogName||""),v.value=!0,C.pageId=_,C.meta=await d.getBlockAttrs(_);let B;try{B=await d.getBlockByID(_)}catch(m){throw G.value=!1,l.error("\u9875\u9762\u4FE1\u606F\u83B7\u53D6\u5931\u8D25",m),new Error("\u9875\u9762\u4FE1\u606F\u83B7\u53D6\u5931\u8D25")}if(!B)throw G.value=!1,K.error(w("config.error.msg")+"_"+o.apiType),new Error(w("config.error.msg")+"_"+o.apiType);l.debug("CommonblogMain\u521D\u59CB\u5316\u9875\u9762,meta=>",C.meta),r.title=B.content,r.customSlug=C.meta[De.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY],r.desc=C.meta[De.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY],r.created=ht(B.created),r.tag.dynamicTags=[];const pe=(C.meta.tags||"").split(",");for(let m=0;m<pe.length;m++)pe[m]!==""&&r.tag.dynamicTags.push(pe[m]);s.value=qt(o.apiType,C.meta),b.value=!s.value;const z=_e(o.apiType),ye=new Ne(o.apiType);let ie=[],oe=[];if(s.value){const m=C.meta;if(r.postid=m[z.posidKey||""],f.value=await ye.getPreviewUrl(r.postid.toString()),o.useCat)try{const E=await ye.getPost(r.postid.toString());ie=E.categories,oe=E.cate_slugs,l.debug("postid=>",r.postid),l.debug("post=>",E),l.debug("\u521D\u59CB\u5316\u9009\u62E9\u8FC7\u7684\u5206\u7C7B,catData=>",ie)}catch(E){K.error(w("post.delete.by.platform")),G.value=!1,l.error("\u5E73\u53F0\u6587\u7AE0\u65B0\u83B7\u53D6\u5931\u8D25",E)}}else if(o.useCat&&!Qe(z.blogName)){const m=[],E=[];m.push(z.blogName),ie=m,E.push(z.blogid),oe=E}if(o.useCat){let m=[];try{m=await ye.getCategories()}catch(j){G.value=!1,l.error("\u5206\u7C7B\u83B7\u53D6\u5931\u8D25",j)}const E=[];m&&m.length&&m.length>0&&(m.forEach(j=>{const Q={value:j.categoryId,label:j.description};E.push(Q)}),r.cat.categoryList=E),r.cat.categorySelected=ie.length>0?ie[0]:"",y.value=r.cat.categorySelected,r.categories=ie,r.cat_slugs=oe}A.value=O.apiStatus||!1,G.value=!1};Fe(async()=>{await S()});function P(){return Qe(r.customSlug)||X.value?!0:(l.debug(w("main.force.refresh.tip")),!1)}const U=async _=>{if(!P())return;c.value=!0;const O=await d.getBlockByID(C.pageId);l.debug("page=>",O);let B=O.content;if(B.indexOf(".")>-1&&(B=B.replace(/\d*\./g,"")),l.debug("fmtTitle=>",B),r.checkList.length>0){const H=await Ft(B);l.debug("result=>",H),H?r.customSlug=H:K.success(w("main.opt.failure"))}else r.customSlug=await Kt(B);if(v.value){const H=O.content+new Date().toISOString(),pe="-"+jt(H).toLowerCase();r.customSlug+=pe}c.value=!1,_!==!0&&K.success(w("main.opt.success"))},q=async _=>{V.value=!0;const B=(await d.exportMdContent(C.pageId)).content,H=Yt(B);r.desc=Ot(H,Ht.MAX_PREVIEW_LENGTH,!0),V.value=!1,_!==!0&&K.success(w("main.opt.success"))},L=_=>{r.tag.dynamicTags.splice(r.tag.dynamicTags.indexOf(_),1)},ee=p(),ce=()=>{r.tag.inputVisible=!0,bt(()=>{ee.value.focus()})},J=()=>{r.tag.inputValue&&r.tag.dynamicTags.push(r.tag.inputValue),r.tag.inputVisible=!1,r.tag.inputValue=""};async function ge(_){if(!a.value){K.warning(w("main.tag.auto.switch.no.tip"));return}$.value=!0;const B=(await d.exportMdContent(C.pageId)).content,H=await Mt(B);l.debug("genTags=>",H);const pe=Lt(H,5);l.debug("hotTags=>",pe);for(let z=0;z<pe.length;z++)r.tag.dynamicTags.includes(pe[z])||r.tag.dynamicTags.push(pe[z]);$.value=!1,_!==!0&&K.success(w("main.opt.success"))}const Pe=_=>{l.debug("val=>",_);const O=_e(o.apiType),B=[],H=[];B.push(_.label),r.categories=B,H.push(O.username+"/"+_.value),r.cat_slugs=H,y.value=_.label,l.debug(" formData.categories=>",r.categories),l.debug(" formData.cat_slugs=>",r.cat_slugs)},le=async _=>{const O={[De.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY]:r.customSlug,[De.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY]:r.desc,tags:r.tag.dynamicTags.join(",")};await d.setBlockAttrs(C.pageId,O),l.debug("CommonblogMain\u4FDD\u5B58\u5C5E\u6027\u5230\u601D\u6E90\u7B14\u8BB0,meta=>",O),_!==!0&&(await S(),K.success(w("main.opt.success")))},Ke=async _=>{D.value=!0,await U(!0),await q(!0),await ge(!0),await le(!0),l.debug("\u53D1\u5E03\u5C5E\u6027\u5B8C\u6210"),D.value=!1,_!==!0&&K.success(w("main.publish.oneclick.attr.finish"))},Ge=_=>{const B=Da(_);if(Qe(B))return!1;l.debug("checkLimit lastmodKey=>",_),l.debug("checkLimit lastmodDate=>",B);const H=Na(B);return H<=o.limitSeconds?(K.error("\u7531\u4E8E\u3010"+o.apiType+"\u3011\u5E73\u53F0\u7684\u9650\u5236\uFF0C\u6BCF6\u5206\u949F\u4E4B\u5185\u53EA\u80FD\u53D1\u5E03\u6216\u8005\u66F4\u65B0\u4E00\u6B21\u6587\u7AE0\uFF0C\u8DDD\u79BB\u4E0A\u4E00\u6B21\u53D1\u5E03\u65F6\u95F4\u4E3A\uFF1A"+H+"\u79D2\uFF0C\u4ECD\u9700\u7B49\u5F85\uFF1A"+(o.limitSeconds-H)+"\u79D2"),!0):!1},et=async()=>{const O=(await d.exportMdContent(C.pageId)).content;o.removeImage&&g.hasExternalImages(O)?at.confirm("\u68C0\u6D4B\u5230\u5916\u94FE\u56FE\u7247\uFF0C\u7531\u4E8E\u5E73\u53F0\u9650\u5236\uFF0C\u7EE7\u7EED\u53D1\u5E03\u5C06\u5254\u9664\u8FD9\u4E9B\u56FE\u7247\uFF0C\u4EE5\u7EAF\u6587\u672C\u53D1\u5E03\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F",w("main.opt.warning"),{confirmButtonText:w("main.opt.ok"),cancelButtonText:w("main.opt.cancel"),type:"warning"}).then(async()=>{await k()}).catch(()=>{}):await k()},k=async()=>{if(!A.value){K.error(w("setting.blog.vali.tip.metaweblog"));return}W.value=!0;try{const _=o.apiType+"_PUBLISH_LIMIT";if(Ge(_)){W.value=!1;return}l.debug("\u9A8C\u8BC1\u901A\u8FC7\uFF0C\u66F4\u65B0\u53D1\u5E03\u65F6\u95F4");const O=new Date().toISOString();Ia(_,O),await Ke(!0);const B=_e(o.apiType),H=new Ne(o.apiType),pe=Rt(r.title);let z,ie=(await d.exportMdContent(C.pageId)).content;if(o.removeImage&&(ie=g.removeImages(ie)),Se.Html===B.pageType){const j=oa(ie);z=ua(j)}else z=Nt(ie);const oe=new Bt;oe.title=pe,oe.wp_slug=r.customSlug,oe.description=z,oe.categories=r.categories,oe.cate_slugs=r.cat_slugs,oe.mt_keywords=r.tag.dynamicTags.join(","),oe.dateCreated=new Date;const m=!0;let E;if(s.value){if(E=r.postid,!await H.editPost(E,oe,!0))throw K.error("\u6587\u7AE0\u66F4\u65B0\u5931\u8D25"),new Error("\u6587\u7AE0\u66F4\u65B0\u5931\u8D25=>"+E);l.debug("\u6587\u7AE0\u5DF2\u66F4\u65B0\uFF0Cpostid=>",E)}else{if(E=await H.newPost(oe,m),oe.cate_slugs&&oe.cate_slugs.length>0){const Q=oe.cate_slugs[0];E=E+"_"+Q}l.debug("\u5F53\u524D\u4FDD\u5B58\u7684posidKey=>",B.posidKey);const j={[B.posidKey||""]:E};await d.setBlockAttrs(C.pageId,j),l.debug("CommonblogMain\u53D1\u5E03\u6210\u529F\uFF0C\u4FDD\u5B58postid,meta=>",j),l.debug("\u6587\u7AE0\u53D1\u5E03\u6210\u529F\uFF0Cpostid=>",E)}await S(),K.success(w("main.opt.success"))}catch(_){W.value=!1,l.error("\u53D1\u5E03\u5F02\u5E38",_),K.error({dangerouslyUseHTMLString:!0,message:w("main.opt.failure")+"=>"+_})}W.value=!1},Z=async()=>{R.value=!0,at.confirm(w("main.opt.warning.tip"),w("main.opt.warning"),{confirmButtonText:w("main.opt.ok"),cancelButtonText:w("main.opt.cancel"),type:"warning"}).then(async()=>{await ne(!0),R.value=!1,K.warning(w("main.opt.status.cancel"))}).catch(_=>{throw K({type:"error",message:w("main.opt.failure")}),R.value=!1,new Error(_)})},ne=async _=>{const O=_e(o.apiType);l.debug("\u51C6\u5907\u53D6\u6D88\u53D1\u5E03\uFF0Cpostid=>",r.postid);const B={[O.posidKey||""]:""};await d.setBlockAttrs(C.pageId,B),l.debug("MetaweblogMain\u53D6\u6D88\u53D1\u5E03,meta=>",B);try{if(!await new Ne(o.apiType).deletePost(r.postid))throw K.error("\u6587\u7AE0\u5220\u9664\u5931\u8D25"),new Error("\u6587\u7AE0\u5220\u9664\u5931\u8D25")}catch(H){l.error("\u5F3A\u884C\u5220\u9664\u4E00\u6B21",H)}_&&await S()};return(_,O)=>{const B=Be,H=Re,pe=ut,z=Oe,ye=nt,ie=We,oe=It,m=Dt,E=Pt,j=At,Q=St,be=kt,F=Me,Ae=Tt,Le=Ut,Ve=vt;return u(),i(Ve,null,{default:t(()=>[G.value?h("",!0):(u(),i(Ae,{key:0,class:"common-main"},{default:t(()=>[e(B,{class:"top-version-tip",title:T.value+y.value,type:"info",closable:!1},null,8,["title"]),n.useCat&&s.value?(u(),i(B,{key:0,class:"top-version-tip",title:"\u4EC5\u652F\u6301\u65B0\u5EFA\u4FEE\u6539\uFF0C\u6682\u65F6\u4E0D\u652F\u6301\u7F16\u8F91\u6240\u5C5E\u77E5\u8BC6\u5E93\u3002\u5982\u679C\u60A8\u60F3\u79FB\u52A8\u6587\u6863\uFF0C\u8BF7\u5148\u70B9\u51FB\u53D6\u6D88\u5220\u9664\u8BE5\u6587\u6863\uFF0C\u7136\u540E\u91CD\u65B0\u9009\u62E9\u65B0\u7684\u77E5\u8BC6\u5E93\u53D1\u5E03\u3002",type:"warning",closable:!1})):h("",!0),A.value?h("",!0):(u(),i(B,{key:1,class:"top-version-tip",title:_.$t("setting.blog.vali.tip.metaweblog"),type:"error",closable:!1},null,8,["title"])),e(F,{"label-width":"120px"},{default:t(()=>[e(z,{label:_.$t("main.publish.editmode")},{default:t(()=>[e(pe,null,{default:t(()=>[e(H,{type:M.value?"default":"primary",onClick:x},{default:t(()=>[Y(I(_.$t("main.publish.editmode.simple")),1)]),_:1},8,["type"]),e(H,{type:M.value?"primary":"default",onClick:ve},{default:t(()=>[Y(I(_.$t("main.publish.editmode.complex")),1)]),_:1},8,["type"])]),_:1})]),_:1},8,["label"]),M.value?(u(),i(z,{key:0,label:_.$t("main.force.refresh")},{default:t(()=>[e(ye,{modelValue:X.value,"onUpdate:modelValue":O[0]||(O[0]=ae=>X.value=ae)},null,8,["modelValue"]),X.value?h("",!0):(u(),i(B,{key:0,title:_.$t("main.force.refresh.tip"),type:"warning",closable:!1},null,8,["title"]))]),_:1},8,["label"])):h("",!0),M.value?(u(),i(z,{key:1,label:_.$t("main.slug")},{default:t(()=>[e(ie,{modelValue:r.customSlug,"onUpdate:modelValue":O[1]||(O[1]=ae=>r.customSlug=ae)},null,8,["modelValue"])]),_:1},8,["label"])):h("",!0),M.value?(u(),i(z,{key:2},{default:t(()=>[e(m,{modelValue:r.checkList,"onUpdate:modelValue":O[2]||(O[2]=ae=>r.checkList=ae)},{default:t(()=>[e(oe,{label:"1"},{default:t(()=>[Y(I(_.$t("main.use.google.translate")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})):h("",!0),M.value?(u(),i(z,{key:3},{default:t(()=>[e(H,{type:"primary",class:"make-slug-btn",onClick:U,loading:c.value},{default:t(()=>[Y(I(c.value?_.$t("main.opt.loading"):_.$t("main.auto.fetch.slug")),1)]),_:1},8,["loading"])]),_:1})):h("",!0),M.value?(u(),i(z,{key:4,label:_.$t("main.use.hash")},{default:t(()=>[e(ye,{modelValue:v.value,"onUpdate:modelValue":O[3]||(O[3]=ae=>v.value=ae)},null,8,["modelValue"]),v.value?h("",!0):(u(),i(B,{key:0,title:_.$t("main.use.hash.tip"),type:"warning",closable:!1},null,8,["title"]))]),_:1},8,["label"])):h("",!0),M.value?(u(),i(z,{key:5,label:_.$t("main.desc")},{default:t(()=>[e(ie,{type:"textarea",modelValue:r.desc,"onUpdate:modelValue":O[4]||(O[4]=ae=>r.desc=ae)},null,8,["modelValue"])]),_:1},8,["label"])):h("",!0),M.value?(u(),i(z,{key:6},{default:t(()=>[e(H,{type:"primary",onClick:q,loading:V.value},{default:t(()=>[Y(I(V.value?_.$t("main.opt.loading"):_.$t("main.auto.fetch.desc")),1)]),_:1},8,["loading"])]),_:1})):h("",!0),M.value?(u(),i(z,{key:7,label:_.$t("main.create.time")},{default:t(()=>[e(E,{type:"datetime",modelValue:r.created,"onUpdate:modelValue":O[5]||(O[5]=ae=>r.created=ae),format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:_.$t("main.create.time.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):h("",!0),e(z,{label:_.$t("main.tag")},{default:t(()=>[(u(!0),de(Ce,null,Ee(r.tag.dynamicTags,ae=>(u(),i(j,{key:ae,class:"mx-1",closable:"","disable-transitions":!1,onClose:ft=>L(ae)},{default:t(()=>[Y(I(ae),1)]),_:2},1032,["onClose"]))),128)),r.tag.inputVisible?(u(),i(ie,{key:0,ref_key:"tagRefInput",ref:ee,modelValue:r.tag.inputValue,"onUpdate:modelValue":O[6]||(O[6]=ae=>r.tag.inputValue=ae),class:"ml-1 w-20",size:"small",onKeyup:Gt(J,["enter"]),onBlur:J},null,8,["modelValue","onKeyup"])):(u(),i(H,{key:1,class:"button-new-tag ml-1 el-tag",size:"small",onClick:ce},{default:t(()=>[Y(I(_.$t("main.tag.new")),1)]),_:1}))]),_:1},8,["label"]),M.value?(u(),i(z,{key:8},{default:t(()=>[e(H,{type:"primary",onClick:ge,loading:$.value},{default:t(()=>[Y(I($.value?_.$t("main.opt.loading"):_.$t("main.auto.fetch.tag")),1)]),_:1},8,["loading"])]),_:1})):h("",!0),e(z,{label:_.$t("main.tag.auto.switch")},{default:t(()=>[e(ye,{modelValue:a.value,"onUpdate:modelValue":O[7]||(O[7]=ae=>a.value=ae)},null,8,["modelValue"])]),_:1},8,["label"]),o.useCat?(u(),i(z,{key:9,label:_.$t("main.cat"),style:{width:"100%"}},{default:t(()=>[b.value?(u(),i(be,{key:0,modelValue:r.cat.categorySelected,"onUpdate:modelValue":O[8]||(O[8]=ae=>r.cat.categorySelected=ae),placeholder:"\u8BF7\u9009\u62E9","no-data-text":"\u6682\u65E0\u6570\u636E",class:"m-2",size:"default",onChange:Pe},{default:t(()=>[(u(!0),de(Ce,null,Ee(r.cat.categoryList,ae=>(u(),i(Q,{key:ae.value,label:ae.label,value:ae},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(u(),i(be,{key:1,modelValue:r.cat.categorySelected,"onUpdate:modelValue":O[9]||(O[9]=ae=>r.cat.categorySelected=ae),disabled:"",placeholder:"\u8BF7\u9009\u62E9","no-data-text":"\u6682\u65E0\u6570\u636E",class:"m-2",size:"default",onChange:Pe},{default:t(()=>[(u(!0),de(Ce,null,Ee(r.cat.categoryList,ae=>(u(),i(Q,{key:ae.value,label:ae.label,value:ae},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]))]),_:1},8,["label"])):h("",!0),e(z,{label:_.$t("main.opt.quick")},{default:t(()=>[e(H,{type:"primary",onClick:Ke,loading:D.value},{default:t(()=>[Y(I(D.value?_.$t("main.opt.loading"):_.$t("main.publish.oneclick.attr")),1)]),_:1},8,["loading"])]),_:1},8,["label"]),e(z,null,{default:t(()=>[e(H,{type:"primary",onClick:le},{default:t(()=>[Y(I(_.$t("main.save.attr.to.siyuan")),1)]),_:1})]),_:1}),e(z,{label:""},{default:t(()=>[e(H,{type:"primary",onClick:et,loading:W.value},{default:t(()=>[Y(I(W.value?_.$t("main.publish.loading"):s.value?_.$t("main.update"):_.$t("main.publish")),1)]),_:1},8,["loading"]),e(H,{onClick:Z,loading:R.value},{default:t(()=>[Y(I(_.$t("main.cancel")),1)]),_:1},8,["loading"])]),_:1}),e(z,null,{default:t(()=>[e(H,{type:"danger",text:"",disabled:""},{default:t(()=>[Y(I(s.value?_.$t("main.publish.status.published"):_.$t("main.publish.status.unpublish")),1)]),_:1}),s.value?(u(),de("a",{key:0,href:f.value,title:f.value,target:"_blank"},I(_.$t("main.publish.vuepress.see.preview")),9,io)):h("",!0)]),_:1})]),_:1})]),_:1})),e(Le,{loading:G.value,rows:5,animated:""},null,8,["loading"])]),_:1})}}});const Jt=st(ro,[["__scopeId","data-v-7ec3311d"]]),po=ue({__name:"LiandiMain",props:{pageId:{type:String,default:void 0}},setup(n){const o=n,l=p(te.API_TYPE_LIANDI);return(d,g)=>(u(),i(Jt,{"api-type":l.value,"page-id":o.pageId,"limit-rate":!0,"limit-seconds":360,"remove-image":!0},null,8,["api-type","page-id"]))}}),co=ue({__name:"YuqueMain",props:{pageId:{type:String,default:void 0}},setup(n){const o=n,l=p(te.API_TYPE_YUQUE);return(d,g)=>(u(),i(Jt,{"api-type":l.value,"page-id":o.pageId,"use-cat":!0},null,8,["api-type","page-id"]))}}),go=ue({__name:"KmsMain",props:{pageId:{type:String,default:void 0}},setup(n){const o=n,l=p(te.API_TYPE_KMS);return(d,g)=>(u(),i(Jt,{"api-type":l.value,"page-id":o.pageId},null,8,["api-type","page-id"]))}}),mo={key:1},fo=ue({__name:"PlatformMain",props:{isReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(n){const o=n,l=we.getLogger("components/publish/tab/PlatformMain.vue"),{tabCountStore:d,vuepressEnabled:g,hugoEnabled:w,hexoEnabled:y,jekyllEnabled:T,jvueEnabled:A,confEnabled:c,cnblogsEnabled:V,wordpressEnabled:$,liandiEnabled:D,yuqueEnabled:W,kmsEnabled:R,doCount:G}=wt(),M=Te({dynamicConfigArray:[],githubArray:[],metaweblogArray:[],wordpressArray:[]}),X=s=>{const f=[];return s.forEach(a=>{const b=new tt(a.plantformType,a.plantformKey,a.plantformName),r="switch-"+a.plantformKey,C=he(r);b.modelValue=C,C&&f.push(b)}),f},v=()=>{G();const s=xe();M.dynamicConfigArray=X(s.totalCfg||[]),M.metaweblogArray=X(s.metaweblogCfg||[]),M.wordpressArray=X(s.wordpressCfg||[]),l.debug("dynamicJsonCfg=>",JSON.stringify(s)),l.debug("\u5E73\u53F0\u8BBE\u7F6E\u521D\u59CB\u5316")};return pt(()=>o.isReload,(s,f)=>{v()}),Fe(()=>{v()}),(s,f)=>{const a=Vt,b=$t,r=Be;return N(d).tabCount>0?(u(),i(b,{key:0,type:"border-card"},{default:t(()=>[N(g)?(u(),i(a,{key:0,label:s.$t("main.publish.to.vuepress")},{default:t(()=>[e(zl,{"page-id":o.pageId},null,8,["page-id"])]),_:1},8,["label"])):h("",!0),N(w)?(u(),i(a,{key:1,label:s.$t("main.publish.to.hugo")},{default:t(()=>[e(Xl,{"page-id":o.pageId},null,8,["page-id"])]),_:1},8,["label"])):h("",!0),N(y)?(u(),i(a,{key:2,label:s.$t("main.publish.to.hexo")},{default:t(()=>[e(Ql,{"page-id":o.pageId},null,8,["page-id"])]),_:1},8,["label"])):h("",!0),N(T)?(u(),i(a,{key:3,label:s.$t("main.publish.to.jekyll")},{default:t(()=>[e(Zl,{"page-id":o.pageId},null,8,["page-id"])]),_:1},8,["label"])):h("",!0),N(A)?(u(),i(a,{key:4,label:s.$t("main.publish.to.jvue")},{default:t(()=>[e(to,{"page-id":o.pageId},null,8,["page-id"])]),_:1},8,["label"])):h("",!0),N(c)?(u(),i(a,{key:5,label:s.$t("main.publish.to.conf")},{default:t(()=>[e(ao,{"page-id":o.pageId},null,8,["page-id"])]),_:1},8,["label"])):h("",!0),N(V)?(u(),i(a,{key:6,label:s.$t("main.publish.to.cnblogs")},{default:t(()=>[e(lo,{"page-id":o.pageId},null,8,["page-id"])]),_:1},8,["label"])):h("",!0),N($)?(u(),i(a,{key:7,label:s.$t("main.publish.to.wordpress")},{default:t(()=>[e(oo,{"page-id":o.pageId},null,8,["page-id"])]),_:1},8,["label"])):h("",!0),N(D)?(u(),i(a,{key:8,label:s.$t("main.publish.to.liandi")},{default:t(()=>[e(po,{"page-id":o.pageId},null,8,["page-id"])]),_:1},8,["label"])):h("",!0),N(W)?(u(),i(a,{key:9,label:s.$t("main.publish.to.yuque")},{default:t(()=>[e(co,{"page-id":o.pageId},null,8,["page-id"])]),_:1},8,["label"])):h("",!0),N(R)?(u(),i(a,{key:10,label:s.$t("main.publish.to.kms")},{default:t(()=>[e(go,{"page-id":o.pageId},null,8,["page-id"])]),_:1},8,["label"])):h("",!0),(u(!0),de(Ce,null,Ee(M.githubArray,C=>(u(),i(a,{key:C.platformKey,label:C.platformName},{default:t(()=>[e(mt,{"api-type":C.platformKey,"page-id":o.pageId},null,8,["api-type","page-id"])]),_:2},1032,["label"]))),128)),(u(!0),de(Ce,null,Ee(M.metaweblogArray,C=>(u(),i(a,{key:C.platformKey,label:C.platformName},{default:t(()=>[e(Ze,{"api-type":C.platformKey,"page-id":o.pageId},null,8,["api-type","page-id"])]),_:2},1032,["label"]))),128)),(u(!0),de(Ce,null,Ee(M.wordpressArray,C=>(u(),i(a,{key:C.platformKey,label:C.platformName},{default:t(()=>[e(Ze,{"api-type":C.platformKey,"page-id":o.pageId},null,8,["api-type","page-id"])]),_:2},1032,["label"]))),128))]),_:1})):(u(),de("div",mo,[e(r,{class:"top-version-tip",title:s.$t("config.platform.none"),type:"error",closable:!1},null,8,["title"])]))}}}),$o=ue({__name:"PublishService",props:{isReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(n){const o=n,l=we.getLogger("components/publish/PublishService.vue"),d=p("platform-main"),g=p(!1),w=p(!1),y=p(!1),T=p(!1),A=c=>{l.debug("serviceTabChange=>",c),c==="platform-setting"?(g.value=!g.value,l.debug("platform-setting change=>")):c==="platform-main"?(w.value=!w.value,l.debug("platform-main change=>")):c==="post-bind"?(y.value=!y.value,l.debug("post-bind change=>")):c==="service-switch"&&(T.value=!T.value,l.debug("service-switch change=>"))};return Fe(()=>{}),(c,V)=>{const $=Vt,D=$t;return u(),i(D,{"model-value":d.value,"tab-position":"left",onTabChange:A},{default:t(()=>[e($,{name:"platform-main",label:c.$t("service.tab.publish.service")},{default:t(()=>[e(fo,{"is-reload":w.value,"page-id":o.pageId},null,8,["is-reload","page-id"])]),_:1},8,["label"]),e($,{name:"platform-setting",label:c.$t("service.tab.publish.setting")},{default:t(()=>[e(Ll,{"is-reload":g.value},null,8,["is-reload"])]),_:1},8,["label"]),e($,{name:"post-bind",label:c.$t("service.tab.post.bind")},{default:t(()=>[e(pl,{"is-reload":y.value,"page-id":o.pageId},null,8,["is-reload","page-id"])]),_:1},8,["label"]),e($,{name:"service-switch",label:c.$t("service.tab.service.switch")},{default:t(()=>[e(nl,{"is-reload":T.value},null,8,["is-reload"])]),_:1},8,["label"]),e($,{name:"dynamic-platform",label:c.$t("dynamic.platform.new")},{default:t(()=>[e(ja)]),_:1},8,["label"]),e($,{name:"change-local",label:c.$t("service.tab.change.local")},{default:t(()=>[e(Ha)]),_:1},8,["label"])]),_:1},8,["model-value"])}}});export{$o as _,ea as f};
