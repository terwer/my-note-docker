var sa=Object.defineProperty;var ua=(n,t,l)=>t in n?sa(n,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[t]=l;var oe=(n,t,l)=>(ua(n,typeof t!="symbol"?t+"":t,l),l);import{p as St,q as Tt,f as Fe,h as Ke,g as Ae,a as Me,r as tt,e as Oe,b as ia,k as ra,l as pa,n as mt,o as ft,E as N,d as gt,s as at,t as da,u as ca,v as kt,w as It,x as $t,y as Gt,z as Wt,A as jt,B as qt,C as ga}from"./vendor_element-plus-7dd67f1f.js";import{L as _e,j as ke,k as we,D as Qe,l as Ot,n as Lt,o as ma,s as Rt,q as Xe,t as fa,u as vt,d as We,v as ye,w as Je,x as ya,y as Ie,z as ba,A as _a,B as ha,a as lt,E as Z,F as Ze,G as xe,H as He,I as ot,J as be,K as Ye,P as Vt,M as Ge,N as nt,V as va,O as Q,C as Dt,Q as Jt,R as Ca,T as qe,U as Pt,W as et,X as Ea,Y as At,Z as wa,m as Ut,$ as zt,a0 as Xt,a1 as Qt,a2 as Zt,r as xt,a3 as ea,e as Sa,a4 as Ta,a5 as ka}from"./api-70a4ebc4.js";import{u as Ue}from"./vendor_vue-i18n-5b80ab8c.js";import{M as X,A as De,O as s,P as ue,a1 as e,U as a,a0 as Se,ao as Te,u as m,ac as he,T as c,y as C,_ as O,$ as B,Z as w,z as yt,F as Pe,W as Ve,K as Ia,V as $a,a2 as Va,a8 as Bt,X as ct,ap as ta}from"./vendor-a9bad54d.js";import{d as Da}from"./vendor_pinia-306dd1ce.js";import{d as Ft}from"./vendor_shorthash2-e60185c0.js";import{c as Pa}from"./vendor_copy-to-clipboard-a51858f9.js";import{f as Aa}from"./vendor_rollup-plugin-node-polyfills-2747d496.js";import{f as Ua}from"./vendor_cross-fetch-e4e57030.js";const Re=_e.getLogger(),wt=function(n,t){return n.setTime(n.getTime()+t*60*60*1e3),n},Ba=(n,t)=>{if(!n)return"";let l=n;const i=/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(.\d{3})Z$/gm,d=l.match(i);if(d==null)return"";for(let b=0;b<d.length;b++){const y=d[b];let A=y;t&&(Re.debug("\u4FEE\u590D\u65F6\u533A\uFF0CISO\u65E5\u671F\u9ED8\u8BA4\u665A8\u5C0F\u65F6"),Re.debug(wt(new Date(y),8)),A=wt(new Date(y),8).toISOString());const T=A.split("T"),r=T[0].replaceAll(/-/g,""),E=T[1].split(".")[0].replaceAll(/:/g,""),V=r+E;l=l.replace(y,V),Re.debug("formatIsoDate match=>",y),Re.debug("formatIsoDate result=>",V)}return l},Vo=(n,t,l)=>{if(!n)return"";let i=n;const d=/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(.\d{3})Z$/gm,b=i.match(d);if(b==null)return"";for(let y=0;y<b.length;y++){const A=b[y];let T=A;t&&(T=wt(new Date(A),8).toISOString());const r=T.split("T"),E=r[0],V=r[1].split(".")[0];let P=E+" "+V;l&&(P=E),i=i.replace(A,P)}return i},Kt=n=>{if(!n)return"";const l=n.replace(/\D/g,""),i=l.slice(0,4),d=l.slice(4,6),b=l.slice(6,8),y=l.slice(8,10),A=l.slice(10,12),T=l.slice(12,14);let r=i;return d?b?y?A?T?r=i+"-"+d+"-"+b+" "+y+":"+A+":"+T:r=i+"-"+d+"-"+b+" "+y+":"+A:r=i+"-"+d+"-"+b+" "+y:r=i+"-"+d+"-"+b:r=i+"-"+d:r=i,Re.debug("formatNumToZhDate str=>",n),Re.debug("formatNumToZhDate datestr=>",r),r},Fa=(n,t)=>typeof n=="string"?new Date(new Date(n).toLocaleString("zh-CN",{timeZone:t})):new Date(n.toLocaleString("zh-CN",{timeZone:t})),Ka=n=>{const t=Kt(n);return Re.debug("datestr=>",t),Fa(t,"Asia/Shanghai")},Ya=function(n){const t=Ba(n,!0),l=Ka(t),d=(new Date().getTime()-l.getTime())/1e3;return parseInt(d.toString())},Na={class:"locale-changer"},Ma=X({__name:"ChangeLocale",setup(n){_e.getLogger("components/publish/tab/ChangeLocale.vue");const{locale:t}=Ue(),l=[{value:"zh_CN",label:"\u7B80\u4F53\u4E2D\u6587"},{value:"en_US",label:"English"}],i=d=>{localStorage.Lang=d,t.value=d};return De(()=>{localStorage.Lang!=null&&(t.value=localStorage.Lang)}),(d,b)=>{const y=St,A=Tt,T=Fe,r=Ke;return s(),ue("div",Na,[e(r,{"label-width":"120px"},{default:a(()=>[e(T,{label:d.$t("lang.choose")},{default:a(()=>[e(A,{placeholder:d.$t("lang.choose.placeholder"),modelValue:d.$i18n.locale,"onUpdate:modelValue":b[0]||(b[0]=E=>d.$i18n.locale=E),onChange:i},{default:a(()=>[(s(),ue(Se,null,Te(l,(E,V)=>e(y,{key:V,label:E.label,value:E.value},null,8,["label","value"])),64))]),_:1},8,["placeholder","modelValue"])]),_:1},8,["label"])]),_:1})])}}}),Oa=X({__name:"DynamicPlatform",setup(n){const t=_e.getLogger("components/publish/tab/DynamicPlatform.vue"),{t:l}=Ue(),i=m(!0),d=ke.Github_Jekyll,b=m(),y=he({subtype:d,ptype:we.Github,dynCfg:new Qe(we.Github,Ot(we.Github,d),"Jekyll-1"),subtypeOptions:[],dynamicConfigArray:[]}),A=he({platformName:[{required:!0,message:()=>l("form.validate.name.required")}]}),T=f=>{y.subtype=f,t.debug(y.subtype),r(y.ptype)},r=f=>{y.ptype=f,y.subtypeOptions=Lt(f);const o=ma(f,y.subtype,y.subtypeOptions.length>0&&y.subtype!==ke.NONE);y.dynCfg=new Qe(f,Ot(f,y.subtypeOptions.length>0?y.subtype:ke.NONE),o),i.value=y.ptype!==we.Custom,t.debug(y.ptype)},E=f=>{if(y.ptype===we.Custom)return N.error(l("dynamic.platform.opt.noselect")),!1;const o=y.dynCfg.platformKey;if(t.debug("\u5C06\u8981\u4FDD\u5B58\u7684\u5E73\u53F0key",o),fa(y.dynamicConfigArray,o))return N.error(l("dynamic.platform.opt.key.exist")),!1;const g="switch-"+o,p="custom-"+o+"-post-id";return vt(o)||vt(g)||vt(p)?(N.error(l("dynamic.platform.opt.key.exist")),!1):!0},V=async f=>{if(!f||!E()||!await f.validate((p,v)=>{p?t.debug("\u6821\u9A8C\u6210\u529F"):t.error(l("main.opt.failure"),v)}))return;const g=new Qe(y.ptype,y.dynCfg.platformKey,y.dynCfg.platformName);g.subPlatformType=y.subtype,y.dynamicConfigArray.push(g),Rt(y.dynamicConfigArray),_(),N.success(l("main.opt.success"))},P=[],U=m(0),H=m(),L=m(l("dynamic.platform.opt.item.select")),K=f=>{H.value=f,L.value=l("dynamic.platform.opt.item.select.tip")+H.value.platformName,t.debug(H.value)},j=async()=>{gt.confirm(l("dynamic.platform.opt.del.confirm"),l("main.opt.warning"),{confirmButtonText:l("main.opt.ok"),cancelButtonText:l("main.opt.cancel"),type:"warning"}).then(async()=>{if(!H.value||!H.value.platformKey){N.error(l("dynamic.platform.opt.item.no.select.tip"));return}for(let f=0;f<y.dynamicConfigArray.length;f++)H.value.platformKey===y.dynamicConfigArray[f].platformKey&&y.dynamicConfigArray.splice(f,1);Rt(y.dynamicConfigArray),_(),N.success(l("main.opt.success"))}).catch(()=>{})},_=()=>{P.length=0;for(let f=0;f<y.dynamicConfigArray.length;f++)P.push(y.dynamicConfigArray[f]);U.value=y.dynamicConfigArray.length},u=async()=>{y.subtypeOptions=Lt(we.Github),y.dynamicConfigArray=Xe().totalCfg||[],_(),t.debug("dynamic init page=>",y.dynamicConfigArray)};return De(async()=>{await u()}),(f,o)=>{const g=Ae,p=Me,v=tt,G=Fe,ce=St,S=Tt,D=Oe,k=Ke,I=ia,W=ra,ae=pa,ie=mt,R=ft;return s(),c(R,null,{default:a(()=>[e(I,{height:"300px",class:"publish-dyn-header"},{default:a(()=>[e(k,{"label-width":"165px",ref_key:"formRef",ref:b,model:y.dynCfg,rules:A},{default:a(()=>[e(g,{class:"top-version-tip",title:f.$t("dynamic.platform.tip"),type:"info",closable:!1},null,8,["title"]),e(G,{label:f.$t("dynamic.platform.type")},{default:a(()=>[e(v,null,{default:a(()=>[e(p,{type:y.ptype===C(we).Github?"primary":"",onClick:o[0]||(o[0]=ge=>r(C(we).Github))},{default:a(()=>[O(B(f.$t("dynamic.platform.type.github")),1)]),_:1},8,["type"]),e(p,{type:y.ptype===C(we).Metaweblog?"primary":"",onClick:o[1]||(o[1]=ge=>r(C(we).Metaweblog))},{default:a(()=>[O(B(f.$t("dynamic.platform.type.metaweblog")),1)]),_:1},8,["type"]),e(p,{type:y.ptype===C(we).Wordpress?"primary":"",onClick:o[2]||(o[2]=ge=>r(C(we).Wordpress))},{default:a(()=>[O(B(f.$t("dynamic.platform.type.wordpress")),1)]),_:1},8,["type"]),e(p,{type:y.ptype===C(we).Custom?"primary":"",onClick:o[3]||(o[3]=ge=>r(C(we).Custom))},{default:a(()=>[O(B(f.$t("dynamic.platform.type.custom")),1)]),_:1},8,["type"])]),_:1})]),_:1},8,["label"]),i.value?w("",!0):(s(),c(G,{key:0},{default:a(()=>[e(g,{title:"\u656C\u8BF7\u671F\u5F85",type:"info",closable:!1})]),_:1})),y.subtypeOptions.length>0&&i.value?(s(),c(G,{key:1},{default:a(()=>[e(S,{modelValue:y.subtype,"onUpdate:modelValue":o[4]||(o[4]=ge=>y.subtype=ge),class:"m-2",placeholder:"Select",onChange:T},{default:a(()=>[(s(!0),ue(Se,null,Te(y.subtypeOptions,ge=>(s(),c(ce,{key:ge,label:ge,value:ge},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):w("",!0),i.value?(s(),c(G,{key:2,label:y.ptype+f.$t("dynamic.platform.name"),prop:"platformName"},{default:a(()=>[e(D,{modelValue:y.dynCfg.platformName,"onUpdate:modelValue":o[5]||(o[5]=ge=>y.dynCfg.platformName=ge),placeholder:f.$t("dynamic.platform.name.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):w("",!0),w("",!0),i.value?(s(),c(G,{key:4},{default:a(()=>[e(p,{type:"primary",onClick:o[6]||(o[6]=ge=>V(b.value))},{default:a(()=>[O(B(f.$t("dynamic.platform.opt.add")),1)]),_:1})]),_:1})):w("",!0)]),_:1},8,["model","rules"])]),_:1}),e(ie,{class:"dyn-table-list"},{default:a(()=>[e(G,null,{default:a(()=>[(s(),c(ae,{data:P,key:U.value,border:"",stripe:"","highlight-current-row":"","empty-text":"\u6682\u65E0\u6570\u636E",onCurrentChange:K},{default:a(()=>[e(W,{prop:"platformType",label:f.$t("dynamic.platform.type")},null,8,["label"]),e(W,{prop:"subPlatformType",label:f.$t("dynamic.platform.subtype")},null,8,["label"]),e(W,{prop:"platformKey",label:f.$t("dynamic.platform.key")},null,8,["label"]),e(W,{prop:"platformName",label:f.$t("dynamic.platform.name")},null,8,["label"])]),_:1}))]),_:1}),e(G,null,{default:a(()=>[H.value?(s(),c(g,{key:0,class:"top-version-tip",title:L.value,type:"info",closable:!1},null,8,["title"])):w("",!0),e(p,{type:"danger",onClick:j},{default:a(()=>[O(B(f.$t("dynamic.platform.opt.del.select")),1)]),_:1})]),_:1})]),_:1})]),_:1})}}});const La=We(Oa,[["__scopeId","data-v-bb6fb923"]]),Ra=Da("tabCount",()=>{const n=m(0);function t(){n.value=0}function l(i){i&&n.value++}return{tabCount:n,resetCount:t,incrementIf:l}}),Ha="switch-vuepress",Ga="switch-hugo",Wa="switch-hexo",ja="switch-jekyll",qa="switch-jvue",Ja="switch-conf",za="switch-cnblogs",Xa="switch-wordpress",Qa="switch-liandi",Za="switch-yuque",xa="switch-kms",de={SWITCH_VUEPRESS_KEY:Ha,SWITCH_HUGO_KEY:Ga,SWITCH_HEXO_KEY:Wa,SWITCH_JEKYLL_KEY:ja,SWITCH_JVUE_KEY:qa,SWITCH_CONF_KEY:Ja,SWITCH_CNBLOGS_KEY:za,SWITCH_WORDPRESS_KEY:Xa,SWITCH_LIANDI_KEY:Qa,SWITCH_YUQUE_KEY:Za,SWITCH_KMS_KEY:xa},bt=()=>{const n=Ra(),t=m(!1),l=m(!1),i=m(!1),d=m(!1),b=m(!1),y=m(!1),A=m(!1),T=m(!1),r=m(!1),E=m(!1),V=m(!1),P=he({dynamicConfigArray:[]});function U(){n.resetCount(),t.value=ye(de.SWITCH_VUEPRESS_KEY),n.incrementIf(t.value),l.value=ye(de.SWITCH_HUGO_KEY),n.incrementIf(l.value),i.value=ye(de.SWITCH_HEXO_KEY),n.incrementIf(i.value),d.value=ye(de.SWITCH_JEKYLL_KEY),n.incrementIf(d.value),b.value=ye(de.SWITCH_JVUE_KEY),n.incrementIf(b.value),y.value=ye(de.SWITCH_CONF_KEY),n.incrementIf(y.value),A.value=ye(de.SWITCH_CNBLOGS_KEY),n.incrementIf(A.value),T.value=ye(de.SWITCH_WORDPRESS_KEY),n.incrementIf(T.value),r.value=ye(de.SWITCH_LIANDI_KEY),n.incrementIf(r.value),E.value=ye(de.SWITCH_YUQUE_KEY),n.incrementIf(E.value),V.value=ye(de.SWITCH_KMS_KEY),n.incrementIf(V.value);const L=Xe().totalCfg||[];P.dynamicConfigArray=[],L.forEach(K=>{const j=Je(K.platformKey),_=ye(j);K.modelValue=ya({switchKey:K.platformKey,switchValue:_}),n.incrementIf(_),P.dynamicConfigArray.push(K)})}return{tabCountStore:n,vuepressEnabled:t,hugoEnabled:l,hexoEnabled:i,jekyllEnabled:d,jvueEnabled:b,confEnabled:y,cnblogsEnabled:A,wordpressEnabled:T,liandiEnabled:r,yuqueEnabled:E,kmsEnabled:V,switchFormData:P,doCount:U}},el={key:0},tl=X({__name:"ServiceSwitch",props:{isReload:{type:Boolean,default:!1}},setup(n){const t=n;_e.getLogger("components/publish/tab/ServiceSwitch.vue");const{tabCountStore:l,vuepressEnabled:i,hugoEnabled:d,hexoEnabled:b,jekyllEnabled:y,jvueEnabled:A,confEnabled:T,cnblogsEnabled:r,wordpressEnabled:E,liandiEnabled:V,yuqueEnabled:P,kmsEnabled:U,switchFormData:H,doCount:L}=bt(),K=m(!1),j=I=>{Ie(de.SWITCH_VUEPRESS_KEY,I),k()},_=I=>{Ie(de.SWITCH_HUGO_KEY,I),k()},u=I=>{Ie(de.SWITCH_HEXO_KEY,I),k()},f=I=>{Ie(de.SWITCH_JEKYLL_KEY,I),k()},o=I=>{Ie(de.SWITCH_JVUE_KEY,I),k()},g=I=>{Ie(de.SWITCH_CONF_KEY,I),k()},p=I=>{Ie(de.SWITCH_CNBLOGS_KEY,I),k()},v=I=>{Ie(de.SWITCH_WORDPRESS_KEY,I),k()},G=I=>{Ie(de.SWITCH_LIANDI_KEY,I),k()},ce=I=>{Ie(de.SWITCH_YUQUE_KEY,I),k()},S=I=>{Ie(de.SWITCH_KMS_KEY,I),k()},D=I=>{const W=ha(I);Ie(W.switchKey,W.switchValue),k()},k=()=>{L(),l.tabCount===0?K.value=!0:K.value=!1};return yt(()=>t.isReload,async(I,W)=>{k()}),De(()=>{k()}),(I,W)=>{const ae=at,ie=Fe,R=Ae,ge=Ke;return s(),c(ge,{class:"switch-form",inline:""},{default:a(()=>[e(ie,{label:I.$t("service.switch.vuepress")},{default:a(()=>[e(ae,{modelValue:C(i),"onUpdate:modelValue":W[0]||(W[0]=z=>Pe(i)?i.value=z:null),onChange:j},null,8,["modelValue"])]),_:1},8,["label"]),e(ie,{label:I.$t("service.switch.hugo")},{default:a(()=>[e(ae,{modelValue:C(d),"onUpdate:modelValue":W[1]||(W[1]=z=>Pe(d)?d.value=z:null),onChange:_},null,8,["modelValue"])]),_:1},8,["label"]),e(ie,{label:I.$t("service.switch.hexo")},{default:a(()=>[e(ae,{modelValue:C(b),"onUpdate:modelValue":W[2]||(W[2]=z=>Pe(b)?b.value=z:null),onChange:u},null,8,["modelValue"])]),_:1},8,["label"]),e(ie,{label:I.$t("service.switch.jekyll")},{default:a(()=>[e(ae,{modelValue:C(y),"onUpdate:modelValue":W[3]||(W[3]=z=>Pe(y)?y.value=z:null),onChange:f},null,8,["modelValue"])]),_:1},8,["label"]),e(ie,{label:I.$t("service.switch.jvue")},{default:a(()=>[e(ae,{modelValue:C(A),"onUpdate:modelValue":W[4]||(W[4]=z=>Pe(A)?A.value=z:null),onChange:o},null,8,["modelValue"])]),_:1},8,["label"]),e(ie,{label:I.$t("service.switch.conf")},{default:a(()=>[e(ae,{modelValue:C(T),"onUpdate:modelValue":W[5]||(W[5]=z=>Pe(T)?T.value=z:null),onChange:g},null,8,["modelValue"])]),_:1},8,["label"]),e(ie,{label:I.$t("service.switch.cnblogs")},{default:a(()=>[e(ae,{modelValue:C(r),"onUpdate:modelValue":W[6]||(W[6]=z=>Pe(r)?r.value=z:null),onChange:p},null,8,["modelValue"])]),_:1},8,["label"]),e(ie,{label:I.$t("service.switch.wordpress")},{default:a(()=>[e(ae,{modelValue:C(E),"onUpdate:modelValue":W[7]||(W[7]=z=>Pe(E)?E.value=z:null),onChange:v},null,8,["modelValue"])]),_:1},8,["label"]),e(ie,{label:I.$t("service.switch.liandi")},{default:a(()=>[e(ae,{modelValue:C(V),"onUpdate:modelValue":W[8]||(W[8]=z=>Pe(V)?V.value=z:null),onChange:G},null,8,["modelValue"])]),_:1},8,["label"]),e(ie,{label:I.$t("service.switch.yuque")},{default:a(()=>[e(ae,{modelValue:C(P),"onUpdate:modelValue":W[9]||(W[9]=z=>Pe(P)?P.value=z:null),onChange:ce},null,8,["modelValue"])]),_:1},8,["label"]),e(ie,{label:I.$t("service.switch.kms")},{default:a(()=>[e(ae,{modelValue:C(U),"onUpdate:modelValue":W[10]||(W[10]=z=>Pe(U)?U.value=z:null),onChange:S},null,8,["modelValue"])]),_:1},8,["label"]),(s(!0),ue(Se,null,Te(C(H).dynamicConfigArray,z=>(s(),c(ie,{key:z.posid,label:z.platformName},{default:a(()=>[e(ae,{modelValue:z.modelValue,"onUpdate:modelValue":Le=>z.modelValue=Le,"active-value":C(ba)(z.platformKey),"inactive-value":C(_a)(z.platformKey),onChange:D},null,8,["modelValue","onUpdate:modelValue","active-value","inactive-value"])]),_:2},1032,["label"]))),128)),K.value?(s(),ue("div",el,[Ve("p",null,[e(R,{title:I.$t("platform.must.select.one"),type:"error",closable:!1},null,8,["title"])])])):w("",!0)]),_:1})}}});const al=We(tl,[["__scopeId","data-v-a1231ff3"]]),ll={key:1},ol={name:"PostBind"},nl=X({...ol,props:{isReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(n){const t=n,l=_e.getLogger("components/publish/tab/PostBind.vue"),{t:i}=Ue(),{tabCountStore:d,vuepressEnabled:b,hugoEnabled:y,hexoEnabled:A,jekyllEnabled:T,jvueEnabled:r,confEnabled:E,cnblogsEnabled:V,wordpressEnabled:P,liandiEnabled:U,yuqueEnabled:H,kmsEnabled:L,doCount:K}=bt(),j=he({dynamicConfigArray:[]}),_=()=>{K();const D=Xe().totalCfg||[];j.dynamicConfigArray.length=0,D.forEach(k=>{const I=Je(k.platformKey);k.modelValue=ye(I),j.dynamicConfigArray.push(k)}),l.debug(j.dynamicConfigArray)};yt(()=>t.isReload,async(S,D)=>{_(),await p()}),Ia(async()=>{_(),await p()}),De(()=>{});const u={pageId:"",meta:{}},f=m(),o=he({vuepressSlug:"",hugoSlug:"",hexoSlug:"",jekyllSlug:"",jvuePostid:"",cnblogsPostid:"",confPostid:"",wordpressPostid:"",liandiPostid:"",yuquePostid:"",kmsPostid:""}),g=he({});async function p(){const S=await lt(!0,t.pageId);if(l.debug("PostBind pageId=>",S),!S||S==="")return;const k=await new xe().getBlockAttrs(S);u.pageId=S,u.meta=k,o.vuepressSlug=k[Z.VUEPRESS_POSTID_KEY],o.hugoSlug=k[Z.HUGO_POSTID_KEY],o.hexoSlug=k[Z.HEXO_POSTID_KEY],o.jekyllSlug=k[Z.JEKYLL_POSTID_KEY],o.jvuePostid=k[Z.JVUE_POSTID_KEY],o.confPostid=k[Z.CONFLUENCE_POSTID_KEY],o.cnblogsPostid=k[Z.CNBLOGS_POSTID_KEY],o.wordpressPostid=k[Z.WORDPRESS_POSTID_KEY],o.liandiPostid=k[Z.LIANDI_POSTID_KEY],o.yuquePostid=k[Z.YUQUE_POSTID_KEY],o.kmsPostid=k[Z.KMS_POSTID_KEY];const I=j.dynamicConfigArray;j.dynamicConfigArray=[],I.forEach(W=>{const ae=Ze(W.platformKey);W.posid=k[ae]||"",j.dynamicConfigArray.push(W)})}const v=(S,D,k,I)=>{S&&!He(I)?Object.assign(D,{[k]:I}):Object.assign(D,{[k]:""})},G=async S=>{if(!(!S||!await S.validate((k,I)=>{k?l.debug("\u6821\u9A8C\u6210\u529F"):l.error(i("main.opt.failure"),I)})))try{const k={};v(b.value,k,Z.VUEPRESS_POSTID_KEY,o.vuepressSlug),v(y.value,k,Z.HUGO_POSTID_KEY,o.hugoSlug),v(A.value,k,Z.HEXO_POSTID_KEY,o.hexoSlug),v(T.value,k,Z.JEKYLL_POSTID_KEY,o.jekyllSlug),v(r.value,k,Z.JVUE_POSTID_KEY,o.jvuePostid),v(E.value,k,Z.CONFLUENCE_POSTID_KEY,o.confPostid),v(V.value,k,Z.CNBLOGS_POSTID_KEY,o.cnblogsPostid),v(P.value,k,Z.WORDPRESS_POSTID_KEY,o.wordpressPostid),v(U.value,k,Z.LIANDI_POSTID_KEY,o.liandiPostid),v(H.value,k,Z.YUQUE_POSTID_KEY,o.yuquePostid),v(L.value,k,Z.KMS_POSTID_KEY,o.kmsPostid),j.dynamicConfigArray.forEach(W=>{const ae=Ze(W.platformKey);v(W.modelValue,k,ae,W.posid)}),l.debug("PostBind\u4FDD\u5B58\u5C5E\u6027\u5230\u601D\u6E90\u7B14\u8BB0,meta=>",k),await new xe().setBlockAttrs(u.pageId,k),N.success(i("main.opt.success"))}catch(k){l.error("\u4FDD\u5B58\u5F02\u5E38",k);let I="\u4FDD\u5B58\u5F02\u5E38";k&&(I=k.toString()),N.error({dangerouslyUseHTMLString:!0,message:i("main.opt.failure")+"=>"+I})}},ce=S=>{!S||S.resetFields()};return(S,D)=>{const k=Oe,I=Fe,W=Me,ae=Ke,ie=Ae;return C(d).tabCount>0?(s(),c(ae,{key:0,"label-width":"85px",class:"post-bind-form",ref_key:"ruleFormRef",ref:f,model:o,rules:g,"status-icon":""},{default:a(()=>[C(b)?(s(),c(I,{key:0,label:S.$t("post.bind.vuepress.slug"),prop:"vuepressSlug"},{default:a(()=>[e(k,{modelValue:o.vuepressSlug,"onUpdate:modelValue":D[0]||(D[0]=R=>o.vuepressSlug=R)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),C(y)?(s(),c(I,{key:1,label:S.$t("post.bind.hugo.slug"),prop:"hugoSlug"},{default:a(()=>[e(k,{modelValue:o.hugoSlug,"onUpdate:modelValue":D[1]||(D[1]=R=>o.hugoSlug=R)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),C(A)?(s(),c(I,{key:2,label:S.$t("post.bind.hexo.slug"),prop:"hexosSlug"},{default:a(()=>[e(k,{modelValue:o.hexoSlug,"onUpdate:modelValue":D[2]||(D[2]=R=>o.hexoSlug=R)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),C(T)?(s(),c(I,{key:3,label:S.$t("post.bind.jekyll.slug"),prop:"jekyllSlug"},{default:a(()=>[e(k,{modelValue:o.jekyllSlug,"onUpdate:modelValue":D[3]||(D[3]=R=>o.jekyllSlug=R)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),C(r)?(s(),c(I,{key:4,label:S.$t("post.bind.jvue.postid"),prop:"jvuePostid"},{default:a(()=>[e(k,{modelValue:o.jvuePostid,"onUpdate:modelValue":D[4]||(D[4]=R=>o.jvuePostid=R)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),C(E)?(s(),c(I,{key:5,label:S.$t("post.bind.conf.postid"),prop:"confPostid"},{default:a(()=>[e(k,{modelValue:o.confPostid,"onUpdate:modelValue":D[5]||(D[5]=R=>o.confPostid=R)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),C(V)?(s(),c(I,{key:6,label:S.$t("post.bind.cnblogs.postid"),prop:"cnblogsPostid"},{default:a(()=>[e(k,{modelValue:o.cnblogsPostid,"onUpdate:modelValue":D[6]||(D[6]=R=>o.cnblogsPostid=R)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),C(P)?(s(),c(I,{key:7,label:S.$t("post.bind.wordpress.postid"),prop:"wordpressPostid"},{default:a(()=>[e(k,{modelValue:o.wordpressPostid,"onUpdate:modelValue":D[7]||(D[7]=R=>o.wordpressPostid=R)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),C(U)?(s(),c(I,{key:8,label:S.$t("post.bind.liandi.postid"),prop:"liandiPostid"},{default:a(()=>[e(k,{modelValue:o.liandiPostid,"onUpdate:modelValue":D[8]||(D[8]=R=>o.liandiPostid=R)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),C(H)?(s(),c(I,{key:9,label:S.$t("post.bind.yuque.postid"),prop:"yuquePostid"},{default:a(()=>[e(k,{modelValue:o.yuquePostid,"onUpdate:modelValue":D[9]||(D[9]=R=>o.yuquePostid=R)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),C(L)?(s(),c(I,{key:10,label:S.$t("post.bind.kms.postid"),prop:"kmsPostid"},{default:a(()=>[e(k,{modelValue:o.kmsPostid,"onUpdate:modelValue":D[10]||(D[10]=R=>o.kmsPostid=R)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),(s(!0),ue(Se,null,Te(j.dynamicConfigArray,(R,ge)=>$a((s(),c(I,{key:ge,label:R.platformName},{default:a(()=>[e(k,{modelValue:R.posid,"onUpdate:modelValue":z=>R.posid=z},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])),[[Va,R.modelValue]])),128)),e(I,null,{default:a(()=>[e(W,{type:"primary",onClick:D[11]||(D[11]=R=>G(f.value))},{default:a(()=>[O(B(S.$t("post.bind.conf.save")),1)]),_:1}),e(W,{onClick:D[12]||(D[12]=R=>ce(f.value))},{default:a(()=>[O(B(S.$t("post.bind.conf.cancel")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])):(s(),ue("div",ll,[e(ie,{class:"top-version-tip",title:S.$t("config.platform.none"),type:"error",closable:!1},null,8,["title"])]))}}});const sl=We(nl,[["__scopeId","data-v-34e3fe60"]]);class ul extends ot{constructor(t){switch(super("","","","",""),this.previewUrl="/post/[postid].html",this.posidKey=Ze(t.platformKey),this.blogName=t.subPlatformType,t.subPlatformType){case ke.Github_Vuepress:this.defaultPath="docs";break;case ke.Github_Hugo:this.defaultPath="content/post";break;case ke.Github_Hexo:this.defaultPath="source/_posts",this.previewUrl="/[date]/[postid]/";break;case ke.Github_Jekyll:this.defaultPath="_posts",this.previewUrl="/[cats]/[date]/[postid].html";break;case ke.Github_Vitepress:this.defaultPath="docs";break;case ke.Github_Nuxt:this.defaultPath="content";break;case ke.Github_Next:this.defaultPath="pages";break}}}var Ce=(n=>(n[n.Markdown=0]="Markdown",n[n.Html=1]="Html",n))(Ce||{});class je{constructor(t,l,i,d){oe(this,"home");oe(this,"apiUrl");oe(this,"username");oe(this,"password");oe(this,"apiStatus");oe(this,"blogName");oe(this,"posidKey");oe(this,"previewUrl");oe(this,"pageType");this.home=t,this.apiUrl=l,this.username=i,this.password=d,this.apiStatus=!1,this.blogName="",this.posidKey="",this.previewUrl="",this.pageType=Ce.Markdown}}class il extends je{constructor(t){super("","","",""),this.posidKey=t,this.previewUrl="/p/[postid].html",this.pageType=Ce.Html}}class rl extends je{constructor(t){super("http://localhost:8000","http://localhost:8000/xmlrpc.php","",""),this.posidKey=t,this.previewUrl="/?p=[postid]",this.pageType=Ce.Html}}const pl={class:"github-setting-basic"},dl={href:"https://github.com/settings/tokens/new",target:"_blank"},cl={key:0,class:"github-setting-advanced"},st=X({__name:"GithubSetting",props:{isReload:{type:Boolean,default:!1},apiType:{type:String,default:""},cfg:{type:ot,default:null}},setup(n){const t=n,l=_e.getLogger("components/publish/tab/setting/GithubSetting.vue"),{t:i}=Ue(),d=m(!1),b=m(!1),y=m(!1),A=m(!0),T=m(),r=he({githubUser:"",githubRepo:"",githubToken:"",defaultBranch:"main",defaultPath:"docs/_posts",msg:"auto published by sy-post-publisher",author:"terwer",email:"youweics@163.com",previewUrl:""}),E=he({githubUser:[{required:!0,message:()=>i("form.validate.name.required")}],githubRepo:[{required:!0,message:()=>i("form.validate.name.required")}],githubToken:[{required:!0,message:()=>i("form.validate.name.required")}],defaultBranch:[{required:!0,message:()=>i("form.validate.name.required")}],defaultPath:[{required:!0,message:()=>i("form.validate.name.required")}],msg:[{required:!0,message:()=>i("form.validate.name.required")}],author:[{required:!0,message:()=>i("form.validate.name.required")}],email:[{required:!0,message:()=>i("form.validate.name.required")}]}),V=()=>{d.value=!1},P=()=>{d.value=!0},U=u=>{A.value=u},H=u=>{!u||u.resetFields()},L=async u=>{!u||!await u.validate((o,g)=>{o?l.debug("\u6821\u9A8C\u6210\u529F"):l.error(i("main.opt.failure"),g)})||j(!1)},K=async()=>{b.value=!0,j(!0);const u=be(t.apiType);let f;try{const o=new Ye(t.apiType),g=new Vt;g.postid="content/post/test.md",g.description="# Hello world";let p;try{p=await o.newPost(g)}catch(v){f=v,u.apiStatus=!1,y.value=!1}p?(u.apiStatus=!0,y.value=!0):(u.apiStatus=!1,y.value=!1),A.value&&await o.deletePost(g.postid)}catch(o){u.apiStatus=!1,y.value=!1,l.error(o)}Ge(t.apiType,u),y.value?N.success(i("main.opt.success")):f?N.error(i("setting.blog.vali.error")+"=>"+f):N.error(i("setting.blog.vali.error")),b.value=!1},j=u=>{const f=t.cfg;f.githubUser=r.githubUser,f.githubRepo=r.githubRepo,f.githubToken=r.githubToken,f.defaultPath=r.defaultPath,f.defaultBranch=r.defaultBranch,f.defaultMsg=r.msg,f.author=r.author,f.email=r.email,f.previewUrl=r.previewUrl,f.apiStatus=y.value,Ge(t.apiType,f),u!==!0&&N.success(i("main.opt.success"))},_=()=>{let u=be(t.apiType);nt(u)&&(u=t.cfg),u&&(r.githubUser=u.githubUser,r.githubRepo=u.githubRepo,r.githubToken=u.githubToken,r.defaultPath=u.defaultPath,r.defaultBranch=u.defaultBranch,r.msg=u.defaultMsg,r.author=u.author,r.email=u.email,r.previewUrl=u.previewUrl,y.value=u.apiStatus)};return De(async()=>{_()}),(u,f)=>{const o=Me,g=tt,p=Fe,v=Oe,G=at,ce=Ae,S=Ke;return s(),c(S,{"label-width":"120px",ref_key:"formRef",ref:T,model:r,rules:E,"status-icon":""},{default:a(()=>[e(p,{label:u.$t("main.publish.editmode")},{default:a(()=>[e(g,null,{default:a(()=>[e(o,{type:d.value?"default":"primary",onClick:V},{default:a(()=>[O(B(u.$t("main.publish.editmode.simple")),1)]),_:1},8,["type"]),e(o,{type:d.value?"primary":"default",onClick:P},{default:a(()=>[O(B(u.$t("main.publish.editmode.complex")),1)]),_:1},8,["type"])]),_:1})]),_:1},8,["label"]),Ve("div",pl,[e(p,{label:u.$t("setting.blog.type.github.user"),prop:"githubUser"},{default:a(()=>[e(v,{modelValue:r.githubUser,"onUpdate:modelValue":f[0]||(f[0]=D=>r.githubUser=D),placeholder:u.$t("setting.blog.type.github.user.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(p,{label:u.$t("setting.blog.type.github.repo"),prop:"githubRepo"},{default:a(()=>[e(v,{modelValue:r.githubRepo,"onUpdate:modelValue":f[1]||(f[1]=D=>r.githubRepo=D),placeholder:u.$t("setting.blog.type.github.repo.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(p,{label:u.$t("setting.blog.type.github.token"),prop:"githubToken"},{default:a(()=>[e(v,{type:"password",modelValue:r.githubToken,"onUpdate:modelValue":f[2]||(f[2]=D=>r.githubToken=D),placeholder:u.$t("setting.blog.type.github.token.tip"),"show-password":""},null,8,["modelValue","placeholder"]),Ve("a",dl,B(u.$t("setting.blog.type.github.token.gen")),1)]),_:1},8,["label"])]),d.value?(s(),ue("div",cl,[e(p,{label:u.$t("setting.blog.type.github.default.path"),prop:"defaultPath"},{default:a(()=>[e(v,{modelValue:r.defaultPath,"onUpdate:modelValue":f[3]||(f[3]=D=>r.defaultPath=D),placeholder:u.$t("setting.blog.type.github.default.path.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(p,{label:u.$t("setting.blog.type.github.default.branch"),prop:"defaultBranch"},{default:a(()=>[e(v,{modelValue:r.defaultBranch,"onUpdate:modelValue":f[4]||(f[4]=D=>r.defaultBranch=D),placeholder:u.$t("setting.blog.type.github.default.branch.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(p,{label:u.$t("setting.blog.type.github.msg"),prop:"msg"},{default:a(()=>[e(v,{modelValue:r.msg,"onUpdate:modelValue":f[5]||(f[5]=D=>r.msg=D),placeholder:u.$t("setting.blog.type.github.msg.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(p,{label:u.$t("setting.blog.type.github.author"),prop:"author"},{default:a(()=>[e(v,{modelValue:r.author,"onUpdate:modelValue":f[6]||(f[6]=D=>r.author=D),placeholder:u.$t("setting.blog.type.github.author.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(p,{label:u.$t("setting.blog.type.github.email"),prop:"email"},{default:a(()=>[e(v,{modelValue:r.email,"onUpdate:modelValue":f[7]||(f[7]=D=>r.email=D),placeholder:u.$t("setting.blog.type.github.email.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(p,{label:u.$t("setting.blog.previewUrl")},{default:a(()=>[e(v,{modelValue:r.previewUrl,"onUpdate:modelValue":f[8]||(f[8]=D=>r.previewUrl=D)},null,8,["modelValue"])]),_:1},8,["label"])])):w("",!0),e(p,{label:u.$t("form.validate.github.auto.delete")},{default:a(()=>[e(G,{modelValue:A.value,"onUpdate:modelValue":f[9]||(f[9]=D=>A.value=D),onChange:U},null,8,["modelValue"])]),_:1},8,["label"]),e(p,null,{default:a(()=>[e(o,{type:"primary",onClick:K,loading:b.value},{default:a(()=>[O(B(b.value?u.$t("setting.blog.vali.ing"):u.$t("setting.blog.vali")),1)]),_:1},8,["loading"]),y.value?w("",!0):(s(),c(ce,{key:0,title:u.$t("setting.blog.vali.tip"),type:"warning",closable:!1},null,8,["title"])),y.value?(s(),c(ce,{key:1,title:u.$t("setting.blog.vali.ok"),type:"success",closable:!1},null,8,["title"])):w("",!0)]),_:1}),e(p,null,{default:a(()=>[e(o,{type:"primary",onClick:f[10]||(f[10]=D=>L(T.value))},{default:a(()=>[O(B(u.$t("setting.blog.save")),1)]),_:1}),e(o,{onClick:f[11]||(f[11]=D=>H(T.value))},{default:a(()=>[O(B(u.$t("setting.blog.cancel")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])}}}),gl=X({__name:"VuepressSetting",setup(n){const t=m(Q.API_TYPE_VUEPRESS),l=new va,i=m(l);return(d,b)=>(s(),c(st,{"api-type":t.value,cfg:i.value},null,8,["api-type","cfg"]))}});class ml extends ot{constructor(){super("",ke.Github_Hugo,"","",""),this.defaultPath="content/post",this.posidKey=Z.HUGO_POSTID_KEY,this.home="",this.previewUrl="/post/[postid].html"}}const fl=X({__name:"HugoSetting",setup(n){const t=m(Q.API_TYPE_HUGO),l=new ml,i=m(l);return(d,b)=>(s(),c(st,{"api-type":t.value,cfg:i.value},null,8,["api-type","cfg"]))}});class yl extends ot{constructor(){super("",ke.Github_Hexo,"","",""),this.defaultPath="source/_posts",this.posidKey=Z.HEXO_POSTID_KEY,this.previewUrl="/[date]/[postid]/"}}const bl=X({__name:"HexoSetting",setup(n){const t=m(Q.API_TYPE_HEXO),l=new yl,i=m(l);return(d,b)=>(s(),c(st,{"api-type":t.value,cfg:i.value},null,8,["api-type","cfg"]))}});class _l extends ot{constructor(){super("",ke.Github_Jekyll,"","",""),this.defaultPath="_posts",this.posidKey=Z.JEKYLL_POSTID_KEY,this.previewUrl="/[cats]/[date]/[postid].html"}}const hl=X({__name:"JekyllSetting",setup(n){const t=m(Q.API_TYPE_JEKYLL),l=new _l,i=m(l);return(d,b)=>(s(),c(st,{"api-type":t.value,cfg:i.value},null,8,["api-type","cfg"]))}});class vl extends je{constructor(){super("https://[your-jvue-site]","https://[your-jvue-site]/xmlrpc","",""),this.posidKey=Z.JVUE_POSTID_KEY,this.previewUrl="/post/[postid].html",this.pageType=Ce.Markdown}}const ut=X({__name:"MetaweblogSetting",props:{isReload:{type:Boolean,default:!1},apiType:{type:String,default:""},cfg:{type:je,default:null}},setup(n){const t=n,l=_e.getLogger("components/publish/tab/setting/MetaweblogSetting.vue"),{t:i}=Ue(),d=parseInt(Ce.Markdown.toString()),b=m(""),y=m(""),A=m(""),T=m(""),r=m(""),E=m(d),V=m(!1),P=m(!1),U=m(""),H=m(i("setting.blog.platform.support.metaweblog")+t.apiType+" "),L=async()=>{V.value=!0;try{K(!0);const _=be(t.apiType),f=await new Ye(t.apiType).getUsersBlogs();if(f&&f.length>0){const o=f[0];_.blogName=o.blogName,U.value=o.blogName,_.apiStatus=!0,P.value=!0}else _.apiStatus=!1,P.value=!1;Ge(t.apiType,_)}catch(_){console.error(_)}P.value?N.success(i("main.opt.success")):N.error(i("setting.blog.vali.error")),V.value=!1,l.debug("Metaweblog\u901A\u7528Setting\u9A8C\u8BC1\u5B8C\u6BD5")},K=_=>{l.debug("Metaweblog\u901A\u7528Setting\u4FDD\u5B58\u914D\u7F6E");const u=t.cfg;u.home=b.value,u.username=T.value,u.password=r.value,u.apiUrl=y.value,u.previewUrl=A.value,u.blogName=U.value,u.pageType=E.value,u.apiStatus=P.value,Ge(t.apiType,u),_!==!0&&N.success(i("main.opt.success"))},j=()=>{l.debug("Metaweblog\u901A\u7528Setting\u914D\u7F6E\u521D\u59CB\u5316");let _=be(t.apiType);nt(_)&&(_=t.cfg),_&&(l.debug("get setting conf=>",_),b.value=_.home,y.value=_.apiUrl,A.value=_.previewUrl,T.value=_.username,r.value=_.password,U.value=_.blogName,E.value=_.pageType,P.value=_.apiStatus)};return De(async()=>{j()}),(_,u)=>{const f=Ae,o=Oe,g=Fe,p=da,v=ca,G=Me,ce=Ke;return s(),c(ce,{"label-width":"120px"},{default:a(()=>[e(f,{class:"top-version-tip",title:H.value+U.value,type:"info",closable:!1},null,8,["title"]),e(g,{label:_.$t("setting.blog.url")},{default:a(()=>[e(o,{modelValue:b.value,"onUpdate:modelValue":u[0]||(u[0]=S=>b.value=S)},null,8,["modelValue"])]),_:1},8,["label"]),e(g,{label:_.$t("setting.blog.username")},{default:a(()=>[e(o,{modelValue:T.value,"onUpdate:modelValue":u[1]||(u[1]=S=>T.value=S)},null,8,["modelValue"])]),_:1},8,["label"]),e(g,{label:_.$t("setting.blog.password")},{default:a(()=>[e(o,{type:"password",modelValue:r.value,"onUpdate:modelValue":u[2]||(u[2]=S=>r.value=S),"show-password":""},null,8,["modelValue"])]),_:1},8,["label"]),e(g,{label:_.$t("setting.blog.apiurl")},{default:a(()=>[e(o,{modelValue:y.value,"onUpdate:modelValue":u[3]||(u[3]=S=>y.value=S)},null,8,["modelValue"])]),_:1},8,["label"]),e(g,{label:_.$t("setting.blog.previewUrl")},{default:a(()=>[e(o,{modelValue:A.value,"onUpdate:modelValue":u[4]||(u[4]=S=>A.value=S)},null,8,["modelValue"])]),_:1},8,["label"]),e(g,{label:_.$t("setting.blog.pageType")},{default:a(()=>[e(v,{modelValue:E.value,"onUpdate:modelValue":u[5]||(u[5]=S=>E.value=S),class:"ml-4"},{default:a(()=>[e(p,{label:0,size:"large"},{default:a(()=>[O("Markdown")]),_:1}),e(p,{label:1,size:"large"},{default:a(()=>[O("HTML")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),e(g,null,{default:a(()=>[e(G,{type:"primary",onClick:L,loading:V.value},{default:a(()=>[O(B(V.value?_.$t("setting.blog.vali.ing"):_.$t("setting.blog.vali")),1)]),_:1},8,["loading"]),P.value?w("",!0):(s(),c(f,{key:0,title:_.$t("setting.blog.vali.tip.metaweblog"),type:"warning",closable:!1},null,8,["title"])),P.value?(s(),c(f,{key:1,title:_.$t("setting.blog.vali.ok.metaweblog"),type:"success",closable:!1},null,8,["title"])):w("",!0)]),_:1}),e(g,null,{default:a(()=>[e(G,{type:"primary",onClick:K},{default:a(()=>[O(B(_.$t("setting.blog.save")),1)]),_:1}),e(G,null,{default:a(()=>[O(B(_.$t("setting.blog.cancel")),1)]),_:1})]),_:1})]),_:1})}}}),Cl=X({__name:"JVueSetting",setup(n){const t=m(Q.API_TYPE_JVUE),l=m(new vl);return(i,d)=>(s(),c(ut,{"api-type":t.value,cfg:l.value},null,8,["api-type","cfg"]))}});class El extends je{constructor(){super("https://youweics.atlassian.net/wiki/spaces/[spaceKey]","http://localhost:3000/api/xmlrpc","",""),this.posidKey=Z.CONFLUENCE_POSTID_KEY,this.previewUrl="pages/[postid]",this.pageType=Ce.Html}}const wl=X({__name:"ConfluenceSetting",setup(n){const t=m(Q.API_TYPE_CONFLUENCE),l=m(new El);return(i,d)=>(s(),c(ut,{"api-type":t.value,cfg:l.value},null,8,["api-type","cfg"]))}});class Sl extends je{constructor(){super("https://www.cnblogs.com/[yourblog]","https://rpc.cnblogs.com/metaweblog/[yourblog]","",""),this.posidKey=Z.CNBLOGS_POSTID_KEY,this.previewUrl="/p/[postid].html",this.pageType=Ce.Markdown}}const Tl=X({__name:"CnblogsSetting",setup(n){const t=m(Q.API_TYPE_CNBLOGS),l=new Sl,i=m(l);return(d,b)=>(s(),c(ut,{"api-type":t.value,cfg:i.value},null,8,["api-type","cfg"]))}});class kl extends je{constructor(){super("http://localhost:8000","http://localhost:8000/xmlrpc.php","",""),this.posidKey=Z.WORDPRESS_POSTID_KEY,this.previewUrl="/?p=[postid]",this.pageType=Ce.Markdown}}const Ht=X({__name:"WordpressSetting",setup(n){const t=m(Q.API_TYPE_WORDPRESS),l=m(new kl);return(i,d)=>(s(),c(ut,{"api-type":t.value,cfg:l.value},null,8,["api-type","cfg"]))}});class it{constructor(){oe(this,"home");oe(this,"apiUrl");oe(this,"username");oe(this,"password");oe(this,"token");oe(this,"apiStatus");oe(this,"blogName");oe(this,"blogid");oe(this,"posidKey");oe(this,"previewUrl");oe(this,"pageType");oe(this,"tokenSettingUrl");this.home="",this.apiUrl="",this.username="",this.password="",this.token="",this.apiStatus=!1,this.blogName="",this.blogid="",this.posidKey="",this.previewUrl="",this.pageType=Ce.Markdown,this.tokenSettingUrl=""}}class Il extends it{constructor(){super(),this.home="https://ld246.com/",this.apiUrl="https://ld246.com/api/v2",this.tokenSettingUrl="https://ld246.com/settings/account",this.posidKey=Z.LIANDI_POSTID_KEY,this.previewUrl="/article/[postid]",this.pageType=Ce.Markdown}}const $l=["href"],Vl=["href"],Yt=X({__name:"CommonBlogSetting",props:{isReload:{type:Boolean,default:!1},apiType:{type:String,default:""},cfg:{type:it,default:null},usernameEnabled:{type:Boolean,default:!1},passwordEnabled:{type:Boolean,default:!1},tokenEnabled:{type:Boolean,default:!1}},setup(n){const t=n,l=_e.getLogger("components/publish/tab/setting/CommonBlogSetting.vue"),{t:i}=Ue(),d=m(""),b=m(""),y=m(""),A=m(""),T=m(""),r=m(!1),E=m(!1),V=m(""),P=m(""),U=m(""),H=m(i("setting.blog.platform.support.common")+t.apiType+" "),L=async()=>{r.value=!0;try{K(!0);const _=be(t.apiType),f=await new Ye(t.apiType).getUsersBlogs();if(f&&f.length>0){const o=f[0];_.apiStatus=!0,E.value=!0,_.blogName=o.blogName,V.value=o.blogName,_.blogid=o.blogid,P.value=o.blogid,Ge(t.apiType,_)}else _.apiStatus=!1,E.value=!1,Ge(t.apiType,_)}catch(_){console.error(_)}E.value?N.success(i("main.opt.success")):N.error(i("setting.blog.vali.error")),r.value=!1,l.debug("\u901A\u7528Setting\u9A8C\u8BC1\u5B8C\u6BD5")},K=_=>{l.debug("Metaweblog\u901A\u7528Setting\u4FDD\u5B58\u914D\u7F6E");const u=t.cfg;u.home=d.value,u.username=y.value,u.password=A.value,u.token=T.value,u.apiUrl=b.value,u.apiStatus=E.value,u.blogName=V.value,u.blogid=P.value,Ge(t.apiType,u),_!==!0&&N.success(i("main.opt.success"))},j=()=>{l.debug("\u901A\u7528Setting\u914D\u7F6E\u521D\u59CB\u5316");let _=be(t.apiType);nt(_)&&(_=t.cfg),_&&(l.debug("get setting conf=>",_),d.value=_.home||"",b.value=_.apiUrl||"",y.value=_.username||"",A.value=_.password||"",T.value=_.token||"",E.value=_.apiStatus||!1,V.value=_.blogName||"",P.value=_.blogid||"",U.value=_.tokenSettingUrl||"")};return De(async()=>{j()}),(_,u)=>{const f=Ae,o=Oe,g=Fe,p=Me,v=Ke;return s(),c(v,{"label-width":"120px"},{default:a(()=>[e(f,{class:"top-version-tip",title:H.value+V.value,type:"info",closable:!1},null,8,["title"]),e(g,{label:_.$t("setting.common.home")},{default:a(()=>[e(o,{modelValue:d.value,"onUpdate:modelValue":u[0]||(u[0]=G=>d.value=G)},null,8,["modelValue"])]),_:1},8,["label"]),t.usernameEnabled?(s(),c(g,{key:0,label:_.$t("setting.common.username")},{default:a(()=>[e(o,{modelValue:y.value,"onUpdate:modelValue":u[1]||(u[1]=G=>y.value=G)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),t.passwordEnabled?(s(),c(g,{key:1,label:_.$t("setting.common.password")},{default:a(()=>[e(o,{type:"password",modelValue:A.value,"onUpdate:modelValue":u[2]||(u[2]=G=>A.value=G),"show-password":""},null,8,["modelValue"]),Ve("a",{href:U.value,target:"_blank"},B(_.$t("setting.common.username.gen"))+"\uFF1A"+B(U.value),9,$l)]),_:1},8,["label"])):w("",!0),t.tokenEnabled?(s(),c(g,{key:2,label:_.$t("setting.common.token")},{default:a(()=>[e(o,{type:"password",modelValue:T.value,"onUpdate:modelValue":u[3]||(u[3]=G=>T.value=G),"show-password":""},null,8,["modelValue"]),Ve("a",{href:U.value,target:"_blank"},B(_.$t("setting.common.token.gen"))+"\uFF1A"+B(U.value),9,Vl)]),_:1},8,["label"])):w("",!0),e(g,{label:_.$t("setting.common.apiurl")},{default:a(()=>[e(o,{modelValue:b.value,"onUpdate:modelValue":u[4]||(u[4]=G=>b.value=G)},null,8,["modelValue"])]),_:1},8,["label"]),e(g,null,{default:a(()=>[e(p,{type:"primary",onClick:L,loading:r.value},{default:a(()=>[O(B(r.value?_.$t("setting.blog.vali.ing"):_.$t("setting.blog.vali")),1)]),_:1},8,["loading"]),E.value?w("",!0):(s(),c(f,{key:0,title:_.$t("setting.blog.vali.tip.metaweblog"),type:"warning",closable:!1},null,8,["title"])),E.value?(s(),c(f,{key:1,title:_.$t("setting.blog.vali.ok.metaweblog"),type:"success",closable:!1},null,8,["title"])):w("",!0)]),_:1}),e(g,null,{default:a(()=>[e(p,{type:"primary",onClick:K},{default:a(()=>[O(B(_.$t("setting.blog.save")),1)]),_:1}),e(p,null,{default:a(()=>[O(B(_.$t("setting.blog.cancel")),1)]),_:1})]),_:1})]),_:1})}}}),Dl=X({__name:"LiandiSetting",setup(n){const t=m(Q.API_TYPE_LIANDI),l=new Il,i=m(l);return(d,b)=>(s(),c(Yt,{"api-type":t.value,"username-enabled":!0,"token-enabled":!0,cfg:i.value},null,8,["api-type","cfg"]))}});class Pl extends it{constructor(){super(),this.home="https://www.yuque.com/",this.apiUrl="https://www.yuque.com/api/v2",this.tokenSettingUrl="https://www.yuque.com/settings/tokens",this.posidKey=Z.YUQUE_POSTID_KEY,this.previewUrl="/[notebook]/[postid]",this.pageType=Ce.Markdown}}const Al=X({__name:"YuqueSetting",setup(n){const t=m(Q.API_TYPE_YUQUE),l=new Pl,i=m(l);return(d,b)=>(s(),c(Yt,{"api-type":t.value,"username-enabled":!0,"token-enabled":!0,cfg:i.value},null,8,["api-type","cfg"]))}});class Ul extends it{constructor(){super(),this.home="http://localhost:9564/kms16_release/kms/multidoc",this.apiUrl="http://localhost:9564/kms16_release/api/kms-multidoc/kmsMultidocKnowledgeRestService",this.tokenSettingUrl="http://localhost:9564/kms16_release/sys/profile/index.jsp#integrate/RestService/",this.posidKey=Z.KMS_POSTID_KEY,this.previewUrl="/kms_multidoc_knowledge/kmsMultidocKnowledge.do?method=view&fdId=[postid]",this.pageType=Ce.Html}}const Bl=X({__name:"KmsSetting",setup(n){const t=m(Q.API_TYPE_KMS),l=new Ul,i=m(l);return(d,b)=>(s(),c(Yt,{"api-type":t.value,"username-enabled":!0,"password-enabled":!0,cfg:i.value},null,8,["api-type","cfg"]))}}),Fl={key:1},Kl=X({__name:"PlatformSetting",props:{isReload:{type:Boolean,default:!1}},setup(n){const t=n,l=_e.getLogger("components/publish/tab/PlatformSetting.vue"),{tabCountStore:i,vuepressEnabled:d,hugoEnabled:b,hexoEnabled:y,jekyllEnabled:A,jvueEnabled:T,confEnabled:r,cnblogsEnabled:E,wordpressEnabled:V,liandiEnabled:P,yuqueEnabled:U,kmsEnabled:H,doCount:L}=bt(),K=he({dynamicConfigArray:[],githubArray:[],metaweblogArray:[],wordpressArray:[]}),j=m(g=>new ul(g)),_=m(g=>new il(Ze(g.platformKey))),u=m(g=>new rl(Ze(g.platformKey))),f=g=>{const p=[];return g.forEach(v=>{const G=new Qe(v.platformType,v.platformKey,v.platformName);G.subPlatformType=v.subPlatformType;const ce=Je(v.platformKey),S=ye(ce);G.modelValue=S,S&&p.push(G)}),p},o=()=>{L();const g=Xe();K.dynamicConfigArray=f(g.totalCfg||[]),K.githubArray=f(g.githubCfg||[]),K.metaweblogArray=f(g.metaweblogCfg||[]),K.wordpressArray=f(g.wordpressCfg||[]),l.debug("dynamicJsonCfg=>",JSON.stringify(g))};return yt(()=>t.isReload,(g,p)=>{o(),l.debug("platform-setting\u521D\u59CB\u5316")}),(g,p)=>{const v=kt,G=It,ce=Ae;return C(i).tabCount>0?(s(),c(G,{key:0,type:"border-card"},{default:a(()=>[C(d)?(s(),c(v,{key:0,label:g.$t("setting.vuepress")+g.$t("setting.blog.setting")},{default:a(()=>[e(gl)]),_:1},8,["label"])):w("",!0),C(b)?(s(),c(v,{key:1,label:g.$t("setting.hugo")+g.$t("setting.blog.setting")},{default:a(()=>[e(fl)]),_:1},8,["label"])):w("",!0),C(y)?(s(),c(v,{key:2,label:g.$t("setting.hexo")+g.$t("setting.blog.setting")},{default:a(()=>[e(bl)]),_:1},8,["label"])):w("",!0),C(A)?(s(),c(v,{key:3,label:g.$t("setting.jekyll")+g.$t("setting.blog.setting")},{default:a(()=>[e(hl)]),_:1},8,["label"])):w("",!0),C(T)?(s(),c(v,{key:4,label:g.$t("setting.jvue")+g.$t("setting.blog.setting")},{default:a(()=>[e(Cl)]),_:1},8,["label"])):w("",!0),C(r)?(s(),c(v,{key:5,label:g.$t("setting.conf")+g.$t("setting.blog.setting")},{default:a(()=>[e(wl)]),_:1},8,["label"])):w("",!0),C(E)?(s(),c(v,{key:6,label:g.$t("setting.cnblogs")+g.$t("setting.blog.setting")},{default:a(()=>[e(Tl)]),_:1},8,["label"])):w("",!0),C(V)?(s(),c(v,{key:7,label:g.$t("setting.wordpress")+g.$t("setting.blog.setting")},{default:a(()=>[e(Ht)]),_:1},8,["label"])):w("",!0),C(P)?(s(),c(v,{key:8,label:g.$t("setting.liandi")+g.$t("setting.blog.setting")},{default:a(()=>[e(Dl)]),_:1},8,["label"])):w("",!0),C(U)?(s(),c(v,{key:9,label:g.$t("setting.yuque")+g.$t("setting.blog.setting")},{default:a(()=>[e(Al)]),_:1},8,["label"])):w("",!0),C(H)?(s(),c(v,{key:10,label:g.$t("setting.kms")+g.$t("setting.blog.setting")},{default:a(()=>[e(Bl)]),_:1},8,["label"])):w("",!0),(s(!0),ue(Se,null,Te(K.githubArray,S=>(s(),c(v,{key:S.platformKey,label:S.platformName+g.$t("setting.blog.setting")},{default:a(()=>[e(st,{"api-type":S.platformKey,cfg:j.value(S)},null,8,["api-type","cfg"])]),_:2},1032,["label"]))),128)),(s(!0),ue(Se,null,Te(K.metaweblogArray,S=>(s(),c(v,{key:S.platformKey,label:S.platformName+g.$t("setting.blog.setting")},{default:a(()=>[e(ut,{"api-type":S.platformKey,cfg:_.value(S)},null,8,["api-type","cfg"])]),_:2},1032,["label"]))),128)),(s(!0),ue(Se,null,Te(K.wordpressArray,S=>(s(),c(v,{key:S.platformKey,label:S.platformName+g.$t("setting.blog.setting")},{default:a(()=>[e(Ht,{"api-type":S.platformKey,cfg:u.value(S)},null,8,["api-type","cfg"])]),_:2},1032,["label"]))),128))]),_:1})):(s(),ue("div",Fl,[e(ce,{class:"top-version-tip",title:g.$t("config.platform.none"),type:"error",closable:!1},null,8,["title"])]))}}});var fe=(n=>(n[n.EditMode_simple=0]="EditMode_simple",n[n.EditMode_complex=1]="EditMode_complex",n[n.EditMode_source=2]="EditMode_source",n))(fe||{}),ve=(n=>(n[n.YAML=0]="YAML",n[n.CONTENT=1]="CONTENT",n[n.YAML_CONTENT=2]="YAML_CONTENT",n[n.HTML_CONTENT=3]="HTML_CONTENT",n))(ve||{});class Yl{constructor(){oe(this,"editMode");oe(this,"contentShowType");oe(this,"fixTitle");oe(this,"useGoogleTranslate");oe(this,"removeH1")}}const $e=_e.getLogger("utils/publishUtil.ts");function Ct(n){return be(n)}const aa=(n,t)=>{const l=[Q.API_TYPE_VUEPRESS,Q.API_TYPE_HUGO,Q.API_TYPE_HEXO,Q.API_TYPE_JEKYLL],i=[Q.API_TYPE_JVUE,Q.API_TYPE_CONFLUENCE,Q.API_TYPE_CNBLOGS,Q.API_TYPE_WORDPRESS],d=[Q.API_TYPE_LIANDI,Q.API_TYPE_YUQUE,Q.API_TYPE_KMS],b=Xe(),y=b.githubCfg||[],A=b.metaweblogCfg||[],T=b.wordpressCfg||[];if(y.forEach(r=>{const E=r.platformKey,V=Je(r.platformKey);ye(V)&&l.push(E)}),A.forEach(r=>{const E=r.platformKey,V=Je(r.platformKey);ye(V)&&i.push(E)}),T.forEach(r=>{const E=r.platformKey,V=Je(r.platformKey);ye(V)&&i.push(E)}),l.includes(n)){const r=Ct(n).posidKey,E=t[r]||"";return $e.debug("\u5E73\u53F0=>",n),$e.debug("meta=>",t),$e.debug("postidKey=>",r),$e.debug("postidKey\u7684\u503C=>",E),E!==""}else if(i.includes(n)){const r=Ct(n).posidKey,E=t[r]||"";return $e.debug("\u5E73\u53F0=>",n),$e.debug("meta=>",t),$e.debug("postidKey=>",r),$e.debug("postidKey\u7684\u503C=>",E),E!==""}else if(d.includes(n)){const r=Ct(n).posidKey,E=t[r!=null?r:""]||"";return $e.debug("\u5E73\u53F0=>",n),$e.debug("meta=>",t),$e.debug("postidKey=>",r),$e.debug("postidKey\u7684\u503C=>",E),E!==""}return!1},la=()=>{let n=be(Dt.PUBLISH_PREFERENCE_CONFIG_KEY);return He(n)&&(n=new Yl,n.fixTitle=!1,n.useGoogleTranslate=!0,n.editMode=fe.EditMode_simple,n.contentShowType=ve.YAML_CONTENT),n.fixTitle=!0,n.useGoogleTranslate=!0,n.editMode=fe.EditMode_complex,n.contentShowType=ve.YAML,n.removeH1=!0,n},Nl="custom-slug",Ml="custom-desc",Be={SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY:Nl,SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY:Ml},Et={VITE_LOG_INFO_ENABLED:"false",VITE_SIYUAN_API_URL:"http://127.0.0.1:6806",VITE_SIYUAN_CONFIG_TOKEN:"",VITE_MIDDLEWARE_URL:"https://publish.terwer.space/api/middleware"}.TEST==="true",Ol="test-data-siyuanPage",Ll={CONSTANTS_SIYUAN_PAGE:Ol},Rl=(n,t)=>{const l=_e.getLogger("composables/makeSlugCom.ts"),{t:i}=Ue(),d=he({isSlugLoading:!1,forceRefresh:!1,customSlug:"",slugHashEnabled:!0});function b(){return He(d.customSlug)?!0:d.forceRefresh}async function y(T){if(!b()){T!==!0&&N.warning(i("main.force.refresh.tip")),l.debug(i("main.force.refresh.tip"));return}d.isSlugLoading=!0,l.debug("\u5F00\u59CB\u751F\u6210\u522B\u540D...");try{const r=la(),E=await lt(!0,n);if(!E||E===""){d.isSlugLoading=!1,l.error(i("page.no.id")),N.error(i("page.no.id"));return}if(l.debug("\u5F53\u524D\u9875\u9762ID\u4E3A=>",E),Et){const H=Jt(Ll.CONSTANTS_SIYUAN_PAGE),L=JSON.parse(JSON.parse(H));vi.spyOn(t,"getBlockByID").mockResolvedValue(L)}const V=await t.getBlockByID(E);l.debug("\u83B7\u53D6\u5230\u601D\u6E90\u9875\u9762\u6570\u636E=>",V);let P=V.content;if(r.fixTitle&&(P=Ca(P)),l.debug("\u6807\u9898\u5904\u7406\u5B8C\u6BD5"),r.useGoogleTranslate)try{let H;Et?H=await vi.fn().mockImplementation(K=>qe(K))(P):H=await Pt(P),l.debug("\u4F7F\u7528\u8C37\u6B4C\u7FFB\u8BD1"),H?d.customSlug=H:(d.customSlug=qe(P),N.success(i("main.opt.failure")))}catch{d.customSlug=qe(P)}else d.customSlug=qe(P);if(l.debug("\u5B8C\u6210\u522B\u540D\u7FFB\u8BD1"),d.slugHashEnabled){const H=V.content+new Date().toISOString(),L=et("-",Ft(H).toLowerCase());d.customSlug+=L,l.debug("\u4E3A\u522B\u540D\u6DFB\u52A0hash")}const U={[Be.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY]:d.customSlug};Et&&vi.spyOn(t,"setBlockAttrs").mockResolvedValue(void 0),await t.setBlockAttrs(E,U),T!==!0&&N.success(i("main.opt.success")),l.info("\u751F\u6210\u522B\u540D\u6B63\u5E38\u5B8C\u6210,slugData=>",d)}catch(r){const E=et(i("main.opt.failure"),"=>",r);T!==!0&&N.error(E),l.error(E)}d.isSlugLoading=!1,l.debug("\u751F\u6210\u522B\u540D\u7ED3\u675F.")}function A(T){d.customSlug=T}return{slugData:d,makeSlug:y,initSlug:A}},Hl=()=>{const n=_e.getLogger("composables/makeSlugCom.ts"),{t}=Ue(),l=he({yamlObj:{},yamlContent:"",formatter:"",mdContent:"",mdFullContent:"",htmlContent:""}),i=r=>{r.target.select()},d=()=>(n.error("Not implemented"),"yaml example"),b=()=>{throw new Error("Not implemented")},y=m();return{yamlData:l,onYamlContentFocus:i,convertAttrToYAML:d,convertYAMLToAttr:b,copyToClipboard:()=>{Bt(()=>{y.value.focus(),Pa(l.yamlContent),N.success(t("main.opt.success"))})},initYaml:r=>{l.yamlContent=r}}},Gl={class:"github-tips"},Wl={key:0,class:"normal-mode"},jl={class:"form-slug"},ql={key:1,class:"source-mode"},Jl={class:"source-opt"},zl=X({__name:"GithubMain",props:{isReload:{type:Boolean,default:!1},apiType:{type:String,default:""},pageId:{type:String,default:void 0}},setup(n){const t=n,l=_e.getLogger("components/publish/tab/main/GithubMain.vue"),{t:i}=Ue(),d=new xe,b=m(!1),y=m(!1),A=m(et(i("setting.blog.platform.support.github"),t.apiType)),T=he({etype:fe.EditMode_simple,stype:ve.YAML_CONTENT}),r=m({pageId:"",meta:{tags:""}}),{slugData:E,makeSlug:V,initSlug:P}=Rl(t.pageId,d),{yamlData:U,onYamlContentFocus:H,convertAttrToYAML:L,convertYAMLToAttr:K,copyToClipboard:j,initYaml:_}=Hl(),u=g=>{T.etype=g},f=g=>{switch(T.stype=g,g){case ve.YAML:U.yamlContent=U.formatter;break;case ve.CONTENT:U.yamlContent=U.mdContent;break;case ve.YAML_CONTENT:U.yamlContent=U.formatter+U.mdContent;break;case ve.HTML_CONTENT:U.yamlContent=U.htmlContent;break}},o=async()=>{b.value=!0;try{const g=la();T.etype=g.editMode,T.stype=g.contentShowType;const p=be(t.apiType);y.value=p.apiStatus;const v=await lt(!0,t.pageId);if(!v||v===""){b.value=!1,l.error(i("page.no.id")),N.error(i("page.no.id"));return}r.value.pageId=v,r.value.meta=await d.getBlockAttrs(v);const G=Be.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY;await P(r.value.meta[G]),U.formatter=L();let S=(await d.exportMdContent(r.value.pageId)).content;S=At(S),g.removeH1&&(S=wa(S)),U.mdContent=S,U.mdFullContent=U.formatter+`
`+U.mdContent,U.htmlContent=Ut(S),f(g.contentShowType),_(U.yamlContent)}catch(g){const p=et(i("main.opt.failure"),"=>",g);l.error(p)}b.value=!1};return De(async()=>{await o()}),(g,p)=>{const v=Ae,G=Me,ce=tt,S=Fe,D=at,k=Oe,I=Ke,W=mt,ae=ft,ie=$t;return s(),ue("div",null,[b.value?w("",!0):(s(),c(ae,{key:0},{default:a(()=>[e(W,{class:"github-main"},{default:a(()=>[Ve("div",Gl,[T.etype!==C(fe).EditMode_source?(s(),c(v,{key:0,closable:!1,title:A.value,class:"top-version-tip",type:"info"},null,8,["title"])):w("",!0),!y.value&&T.etype!==C(fe).EditMode_source?(s(),c(v,{key:1,closable:!1,title:g.$t("main.publish.github.error.tip"),class:"top-version-tip",type:"error"},null,8,["title"])):w("",!0)]),e(I,{"label-width":"100px"},{default:a(()=>[e(S,{label:g.$t("main.publish.editmode")},{default:a(()=>[e(ce,null,{default:a(()=>[e(G,{type:T.etype===C(fe).EditMode_simple?"primary":"default",onClick:p[0]||(p[0]=R=>u(C(fe).EditMode_simple))},{default:a(()=>[O(B(g.$t("main.publish.editmode.simple")),1)]),_:1},8,["type"]),e(G,{type:T.etype===C(fe).EditMode_complex?"primary":"default",onClick:p[1]||(p[1]=R=>u(C(fe).EditMode_complex))},{default:a(()=>[O(B(g.$t("main.publish.editmode.complex")),1)]),_:1},8,["type"]),e(G,{type:T.etype===C(fe).EditMode_source?"primary":"default",onClick:p[2]||(p[2]=R=>u(C(fe).EditMode_source))},{default:a(()=>[O(B(g.$t("main.publish.editmode.source")),1)]),_:1},8,["type"])]),_:1})]),_:1},8,["label"]),T.etype!==C(fe).EditMode_source?(s(),ue("div",Wl,[Ve("div",jl,[T.etype!==C(fe).EditMode_simple?(s(),c(S,{key:0,label:g.$t("main.force.refresh")},{default:a(()=>[e(D,{modelValue:C(E).forceRefresh,"onUpdate:modelValue":p[3]||(p[3]=R=>C(E).forceRefresh=R)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),T.etype.toString()!==C(fe).EditMode_simple.toString()?(s(),c(S,{key:1,label:g.$t("main.use.hash")},{default:a(()=>[e(D,{modelValue:C(E).slugHashEnabled,"onUpdate:modelValue":p[4]||(p[4]=R=>C(E).slugHashEnabled=R)},null,8,["modelValue"]),C(E).slugHashEnabled?w("",!0):(s(),c(v,{key:0,closable:!1,title:g.$t("main.use.hash.tip"),type:"warning"},null,8,["title"]))]),_:1},8,["label"])):w("",!0),T.etype.toString()!==C(fe).EditMode_simple.toString()?(s(),c(S,{key:2,label:g.$t("main.slug")},{default:a(()=>[e(k,{modelValue:C(E).customSlug,"onUpdate:modelValue":p[5]||(p[5]=R=>C(E).customSlug=R)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),T.etype!==C(fe).EditMode_simple?(s(),c(S,{key:3},{default:a(()=>[e(G,{loading:C(E).isSlugLoading,class:"make-slug-btn",type:"primary",onClick:C(V)},{default:a(()=>[O(B(C(E).isSlugLoading?g.$t("main.opt.loading"):g.$t("main.auto.fetch.slug")),1)]),_:1},8,["loading","onClick"])]),_:1})):w("",!0)])])):w("",!0),T.etype===C(fe).EditMode_source?(s(),ue("div",ql,[e(S,null,{default:a(()=>[e(v,{closable:!1,title:C(Ea)(t.apiType)+" "+g.$t("main.yaml.formatter"),class:"top-yaml-tip",type:"info"},null,8,["title"])]),_:1}),e(S,null,{default:a(()=>[Ve("div",Jl,[Ve("a",{class:ct({current:T.stype===C(ve).YAML}),onClick:p[6]||(p[6]=R=>f(C(ve).YAML))},B(g.$t("yaml.show.type.yaml")),3),Ve("a",{class:ct({current:T.stype===C(ve).CONTENT,middle:!0}),onClick:p[7]||(p[7]=R=>f(C(ve).CONTENT))},B(g.$t("yaml.show.type.md")),3),Ve("a",{class:ct({current:T.stype===C(ve).YAML_CONTENT,middle:!0}),onClick:p[8]||(p[8]=R=>f(C(ve).YAML_CONTENT))},B(g.$t("yaml.show.type.yamlmd")),3),Ve("a",{class:ct({current:T.stype===C(ve).HTML_CONTENT}),onClick:p[9]||(p[9]=R=>f(C(ve).HTML_CONTENT))},B(g.$t("yaml.show.type.html")),3)]),e(k,{ref:"fmtRefInput",modelValue:C(U).yamlContent,"onUpdate:modelValue":p[10]||(p[10]=R=>C(U).yamlContent=R),autosize:{minRows:4,maxRows:16},type:"textarea",onFocus:C(H)},null,8,["modelValue","onFocus"])]),_:1}),e(S,null,{default:a(()=>[e(G,{type:"primary",onClick:C(L)},{default:a(()=>[O(B(g.$t("main.siyuan.to.yaml")),1)]),_:1},8,["onClick"]),e(G,{type:"primary",onClick:C(K)},{default:a(()=>[O(B(g.$t("main.yaml.to.siyuan")),1)]),_:1},8,["onClick"]),e(G,{type:"primary",onClick:C(j)},{default:a(()=>[O(B(g.$t("main.copy")),1)]),_:1},8,["onClick"])]),_:1})])):w("",!0)]),_:1})]),_:1})]),_:1})),e(ie,{loading:b.value,rows:5,animated:""},null,8,["loading"])])}}});const rt=We(zl,[["__scopeId","data-v-dd35dd20"]]),Xl=X({__name:"VuepressMain",props:{pageId:{type:String,default:void 0}},setup(n){const t=n,l=m(Q.API_TYPE_VUEPRESS);return(i,d)=>(s(),c(rt,{"api-type":l.value,"page-id":t.pageId},null,8,["api-type","page-id"]))}}),Ql=X({__name:"HugoMain",props:{pageId:{type:String,default:void 0}},setup(n){const t=n,l=m(Q.API_TYPE_HUGO);return(i,d)=>(s(),c(rt,{"api-type":l.value,"page-id":t.pageId},null,8,["api-type","page-id"]))}}),Zl=X({__name:"HexoMain",props:{pageId:{type:String,default:void 0}},setup(n){const t=n,l=m(Q.API_TYPE_HEXO);return(i,d)=>(s(),c(rt,{"api-type":l.value,"page-id":t.pageId},null,8,["api-type","page-id"]))}}),xl=X({__name:"JekyllMain",props:{pageId:{type:String,default:void 0}},setup(n){const t=n,l=m(Q.API_TYPE_JEKYLL);return(i,d)=>(s(),c(rt,{"api-type":l.value,"page-id":t.pageId},null,8,["api-type","page-id"]))}}),eo=["href","title"],to=X({__name:"MetaweblogMain",props:{isReload:{type:Boolean,default:!1},apiType:{type:String,default:""},useAdaptor:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(n){const t=n,l=_e.getLogger("components/publish/tab/main/MetaweblogMain.vue"),i=new xe,{t:d}=Ue(),b=m(""),y=m(d("setting.blog.platform.support.metaweblog")+t.apiType+" "),A=m(!1),T=m(!1),r=m(!1),E=m(!1),V=m(!1),P=m(!1),U=m(!1),H=m(!1),L=m(!1),K=m(!1),j=m(!1),_=m(!1),u=m(""),f=m(!1),o=he({postid:"",title:"",customSlug:"",desc:"",created:"",checkList:["1"],tag:{inputValue:"",dynamicTags:[],inputVisible:!1},cat:{categorySelected:[],categoryList:[]},categories:["\u9ED8\u8BA4\u5206\u7C7B"]}),g=he({pageId:"",meta:{tags:""}}),p=()=>{L.value=!1},v=()=>{L.value=!0},G=async()=>{H.value=!0;const $=await lt(!0,t.pageId);if(!$||$==="")return;const J=be(t.apiType);nt(J)||(b.value=J.blogName),j.value=!0,g.pageId=$,g.meta=await i.getBlockAttrs($);const x=await i.getBlockByID($);if(!x)throw H.value=!1,N.error(d("config.error.msg")+"_"+t.apiType),new Error(d("config.error.msg")+"_"+t.apiType);l.debug("MetaweblogMain\u521D\u59CB\u5316\u9875\u9762,meta=>",g.meta),o.title=x.content,o.customSlug=g.meta[Be.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY],o.desc=g.meta[Be.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY],o.created=Kt(x.created),o.tag.dynamicTags=[];const Y=(g.meta.tags||"").split(",");for(let te=0;te<Y.length;te++)Y[te]!==""&&o.tag.dynamicTags.push(Y[te]);_.value=aa(t.apiType,g.meta);const F=be(t.apiType),M=new Ye(t.apiType);let ne=[];if(_.value){const te=g.meta;o.postid=te[F.posidKey],u.value=await M.getPreviewUrl(o.postid.toString());try{const le=await M.getPost(o.postid.toString());ne=le.categories,l.debug("postid=>",o.postid),l.debug("post=>",le),l.debug("\u521D\u59CB\u5316\u9009\u62E9\u8FC7\u7684\u5206\u7C7B,catData=>",ne)}catch(le){N.error(d("post.delete.by.platform")),H.value=!1,l.error("\u6587\u7AE0\u65B0\u83B7\u53D6\u5931\u8D25",le)}}let q=[];try{q=await M.getCategories()}catch(te){H.value=!1,l.error("\u5206\u7C7B\u83B7\u53D6\u5931\u8D25",te)}const me=[];q&&q.length&&q.length>0&&(q.forEach(te=>{const le={value:te.description,label:te.description};me.push(le)}),o.cat.categoryList=me),o.cat.categorySelected=ne,o.categories=ne,A.value=J.apiStatus,H.value=!1};De(async()=>{await G()});function ce(){return He(o.customSlug)||K.value?!0:(l.debug(d("main.force.refresh.tip")),!1)}const S=async $=>{if(!ce())return;T.value=!0;const J=await i.getBlockByID(g.pageId);l.debug("page=>",J);let x=J.content;if(x.indexOf(".")>-1&&(x=x.replace(/\d*\./g,"")),l.debug("fmtTitle=>",x),o.checkList.length>0){const h=await Pt(x);l.debug("result=>",h),h?o.customSlug=h:N.success(d("main.opt.failure"))}else o.customSlug=qe(x);if(j.value){const h=J.content+new Date().toISOString(),Y="-"+Ft(h).toLowerCase();o.customSlug+=Y}T.value=!1,$!==!0&&N.success(d("main.opt.success"))},D=async $=>{r.value=!0;const x=(await i.exportMdContent(g.pageId)).content,h=zt(x);o.desc=Xt(h,Dt.MAX_PREVIEW_LENGTH,!0),r.value=!1,$!==!0&&N.success(d("main.opt.success"))},k=$=>{o.tag.dynamicTags.splice(o.tag.dynamicTags.indexOf($),1)},I=m(),W=()=>{o.tag.inputVisible=!0,Bt(()=>{I.value.focus()})},ae=()=>{o.tag.inputValue&&o.tag.dynamicTags.push(o.tag.inputValue),o.tag.inputVisible=!1,o.tag.inputValue=""};async function ie($){if(!f.value){N.warning(d("main.tag.auto.switch.no.tip"));return}E.value=!0;const x=(await i.exportMdContent(g.pageId)).content,h=await Qt(x);l.debug("genTags=>",h);const Y=Zt(h,5);l.debug("hotTags=>",Y);for(let F=0;F<Y.length;F++)o.tag.dynamicTags.includes(Y[F])||o.tag.dynamicTags.push(Y[F]);E.value=!1,$!==!0&&N.success(d("main.opt.success"))}const R=async $=>{const J={[Be.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY]:o.customSlug,[Be.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY]:o.desc,tags:o.tag.dynamicTags.join(",")};await i.setBlockAttrs(g.pageId,J),l.debug("MetaweblogMain\u4FDD\u5B58\u5C5E\u6027\u5230\u601D\u6E90\u7B14\u8BB0,meta=>",J),$!==!0&&(await G(),N.success(d("main.opt.success")))},ge=($,J,x,h)=>{},z=($,J)=>{console.log("data=>",$),console.log("status=>",J);const x=[];J.checkedKeys.forEach(Y=>{x.push(Y.toString())}),o.categories=x,l.debug(" formData.categories=>",o.categories)},Le=async $=>{V.value=!0,await S(!0),await D(!0),await ie(!0),await R(!0),l.debug("\u53D1\u5E03\u5C5E\u6027\u5B8C\u6210"),V.value=!1,$!==!0&&N.success(d("main.publish.oneclick.attr.finish"))},pt=async()=>{if(!A.value){N.error(d("setting.blog.vali.tip.metaweblog"));return}P.value=!0;try{await Le(!0);const $=be(t.apiType),J=new Ye(t.apiType),x=xt(o.title);let h;const F=(await i.exportMdContent(g.pageId)).content;if(Ce.Html===$.pageType){const me=Ut(F);h=ea(me)}else h=At(F);const M=new Vt;M.title=x,M.wp_slug=o.customSlug,M.description=h,M.categories=o.categories,M.mt_keywords=o.tag.dynamicTags.join(","),t.apiType===Q.API_TYPE_CNBLOGS&&M.categories.push("[Markdown]"),M.dateCreated=new Date;const ne=!0;let q;if(_.value){if(q=o.postid,!await J.editPost(q,M,!0))throw N.error("\u6587\u7AE0\u66F4\u65B0\u5931\u8D25"),new Error("\u6587\u7AE0\u66F4\u65B0\u5931\u8D25=>"+q);l.debug("\u6587\u7AE0\u5DF2\u66F4\u65B0\uFF0Cpostid=>",q)}else{q=await J.newPost(M,ne),l.debug("\u5F53\u524D\u4FDD\u5B58\u7684posidKey=>",$.posidKey);const me={[$.posidKey]:q};await i.setBlockAttrs(g.pageId,me),l.debug("MetaweblogMain\u53D1\u5E03\u6210\u529F\uFF0C\u4FDD\u5B58postid,meta=>",me),l.info("\u6587\u7AE0\u53D1\u5E03\u6210\u529F\uFF0Cpostid=>",q)}await G(),N.success(d("main.opt.success"))}catch($){throw l.error("\u53D1\u5E03\u5F02\u5E38"),N.error(d("main.opt.failure")),$}P.value=!1},_t=async()=>{U.value=!0,gt.confirm(d("main.opt.warning.tip"),d("main.opt.warning"),{confirmButtonText:d("main.opt.ok"),cancelButtonText:d("main.opt.cancel"),type:"warning"}).then(async()=>{await ht(!0),U.value=!1,N.warning(d("main.opt.status.cancel"))}).catch($=>{throw N({type:"error",message:d("main.opt.failure")}),U.value=!1,new Error($)})},ht=async $=>{const J=be(t.apiType);l.debug("\u51C6\u5907\u53D6\u6D88\u53D1\u5E03\uFF0Cpostid=>",o.postid);const x={[J.posidKey]:""};await i.setBlockAttrs(g.pageId,x),l.debug("MetaweblogMain\u53D6\u6D88\u53D1\u5E03,meta=>",x);try{await new Ye(t.apiType).deletePost(o.postid)||N.error("\u6587\u7AE0\u5220\u9664\u5931\u8D25")}catch(h){l.error("\u5F3A\u884C\u5220\u9664\u4E00\u6B21",h)}$&&await G()};return($,J)=>{const x=Ae,h=Me,Y=tt,F=Fe,M=at,ne=Oe,q=Gt,me=Wt,te=jt,le=qt,re=ga,se=Ke,Ee=mt,Ne=$t,dt=ft;return s(),c(dt,null,{default:a(()=>[H.value?w("",!0):(s(),c(Ee,{key:0,class:"blog-main"},{default:a(()=>[e(x,{class:"top-version-tip",title:y.value+b.value,type:"info",closable:!1},null,8,["title"]),A.value?w("",!0):(s(),c(x,{key:0,class:"top-version-tip",title:$.$t("setting.blog.vali.tip.metaweblog"),type:"error",closable:!1},null,8,["title"])),n.useAdaptor?(s(),c(x,{key:1,class:"top-version-tip",title:$.$t("setting.conf.tip"),type:"info",closable:!1},null,8,["title"])):w("",!0),e(se,{"label-width":"120px"},{default:a(()=>[e(F,{label:$.$t("main.publish.editmode")},{default:a(()=>[e(Y,null,{default:a(()=>[e(h,{type:L.value?"default":"primary",onClick:p},{default:a(()=>[O(B($.$t("main.publish.editmode.simple")),1)]),_:1},8,["type"]),e(h,{type:L.value?"primary":"default",onClick:v},{default:a(()=>[O(B($.$t("main.publish.editmode.complex")),1)]),_:1},8,["type"])]),_:1})]),_:1},8,["label"]),L.value?(s(),c(F,{key:0,label:$.$t("main.force.refresh")},{default:a(()=>[e(M,{modelValue:K.value,"onUpdate:modelValue":J[0]||(J[0]=pe=>K.value=pe)},null,8,["modelValue"]),K.value?w("",!0):(s(),c(x,{key:0,title:$.$t("main.force.refresh.tip"),type:"warning",closable:!1},null,8,["title"]))]),_:1},8,["label"])):w("",!0),L.value?(s(),c(F,{key:1,label:$.$t("main.slug")},{default:a(()=>[e(ne,{modelValue:o.customSlug,"onUpdate:modelValue":J[1]||(J[1]=pe=>o.customSlug=pe)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),L.value?(s(),c(F,{key:2},{default:a(()=>[e(me,{modelValue:o.checkList,"onUpdate:modelValue":J[2]||(J[2]=pe=>o.checkList=pe)},{default:a(()=>[e(q,{label:"1"},{default:a(()=>[O(B($.$t("main.use.google.translate")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})):w("",!0),L.value?(s(),c(F,{key:3},{default:a(()=>[e(h,{type:"primary",class:"make-slug-btn",onClick:S,loading:T.value},{default:a(()=>[O(B(T.value?$.$t("main.opt.loading"):$.$t("main.auto.fetch.slug")),1)]),_:1},8,["loading"])]),_:1})):w("",!0),L.value?(s(),c(F,{key:4,label:$.$t("main.use.hash")},{default:a(()=>[e(M,{modelValue:j.value,"onUpdate:modelValue":J[3]||(J[3]=pe=>j.value=pe)},null,8,["modelValue"]),j.value?w("",!0):(s(),c(x,{key:0,title:$.$t("main.use.hash.tip"),type:"warning",closable:!1},null,8,["title"]))]),_:1},8,["label"])):w("",!0),L.value?(s(),c(F,{key:5,label:$.$t("main.desc")},{default:a(()=>[e(ne,{type:"textarea",modelValue:o.desc,"onUpdate:modelValue":J[4]||(J[4]=pe=>o.desc=pe)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),L.value?(s(),c(F,{key:6},{default:a(()=>[e(h,{type:"primary",onClick:D,loading:r.value},{default:a(()=>[O(B(r.value?$.$t("main.opt.loading"):$.$t("main.auto.fetch.desc")),1)]),_:1},8,["loading"])]),_:1})):w("",!0),L.value?(s(),c(F,{key:7,label:$.$t("main.create.time")},{default:a(()=>[e(te,{type:"datetime",modelValue:o.created,"onUpdate:modelValue":J[5]||(J[5]=pe=>o.created=pe),format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:$.$t("main.create.time.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):w("",!0),e(F,{label:$.$t("main.tag")},{default:a(()=>[(s(!0),ue(Se,null,Te(o.tag.dynamicTags,pe=>(s(),c(le,{key:pe,class:"mx-1",closable:"","disable-transitions":!1,onClose:Mt=>k(pe)},{default:a(()=>[O(B(pe),1)]),_:2},1032,["onClose"]))),128)),o.tag.inputVisible?(s(),c(ne,{key:0,ref_key:"tagRefInput",ref:I,modelValue:o.tag.inputValue,"onUpdate:modelValue":J[6]||(J[6]=pe=>o.tag.inputValue=pe),class:"ml-1 w-20",size:"small",onKeyup:ta(ae,["enter"]),onBlur:ae},null,8,["modelValue","onKeyup"])):(s(),c(h,{key:1,class:"button-new-tag ml-1 el-tag",size:"small",onClick:W},{default:a(()=>[O(B($.$t("main.tag.new")),1)]),_:1}))]),_:1},8,["label"]),L.value?(s(),c(F,{key:8},{default:a(()=>[e(h,{type:"primary",onClick:ie,loading:E.value},{default:a(()=>[O(B(E.value?$.$t("main.opt.loading"):$.$t("main.auto.fetch.tag")),1)]),_:1},8,["loading"])]),_:1})):w("",!0),e(F,{label:$.$t("main.tag.auto.switch")},{default:a(()=>[e(M,{modelValue:f.value,"onUpdate:modelValue":J[7]||(J[7]=pe=>f.value=pe)},null,8,["modelValue"])]),_:1},8,["label"]),e(F,{label:$.$t("main.cat"),style:{width:"100%"}},{default:a(()=>[e(re,{style:{width:"100%"},modelValue:o.cat.categorySelected,"onUpdate:modelValue":J[8]||(J[8]=pe=>o.cat.categorySelected=pe),data:o.cat.categoryList,multiple:"","tag-type":"info","check-on-click-node":!0,"render-after-expand":!1,"show-checkbox":"",placeholder:$.$t("main.cat.select"),"empty-text":$.$t("main.cat.empty"),"no-data-text":$.$t("main.cat.empty"),onNodeClick:ge,onCheck:z},null,8,["modelValue","data","placeholder","empty-text","no-data-text"])]),_:1},8,["label"]),e(F,{label:$.$t("main.opt.quick")},{default:a(()=>[e(h,{type:"primary",onClick:Le,loading:V.value},{default:a(()=>[O(B(V.value?$.$t("main.opt.loading"):$.$t("main.publish.oneclick.attr")),1)]),_:1},8,["loading"]),e(h,{type:"primary",onClick:R},{default:a(()=>[O(B($.$t("main.save.attr.to.siyuan")),1)]),_:1})]),_:1},8,["label"]),e(F,{label:""},{default:a(()=>[e(h,{type:"primary",onClick:pt,loading:P.value},{default:a(()=>[O(B(P.value?$.$t("main.publish.loading"):_.value?$.$t("main.update"):$.$t("main.publish")),1)]),_:1},8,["loading"]),e(h,{onClick:_t,loading:U.value},{default:a(()=>[O(B($.$t("main.cancel")),1)]),_:1},8,["loading"])]),_:1}),e(F,null,{default:a(()=>[e(h,{type:"danger",text:"",disabled:""},{default:a(()=>[O(B(_.value?$.$t("main.publish.status.published"):$.$t("main.publish.status.unpublish")),1)]),_:1}),_.value?(s(),ue("a",{key:0,href:u.value,title:u.value,target:"_blank"},B($.$t("main.publish.vuepress.see.preview")),9,eo)):w("",!0)]),_:1})]),_:1})]),_:1})),e(Ne,{loading:H.value,rows:5,animated:""},null,8,["loading"])]),_:1})}}});const ze=We(to,[["__scopeId","data-v-c283a753"]]),ao=X({__name:"JVueMain",props:{pageId:{type:String,default:void 0}},setup(n){const t=n,l=m(Q.API_TYPE_JVUE);return(i,d)=>(s(),c(ze,{"api-type":l.value,"page-id":t.pageId},null,8,["api-type","page-id"]))}}),lo=X({__name:"ConfluenceMain",props:{pageId:{type:String,default:void 0}},setup(n){const t=n,l=m(Q.API_TYPE_CONFLUENCE);return(i,d)=>(s(),c(ze,{"api-type":l.value,"use-adaptor":!0,"page-id":t.pageId},null,8,["api-type","page-id"]))}}),oo=X({__name:"CnblogsMain",props:{pageId:{type:String,default:void 0}},setup(n){const t=n,l=m(Q.API_TYPE_CNBLOGS);return(i,d)=>(s(),c(ze,{"api-type":l.value,"page-id":t.pageId},null,8,["api-type","page-id"]))}}),no=X({__name:"WordpressMain",props:{pageId:{type:String,default:void 0}},setup(n){const t=n,l=m(Q.API_TYPE_WORDPRESS);return(i,d)=>(s(),c(ze,{"api-type":l.value,"page-id":t.pageId},null,8,["api-type","page-id"]))}}),so=/.(gif|jpe?g|tiff?|png|webp|bmp|ico)$/i;async function uo(n){let t="";if(n.uri){const l=new URL(n.uri);t=(await(await Ua(l)).buffer()).toString("base64")}else if(n.path&&so.test(n.path))(await(void 0)(n.path)).isFile()&&(t=(await(void 0)(Aa(n.path))).toString("base64"));else throw new Error("Didn't get an image or a good uri for the appropriate param");return{base64:t}}class io{constructor(){oe(this,"logger",_e.getLogger("utils/parser/imageParser.ts"))}hasExternalImages(t){const i=/!\[.*]\((http|https):\/.*\/.*\)/g,d=t.match(i);if(d!=null&&d.length>0)return!0;const b=/!\[.*]\((data:image):\/.*\/.*\)/g,y=t.match(b);return y!=null&&y.length>0}removeImages(t){let l=t;return l=l.replace(/!\[.*]\((http|https):\/.*\/.*\)/g,""),l}async replaceImagesWithBase64(t){var b,y,A;let l=t;const i=/!\[.*]\((http|https):\/.*\/.*\)/g,d=l.match(i);if(d==null||d.length===0)return l;for(let T=0;T<d.length;T++){const r=d[T];this.logger.debug("img=>",r);const E=r.replace(/!\[]\(/g,"").replace(/\)/,"");this.logger.debug("src=>",E);let V;if(Sa()){const P=await uo({uri:E});V=(b=P==null?void 0:P.base64)!=null?b:"no pic"}else{const U=Ta("VITE_MIDDLEWARE_URL","/api/middleware")+"/imageToBase64",H={fetchParams:{imgUrl:E}},L={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(H)};this.logger.debug("middleApiUrl=>",U),this.logger.debug("middleFetchOption=>",L);const j=await(await fetch(U,L)).json();this.logger.debug("resJson=>",j),V=(A=(y=j==null?void 0:j.body)==null?void 0:y.base64str)!=null?A:"parse error"}V=et('<img src="data:image/png;base64,',V,'"  alt="base64Image"/>'),l=l.replace(r,V)}return l}replaceImagesWithAscii(t){return t}replaceImagesWithColorAscii(t){return t}async uploadImageToBeds(t){return t}async downloadMdWithImages(){}async downloadImagesToSiyuan(){throw new Error("\u601D\u6E90\u7B14\u8BB0\u5DF2\u7ECF\u6709\u6B64\u529F\u80FD\uFF0C\u65E0\u9700\u91CD\u65B0\u5B9E\u73B0")}}const ro=["href","title"],po=X({__name:"CommonBlogMain",props:{isReload:{type:Boolean,default:!1},useCat:{type:Boolean,default:!1},apiType:{type:String,default:""},cfg:{type:it,default:null},pageId:{type:String,default:void 0},limitRate:{type:Boolean,default:!1},limitSeconds:{type:Number,default:5},imageToBase64:{type:Boolean,default:!1},removeImage:{type:Boolean,default:!1}},setup(n){const t=n,l=_e.getLogger("components/publish/tab/main/CommonBlogMain.vue"),i=new xe,d=new io,{t:b}=Ue(),y=m(""),A=m(b("setting.blog.platform.support.common")+t.apiType+" "),T=m(!1),r=m(!1),E=m(!1),V=m(!1),P=m(!1),U=m(!1),H=m(!1),L=m(!1),K=m(!1),j=m(!1),_=m(!1),u=m(!1),f=m(""),o=m(!1),g=m(!1),p=he({postid:"",title:"",customSlug:"",desc:"",created:"",checkList:["1"],tag:{inputValue:"",dynamicTags:[],inputVisible:!1},cat:{categorySelected:"",categoryList:[]},categories:["\u9ED8\u8BA4\u5206\u7C7B"],cat_slugs:[]}),v=he({pageId:"",meta:{tags:""}}),G=()=>{K.value=!1},ce=()=>{K.value=!0},S=async()=>{L.value=!0;const h=await lt(!0,t.pageId);if(!h||h==="")return;const Y=be(t.apiType);nt(Y)||(y.value=Y.blogName||""),_.value=!0,v.pageId=h,v.meta=await i.getBlockAttrs(h);let F;try{F=await i.getBlockByID(h)}catch(re){throw L.value=!1,l.error("\u9875\u9762\u4FE1\u606F\u83B7\u53D6\u5931\u8D25",re),new Error("\u9875\u9762\u4FE1\u606F\u83B7\u53D6\u5931\u8D25")}if(!F)throw L.value=!1,N.error(b("config.error.msg")+"_"+t.apiType),new Error(b("config.error.msg")+"_"+t.apiType);l.debug("CommonblogMain\u521D\u59CB\u5316\u9875\u9762,meta=>",v.meta),p.title=F.content,p.customSlug=v.meta[Be.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY],p.desc=v.meta[Be.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY],p.created=Kt(F.created),p.tag.dynamicTags=[];const ne=(v.meta.tags||"").split(",");for(let re=0;re<ne.length;re++)ne[re]!==""&&p.tag.dynamicTags.push(ne[re]);u.value=aa(t.apiType,v.meta),g.value=!u.value;const q=be(t.apiType),me=new Ye(t.apiType);let te=[],le=[];if(u.value){const re=v.meta;if(p.postid=re[q.posidKey||""],f.value=await me.getPreviewUrl(p.postid.toString()),t.useCat)try{const se=await me.getPost(p.postid.toString());te=se.categories,le=se.cate_slugs,l.debug("postid=>",p.postid),l.debug("post=>",se),l.debug("\u521D\u59CB\u5316\u9009\u62E9\u8FC7\u7684\u5206\u7C7B,catData=>",te)}catch(se){N.error(b("post.delete.by.platform")),L.value=!1,l.error("\u5E73\u53F0\u6587\u7AE0\u65B0\u83B7\u53D6\u5931\u8D25",se)}}else if(t.useCat&&!He(q.blogName)){const re=[],se=[];re.push(q.blogName),te=re,se.push(q.blogid),le=se}if(t.useCat){let re=[];try{re=await me.getCategories()}catch(Ee){L.value=!1,l.error("\u5206\u7C7B\u83B7\u53D6\u5931\u8D25",Ee)}const se=[];re&&re.length&&re.length>0&&(re.forEach(Ee=>{const Ne={value:Ee.categoryId,label:Ee.description};se.push(Ne)}),p.cat.categoryList=se),p.cat.categorySelected=te.length>0?te[0]:"",y.value=p.cat.categorySelected,p.categories=te,p.cat_slugs=le}T.value=Y.apiStatus||!1,L.value=!1};De(async()=>{await S()});function D(){return He(p.customSlug)||j.value?!0:(l.debug(b("main.force.refresh.tip")),!1)}const k=async h=>{if(!D())return;r.value=!0;const Y=await i.getBlockByID(v.pageId);l.debug("page=>",Y);let F=Y.content;if(F.indexOf(".")>-1&&(F=F.replace(/\d*\./g,"")),l.debug("fmtTitle=>",F),p.checkList.length>0){const M=await Pt(F);l.debug("result=>",M),M?p.customSlug=M:N.success(b("main.opt.failure"))}else p.customSlug=qe(F);if(_.value){const M=Y.content+new Date().toISOString(),ne="-"+Ft(M).toLowerCase();p.customSlug+=ne}r.value=!1,h!==!0&&N.success(b("main.opt.success"))},I=async h=>{E.value=!0;const F=(await i.exportMdContent(v.pageId)).content,M=zt(F);p.desc=Xt(M,Dt.MAX_PREVIEW_LENGTH,!0),E.value=!1,h!==!0&&N.success(b("main.opt.success"))},W=h=>{p.tag.dynamicTags.splice(p.tag.dynamicTags.indexOf(h),1)},ae=m(),ie=()=>{p.tag.inputVisible=!0,Bt(()=>{ae.value.focus()})},R=()=>{p.tag.inputValue&&p.tag.dynamicTags.push(p.tag.inputValue),p.tag.inputVisible=!1,p.tag.inputValue=""};async function ge(h){if(!o.value){N.warning(b("main.tag.auto.switch.no.tip"));return}V.value=!0;const F=(await i.exportMdContent(v.pageId)).content,M=await Qt(F);l.debug("genTags=>",M);const ne=Zt(M,5);l.debug("hotTags=>",ne);for(let q=0;q<ne.length;q++)p.tag.dynamicTags.includes(ne[q])||p.tag.dynamicTags.push(ne[q]);V.value=!1,h!==!0&&N.success(b("main.opt.success"))}const z=h=>{l.debug("val=>",h);const Y=be(t.apiType),F=[],M=[];F.push(h.label),p.categories=F,M.push(Y.username+"/"+h.value),p.cat_slugs=M,y.value=h.label,l.debug(" formData.categories=>",p.categories),l.debug(" formData.cat_slugs=>",p.cat_slugs)},Le=async h=>{const Y={[Be.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY]:p.customSlug,[Be.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY]:p.desc,tags:p.tag.dynamicTags.join(",")};await i.setBlockAttrs(v.pageId,Y),l.debug("CommonblogMain\u4FDD\u5B58\u5C5E\u6027\u5230\u601D\u6E90\u7B14\u8BB0,meta=>",Y),h!==!0&&(await S(),N.success(b("main.opt.success")))},pt=async h=>{P.value=!0,await k(!0),await I(!0),await ge(!0),await Le(!0),l.debug("\u53D1\u5E03\u5C5E\u6027\u5B8C\u6210"),P.value=!1,h!==!0&&N.success(b("main.publish.oneclick.attr.finish"))},_t=h=>{const F=Jt(h);if(He(F))return!1;l.debug("checkLimit lastmodKey=>",h),l.debug("checkLimit lastmodDate=>",F);const M=Ya(F);return M<=t.limitSeconds?(N.error("\u7531\u4E8E\u3010"+t.apiType+"\u3011\u5E73\u53F0\u7684\u9650\u5236\uFF0C\u6BCF6\u5206\u949F\u4E4B\u5185\u53EA\u80FD\u53D1\u5E03\u6216\u8005\u66F4\u65B0\u4E00\u6B21\u6587\u7AE0\uFF0C\u8DDD\u79BB\u4E0A\u4E00\u6B21\u53D1\u5E03\u65F6\u95F4\u4E3A\uFF1A"+M+"\u79D2\uFF0C\u4ECD\u9700\u7B49\u5F85\uFF1A"+(t.limitSeconds-M)+"\u79D2"),!0):!1},ht=async()=>{const Y=(await i.exportMdContent(v.pageId)).content;t.removeImage&&d.hasExternalImages(Y)?gt.confirm("\u68C0\u6D4B\u5230\u5916\u94FE\u56FE\u7247\uFF0C\u7531\u4E8E\u5E73\u53F0\u9650\u5236\uFF0C\u7EE7\u7EED\u53D1\u5E03\u5C06\u5254\u9664\u8FD9\u4E9B\u56FE\u7247\uFF0C\u4EE5\u7EAF\u6587\u672C\u53D1\u5E03\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F",b("main.opt.warning"),{confirmButtonText:b("main.opt.ok"),cancelButtonText:b("main.opt.cancel"),type:"warning"}).then(async()=>{await $()}).catch(()=>{}):await $()},$=async()=>{if(!T.value){N.error(b("setting.blog.vali.tip.metaweblog"));return}U.value=!0;try{const h=t.apiType+"_PUBLISH_LIMIT";if(_t(h)){U.value=!1;return}l.debug("\u9A8C\u8BC1\u901A\u8FC7\uFF0C\u66F4\u65B0\u53D1\u5E03\u65F6\u95F4");const Y=new Date().toISOString();ka(h,Y),await pt(!0);const F=be(t.apiType),M=new Ye(t.apiType),ne=xt(p.title);let q,te=(await i.exportMdContent(v.pageId)).content;if(t.removeImage&&(te=d.removeImages(te)),Ce.Html===F.pageType){const Ee=Ut(te);q=ea(Ee)}else q=At(te);const le=new Vt;le.title=ne,le.wp_slug=p.customSlug,le.description=q,le.categories=p.categories,le.cate_slugs=p.cat_slugs,le.mt_keywords=p.tag.dynamicTags.join(","),le.dateCreated=new Date;const re=!0;let se;if(u.value){if(se=p.postid,!await M.editPost(se,le,!0))throw N.error("\u6587\u7AE0\u66F4\u65B0\u5931\u8D25"),new Error("\u6587\u7AE0\u66F4\u65B0\u5931\u8D25=>"+se);l.debug("\u6587\u7AE0\u5DF2\u66F4\u65B0\uFF0Cpostid=>",se)}else{if(se=await M.newPost(le,re),le.cate_slugs&&le.cate_slugs.length>0){const Ne=le.cate_slugs[0];se=se+"_"+Ne}l.debug("\u5F53\u524D\u4FDD\u5B58\u7684posidKey=>",F.posidKey);const Ee={[F.posidKey||""]:se};await i.setBlockAttrs(v.pageId,Ee),l.debug("CommonblogMain\u53D1\u5E03\u6210\u529F\uFF0C\u4FDD\u5B58postid,meta=>",Ee),l.debug("\u6587\u7AE0\u53D1\u5E03\u6210\u529F\uFF0Cpostid=>",se)}await S(),N.success(b("main.opt.success"))}catch(h){U.value=!1,l.error("\u53D1\u5E03\u5F02\u5E38",h),N.error({dangerouslyUseHTMLString:!0,message:b("main.opt.failure")+"=>"+h})}U.value=!1},J=async()=>{H.value=!0,gt.confirm(b("main.opt.warning.tip"),b("main.opt.warning"),{confirmButtonText:b("main.opt.ok"),cancelButtonText:b("main.opt.cancel"),type:"warning"}).then(async()=>{await x(!0),H.value=!1,N.warning(b("main.opt.status.cancel"))}).catch(h=>{throw N({type:"error",message:b("main.opt.failure")}),H.value=!1,new Error(h)})},x=async h=>{const Y=be(t.apiType);l.debug("\u51C6\u5907\u53D6\u6D88\u53D1\u5E03\uFF0Cpostid=>",p.postid);const F={[Y.posidKey||""]:""};await i.setBlockAttrs(v.pageId,F),l.debug("MetaweblogMain\u53D6\u6D88\u53D1\u5E03,meta=>",F);try{if(!await new Ye(t.apiType).deletePost(p.postid))throw N.error("\u6587\u7AE0\u5220\u9664\u5931\u8D25"),new Error("\u6587\u7AE0\u5220\u9664\u5931\u8D25")}catch(M){l.error("\u5F3A\u884C\u5220\u9664\u4E00\u6B21",M)}h&&await S()};return(h,Y)=>{const F=Ae,M=Me,ne=tt,q=Fe,me=at,te=Oe,le=Gt,re=Wt,se=jt,Ee=qt,Ne=St,dt=Tt,pe=Ke,Mt=mt,oa=$t,na=ft;return s(),c(na,null,{default:a(()=>[L.value?w("",!0):(s(),c(Mt,{key:0,class:"common-main"},{default:a(()=>[e(F,{class:"top-version-tip",title:A.value+y.value,type:"info",closable:!1},null,8,["title"]),n.useCat&&u.value?(s(),c(F,{key:0,class:"top-version-tip",title:"\u4EC5\u652F\u6301\u65B0\u5EFA\u4FEE\u6539\uFF0C\u6682\u65F6\u4E0D\u652F\u6301\u7F16\u8F91\u6240\u5C5E\u77E5\u8BC6\u5E93\u3002\u5982\u679C\u60A8\u60F3\u79FB\u52A8\u6587\u6863\uFF0C\u8BF7\u5148\u70B9\u51FB\u53D6\u6D88\u5220\u9664\u8BE5\u6587\u6863\uFF0C\u7136\u540E\u91CD\u65B0\u9009\u62E9\u65B0\u7684\u77E5\u8BC6\u5E93\u53D1\u5E03\u3002",type:"warning",closable:!1})):w("",!0),T.value?w("",!0):(s(),c(F,{key:1,class:"top-version-tip",title:h.$t("setting.blog.vali.tip.metaweblog"),type:"error",closable:!1},null,8,["title"])),e(pe,{"label-width":"120px"},{default:a(()=>[e(q,{label:h.$t("main.publish.editmode")},{default:a(()=>[e(ne,null,{default:a(()=>[e(M,{type:K.value?"default":"primary",onClick:G},{default:a(()=>[O(B(h.$t("main.publish.editmode.simple")),1)]),_:1},8,["type"]),e(M,{type:K.value?"primary":"default",onClick:ce},{default:a(()=>[O(B(h.$t("main.publish.editmode.complex")),1)]),_:1},8,["type"])]),_:1})]),_:1},8,["label"]),K.value?(s(),c(q,{key:0,label:h.$t("main.force.refresh")},{default:a(()=>[e(me,{modelValue:j.value,"onUpdate:modelValue":Y[0]||(Y[0]=ee=>j.value=ee)},null,8,["modelValue"]),j.value?w("",!0):(s(),c(F,{key:0,title:h.$t("main.force.refresh.tip"),type:"warning",closable:!1},null,8,["title"]))]),_:1},8,["label"])):w("",!0),K.value?(s(),c(q,{key:1,label:h.$t("main.slug")},{default:a(()=>[e(te,{modelValue:p.customSlug,"onUpdate:modelValue":Y[1]||(Y[1]=ee=>p.customSlug=ee)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),K.value?(s(),c(q,{key:2},{default:a(()=>[e(re,{modelValue:p.checkList,"onUpdate:modelValue":Y[2]||(Y[2]=ee=>p.checkList=ee)},{default:a(()=>[e(le,{label:"1"},{default:a(()=>[O(B(h.$t("main.use.google.translate")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})):w("",!0),K.value?(s(),c(q,{key:3},{default:a(()=>[e(M,{type:"primary",class:"make-slug-btn",onClick:k,loading:r.value},{default:a(()=>[O(B(r.value?h.$t("main.opt.loading"):h.$t("main.auto.fetch.slug")),1)]),_:1},8,["loading"])]),_:1})):w("",!0),K.value?(s(),c(q,{key:4,label:h.$t("main.use.hash")},{default:a(()=>[e(me,{modelValue:_.value,"onUpdate:modelValue":Y[3]||(Y[3]=ee=>_.value=ee)},null,8,["modelValue"]),_.value?w("",!0):(s(),c(F,{key:0,title:h.$t("main.use.hash.tip"),type:"warning",closable:!1},null,8,["title"]))]),_:1},8,["label"])):w("",!0),K.value?(s(),c(q,{key:5,label:h.$t("main.desc")},{default:a(()=>[e(te,{type:"textarea",modelValue:p.desc,"onUpdate:modelValue":Y[4]||(Y[4]=ee=>p.desc=ee)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),K.value?(s(),c(q,{key:6},{default:a(()=>[e(M,{type:"primary",onClick:I,loading:E.value},{default:a(()=>[O(B(E.value?h.$t("main.opt.loading"):h.$t("main.auto.fetch.desc")),1)]),_:1},8,["loading"])]),_:1})):w("",!0),K.value?(s(),c(q,{key:7,label:h.$t("main.create.time")},{default:a(()=>[e(se,{type:"datetime",modelValue:p.created,"onUpdate:modelValue":Y[5]||(Y[5]=ee=>p.created=ee),format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:h.$t("main.create.time.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):w("",!0),e(q,{label:h.$t("main.tag")},{default:a(()=>[(s(!0),ue(Se,null,Te(p.tag.dynamicTags,ee=>(s(),c(Ee,{key:ee,class:"mx-1",closable:"","disable-transitions":!1,onClose:_o=>W(ee)},{default:a(()=>[O(B(ee),1)]),_:2},1032,["onClose"]))),128)),p.tag.inputVisible?(s(),c(te,{key:0,ref_key:"tagRefInput",ref:ae,modelValue:p.tag.inputValue,"onUpdate:modelValue":Y[6]||(Y[6]=ee=>p.tag.inputValue=ee),class:"ml-1 w-20",size:"small",onKeyup:ta(R,["enter"]),onBlur:R},null,8,["modelValue","onKeyup"])):(s(),c(M,{key:1,class:"button-new-tag ml-1 el-tag",size:"small",onClick:ie},{default:a(()=>[O(B(h.$t("main.tag.new")),1)]),_:1}))]),_:1},8,["label"]),K.value?(s(),c(q,{key:8},{default:a(()=>[e(M,{type:"primary",onClick:ge,loading:V.value},{default:a(()=>[O(B(V.value?h.$t("main.opt.loading"):h.$t("main.auto.fetch.tag")),1)]),_:1},8,["loading"])]),_:1})):w("",!0),e(q,{label:h.$t("main.tag.auto.switch")},{default:a(()=>[e(me,{modelValue:o.value,"onUpdate:modelValue":Y[7]||(Y[7]=ee=>o.value=ee)},null,8,["modelValue"])]),_:1},8,["label"]),t.useCat?(s(),c(q,{key:9,label:h.$t("main.cat"),style:{width:"100%"}},{default:a(()=>[g.value?(s(),c(dt,{key:0,modelValue:p.cat.categorySelected,"onUpdate:modelValue":Y[8]||(Y[8]=ee=>p.cat.categorySelected=ee),placeholder:"\u8BF7\u9009\u62E9","no-data-text":"\u6682\u65E0\u6570\u636E",class:"m-2",size:"default",onChange:z},{default:a(()=>[(s(!0),ue(Se,null,Te(p.cat.categoryList,ee=>(s(),c(Ne,{key:ee.value,label:ee.label,value:ee},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(s(),c(dt,{key:1,modelValue:p.cat.categorySelected,"onUpdate:modelValue":Y[9]||(Y[9]=ee=>p.cat.categorySelected=ee),disabled:"",placeholder:"\u8BF7\u9009\u62E9","no-data-text":"\u6682\u65E0\u6570\u636E",class:"m-2",size:"default",onChange:z},{default:a(()=>[(s(!0),ue(Se,null,Te(p.cat.categoryList,ee=>(s(),c(Ne,{key:ee.value,label:ee.label,value:ee},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]))]),_:1},8,["label"])):w("",!0),e(q,{label:h.$t("main.opt.quick")},{default:a(()=>[e(M,{type:"primary",onClick:pt,loading:P.value},{default:a(()=>[O(B(P.value?h.$t("main.opt.loading"):h.$t("main.publish.oneclick.attr")),1)]),_:1},8,["loading"]),e(M,{type:"primary",onClick:Le},{default:a(()=>[O(B(h.$t("main.save.attr.to.siyuan")),1)]),_:1})]),_:1},8,["label"]),e(q,{label:""},{default:a(()=>[e(M,{type:"primary",onClick:ht,loading:U.value},{default:a(()=>[O(B(U.value?h.$t("main.publish.loading"):u.value?h.$t("main.update"):h.$t("main.publish")),1)]),_:1},8,["loading"]),e(M,{onClick:J,loading:H.value},{default:a(()=>[O(B(h.$t("main.cancel")),1)]),_:1},8,["loading"])]),_:1}),e(q,null,{default:a(()=>[e(M,{type:"danger",text:"",disabled:""},{default:a(()=>[O(B(u.value?h.$t("main.publish.status.published"):h.$t("main.publish.status.unpublish")),1)]),_:1}),u.value?(s(),ue("a",{key:0,href:f.value,title:f.value,target:"_blank"},B(h.$t("main.publish.vuepress.see.preview")),9,ro)):w("",!0)]),_:1})]),_:1})]),_:1})),e(oa,{loading:L.value,rows:5,animated:""},null,8,["loading"])]),_:1})}}});const Nt=We(po,[["__scopeId","data-v-2305fa70"]]),co=X({__name:"LiandiMain",props:{pageId:{type:String,default:void 0}},setup(n){const t=n,l=m(Q.API_TYPE_LIANDI);return(i,d)=>(s(),c(Nt,{"api-type":l.value,"page-id":t.pageId,"limit-rate":!0,"limit-seconds":360,"remove-image":!0},null,8,["api-type","page-id"]))}}),go=X({__name:"YuqueMain",props:{pageId:{type:String,default:void 0}},setup(n){const t=n,l=m(Q.API_TYPE_YUQUE);return(i,d)=>(s(),c(Nt,{"api-type":l.value,"page-id":t.pageId,"use-cat":!0},null,8,["api-type","page-id"]))}}),mo=X({__name:"KmsMain",props:{pageId:{type:String,default:void 0}},setup(n){const t=n,l=m(Q.API_TYPE_KMS);return(i,d)=>(s(),c(Nt,{"api-type":l.value,"page-id":t.pageId},null,8,["api-type","page-id"]))}}),fo={key:1},yo=X({__name:"PlatformMain",props:{isReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(n){const t=n,l=_e.getLogger("components/publish/tab/PlatformMain.vue"),{tabCountStore:i,vuepressEnabled:d,hugoEnabled:b,hexoEnabled:y,jekyllEnabled:A,jvueEnabled:T,confEnabled:r,cnblogsEnabled:E,wordpressEnabled:V,liandiEnabled:P,yuqueEnabled:U,kmsEnabled:H,doCount:L}=bt(),K=he({dynamicConfigArray:[],githubArray:[],metaweblogArray:[],wordpressArray:[]}),j=u=>{const f=[];return u.forEach(o=>{const g=new Qe(o.platformType,o.platformKey,o.platformName),p="switch-"+o.platformKey,v=ye(p);g.modelValue=v,v&&f.push(g)}),f},_=()=>{L();const u=Xe();K.dynamicConfigArray=j(u.totalCfg||[]),K.githubArray=j(u.githubCfg||[]),K.metaweblogArray=j(u.metaweblogCfg||[]),K.wordpressArray=j(u.wordpressCfg||[]),l.debug("dynamicJsonCfg=>",JSON.stringify(u)),l.debug("\u5E73\u53F0\u8BBE\u7F6E\u521D\u59CB\u5316")};return yt(()=>t.isReload,(u,f)=>{_()}),De(()=>{_()}),(u,f)=>{const o=kt,g=It,p=Ae;return C(i).tabCount>0?(s(),c(g,{key:0,type:"border-card"},{default:a(()=>[C(d)?(s(),c(o,{key:0,label:u.$t("main.publish.to.vuepress")},{default:a(()=>[e(Xl,{"page-id":t.pageId},null,8,["page-id"])]),_:1},8,["label"])):w("",!0),C(b)?(s(),c(o,{key:1,label:u.$t("main.publish.to.hugo")},{default:a(()=>[e(Ql,{"page-id":t.pageId},null,8,["page-id"])]),_:1},8,["label"])):w("",!0),C(y)?(s(),c(o,{key:2,label:u.$t("main.publish.to.hexo")},{default:a(()=>[e(Zl,{"page-id":t.pageId},null,8,["page-id"])]),_:1},8,["label"])):w("",!0),C(A)?(s(),c(o,{key:3,label:u.$t("main.publish.to.jekyll")},{default:a(()=>[e(xl,{"page-id":t.pageId},null,8,["page-id"])]),_:1},8,["label"])):w("",!0),C(T)?(s(),c(o,{key:4,label:u.$t("main.publish.to.jvue")},{default:a(()=>[e(ao,{"page-id":t.pageId},null,8,["page-id"])]),_:1},8,["label"])):w("",!0),C(r)?(s(),c(o,{key:5,label:u.$t("main.publish.to.conf")},{default:a(()=>[e(lo,{"page-id":t.pageId},null,8,["page-id"])]),_:1},8,["label"])):w("",!0),C(E)?(s(),c(o,{key:6,label:u.$t("main.publish.to.cnblogs")},{default:a(()=>[e(oo,{"page-id":t.pageId},null,8,["page-id"])]),_:1},8,["label"])):w("",!0),C(V)?(s(),c(o,{key:7,label:u.$t("main.publish.to.wordpress")},{default:a(()=>[e(no,{"page-id":t.pageId},null,8,["page-id"])]),_:1},8,["label"])):w("",!0),C(P)?(s(),c(o,{key:8,label:u.$t("main.publish.to.liandi")},{default:a(()=>[e(co,{"page-id":t.pageId},null,8,["page-id"])]),_:1},8,["label"])):w("",!0),C(U)?(s(),c(o,{key:9,label:u.$t("main.publish.to.yuque")},{default:a(()=>[e(go,{"page-id":t.pageId},null,8,["page-id"])]),_:1},8,["label"])):w("",!0),C(H)?(s(),c(o,{key:10,label:u.$t("main.publish.to.kms")},{default:a(()=>[e(mo,{"page-id":t.pageId},null,8,["page-id"])]),_:1},8,["label"])):w("",!0),(s(!0),ue(Se,null,Te(K.githubArray,v=>(s(),c(o,{key:v.platformKey,label:v.platformName},{default:a(()=>[e(rt,{"api-type":v.platformKey,"page-id":t.pageId},null,8,["api-type","page-id"])]),_:2},1032,["label"]))),128)),(s(!0),ue(Se,null,Te(K.metaweblogArray,v=>(s(),c(o,{key:v.platformKey,label:v.platformName},{default:a(()=>[e(ze,{"api-type":v.platformKey,"page-id":t.pageId},null,8,["api-type","page-id"])]),_:2},1032,["label"]))),128)),(s(!0),ue(Se,null,Te(K.wordpressArray,v=>(s(),c(o,{key:v.platformKey,label:v.platformName},{default:a(()=>[e(ze,{"api-type":v.platformKey,"page-id":t.pageId},null,8,["api-type","page-id"])]),_:2},1032,["label"]))),128))]),_:1})):(s(),ue("div",fo,[e(p,{class:"top-version-tip",title:u.$t("config.platform.none"),type:"error",closable:!1},null,8,["title"])]))}}}),bo=X({__name:"PublishService",props:{isReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(n){const t=n,l=_e.getLogger("components/publish/PublishService.vue"),i=m("platform-main"),d=m(!1),b=m(!1),y=m(!1),A=m(!1),T=r=>{l.debug("serviceTabChange=>",r),r==="platform-setting"?(d.value=!d.value,l.debug("platform-setting change=>")):r==="platform-main"?(b.value=!b.value,l.debug("platform-main change=>")):r==="post-bind"?(y.value=!y.value,l.debug("post-bind change=>")):r==="service-switch"&&(A.value=!A.value,l.debug("service-switch change=>"))};return De(()=>{}),(r,E)=>{const V=kt,P=It;return s(),c(P,{"model-value":i.value,"tab-position":"left",onTabChange:T},{default:a(()=>[e(V,{class:"pane-platform-main-body",name:"platform-main",label:r.$t("service.tab.publish.service")},{default:a(()=>[e(yo,{"is-reload":b.value,"page-id":t.pageId},null,8,["is-reload","page-id"])]),_:1},8,["label"]),e(V,{name:"platform-setting",label:r.$t("service.tab.publish.setting")},{default:a(()=>[e(Kl,{"is-reload":d.value},null,8,["is-reload"])]),_:1},8,["label"]),e(V,{name:"post-bind",label:r.$t("service.tab.post.bind")},{default:a(()=>[e(sl,{"is-reload":y.value,"page-id":t.pageId},null,8,["is-reload","page-id"])]),_:1},8,["label"]),e(V,{name:"service-switch",label:r.$t("service.tab.service.switch")},{default:a(()=>[e(al,{"is-reload":A.value},null,8,["is-reload"])]),_:1},8,["label"]),e(V,{name:"dynamic-platform",label:r.$t("dynamic.platform.new")},{default:a(()=>[e(La)]),_:1},8,["label"]),e(V,{name:"change-local",label:r.$t("service.tab.change.local")},{default:a(()=>[e(Ma)]),_:1},8,["label"])]),_:1},8,["model-value"])}}});const Do=We(bo,[["__scopeId","data-v-f92eb2fc"]]);export{Do as P,Vo as f};
