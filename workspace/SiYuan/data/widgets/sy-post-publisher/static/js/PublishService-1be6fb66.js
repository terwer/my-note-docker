var ba=Object.defineProperty;var ha=(d,e,a)=>e in d?ba(d,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):d[e]=a;var le=(d,e,a)=>(ha(d,typeof e!="symbol"?e+"":e,a),a);import{k as Ye,a as qe,s as nt,e as je,c as xt,d as ea,j as Je,f as We,b as _a,n as va,o as Ca,q as ht,r as _t,E as U,i as xe,g as ut,t as wa,u as Ea,v as Pt,w as Mt,x as Vt,y as $t,z as ta,A as At,B as aa,C as la}from"./vendor_element-plus-5709147a.js";import{L as me,l as Ae,n as ke,D as ot,o as Jt,q as zt,s as Ta,t as Xt,u as it,v as Sa,w as Tt,f as et,x as Ee,y as It,z as Da,A as Ie,B as ka,E as Pa,F as Ma,a as rt,G as ue,H as st,I as Ke,J as Re,K as dt,M as _e,N as Ge,P as Bt,O as Ze,Q as pt,V as Va,R as ye,c as Ue,T as oa,U as at,W as Ft,X as Te,Y as sa,Z as $a,$ as Dt,r as Ut,m as vt,a0 as Ct,a1 as Yt,C as Ot,a2 as Lt,a3 as Rt,a4 as Aa,a5 as Xe,a6 as pe,a7 as Pe,a8 as Kt,a9 as Nt,aa as Ia,ab as na,ac as ua,ad as ia,h as Ba,ae as Fa,af as Ua,ag as Ya}from"./api-0c3debab.js";import{u as Se}from"./vendor_vue-i18n-5b80ab8c.js";import{M as oe,u as _,ac as ce,A as Oe,O as r,T as f,U as l,a1 as t,y as s,_ as H,$ as K,Z as C,P as te,ao as Ve,a0 as $e,z as Ne,F as Fe,W as ve,K as Oa,V as La,a2 as Ra,ap as Ht,X as yt,a8 as ra}from"./vendor-a9bad54d.js";import{d as Ka}from"./vendor_pinia-306dd1ce.js";import{d as Gt}from"./vendor_shorthash2-e60185c0.js";import{c as Na}from"./vendor_copy-to-clipboard-a51858f9.js";import{j as da}from"./vendor_js-yaml-c400b4ba.js";import{f as Ha}from"./vendor_rollup-plugin-node-polyfills-2747d496.js";import{f as Ga}from"./vendor_cross-fetch-e4e57030.js";const Qe=me.getLogger(),kt=function(d,e){return d.setTime(d.getTime()+e*60*60*1e3),d},ja=(d,e)=>{if(!d)return"";let a=d;const o=/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(.\d{3})Z$/gm,u=a.match(o);if(u==null)return"";for(let p=0;p<u.length;p++){const i=u[p];let S=i;e&&(Qe.debug("\u4FEE\u590D\u65F6\u533A\uFF0CISO\u65E5\u671F\u9ED8\u8BA4\u665A8\u5C0F\u65F6"),Qe.debug(kt(new Date(i),8)),S=kt(new Date(i),8).toISOString());const T=S.split("T"),y=T[0].replaceAll(/-/g,""),V=T[1].split(".")[0].replaceAll(/:/g,""),$=y+V;a=a.replace(i,$),Qe.debug("formatIsoDate match=>",i),Qe.debug("formatIsoDate result=>",$)}return a},Qt=(d,e,a)=>{if(!d)return"";let o=d;const u=/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(.\d{3})Z$/gm,p=o.match(u);if(p==null)return"";for(let i=0;i<p.length;i++){const S=p[i];let T=S;e&&(T=kt(new Date(S),8).toISOString());const y=T.split("T"),V=y[0],$=y[1].split(".")[0];let E=V+" "+$;a&&(E=V),o=o.replace(S,E)}return o},wt=d=>{if(!d)return"";const a=d.replace(/\D/g,""),o=a.slice(0,4),u=a.slice(4,6),p=a.slice(6,8),i=a.slice(8,10),S=a.slice(10,12),T=a.slice(12,14);let y=o;return u?p?i?S?T?y=o+"-"+u+"-"+p+" "+i+":"+S+":"+T:y=o+"-"+u+"-"+p+" "+i+":"+S:y=o+"-"+u+"-"+p+" "+i:y=o+"-"+u+"-"+p:y=o+"-"+u:y=o,Qe.debug("formatNumToZhDate str=>",d),Qe.debug("formatNumToZhDate datestr=>",y),y},Wa=(d,e)=>typeof d=="string"?new Date(new Date(d).toLocaleString("zh-CN",{timeZone:e})):new Date(d.toLocaleString("zh-CN",{timeZone:e})),pa=d=>{const e=wt(d);return Qe.debug("datestr=>",e),Wa(e,"Asia/Shanghai")},qa=function(d){const e=ja(d,!0),a=pa(e),u=(new Date().getTime()-a.getTime())/1e3;return parseInt(u.toString())},Ja=oe({__name:"DynamicPlatform",setup(d){const e=me.getLogger("components/publish/tab/DynamicPlatform.vue"),{t:a}=Se(),o=_(!0),u=Ae.Github_Jekyll,p=_(),i=ce({subtype:u,ptype:ke.Github,dynCfg:new ot(ke.Github,Jt(ke.Github,u),"Jekyll-1"),subtypeOptions:[],dynamicConfigArray:[]}),S=ce({platformName:[{required:!0,message:()=>a("form.validate.name.required")}]}),T=m=>{i.subtype=m,e.debug(i.subtype),y(i.ptype)},y=m=>{i.ptype=m,i.subtypeOptions=zt(m);const n=Ta(m,i.subtype,i.subtypeOptions.length>0&&i.subtype!==Ae.NONE);i.dynCfg=new ot(m,Jt(m,i.subtypeOptions.length>0?i.subtype:Ae.NONE),n),o.value=i.ptype!==ke.Custom,e.debug(i.ptype)},V=m=>{if(i.ptype===ke.Custom)return U.error(a("dynamic.platform.opt.noselect")),!1;const n=i.dynCfg.platformKey;if(e.debug("\u5C06\u8981\u4FDD\u5B58\u7684\u5E73\u53F0key",n),Sa(i.dynamicConfigArray,n))return U.error(a("dynamic.platform.opt.key.exist")),!1;const w="switch-"+n,g="custom-"+n+"-post-id";return Tt(n)||Tt(w)||Tt(g)?(U.error(a("dynamic.platform.opt.key.exist")),!1):!0},$=async m=>{if(!m||!V()||!await m.validate((g,b)=>{g?e.debug("\u6821\u9A8C\u6210\u529F"):e.error(a("main.opt.failure"),b)}))return;const w=new ot(i.ptype,i.dynCfg.platformKey,i.dynCfg.platformName);w.subPlatformType=i.subtype,i.dynamicConfigArray.push(w),Xt(i.dynamicConfigArray),h(),U.success(a("main.opt.success"))},E=[],I=_(0),Y=_(),M=_(a("dynamic.platform.opt.item.select")),v=m=>{Y.value=m,M.value=a("dynamic.platform.opt.item.select.tip")+Y.value.platformName,e.debug(Y.value)},O=async()=>{xe.confirm(a("dynamic.platform.opt.del.confirm"),a("main.opt.warning"),{confirmButtonText:a("main.opt.ok"),cancelButtonText:a("main.opt.cancel"),type:"warning"}).then(async()=>{if(!Y.value||!Y.value.platformKey){U.error(a("dynamic.platform.opt.item.no.select.tip"));return}for(let m=0;m<i.dynamicConfigArray.length;m++)Y.value.platformKey===i.dynamicConfigArray[m].platformKey&&i.dynamicConfigArray.splice(m,1);Xt(i.dynamicConfigArray),h(),U.success(a("main.opt.success"))}).catch(()=>{})},h=()=>{E.length=0;for(let m=0;m<i.dynamicConfigArray.length;m++)E.push(i.dynamicConfigArray[m]);I.value=i.dynamicConfigArray.length},c=async()=>{i.subtypeOptions=zt(ke.Github),i.dynamicConfigArray=it().totalCfg||[],h(),e.debug("dynamic init page=>",i.dynamicConfigArray)};return Oe(async()=>{await c()}),(m,n)=>{const w=Ye,g=qe,b=nt,P=je,z=xt,B=ea,D=Je,A=We,F=_a,N=va,ae=Ca,Z=ht,G=_t;return r(),f(G,null,{default:l(()=>[t(F,{height:"300px",class:"publish-dyn-header"},{default:l(()=>[t(A,{"label-width":"165px",ref_key:"formRef",ref:p,model:i.dynCfg,rules:S},{default:l(()=>[t(w,{class:"top-version-tip",title:m.$t("dynamic.platform.tip"),type:"info",closable:!1},null,8,["title"]),t(P,{label:m.$t("dynamic.platform.type")},{default:l(()=>[t(b,null,{default:l(()=>[t(g,{type:i.ptype===s(ke).Github?"primary":"",onClick:n[0]||(n[0]=ee=>y(s(ke).Github))},{default:l(()=>[H(K(m.$t("dynamic.platform.type.github")),1)]),_:1},8,["type"]),t(g,{type:i.ptype===s(ke).Metaweblog?"primary":"",onClick:n[1]||(n[1]=ee=>y(s(ke).Metaweblog))},{default:l(()=>[H(K(m.$t("dynamic.platform.type.metaweblog")),1)]),_:1},8,["type"]),t(g,{type:i.ptype===s(ke).Wordpress?"primary":"",onClick:n[2]||(n[2]=ee=>y(s(ke).Wordpress))},{default:l(()=>[H(K(m.$t("dynamic.platform.type.wordpress")),1)]),_:1},8,["type"]),t(g,{type:i.ptype===s(ke).Custom?"primary":"",onClick:n[3]||(n[3]=ee=>y(s(ke).Custom))},{default:l(()=>[H(K(m.$t("dynamic.platform.type.custom")),1)]),_:1},8,["type"])]),_:1})]),_:1},8,["label"]),o.value?C("",!0):(r(),f(P,{key:0},{default:l(()=>[t(w,{title:"\u656C\u8BF7\u671F\u5F85",type:"info",closable:!1})]),_:1})),i.subtypeOptions.length>0&&o.value?(r(),f(P,{key:1},{default:l(()=>[t(B,{modelValue:i.subtype,"onUpdate:modelValue":n[4]||(n[4]=ee=>i.subtype=ee),class:"m-2",placeholder:"Select",onChange:T},{default:l(()=>[(r(!0),te($e,null,Ve(i.subtypeOptions,ee=>(r(),f(z,{key:ee,label:ee,value:ee},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):C("",!0),o.value?(r(),f(P,{key:2,label:i.ptype+m.$t("dynamic.platform.name"),prop:"platformName"},{default:l(()=>[t(D,{modelValue:i.dynCfg.platformName,"onUpdate:modelValue":n[5]||(n[5]=ee=>i.dynCfg.platformName=ee),placeholder:m.$t("dynamic.platform.name.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):C("",!0),C("",!0),o.value?(r(),f(P,{key:4},{default:l(()=>[t(g,{type:"primary",onClick:n[6]||(n[6]=ee=>$(p.value))},{default:l(()=>[H(K(m.$t("dynamic.platform.opt.add")),1)]),_:1})]),_:1})):C("",!0)]),_:1},8,["model","rules"])]),_:1}),t(Z,{class:"dyn-table-list"},{default:l(()=>[t(P,null,{default:l(()=>[(r(),f(ae,{data:E,key:I.value,border:"",stripe:"","highlight-current-row":"","empty-text":"\u6682\u65E0\u6570\u636E",onCurrentChange:v},{default:l(()=>[t(N,{prop:"platformType",label:m.$t("dynamic.platform.type")},null,8,["label"]),t(N,{prop:"subPlatformType",label:m.$t("dynamic.platform.subtype")},null,8,["label"]),t(N,{prop:"platformKey",label:m.$t("dynamic.platform.key")},null,8,["label"]),t(N,{prop:"platformName",label:m.$t("dynamic.platform.name")},null,8,["label"])]),_:1}))]),_:1}),t(P,null,{default:l(()=>[Y.value?(r(),f(w,{key:0,class:"top-version-tip",title:M.value,type:"info",closable:!1},null,8,["title"])):C("",!0),t(g,{type:"danger",onClick:O},{default:l(()=>[H(K(m.$t("dynamic.platform.opt.del.select")),1)]),_:1})]),_:1})]),_:1})]),_:1})}}});const za=et(Ja,[["__scopeId","data-v-bb6fb923"]]),Xa=Ka("tabCount",()=>{const d=_(0);function e(){d.value=0}function a(o){o&&d.value++}return{tabCount:d,resetCount:e,incrementIf:a}}),Qa="switch-vuepress",Za="switch-hugo",xa="switch-hexo",el="switch-jekyll",tl="switch-jvue",al="switch-conf",ll="switch-cnblogs",ol="switch-wordpress",sl="switch-liandi",nl="switch-yuque",ul="switch-kms",be={SWITCH_VUEPRESS_KEY:Qa,SWITCH_HUGO_KEY:Za,SWITCH_HEXO_KEY:xa,SWITCH_JEKYLL_KEY:el,SWITCH_JVUE_KEY:tl,SWITCH_CONF_KEY:al,SWITCH_CNBLOGS_KEY:ll,SWITCH_WORDPRESS_KEY:ol,SWITCH_LIANDI_KEY:sl,SWITCH_YUQUE_KEY:nl,SWITCH_KMS_KEY:ul},Et=()=>{const d=Xa(),e=_(!1),a=_(!1),o=_(!1),u=_(!1),p=_(!1),i=_(!1),S=_(!1),T=_(!1),y=_(!1),V=_(!1),$=_(!1),E=ce({dynamicConfigArray:[]});function I(){d.resetCount(),e.value=Ee(be.SWITCH_VUEPRESS_KEY),d.incrementIf(e.value),a.value=Ee(be.SWITCH_HUGO_KEY),d.incrementIf(a.value),o.value=Ee(be.SWITCH_HEXO_KEY),d.incrementIf(o.value),u.value=Ee(be.SWITCH_JEKYLL_KEY),d.incrementIf(u.value),p.value=Ee(be.SWITCH_JVUE_KEY),d.incrementIf(p.value),i.value=Ee(be.SWITCH_CONF_KEY),d.incrementIf(i.value),S.value=Ee(be.SWITCH_CNBLOGS_KEY),d.incrementIf(S.value),T.value=Ee(be.SWITCH_WORDPRESS_KEY),d.incrementIf(T.value),y.value=Ee(be.SWITCH_LIANDI_KEY),d.incrementIf(y.value),V.value=Ee(be.SWITCH_YUQUE_KEY),d.incrementIf(V.value),$.value=Ee(be.SWITCH_KMS_KEY),d.incrementIf($.value);const M=it().totalCfg||[];E.dynamicConfigArray=[],M.forEach(v=>{const O=It(v.platformKey),h=Ee(O);v.modelValue=Da({switchKey:v.platformKey,switchValue:h}),d.incrementIf(h),E.dynamicConfigArray.push(v)})}return{tabCountStore:d,vuepressEnabled:e,hugoEnabled:a,hexoEnabled:o,jekyllEnabled:u,jvueEnabled:p,confEnabled:i,cnblogsEnabled:S,wordpressEnabled:T,liandiEnabled:y,yuqueEnabled:V,kmsEnabled:$,switchFormData:E,doCount:I}},il={key:0},rl=oe({__name:"ServiceSwitch",props:{isReload:{type:Boolean,default:!1}},setup(d){const e=d;me.getLogger("components/publish/tab/ServiceSwitch.vue");const{tabCountStore:a,vuepressEnabled:o,hugoEnabled:u,hexoEnabled:p,jekyllEnabled:i,jvueEnabled:S,confEnabled:T,cnblogsEnabled:y,wordpressEnabled:V,liandiEnabled:$,yuqueEnabled:E,kmsEnabled:I,switchFormData:Y,doCount:M}=Et(),v=_(!1),O=F=>{Ie(be.SWITCH_VUEPRESS_KEY,F),A()},h=F=>{Ie(be.SWITCH_HUGO_KEY,F),A()},c=F=>{Ie(be.SWITCH_HEXO_KEY,F),A()},m=F=>{Ie(be.SWITCH_JEKYLL_KEY,F),A()},n=F=>{Ie(be.SWITCH_JVUE_KEY,F),A()},w=F=>{Ie(be.SWITCH_CONF_KEY,F),A()},g=F=>{Ie(be.SWITCH_CNBLOGS_KEY,F),A()},b=F=>{Ie(be.SWITCH_WORDPRESS_KEY,F),A()},P=F=>{Ie(be.SWITCH_LIANDI_KEY,F),A()},z=F=>{Ie(be.SWITCH_YUQUE_KEY,F),A()},B=F=>{Ie(be.SWITCH_KMS_KEY,F),A()},D=F=>{const N=Ma(F);Ie(N.switchKey,N.switchValue),A()},A=()=>{M(),a.tabCount===0?v.value=!0:v.value=!1};return Ne(()=>e.isReload,async(F,N)=>{A()}),Oe(()=>{A()}),(F,N)=>{const ae=ut,Z=je,G=Ye,ee=We;return r(),f(ee,{class:"switch-form",inline:""},{default:l(()=>[t(Z,{label:F.$t("service.switch.vuepress")},{default:l(()=>[t(ae,{modelValue:s(o),"onUpdate:modelValue":N[0]||(N[0]=x=>Fe(o)?o.value=x:null),onChange:O},null,8,["modelValue"])]),_:1},8,["label"]),t(Z,{label:F.$t("service.switch.hugo")},{default:l(()=>[t(ae,{modelValue:s(u),"onUpdate:modelValue":N[1]||(N[1]=x=>Fe(u)?u.value=x:null),onChange:h},null,8,["modelValue"])]),_:1},8,["label"]),t(Z,{label:F.$t("service.switch.hexo")},{default:l(()=>[t(ae,{modelValue:s(p),"onUpdate:modelValue":N[2]||(N[2]=x=>Fe(p)?p.value=x:null),onChange:c},null,8,["modelValue"])]),_:1},8,["label"]),t(Z,{label:F.$t("service.switch.jekyll")},{default:l(()=>[t(ae,{modelValue:s(i),"onUpdate:modelValue":N[3]||(N[3]=x=>Fe(i)?i.value=x:null),onChange:m},null,8,["modelValue"])]),_:1},8,["label"]),t(Z,{label:F.$t("service.switch.jvue")},{default:l(()=>[t(ae,{modelValue:s(S),"onUpdate:modelValue":N[4]||(N[4]=x=>Fe(S)?S.value=x:null),onChange:n},null,8,["modelValue"])]),_:1},8,["label"]),t(Z,{label:F.$t("service.switch.conf")},{default:l(()=>[t(ae,{modelValue:s(T),"onUpdate:modelValue":N[5]||(N[5]=x=>Fe(T)?T.value=x:null),onChange:w},null,8,["modelValue"])]),_:1},8,["label"]),t(Z,{label:F.$t("service.switch.cnblogs")},{default:l(()=>[t(ae,{modelValue:s(y),"onUpdate:modelValue":N[6]||(N[6]=x=>Fe(y)?y.value=x:null),onChange:g},null,8,["modelValue"])]),_:1},8,["label"]),t(Z,{label:F.$t("service.switch.wordpress")},{default:l(()=>[t(ae,{modelValue:s(V),"onUpdate:modelValue":N[7]||(N[7]=x=>Fe(V)?V.value=x:null),onChange:b},null,8,["modelValue"])]),_:1},8,["label"]),t(Z,{label:F.$t("service.switch.liandi")},{default:l(()=>[t(ae,{modelValue:s($),"onUpdate:modelValue":N[8]||(N[8]=x=>Fe($)?$.value=x:null),onChange:P},null,8,["modelValue"])]),_:1},8,["label"]),t(Z,{label:F.$t("service.switch.yuque")},{default:l(()=>[t(ae,{modelValue:s(E),"onUpdate:modelValue":N[9]||(N[9]=x=>Fe(E)?E.value=x:null),onChange:z},null,8,["modelValue"])]),_:1},8,["label"]),t(Z,{label:F.$t("service.switch.kms")},{default:l(()=>[t(ae,{modelValue:s(I),"onUpdate:modelValue":N[10]||(N[10]=x=>Fe(I)?I.value=x:null),onChange:B},null,8,["modelValue"])]),_:1},8,["label"]),(r(!0),te($e,null,Ve(s(Y).dynamicConfigArray,x=>(r(),f(Z,{key:x.posid,label:x.platformName},{default:l(()=>[t(ae,{modelValue:x.modelValue,"onUpdate:modelValue":Le=>x.modelValue=Le,"active-value":s(ka)(x.platformKey),"inactive-value":s(Pa)(x.platformKey),onChange:D},null,8,["modelValue","onUpdate:modelValue","active-value","inactive-value"])]),_:2},1032,["label"]))),128)),v.value?(r(),te("div",il,[ve("p",null,[t(G,{title:F.$t("platform.must.select.one"),type:"error",closable:!1},null,8,["title"])])])):C("",!0)]),_:1})}}});const dl=et(rl,[["__scopeId","data-v-304ae79a"]]),pl={key:1},cl={name:"PostBind"},gl=oe({...cl,props:{isReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(d){const e=d,a=me.getLogger("components/publish/tab/PostBind.vue"),{t:o}=Se(),{tabCountStore:u,vuepressEnabled:p,hugoEnabled:i,hexoEnabled:S,jekyllEnabled:T,jvueEnabled:y,confEnabled:V,cnblogsEnabled:$,wordpressEnabled:E,liandiEnabled:I,yuqueEnabled:Y,kmsEnabled:M,doCount:v}=Et(),O=ce({dynamicConfigArray:[]}),h=()=>{v();const D=it().totalCfg||[];O.dynamicConfigArray.length=0,D.forEach(A=>{const F=It(A.platformKey);A.modelValue=Ee(F),O.dynamicConfigArray.push(A)}),a.debug(O.dynamicConfigArray)};Ne(()=>e.isReload,async(B,D)=>{h(),await g()}),Oa(async()=>{h(),await g()}),Oe(()=>{});const c={pageId:"",meta:{}},m=_(),n=ce({vuepressSlug:"",hugoSlug:"",hexoSlug:"",jekyllSlug:"",jvuePostid:"",cnblogsPostid:"",confPostid:"",wordpressPostid:"",liandiPostid:"",yuquePostid:"",kmsPostid:""}),w=ce({});async function g(){const B=await rt(!0,e.pageId);if(a.debug("PostBind pageId=>",B),!B||B==="")return;const A=await new Ke().getBlockAttrs(B);c.pageId=B,c.meta=A,n.vuepressSlug=A[ue.VUEPRESS_POSTID_KEY],n.hugoSlug=A[ue.HUGO_POSTID_KEY],n.hexoSlug=A[ue.HEXO_POSTID_KEY],n.jekyllSlug=A[ue.JEKYLL_POSTID_KEY],n.jvuePostid=A[ue.JVUE_POSTID_KEY],n.confPostid=A[ue.CONFLUENCE_POSTID_KEY],n.cnblogsPostid=A[ue.CNBLOGS_POSTID_KEY],n.wordpressPostid=A[ue.WORDPRESS_POSTID_KEY],n.liandiPostid=A[ue.LIANDI_POSTID_KEY],n.yuquePostid=A[ue.YUQUE_POSTID_KEY],n.kmsPostid=A[ue.KMS_POSTID_KEY];const F=O.dynamicConfigArray;O.dynamicConfigArray=[],F.forEach(N=>{const ae=st(N.platformKey);N.posid=A[ae]||"",O.dynamicConfigArray.push(N)})}const b=(B,D,A,F)=>{B&&!Re(F)?Object.assign(D,{[A]:F}):Object.assign(D,{[A]:""})},P=async B=>{if(!(!B||!await B.validate((A,F)=>{A?a.debug("\u6821\u9A8C\u6210\u529F"):a.error(o("main.opt.failure"),F)})))try{const A={};b(p.value,A,ue.VUEPRESS_POSTID_KEY,n.vuepressSlug),b(i.value,A,ue.HUGO_POSTID_KEY,n.hugoSlug),b(S.value,A,ue.HEXO_POSTID_KEY,n.hexoSlug),b(T.value,A,ue.JEKYLL_POSTID_KEY,n.jekyllSlug),b(y.value,A,ue.JVUE_POSTID_KEY,n.jvuePostid),b(V.value,A,ue.CONFLUENCE_POSTID_KEY,n.confPostid),b($.value,A,ue.CNBLOGS_POSTID_KEY,n.cnblogsPostid),b(E.value,A,ue.WORDPRESS_POSTID_KEY,n.wordpressPostid),b(I.value,A,ue.LIANDI_POSTID_KEY,n.liandiPostid),b(Y.value,A,ue.YUQUE_POSTID_KEY,n.yuquePostid),b(M.value,A,ue.KMS_POSTID_KEY,n.kmsPostid),O.dynamicConfigArray.forEach(N=>{const ae=st(N.platformKey);b(N.modelValue,A,ae,N.posid)}),a.debug("PostBind\u4FDD\u5B58\u5C5E\u6027\u5230\u601D\u6E90\u7B14\u8BB0,meta=>",A),await new Ke().setBlockAttrs(c.pageId,A),U.success(o("main.opt.success"))}catch(A){a.error("\u4FDD\u5B58\u5F02\u5E38",A);let F="\u4FDD\u5B58\u5F02\u5E38";A&&(F=A.toString()),U.error({dangerouslyUseHTMLString:!0,message:o("main.opt.failure")+"=>"+F})}},z=B=>{!B||B.resetFields()};return(B,D)=>{const A=Je,F=je,N=qe,ae=We,Z=Ye;return s(u).tabCount>0?(r(),f(ae,{key:0,"label-width":"85px",class:"post-bind-form",ref_key:"ruleFormRef",ref:m,model:n,rules:w,"status-icon":""},{default:l(()=>[s(p)?(r(),f(F,{key:0,label:B.$t("post.bind.vuepress.slug"),prop:"vuepressSlug"},{default:l(()=>[t(A,{modelValue:n.vuepressSlug,"onUpdate:modelValue":D[0]||(D[0]=G=>n.vuepressSlug=G)},null,8,["modelValue"])]),_:1},8,["label"])):C("",!0),s(i)?(r(),f(F,{key:1,label:B.$t("post.bind.hugo.slug"),prop:"hugoSlug"},{default:l(()=>[t(A,{modelValue:n.hugoSlug,"onUpdate:modelValue":D[1]||(D[1]=G=>n.hugoSlug=G)},null,8,["modelValue"])]),_:1},8,["label"])):C("",!0),s(S)?(r(),f(F,{key:2,label:B.$t("post.bind.hexo.slug"),prop:"hexosSlug"},{default:l(()=>[t(A,{modelValue:n.hexoSlug,"onUpdate:modelValue":D[2]||(D[2]=G=>n.hexoSlug=G)},null,8,["modelValue"])]),_:1},8,["label"])):C("",!0),s(T)?(r(),f(F,{key:3,label:B.$t("post.bind.jekyll.slug"),prop:"jekyllSlug"},{default:l(()=>[t(A,{modelValue:n.jekyllSlug,"onUpdate:modelValue":D[3]||(D[3]=G=>n.jekyllSlug=G)},null,8,["modelValue"])]),_:1},8,["label"])):C("",!0),s(y)?(r(),f(F,{key:4,label:B.$t("post.bind.jvue.postid"),prop:"jvuePostid"},{default:l(()=>[t(A,{modelValue:n.jvuePostid,"onUpdate:modelValue":D[4]||(D[4]=G=>n.jvuePostid=G)},null,8,["modelValue"])]),_:1},8,["label"])):C("",!0),s(V)?(r(),f(F,{key:5,label:B.$t("post.bind.conf.postid"),prop:"confPostid"},{default:l(()=>[t(A,{modelValue:n.confPostid,"onUpdate:modelValue":D[5]||(D[5]=G=>n.confPostid=G)},null,8,["modelValue"])]),_:1},8,["label"])):C("",!0),s($)?(r(),f(F,{key:6,label:B.$t("post.bind.cnblogs.postid"),prop:"cnblogsPostid"},{default:l(()=>[t(A,{modelValue:n.cnblogsPostid,"onUpdate:modelValue":D[6]||(D[6]=G=>n.cnblogsPostid=G)},null,8,["modelValue"])]),_:1},8,["label"])):C("",!0),s(E)?(r(),f(F,{key:7,label:B.$t("post.bind.wordpress.postid"),prop:"wordpressPostid"},{default:l(()=>[t(A,{modelValue:n.wordpressPostid,"onUpdate:modelValue":D[7]||(D[7]=G=>n.wordpressPostid=G)},null,8,["modelValue"])]),_:1},8,["label"])):C("",!0),s(I)?(r(),f(F,{key:8,label:B.$t("post.bind.liandi.postid"),prop:"liandiPostid"},{default:l(()=>[t(A,{modelValue:n.liandiPostid,"onUpdate:modelValue":D[8]||(D[8]=G=>n.liandiPostid=G)},null,8,["modelValue"])]),_:1},8,["label"])):C("",!0),s(Y)?(r(),f(F,{key:9,label:B.$t("post.bind.yuque.postid"),prop:"yuquePostid"},{default:l(()=>[t(A,{modelValue:n.yuquePostid,"onUpdate:modelValue":D[9]||(D[9]=G=>n.yuquePostid=G)},null,8,["modelValue"])]),_:1},8,["label"])):C("",!0),s(M)?(r(),f(F,{key:10,label:B.$t("post.bind.kms.postid"),prop:"kmsPostid"},{default:l(()=>[t(A,{modelValue:n.kmsPostid,"onUpdate:modelValue":D[10]||(D[10]=G=>n.kmsPostid=G)},null,8,["modelValue"])]),_:1},8,["label"])):C("",!0),(r(!0),te($e,null,Ve(O.dynamicConfigArray,(G,ee)=>La((r(),f(F,{key:ee,label:G.platformName},{default:l(()=>[t(A,{modelValue:G.posid,"onUpdate:modelValue":x=>G.posid=x},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])),[[Ra,G.modelValue]])),128)),t(F,null,{default:l(()=>[t(N,{type:"primary",onClick:D[11]||(D[11]=G=>P(m.value))},{default:l(()=>[H(K(B.$t("post.bind.conf.save")),1)]),_:1}),t(N,{onClick:D[12]||(D[12]=G=>z(m.value))},{default:l(()=>[H(K(B.$t("post.bind.conf.cancel")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])):(r(),te("div",pl,[t(Z,{class:"top-version-tip",title:B.$t("config.platform.none"),type:"error",closable:!1},null,8,["title"])]))}}});const ml=et(gl,[["__scopeId","data-v-1e3d85a4"]]);class fl extends dt{constructor(e){switch(super("","","","",""),this.previewUrl="/post/[postid].html",this.posidKey=st(e.platformKey),this.blogName=e.subPlatformType,e.subPlatformType){case Ae.Github_Vuepress:this.defaultPath="docs";break;case Ae.Github_Hugo:this.defaultPath="content/post";break;case Ae.Github_Hexo:this.defaultPath="source/_posts",this.previewUrl="/[date]/[postid]/";break;case Ae.Github_Jekyll:this.defaultPath="_posts",this.previewUrl="/[cats]/[date]/[postid].html";break;case Ae.Github_Vitepress:this.defaultPath="docs";break;case Ae.Github_Nuxt:this.defaultPath="content";break;case Ae.Github_Next:this.defaultPath="pages";break}}}var De=(d=>(d[d.Markdown=0]="Markdown",d[d.Html=1]="Html",d))(De||{});class tt{constructor(e,a,o,u){le(this,"home");le(this,"apiUrl");le(this,"username");le(this,"password");le(this,"apiStatus");le(this,"blogName");le(this,"posidKey");le(this,"previewUrl");le(this,"pageType");this.home=e,this.apiUrl=a,this.username=o,this.password=u,this.apiStatus=!1,this.blogName="",this.posidKey="",this.previewUrl="",this.pageType=De.Markdown}}class yl extends tt{constructor(e){super("","","",""),this.posidKey=e,this.previewUrl="/p/[postid].html",this.pageType=De.Html}}class bl extends tt{constructor(e){super("http://localhost:8000","http://localhost:8000/xmlrpc.php","",""),this.posidKey=e,this.previewUrl="/?p=[postid]",this.pageType=De.Html}}const hl={class:"github-setting-basic"},_l={href:"https://github.com/settings/tokens/new",target:"_blank"},vl={key:0,class:"github-setting-advanced"},ct=oe({__name:"GithubSetting",props:{isReload:{type:Boolean,default:!1},apiType:{type:String,default:""},cfg:{type:dt,default:null}},setup(d){const e=d,a=me.getLogger("components/publish/tab/setting/GithubSetting.vue"),{t:o}=Se(),u=_(!1),p=_(!1),i=_(!1),S=_(!0),T=_(),y=ce({githubUser:"",githubRepo:"",githubToken:"",defaultBranch:"main",defaultPath:"docs/_posts",msg:"auto published by sy-post-publisher",author:"terwer",email:"youweics@163.com",home:"",baseUrl:"",previewMdUrl:"",previewUrl:"",mdFilenameRule:"[filename]"}),V=ce({githubUser:[{required:!0,message:()=>o("form.validate.name.required")}],githubRepo:[{required:!0,message:()=>o("form.validate.name.required")}],githubToken:[{required:!0,message:()=>o("form.validate.name.required")}],defaultBranch:[{required:!0,message:()=>o("form.validate.name.required")}],defaultPath:[{required:!0,message:()=>o("form.validate.name.required")}],msg:[{required:!0,message:()=>o("form.validate.name.required")}],author:[{required:!0,message:()=>o("form.validate.name.required")}],email:[{required:!0,message:()=>o("form.validate.name.required")}]}),$=()=>{u.value=!1},E=()=>{u.value=!0},I=c=>{S.value=c},Y=c=>{!c||c.resetFields()},M=async c=>{!c||!await c.validate((n,w)=>{n?a.debug("\u6821\u9A8C\u6210\u529F"):a.error(o("main.opt.failure"),w)})||O(!1)},v=async()=>{p.value=!0,O(!0);const c=_e(e.apiType);let m;try{const n=new Ge(e.apiType),w=new Bt;w.postid="content/post/test.md",w.description="# Hello world";let g;try{g=await n.newPost(w)}catch(b){m=b,c.apiStatus=!1,i.value=!1}g?(c.apiStatus=!0,i.value=!0):(c.apiStatus=!1,i.value=!1),S.value&&await n.deletePost(w.postid)}catch(n){c.apiStatus=!1,i.value=!1,a.error(n)}Ze(e.apiType,c),i.value?U.success(o("main.opt.success")):m?U.error(o("setting.blog.vali.error")+"=>"+m):U.error(o("setting.blog.vali.error")),p.value=!1},O=c=>{const m=e.cfg;m.githubUser=y.githubUser,m.githubRepo=y.githubRepo,m.githubToken=y.githubToken,m.defaultPath=y.defaultPath,m.defaultBranch=y.defaultBranch,m.defaultMsg=y.msg,m.author=y.author,m.email=y.email,m.home=y.home,m.baseUrl=y.baseUrl,m.previewMdUrl=y.previewMdUrl,m.previewUrl=y.previewUrl,m.mdFilenameRule=y.mdFilenameRule,m.apiStatus=i.value,Ze(e.apiType,m),c!==!0&&U.success(o("main.opt.success"))},h=()=>{let c=_e(e.apiType);pt(c)&&(c=e.cfg),c&&(y.githubUser=c.githubUser,y.githubRepo=c.githubRepo,y.githubToken=c.githubToken,y.defaultPath=c.defaultPath,y.defaultBranch=c.defaultBranch,y.msg=c.defaultMsg,y.author=c.author,y.email=c.email,y.home=c.home,y.baseUrl=c.baseUrl,y.previewMdUrl=c.previewMdUrl,y.previewUrl=c.previewUrl,y.mdFilenameRule=c.mdFilenameRule,i.value=c.apiStatus)};return Oe(async()=>{h()}),(c,m)=>{const n=qe,w=nt,g=je,b=Je,P=ut,z=Ye,B=We;return r(),f(B,{"label-width":"120px",ref_key:"formRef",ref:T,model:y,rules:V,"status-icon":""},{default:l(()=>[t(g,{label:c.$t("main.publish.editmode")},{default:l(()=>[t(w,null,{default:l(()=>[t(n,{type:u.value?"default":"primary",onClick:$},{default:l(()=>[H(K(c.$t("main.publish.editmode.simple")),1)]),_:1},8,["type"]),t(n,{type:u.value?"primary":"default",onClick:E},{default:l(()=>[H(K(c.$t("main.publish.editmode.complex")),1)]),_:1},8,["type"])]),_:1})]),_:1},8,["label"]),ve("div",hl,[t(g,{label:c.$t("setting.blog.type.github.user"),prop:"githubUser"},{default:l(()=>[t(b,{modelValue:y.githubUser,"onUpdate:modelValue":m[0]||(m[0]=D=>y.githubUser=D),placeholder:c.$t("setting.blog.type.github.user.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(g,{label:c.$t("setting.blog.type.github.repo"),prop:"githubRepo"},{default:l(()=>[t(b,{modelValue:y.githubRepo,"onUpdate:modelValue":m[1]||(m[1]=D=>y.githubRepo=D),placeholder:c.$t("setting.blog.type.github.repo.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(g,{label:c.$t("setting.blog.type.github.default.branch"),prop:"defaultBranch"},{default:l(()=>[t(b,{modelValue:y.defaultBranch,"onUpdate:modelValue":m[2]||(m[2]=D=>y.defaultBranch=D),placeholder:c.$t("setting.blog.type.github.default.branch.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(g,{label:c.$t("setting.blog.type.github.token"),prop:"githubToken"},{default:l(()=>[t(b,{type:"password",modelValue:y.githubToken,"onUpdate:modelValue":m[3]||(m[3]=D=>y.githubToken=D),placeholder:c.$t("setting.blog.type.github.token.tip"),"show-password":""},null,8,["modelValue","placeholder"]),ve("a",_l,K(c.$t("setting.blog.type.github.token.gen")),1)]),_:1},8,["label"])]),u.value?(r(),te("div",vl,[t(g,{label:c.$t("setting.blog.type.github.default.path"),prop:"defaultPath"},{default:l(()=>[t(b,{modelValue:y.defaultPath,"onUpdate:modelValue":m[4]||(m[4]=D=>y.defaultPath=D),placeholder:c.$t("setting.blog.type.github.default.path.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(g,{label:c.$t("setting.blog.type.github.msg"),prop:"msg"},{default:l(()=>[t(b,{modelValue:y.msg,"onUpdate:modelValue":m[5]||(m[5]=D=>y.msg=D),placeholder:c.$t("setting.blog.type.github.msg.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(g,{label:c.$t("setting.blog.type.github.author"),prop:"author"},{default:l(()=>[t(b,{modelValue:y.author,"onUpdate:modelValue":m[6]||(m[6]=D=>y.author=D),placeholder:c.$t("setting.blog.type.github.author.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(g,{label:c.$t("setting.blog.type.github.email"),prop:"email"},{default:l(()=>[t(b,{modelValue:y.email,"onUpdate:modelValue":m[7]||(m[7]=D=>y.email=D),placeholder:c.$t("setting.blog.type.github.email.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(g,{label:c.$t("setting.common.home")},{default:l(()=>[t(b,{modelValue:y.home,"onUpdate:modelValue":m[8]||(m[8]=D=>y.home=D),placeholder:c.$t("setting.common.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(g,{label:c.$t("setting.github.baseUrl")},{default:l(()=>[t(b,{modelValue:y.baseUrl,"onUpdate:modelValue":m[9]||(m[9]=D=>y.baseUrl=D),placeholder:c.$t("setting.github.baseUrl.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(g,{label:c.$t("setting.blog.previewMdUrl")},{default:l(()=>[t(b,{modelValue:y.previewMdUrl,"onUpdate:modelValue":m[10]||(m[10]=D=>y.previewMdUrl=D),placeholder:c.$t("setting.blog.previewMdUrl.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(g,{label:c.$t("setting.blog.previewUrl")},{default:l(()=>[t(b,{modelValue:y.previewUrl,"onUpdate:modelValue":m[11]||(m[11]=D=>y.previewUrl=D),placeholder:c.$t("setting.blog.previewUrl.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(g,{label:c.$t("setting.blog.mdFilenameRule")},{default:l(()=>[t(b,{modelValue:y.mdFilenameRule,"onUpdate:modelValue":m[12]||(m[12]=D=>y.mdFilenameRule=D),placeholder:c.$t("setting.blog.mdFilenameRule.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])])):C("",!0),t(g,{label:c.$t("form.validate.github.auto.delete")},{default:l(()=>[t(P,{modelValue:S.value,"onUpdate:modelValue":m[13]||(m[13]=D=>S.value=D),onChange:I},null,8,["modelValue"])]),_:1},8,["label"]),t(g,null,{default:l(()=>[t(n,{type:"primary",onClick:v,loading:p.value},{default:l(()=>[H(K(p.value?c.$t("setting.blog.vali.ing"):c.$t("setting.blog.vali")),1)]),_:1},8,["loading"]),i.value?C("",!0):(r(),f(z,{key:0,title:c.$t("setting.blog.vali.tip"),type:"warning",closable:!1},null,8,["title"])),i.value?(r(),f(z,{key:1,title:c.$t("setting.blog.vali.ok"),type:"success",closable:!1},null,8,["title"])):C("",!0)]),_:1}),t(g,null,{default:l(()=>[t(n,{type:"primary",onClick:m[14]||(m[14]=D=>M(T.value))},{default:l(()=>[H(K(c.$t("setting.blog.save")),1)]),_:1}),t(n,{onClick:m[15]||(m[15]=D=>Y(T.value))},{default:l(()=>[H(K(c.$t("setting.blog.cancel")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])}}}),Cl=oe({__name:"VuepressSetting",setup(d){const e=_(ye.API_TYPE_VUEPRESS),a=new Va,o=_(a);return(u,p)=>(r(),f(ct,{"api-type":e.value,cfg:o.value},null,8,["api-type","cfg"]))}});class wl extends dt{constructor(){super("",Ae.Github_Hugo,"","",""),this.defaultPath="content/post",this.posidKey=ue.HUGO_POSTID_KEY,this.home="",this.previewUrl="/post/[postid].html",this.mdFilenameRule="[slug].md"}}const El=oe({__name:"HugoSetting",setup(d){const e=_(ye.API_TYPE_HUGO),a=new wl,o=_(a);return(u,p)=>(r(),f(ct,{"api-type":e.value,cfg:o.value},null,8,["api-type","cfg"]))}});class Tl extends dt{constructor(){super("",Ae.Github_Hexo,"","",""),this.defaultPath="source/_posts",this.posidKey=ue.HEXO_POSTID_KEY,this.previewUrl="/[date]/[postid]/",this.mdFilenameRule="[slug].md"}}const Sl=oe({__name:"HexoSetting",setup(d){const e=_(ye.API_TYPE_HEXO),a=new Tl,o=_(a);return(u,p)=>(r(),f(ct,{"api-type":e.value,cfg:o.value},null,8,["api-type","cfg"]))}});class Dl extends dt{constructor(){super("",Ae.Github_Jekyll,"","",""),this.defaultPath="_posts",this.posidKey=ue.JEKYLL_POSTID_KEY,this.previewUrl="/[cats]/[yyyy]/[mm]/[dd]/[postid].html",this.mdFilenameRule="[yyyy]-[mm]-[dd]-[slug].md"}}const kl=oe({__name:"JekyllSetting",setup(d){const e=_(ye.API_TYPE_JEKYLL),a=new Dl,o=_(a);return(u,p)=>(r(),f(ct,{"api-type":e.value,cfg:o.value},null,8,["api-type","cfg"]))}});class Pl extends tt{constructor(){super("https://[your-jvue-site]","https://[your-jvue-site]/xmlrpc","",""),this.posidKey=ue.JVUE_POSTID_KEY,this.previewUrl="/post/[postid].html",this.pageType=De.Markdown}}const gt=oe({__name:"MetaweblogSetting",props:{isReload:{type:Boolean,default:!1},apiType:{type:String,default:""},cfg:{type:tt,default:null}},setup(d){const e=d,a=me.getLogger("components/publish/tab/setting/MetaweblogSetting.vue"),{t:o}=Se(),u=parseInt(De.Markdown.toString()),p=_(""),i=_(""),S=_(""),T=_(""),y=_(""),V=_(u),$=_(!1),E=_(!1),I=_(""),Y=_(o("setting.blog.platform.support.metaweblog")+e.apiType+" "),M=async()=>{$.value=!0;try{v(!0);const h=_e(e.apiType),m=await new Ge(e.apiType).getUsersBlogs();if(m&&m.length>0){const n=m[0];h.blogName=n.blogName,I.value=n.blogName,h.apiStatus=!0,E.value=!0}else h.apiStatus=!1,E.value=!1;Ze(e.apiType,h)}catch(h){console.error(h)}E.value?U.success(o("main.opt.success")):U.error(o("setting.blog.vali.error")),$.value=!1,a.debug("Metaweblog\u901A\u7528Setting\u9A8C\u8BC1\u5B8C\u6BD5")},v=h=>{a.debug("Metaweblog\u901A\u7528Setting\u4FDD\u5B58\u914D\u7F6E");const c=e.cfg;c.home=p.value,c.username=T.value,c.password=y.value,c.apiUrl=i.value,c.previewUrl=S.value,c.blogName=I.value,c.pageType=V.value,c.apiStatus=E.value,Ze(e.apiType,c),h!==!0&&U.success(o("main.opt.success"))},O=()=>{a.debug("Metaweblog\u901A\u7528Setting\u914D\u7F6E\u521D\u59CB\u5316");let h=_e(e.apiType);pt(h)&&(h=e.cfg),h&&(a.debug("get setting conf=>",h),p.value=h.home,i.value=h.apiUrl,S.value=h.previewUrl,T.value=h.username,y.value=h.password,I.value=h.blogName,V.value=h.pageType,E.value=h.apiStatus)};return Oe(async()=>{O()}),(h,c)=>{const m=Ye,n=Je,w=je,g=wa,b=Ea,P=qe,z=We;return r(),f(z,{"label-width":"120px"},{default:l(()=>[t(m,{class:"top-version-tip",title:Y.value+I.value,type:"info",closable:!1},null,8,["title"]),t(w,{label:h.$t("setting.blog.url")},{default:l(()=>[t(n,{modelValue:p.value,"onUpdate:modelValue":c[0]||(c[0]=B=>p.value=B)},null,8,["modelValue"])]),_:1},8,["label"]),t(w,{label:h.$t("setting.blog.username")},{default:l(()=>[t(n,{modelValue:T.value,"onUpdate:modelValue":c[1]||(c[1]=B=>T.value=B)},null,8,["modelValue"])]),_:1},8,["label"]),t(w,{label:h.$t("setting.blog.password")},{default:l(()=>[t(n,{type:"password",modelValue:y.value,"onUpdate:modelValue":c[2]||(c[2]=B=>y.value=B),"show-password":""},null,8,["modelValue"])]),_:1},8,["label"]),t(w,{label:h.$t("setting.blog.apiurl")},{default:l(()=>[t(n,{modelValue:i.value,"onUpdate:modelValue":c[3]||(c[3]=B=>i.value=B)},null,8,["modelValue"])]),_:1},8,["label"]),t(w,{label:h.$t("setting.blog.previewUrl")},{default:l(()=>[t(n,{modelValue:S.value,"onUpdate:modelValue":c[4]||(c[4]=B=>S.value=B)},null,8,["modelValue"])]),_:1},8,["label"]),t(w,{label:h.$t("setting.blog.pageType")},{default:l(()=>[t(b,{modelValue:V.value,"onUpdate:modelValue":c[5]||(c[5]=B=>V.value=B),class:"ml-4"},{default:l(()=>[t(g,{label:0,size:"large"},{default:l(()=>[H("Markdown")]),_:1}),t(g,{label:1,size:"large"},{default:l(()=>[H("HTML")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(w,null,{default:l(()=>[t(P,{type:"primary",onClick:M,loading:$.value},{default:l(()=>[H(K($.value?h.$t("setting.blog.vali.ing"):h.$t("setting.blog.vali")),1)]),_:1},8,["loading"]),E.value?C("",!0):(r(),f(m,{key:0,title:h.$t("setting.blog.vali.tip.metaweblog"),type:"warning",closable:!1},null,8,["title"])),E.value?(r(),f(m,{key:1,title:h.$t("setting.blog.vali.ok.metaweblog"),type:"success",closable:!1},null,8,["title"])):C("",!0)]),_:1}),t(w,null,{default:l(()=>[t(P,{type:"primary",onClick:v},{default:l(()=>[H(K(h.$t("setting.blog.save")),1)]),_:1}),t(P,null,{default:l(()=>[H(K(h.$t("setting.blog.cancel")),1)]),_:1})]),_:1})]),_:1})}}}),Ml=oe({__name:"JVueSetting",setup(d){const e=_(ye.API_TYPE_JVUE),a=_(new Pl);return(o,u)=>(r(),f(gt,{"api-type":e.value,cfg:a.value},null,8,["api-type","cfg"]))}});class Vl extends tt{constructor(){super("https://youweics.atlassian.net/wiki/spaces/[spaceKey]","http://localhost:3000/api/xmlrpc","",""),this.posidKey=ue.CONFLUENCE_POSTID_KEY,this.previewUrl="pages/[postid]",this.pageType=De.Html}}const $l=oe({__name:"ConfluenceSetting",setup(d){const e=_(ye.API_TYPE_CONFLUENCE),a=_(new Vl);return(o,u)=>(r(),f(gt,{"api-type":e.value,cfg:a.value},null,8,["api-type","cfg"]))}});class Al extends tt{constructor(){super("https://www.cnblogs.com/[yourblog]","https://rpc.cnblogs.com/metaweblog/[yourblog]","",""),this.posidKey=ue.CNBLOGS_POSTID_KEY,this.previewUrl="/p/[postid].html",this.pageType=De.Markdown}}const Il=oe({__name:"CnblogsSetting",setup(d){const e=_(ye.API_TYPE_CNBLOGS),a=new Al,o=_(a);return(u,p)=>(r(),f(gt,{"api-type":e.value,cfg:o.value},null,8,["api-type","cfg"]))}});class Bl extends tt{constructor(){super("http://localhost:8000","http://localhost:8000/xmlrpc.php","",""),this.posidKey=ue.WORDPRESS_POSTID_KEY,this.previewUrl="/?p=[postid]",this.pageType=De.Markdown}}const Zt=oe({__name:"WordpressSetting",setup(d){const e=_(ye.API_TYPE_WORDPRESS),a=_(new Bl);return(o,u)=>(r(),f(gt,{"api-type":e.value,cfg:a.value},null,8,["api-type","cfg"]))}});class mt{constructor(){le(this,"home");le(this,"apiUrl");le(this,"username");le(this,"password");le(this,"token");le(this,"apiStatus");le(this,"blogName");le(this,"blogid");le(this,"posidKey");le(this,"previewUrl");le(this,"pageType");le(this,"tokenSettingUrl");this.home="",this.apiUrl="",this.username="",this.password="",this.token="",this.apiStatus=!1,this.blogName="",this.blogid="",this.posidKey="",this.previewUrl="",this.pageType=De.Markdown,this.tokenSettingUrl=""}}class Fl extends mt{constructor(){super(),this.home="https://ld246.com/",this.apiUrl="https://ld246.com/api/v2",this.tokenSettingUrl="https://ld246.com/settings/account",this.posidKey=ue.LIANDI_POSTID_KEY,this.previewUrl="/article/[postid]",this.pageType=De.Markdown}}const Ul=["href"],Yl=["href"],jt=oe({__name:"CommonBlogSetting",props:{isReload:{type:Boolean,default:!1},apiType:{type:String,default:""},cfg:{type:mt,default:null},usernameEnabled:{type:Boolean,default:!1},passwordEnabled:{type:Boolean,default:!1},tokenEnabled:{type:Boolean,default:!1}},setup(d){const e=d,a=me.getLogger("components/publish/tab/setting/CommonBlogSetting.vue"),{t:o}=Se(),u=_(""),p=_(""),i=_(""),S=_(""),T=_(""),y=_(!1),V=_(!1),$=_(""),E=_(""),I=_(""),Y=_(o("setting.blog.platform.support.common")+e.apiType+" "),M=async()=>{y.value=!0;try{v(!0);const h=_e(e.apiType),m=await new Ge(e.apiType).getUsersBlogs();if(m&&m.length>0){const n=m[0];h.apiStatus=!0,V.value=!0,h.blogName=n.blogName,$.value=n.blogName,h.blogid=n.blogid,E.value=n.blogid,Ze(e.apiType,h)}else h.apiStatus=!1,V.value=!1,Ze(e.apiType,h)}catch(h){console.error(h)}V.value?U.success(o("main.opt.success")):U.error(o("setting.blog.vali.error")),y.value=!1,a.debug("\u901A\u7528Setting\u9A8C\u8BC1\u5B8C\u6BD5")},v=h=>{a.debug("Metaweblog\u901A\u7528Setting\u4FDD\u5B58\u914D\u7F6E");const c=e.cfg;c.home=u.value,c.username=i.value,c.password=S.value,c.token=T.value,c.apiUrl=p.value,c.apiStatus=V.value,c.blogName=$.value,c.blogid=E.value,Ze(e.apiType,c),h!==!0&&U.success(o("main.opt.success"))},O=()=>{a.debug("\u901A\u7528Setting\u914D\u7F6E\u521D\u59CB\u5316");let h=_e(e.apiType);pt(h)&&(h=e.cfg),h&&(a.debug("get setting conf=>",h),u.value=h.home||"",p.value=h.apiUrl||"",i.value=h.username||"",S.value=h.password||"",T.value=h.token||"",V.value=h.apiStatus||!1,$.value=h.blogName||"",E.value=h.blogid||"",I.value=h.tokenSettingUrl||"")};return Oe(async()=>{O()}),(h,c)=>{const m=Ye,n=Je,w=je,g=qe,b=We;return r(),f(b,{"label-width":"120px"},{default:l(()=>[t(m,{class:"top-version-tip",title:Y.value+$.value,type:"info",closable:!1},null,8,["title"]),t(w,{label:h.$t("setting.common.home")},{default:l(()=>[t(n,{modelValue:u.value,"onUpdate:modelValue":c[0]||(c[0]=P=>u.value=P)},null,8,["modelValue"])]),_:1},8,["label"]),e.usernameEnabled?(r(),f(w,{key:0,label:h.$t("setting.common.username")},{default:l(()=>[t(n,{modelValue:i.value,"onUpdate:modelValue":c[1]||(c[1]=P=>i.value=P)},null,8,["modelValue"])]),_:1},8,["label"])):C("",!0),e.passwordEnabled?(r(),f(w,{key:1,label:h.$t("setting.common.password")},{default:l(()=>[t(n,{type:"password",modelValue:S.value,"onUpdate:modelValue":c[2]||(c[2]=P=>S.value=P),"show-password":""},null,8,["modelValue"]),ve("a",{href:I.value,target:"_blank"},K(h.$t("setting.common.username.gen"))+"\uFF1A"+K(I.value),9,Ul)]),_:1},8,["label"])):C("",!0),e.tokenEnabled?(r(),f(w,{key:2,label:h.$t("setting.common.token")},{default:l(()=>[t(n,{type:"password",modelValue:T.value,"onUpdate:modelValue":c[3]||(c[3]=P=>T.value=P),"show-password":""},null,8,["modelValue"]),ve("a",{href:I.value,target:"_blank"},K(h.$t("setting.common.token.gen"))+"\uFF1A"+K(I.value),9,Yl)]),_:1},8,["label"])):C("",!0),t(w,{label:h.$t("setting.common.apiurl")},{default:l(()=>[t(n,{modelValue:p.value,"onUpdate:modelValue":c[4]||(c[4]=P=>p.value=P)},null,8,["modelValue"])]),_:1},8,["label"]),t(w,null,{default:l(()=>[t(g,{type:"primary",onClick:M,loading:y.value},{default:l(()=>[H(K(y.value?h.$t("setting.blog.vali.ing"):h.$t("setting.blog.vali")),1)]),_:1},8,["loading"]),V.value?C("",!0):(r(),f(m,{key:0,title:h.$t("setting.blog.vali.tip.metaweblog"),type:"warning",closable:!1},null,8,["title"])),V.value?(r(),f(m,{key:1,title:h.$t("setting.blog.vali.ok.metaweblog"),type:"success",closable:!1},null,8,["title"])):C("",!0)]),_:1}),t(w,null,{default:l(()=>[t(g,{type:"primary",onClick:v},{default:l(()=>[H(K(h.$t("setting.blog.save")),1)]),_:1}),t(g,null,{default:l(()=>[H(K(h.$t("setting.blog.cancel")),1)]),_:1})]),_:1})]),_:1})}}}),Ol=oe({__name:"LiandiSetting",setup(d){const e=_(ye.API_TYPE_LIANDI),a=new Fl,o=_(a);return(u,p)=>(r(),f(jt,{"api-type":e.value,"username-enabled":!0,"token-enabled":!0,cfg:o.value},null,8,["api-type","cfg"]))}});class Ll extends mt{constructor(){super(),this.home="https://www.yuque.com/",this.apiUrl="https://www.yuque.com/api/v2",this.tokenSettingUrl="https://www.yuque.com/settings/tokens",this.posidKey=ue.YUQUE_POSTID_KEY,this.previewUrl="/[notebook]/[postid]",this.pageType=De.Markdown}}const Rl=oe({__name:"YuqueSetting",setup(d){const e=_(ye.API_TYPE_YUQUE),a=new Ll,o=_(a);return(u,p)=>(r(),f(jt,{"api-type":e.value,"username-enabled":!0,"token-enabled":!0,cfg:o.value},null,8,["api-type","cfg"]))}});class Kl extends mt{constructor(){super(),this.home="http://localhost:9564/kms16_release/kms/multidoc",this.apiUrl="http://localhost:9564/kms16_release/api/kms-multidoc/kmsMultidocKnowledgeRestService",this.tokenSettingUrl="http://localhost:9564/kms16_release/sys/profile/index.jsp#integrate/RestService/",this.posidKey=ue.KMS_POSTID_KEY,this.previewUrl="/kms_multidoc_knowledge/kmsMultidocKnowledge.do?method=view&fdId=[postid]",this.pageType=De.Html}}const Nl=oe({__name:"KmsSetting",setup(d){const e=_(ye.API_TYPE_KMS),a=new Kl,o=_(a);return(u,p)=>(r(),f(jt,{"api-type":e.value,"username-enabled":!0,"password-enabled":!0,cfg:o.value},null,8,["api-type","cfg"]))}}),Hl={key:1},Gl=oe({__name:"PlatformSetting",props:{isReload:{type:Boolean,default:!1}},setup(d){const e=d,a=me.getLogger("components/publish/tab/PlatformSetting.vue"),{tabCountStore:o,vuepressEnabled:u,hugoEnabled:p,hexoEnabled:i,jekyllEnabled:S,jvueEnabled:T,confEnabled:y,cnblogsEnabled:V,wordpressEnabled:$,liandiEnabled:E,yuqueEnabled:I,kmsEnabled:Y,doCount:M}=Et(),v=ce({dynamicConfigArray:[],githubArray:[],metaweblogArray:[],wordpressArray:[]}),O=_(w=>new fl(w)),h=_(w=>new yl(st(w.platformKey))),c=_(w=>new bl(st(w.platformKey))),m=w=>{const g=[];return w.forEach(b=>{const P=new ot(b.platformType,b.platformKey,b.platformName);P.subPlatformType=b.subPlatformType;const z=It(b.platformKey),B=Ee(z);P.modelValue=B,B&&g.push(P)}),g},n=()=>{M();const w=it();v.dynamicConfigArray=m(w.totalCfg||[]),v.githubArray=m(w.githubCfg||[]),v.metaweblogArray=m(w.metaweblogCfg||[]),v.wordpressArray=m(w.wordpressCfg||[]),a.debug("dynamicJsonCfg=>",JSON.stringify(w))};return Ne(()=>e.isReload,(w,g)=>{n(),a.debug("platform-setting\u521D\u59CB\u5316")}),Oe(()=>{n()}),(w,g)=>{const b=Pt,P=Mt,z=Ye;return s(o).tabCount>0?(r(),f(P,{key:0,type:"border-card"},{default:l(()=>[s(u)?(r(),f(b,{key:0,label:w.$t("setting.vuepress")+w.$t("setting.blog.setting")},{default:l(()=>[t(Cl)]),_:1},8,["label"])):C("",!0),s(p)?(r(),f(b,{key:1,label:w.$t("setting.hugo")+w.$t("setting.blog.setting")},{default:l(()=>[t(El)]),_:1},8,["label"])):C("",!0),s(i)?(r(),f(b,{key:2,label:w.$t("setting.hexo")+w.$t("setting.blog.setting")},{default:l(()=>[t(Sl)]),_:1},8,["label"])):C("",!0),s(S)?(r(),f(b,{key:3,label:w.$t("setting.jekyll")+w.$t("setting.blog.setting")},{default:l(()=>[t(kl)]),_:1},8,["label"])):C("",!0),s(T)?(r(),f(b,{key:4,label:w.$t("setting.jvue")+w.$t("setting.blog.setting")},{default:l(()=>[t(Ml)]),_:1},8,["label"])):C("",!0),s(y)?(r(),f(b,{key:5,label:w.$t("setting.conf")+w.$t("setting.blog.setting")},{default:l(()=>[t($l)]),_:1},8,["label"])):C("",!0),s(V)?(r(),f(b,{key:6,label:w.$t("setting.cnblogs")+w.$t("setting.blog.setting")},{default:l(()=>[t(Il)]),_:1},8,["label"])):C("",!0),s($)?(r(),f(b,{key:7,label:w.$t("setting.wordpress")+w.$t("setting.blog.setting")},{default:l(()=>[t(Zt)]),_:1},8,["label"])):C("",!0),s(E)?(r(),f(b,{key:8,label:w.$t("setting.liandi")+w.$t("setting.blog.setting")},{default:l(()=>[t(Ol)]),_:1},8,["label"])):C("",!0),s(I)?(r(),f(b,{key:9,label:w.$t("setting.yuque")+w.$t("setting.blog.setting")},{default:l(()=>[t(Rl)]),_:1},8,["label"])):C("",!0),s(Y)?(r(),f(b,{key:10,label:w.$t("setting.kms")+w.$t("setting.blog.setting")},{default:l(()=>[t(Nl)]),_:1},8,["label"])):C("",!0),(r(!0),te($e,null,Ve(v.githubArray,B=>(r(),f(b,{key:B.platformKey,label:B.platformName+w.$t("setting.blog.setting")},{default:l(()=>[t(ct,{"api-type":B.platformKey,cfg:O.value(B)},null,8,["api-type","cfg"])]),_:2},1032,["label"]))),128)),(r(!0),te($e,null,Ve(v.metaweblogArray,B=>(r(),f(b,{key:B.platformKey,label:B.platformName+w.$t("setting.blog.setting")},{default:l(()=>[t(gt,{"api-type":B.platformKey,cfg:h.value(B)},null,8,["api-type","cfg"])]),_:2},1032,["label"]))),128)),(r(!0),te($e,null,Ve(v.wordpressArray,B=>(r(),f(b,{key:B.platformKey,label:B.platformName+w.$t("setting.blog.setting")},{default:l(()=>[t(Zt,{"api-type":B.platformKey,cfg:c.value(B)},null,8,["api-type","cfg"])]),_:2},1032,["label"]))),128))]),_:1})):(r(),te("div",Hl,[t(z,{class:"top-version-tip",title:w.$t("config.platform.none"),type:"error",closable:!1},null,8,["title"])]))}}}),jl="custom-slug",Wl="custom-desc",Me={SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY:jl,SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY:Wl},St={VITE_LOG_INFO_ENABLED:"false",VITE_SIYUAN_API_URL:"http://127.0.0.1:6806",VITE_SIYUAN_CONFIG_TOKEN:"",VITE_MIDDLEWARE_URL:"https://publish.terwer.space/api/middleware"}.TEST==="true",ql="test-data-siyuanPage",Jl={CONSTANTS_SIYUAN_PAGE:ql},zl=(d,e)=>{const a=me.getLogger("composables/publish/makeSlugCom.ts"),{t:o}=Se(),u=new Ke,p=Ue(),i=ce({isSlugLoading:!1,forceRefresh:!1,title:"",customSlug:"",slugHashEnabled:!0}),S=e.siyuanPageMethods,T=()=>Re(i.customSlug)?!0:i.forceRefresh;return{slugData:i,slugMethods:{makeSlug:async V=>{if(!T()){V!==!0&&U.warning(o("main.force.refresh.tip")),a.debug(o("main.force.refresh.tip"));return}i.isSlugLoading=!0,a.debug("\u5F00\u59CB\u751F\u6210\u522B\u540D...");try{const $=await S.getPageId();if(St){const M=oa(Jl.CONSTANTS_SIYUAN_PAGE),v=JSON.parse(JSON.parse(M));vi.spyOn(u,"getBlockByID").mockResolvedValue(v)}const E=await u.getBlockByID($);a.debug("\u83B7\u53D6\u5230\u601D\u6E90\u9875\u9762\u6570\u636E=>",E);const I=i.title;if(p.useGoogleTranslate)try{let M;St?M=await vi.fn().mockImplementation(O=>at(O))(I):M=await Ft(I),a.debug("\u4F7F\u7528\u8C37\u6B4C\u7FFB\u8BD1"),M?i.customSlug=M:(i.customSlug=at(I),U.success(o("main.opt.failure")))}catch{i.customSlug=at(I)}else i.customSlug=at(I);if(a.debug("\u5B8C\u6210\u522B\u540D\u7FFB\u8BD1"),i.slugHashEnabled){const M=E.content+new Date().toISOString(),v=Te("-",Gt(M).toLowerCase());i.customSlug+=v,a.debug("\u4E3A\u522B\u540D\u6DFB\u52A0hash")}const Y={[Me.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY]:i.customSlug};St&&vi.spyOn(u,"setBlockAttrs").mockResolvedValue(void 0),await u.setBlockAttrs($,Y),V!==!0&&U.success(o("main.opt.success")),a.info("\u751F\u6210\u522B\u540D\u6B63\u5E38\u5B8C\u6210,slugData=>",i)}catch($){const E=Te(o("main.opt.failure"),"=>",$);V!==!0&&U.error(E),a.error(E)}i.isSlugLoading=!1,a.debug("\u751F\u6210\u522B\u540D\u7ED3\u675F.")},getSlugData:()=>i,initSlug:V=>{let $=V.page.content;p.fixTitle&&($=sa($)),a.debug("\u6807\u9898\u5904\u7406\u5B8C\u6BD5"),i.title=$;const E=Me.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY;i.customSlug=V.meta[E],a.debug("initSlug=>",i)},syncSlug:V=>{i.title=V.formData.title,i.customSlug=V.formData.customSlug}}}};class bt{convertToYaml(e,a){throw new Error("YamlConvertAdaptor.convertToYaml: \u8BE5\u529F\u80FD\u672A\u5B9E\u73B0\uFF0C\u8BF7\u5728\u5B50\u7C7B\u91CD\u5199\u8BE5\u65B9\u6CD5")}convertToAttr(e,a){throw new Error("YamlConvertAdaptor.convertToAttr: \u8BE5\u529F\u80FD\u672A\u5B9E\u73B0\uFF0C\u8BF7\u5728\u5B50\u7C7B\u91CD\u5199\u8BE5\u65B9\u6CD5")}}const Xl=()=>{const d=me.getLogger("composables/publish/makeYamlCom.ts"),{t:e}=Se(),a=ce({yamlObj:{},readMode:!0,yamlPreviewContent:"",yamlContent:"",isSaved:!0,formatter:"",mdContent:"",mdFullContent:"",htmlContent:""});return{yamlData:a,yamlMethods:{onYamlContentFocus:u=>{u.preventDefault(),u.target.select(),$a()&&navigator.clipboard.writeText(a.yamlContent).then(function(){U.success(e("main.opt.success"))},function(i){U.error(e("main.opt.failure")+i)})},onYamlContentInput:()=>{a.isSaved=!1},onYamlContextMenu:u=>{u.preventDefault()},doConvertAttrToYAML:(u,p,i)=>{u||(u=new bt,d.error("\u672A\u6307\u5B9AYAML\u8F6C\u6362\u5668"));const S=u.convertToYaml(p,i);a.yamlObj=S.yamlObj,a.formatter=S.formatter,a.mdContent=S.mdContent,a.mdFullContent=S.formatter+`
`+S.mdContent,a.htmlContent=S.htmlContent},doConvertYAMLToAttr:(u,p,i)=>{u||(u=new bt,d.error("\u672A\u6307\u5B9AYAML\u8F6C\u6362\u5668"));const S=u.convertToAttr(p,i);return d.debug("doConvertYAMLToAttr\u8F6C\u6362\u4E2D\u8F6C\u6570\u636EpostForm=>",S),S},copyYamlToClipboard:()=>{Na(a.yamlContent),U.success(e("main.opt.success"))},getYamlData:()=>a,initYaml:u=>{a.yamlContent=u,a.yamlPreviewContent=Te(u)}}}},Ql=(d,e)=>{const a=me.getLogger("composables/publish/publishActionCom.ts"),{t:o}=Se(),u=new Ke,p=ce({isPublishLoading:!1,isCancelLoading:!1}),i=e.siyuanPageMethods,S=e.yamlMethods,T=e.githubPagesMethods,y=e.quickMethods,V=e.initPublishMethods,$={doPublish:async()=>{a.debug("\u51C6\u5907\u53D1\u5E03\u6587\u7AE0..."),p.isPublishLoading=!0;try{const E=_e(d.apiType),I=new Dt(E);try{await $.doCancel(!1)}catch(O){a.error("\u5F3A\u5236\u5220\u9664\u5F02\u5E38\uFF0C\u4E0D\u5F71\u54CD\u53D1\u5E03=>",O)}const Y=T.getGithubPagesData().mdTitle;let M=Ut(Y);if(M=M.replace(/\.md/g,""),/[\s*|\\.]/g.test(M)){a.debug("fmtTitle=>",M),U.error("\u6587\u4EF6\u540D\u4E0D\u80FD\u5305\u542B\u7A7A\u683C\u6216\u8005\u7279\u6B8A\u5B57\u7B26"),p.isPublishLoading=!1;return}await y.doOneclickAttr();const v=E.apiStatus;if(!v&&T.getGithubPagesData().githubEnabled){p.isPublishLoading=!1,U.error("\u68C0\u6D4B\u5230api\u4E0D\u53EF\u7528\u6216\u8005\u914D\u7F6E\u9519\u8BEF\uFF0C\u65E0\u6CD5\u53D1\u5E03\u5230Github\uFF0C\u8BF7\u8F6C\u5230\u6E90\u7801\u6A21\u5F0F\u81EA\u884C\u590D\u5236\u6587\u672C");return}else if(v&&T.getGithubPagesData().githubEnabled){a.debug("\u5F00\u59CB\u771F\u6B63\u8C03\u7528api\u53D1\u5E03\u5230Github");let O=T.getGithubPagesData().publishPath;V.convertAttrToYAML(!0);const h=S.getYamlData().mdFullContent;if(a.debug("\u5373\u5C06\u53D1\u5E03\u7684\u5185\u5BB9\uFF0CmdContent=>",{mdFullContent:h}),!await I.publishGithubPage(O,h)){p.isPublishLoading=!1,await V.initPage(),U.error(o("main.publish.vuepress.failure"));return}const m={[E.posidKey]:O},n=await i.getPageId();await u.setBlockAttrs(n,m),a.debug("VuepressMain\u53D1\u5E03\u6210\u529F\uFF0C\u4FDD\u5B58\u8DEF\u5F84,meta=>",m),await V.initPage(),p.isPublishLoading=!1}a.debug("\u6587\u7AE0\u53D1\u5E03\u5B8C\u6210."),U.success(o("main.opt.status.publish"))}catch(E){const I=Te(o("main.opt.failure"),"=>",E);U.error(I),a.error(I)}p.isPublishLoading=!1},cancelPublish:async()=>{a.debug("\u51C6\u5907\u53D6\u6D88\u6587\u7AE0\u53D1\u5E03..."),p.isCancelLoading=!0,xe.confirm(o("main.opt.warning.tip"),o("main.opt.warning"),{confirmButtonText:o("main.opt.ok"),cancelButtonText:o("main.opt.cancel"),type:"warning"}).then(async()=>{await $.doCancel(!0),p.isCancelLoading=!1,U.warning(o("main.opt.status.cancel"))}).catch(E=>{E.toString().indexOf("cancel")<=-1&&(U({type:"error",message:o("main.opt.failure")+"=>"+E}),a.error(o("main.opt.failure")+"=>"+E)),p.isCancelLoading=!1})},doCancel:async E=>{const I=_e(d.apiType),Y=new Dt(I),M=T.getGithubPagesData().publishPath;a.debug("\u51C6\u5907\u53D6\u6D88\u53D1\u5E03\uFF0CdocPath=>",M),await Y.deleteGithubPage(M);const v={[I.posidKey]:""},O=await i.getPageId();await u.setBlockAttrs(O,v),a.debug(d.apiType+"_Main\u53D6\u6D88\u53D1\u5E03,meta=>",v),E&&await V.initPage()}};return{publishData:p,publishMethods:$}},Zl=(d,e)=>{const a=me.getLogger("composables/publish/publishQuickCom.ts"),{t:o}=Se(),u=new Ke,p=ce({isGenLoading:!1}),i=e.siyuanPageMethods,S=e.slugMethods,T=e.descMethods,y=e.tagMethods,V={oneclickAttr:async $=>{xe.confirm(o("main.opt.onclick.confirm.tip"),o("main.opt.warning"),{confirmButtonText:o("main.opt.ok"),cancelButtonText:o("main.opt.cancel"),type:"warning"}).then(async()=>{p.isGenLoading=!0,await V.doOneclickAttr(),p.isGenLoading=!1,a.debug("\u4E00\u952E\u751F\u6210\u5C5E\u6027\u5B8C\u6210."),$!==!0&&U.success(o("main.publish.oneclick.attr.finish"))}).catch(E=>{p.isGenLoading=!1,E.toString().indexOf("cancel")<=-1&&(U({type:"error",message:o("main.opt.failure")+"=>"+E}),a.error(o("main.opt.failure")+"=>"+E))})},doOneclickAttr:async()=>{await S.makeSlug(!0),await T.makeDesc(!0),await y.fetchTag(!0),await V.saveAttrToSiyuan(!0),a.debug("\u53D1\u5E03\u5C5E\u6027\u5B8C\u6210")},saveAttrToSiyuan:async $=>{try{const E=S.getSlugData(),I=T.getDescData(),Y=y.getTagData(),M={[Me.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY]:E.customSlug,[Me.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY]:I.desc,tags:Y.join(",")},v=await i.getPageId();await u.setBlockAttrs(v,M),$!==!0&&U.success(o("main.opt.success"))}catch(E){const I=Te(o("main.opt.failure"),"=>",E);$!==!0&&U.error(Te(o("main.opt.failure"),"=>",E)),a.error(I)}}};return{quickData:p,quickMethods:V}},xl=(d,e)=>{const a=me.getLogger("composables/publish/makeDescCom.ts"),{t:o}=Se(),u=new Ke,p=ce({isDescLoading:!1,desc:""}),i=e.siyuanPageMethods;return{descData:p,descMethods:{makeDesc:async T=>{a.debug("\u51C6\u5907\u751F\u6210\u6458\u8981..."),p.isDescLoading=!0;try{const y=Ue(),V=await i.getPageId(),E=(await u.exportMdContent(V)).content;let I=vt(E);y.removeH1&&(I=Ct(I)),p.desc=Yt(I,Ot.MAX_PREVIEW_LENGTH,!0);const Y={[Me.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY]:p.desc};await u.setBlockAttrs(V,Y),T!==!0&&U.success(o("main.opt.success"))}catch(y){T!==!0&&U.error(Te(o("main.opt.failure"),"=>",y))}p.isDescLoading=!1,a.debug("\u6458\u8981\u751F\u6210\u5B8C\u6BD5.")},getDescData:()=>p,initDesc:T=>{const y=Me.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY;p.desc=T.meta[y]},syncDesc:T=>{p.desc=T.formData.desc}}}},eo=()=>{const d=ce({created:""});return{publishTimeData:d,publishTimeMethods:{getPublishTime:()=>d,initPublishTime:a=>{d.created=wt(a.page.created)},syncPublishTime:a=>{d.created=a.formData.created}}}};class to{constructor(){le(this,"pageId");le(this,"meta");le(this,"page");le(this,"content")}}const ca=d=>{const e=me.getLogger("composables/publish/siyuanPageCom.ts"),{t:a}=Se(),o=new Ke,u=ce({dataObj:new to});return{siyuanPageData:u,siyuanPageMethods:{getPageId:async()=>{const i=await rt(!0,d.pageId);if(!i||i==="")throw e.error(a("page.no.id")),new Error("page.no.id");return e.debug("\u5F53\u524D\u9875\u9762ID\u4E3A=>",i),i},getSiyuanPageData:()=>u,initSiyuanPage:async i=>{u.dataObj.pageId=i,u.dataObj.meta=await o.getBlockAttrs(i),u.dataObj.page=await o.getBlockByID(i),u.dataObj.content=await o.exportMdContent(i)}}}},ao=d=>{const e=me.getLogger("composables/publish/makeTagCom.ts"),{t:a}=Se(),o=new Ke,u=ce({isTagLoading:!1,tagSwitch:!1,tag:{inputValue:"",dynamicTags:[],inputVisible:!1}}),{siyuanPageMethods:p}=ca(d);return{tagData:u,tagMethods:{tagHandleClose:S=>{u.tag.dynamicTags.splice(u.tag.dynamicTags.indexOf(S),1)},tagShowInput:()=>{u.tag.inputVisible=!0},tagHandleInputConfirm:()=>{u.tag.inputValue&&u.tag.dynamicTags.push(u.tag.inputValue),u.tag.inputVisible=!1,u.tag.inputValue=""},fetchTag:async S=>{try{if(!u.tagSwitch){U.warning(a("main.tag.auto.switch.no.tip"));return}u.isTagLoading=!0;const T=await p.getPageId(),V=(await o.exportMdContent(T)).content,$=await Lt(V);e.debug("genTags=>",$);const E=Rt($,5);e.debug("hotTags=>",E);for(let Y=0;Y<E.length;Y++)u.tag.dynamicTags.includes(E[Y])||u.tag.dynamicTags.push(E[Y]);const I={tags:u.tag.dynamicTags.join(",")};await o.setBlockAttrs(T,I),S!==!0&&U.success(a("main.opt.success"))}catch(T){const y=Te(a("main.opt.failure"),"=>",T);S!==!0&&U.error(y),e.error(y)}u.isTagLoading=!1,S!==!0&&U.success(a("main.opt.success"))},getTagData:()=>u.tag.dynamicTags,initTag:S=>{Ue().autoTag&&(u.tagSwitch=!0),u.tag.dynamicTags=[];const V=(S.meta.tags||"").split(",");for(let $=0;$<V.length;$++)V[$]!==""&&u.tag.dynamicTags.push(V[$])},syncTag:S=>{for(let T=0;T<S.formData.tag.dynamicTags.length;T++){const y=S.formData.tag.dynamicTags[T];!u.tag.dynamicTags.includes(y)&&y!==""&&u.tag.dynamicTags.push(y)}}}}},lo=(d,e)=>{const a=me.getLogger("composables/publish/githubPagesCom.ts"),o=ce({githubEnabled:!1,useDefaultPath:!1,currentDefaultPath:"",customPath:"",mdTitle:"",path:{customProps:{label:"label",children:"children",isLeaf:"isLeaf"}},publishPath:""}),u=e.siyuanPageMethods,p={githubOnChange:i=>{o.githubEnabled=i},defaultPathOnChange:i=>{o.useDefaultPath=i},customLoad:async(i,S)=>{if(i.isLeaf)return S([]);a.debug("\u76EE\u524D\u5DF2\u4FDD\u5B58\u8DEF\u5F84=>",o.customPath),a.debug("\u5F53\u524D\u8282\u70B9=>",i.data);const T=_e(d.apiType),y=new Dt(T);let V,$=i.data.value||"";$===""&&o.customPath!==""?V="/":($===""&&($="/"),V=$);const E=await y.getGithubPageTreeNode(V);S(E)},onSelectChange:i=>{if(a.debug("onSelectChange=>",i),i.isLeaf){U.error("\u60A8\u5F53\u524D\u9009\u62E9\u7684\u662F\u9875\u9762\uFF0C\u8BF7\u6CE8\u610F\uFF0C\u9875\u9762\u5FC5\u987B\u53D1\u5E03\u5728\u76EE\u5F55\u4E0B");return}p.initGithubPages({cpath:i.value,defpath:o.currentDefaultPath,fname:o.mdTitle})},getGithubPagesData:()=>o,getDocPath:()=>{const i=Aa(d.apiType).posidKey;return u.getSiyuanPageData().dataObj.meta[i]||""},initGithubPages:i=>{let S,T,y;i&&(S=i.cpath,T=i.defpath,y=i.fname),a.debug("paths=>",i),o.customPath=S,o.currentDefaultPath=T,o.mdTitle=y.indexOf(".md")>-1?y:y+".md",o.customPath.indexOf(".md")>-1?o.publishPath=o.customPath:o.publishPath=Xe(o.customPath,"/"+o.mdTitle)}};return{githubPagesData:o,githubPagesMethods:p}};class ga{constructor(){le(this,"formData",{title:"",customSlug:"",desc:"",created:"",tag:{inputValue:"",dynamicTags:[],inputVisible:!1},customPath:"",categories:["\u9ED8\u8BA4\u5206\u7C7B"],mdContent:"",htmlContent:""})}}const oo=d=>(d=d.replace(`---
`,""),d=d.replace("---",""),da.load(d,{})),so=d=>{let e=da.dump(d,{});return e=Te(`---
`,e,"---"),e};class ma{constructor(){le(this,"yamlObj",{});le(this,"formatter","");le(this,"mdContent","");le(this,"mdFullContent");le(this,"htmlContent")}}const no=(d,e,a)=>{const o=me.getLogger("composables/publish/initPublishCom.ts"),{t:u}=Se(),p=ce({isInitLoading:!1,apiStatus:!1,apiTypeInfo:_(Te(u("setting.blog.platform.support.github"),d.apiType)),isPublished:!1,previewMdUrl:"",previewUrl:""}),i=e.pageModeMethods,S=e.siyuanPageMethods,T=e.slugMethods,y=e.descMethods,V=e.publishTimeMethods,$=e.tagMethods,E=e.githubPagesMethods,I=e.yamlMethods,Y={onEditModeChange:M=>{const v=i.getPageModeData();M===pe.EditMode_source?(Y.convertAttrToYAML(!0),v.etype=M):I.getYamlData().isSaved?v.etype=M:xe.confirm(u("main.yaml.no.save"),u("main.opt.warning"),{confirmButtonText:u("main.opt.ok"),cancelButtonText:u("main.opt.cancel"),type:"warning"}).then(async()=>{Y.convertYAMLToAttr(!0),v.etype=M}).catch(()=>{v.etype=M})},onYamlShowTypeChange:M=>{const v=i.getPageModeData();switch(v.stype=M,M){case Pe.YAML:I.initYaml(I.getYamlData().formatter);break;case Pe.CONTENT:I.initYaml(I.getYamlData().mdContent);break;case Pe.YAML_CONTENT:I.initYaml(I.getYamlData().formatter+I.getYamlData().mdContent);break;case Pe.HTML_CONTENT:I.initYaml(I.getYamlData().htmlContent);break}},convertDocPathToCategories:M=>{const v=Ue();o.debug("docPath=>",M);const O=M.split("/");let h=[];if(O.length>1)for(let c=1;c<O.length-1;c++){let m;v.fixTitle?m=sa(O[c]):m=O[c],h.push(m)}return h},composableDataToForm:()=>{const M=Ue(),v=new ga;v.formData.title=T.getSlugData().title,v.formData.customSlug=T.getSlugData().customSlug,v.formData.desc=y.getDescData().desc,v.formData.created=V.getPublishTime().created,v.formData.tag.dynamicTags=$.getTagData();const O=E.getGithubPagesData().customPath;v.formData.categories=Y.convertDocPathToCategories(O);let h=S.getSiyuanPageData().dataObj.content.content,c=vt(h);return M.removeH1&&(h=Kt(h),c=Ct(c)),v.formData.mdContent=h,v.formData.htmlContent=c,v},convertAttrToYAML:M=>{const v=Ue(),O=_e(d.apiType),h=Y.composableDataToForm();I.doConvertAttrToYAML(d.yamlConverter,h,O),Y.onYamlShowTypeChange(v.contentShowType),M!==!0&&U.success(u("main.opt.success"))},formToComposableData:M=>{T.syncSlug(M),y.syncDesc(M),V.syncPublishTime(M),$.syncTag(M)},convertYAMLToAttr:M=>{if(i.getPageModeData().stype!==Pe.YAML){const v="\u53EA\u80FD\u8F6C\u6362YAML\uFF0C\u8BF7\u5207\u6362\u663E\u793A\u6A21\u5F0F";throw U.error(v),new Error(v)}try{const v=_e(d.apiType),O=I.getYamlData().yamlContent,h=oo(O),c=new ma;c.yamlObj=h,o.debug("\u51C6\u5907\u5C06YAML\u8F6C\u6362\u4E3A\u6587\u7AE0\u5C5E\u6027\uFF0CyamlFormatObj=>",c);const m=I.doConvertYAMLToAttr(d.yamlConverter,c,v);Y.formToComposableData(m),I.getYamlData().isSaved=!0,M!==!0&&U.success(u("main.opt.success"))}catch(v){M!==!0&&U.error(Te(u("main.opt.failure"),"=>",v))}},getInitPublishData:()=>p,initPage:async()=>{var M,v,O,h,c,m;p.isInitLoading=!0;try{const n=Ue(),w=i.getPageModeData();w.etype=n.editMode,w.stype=n.contentShowType;const g=_e(d.apiType);p.apiStatus=g.apiStatus;const b=await rt(!0,d.pageId);if(!b||b===""){p.isInitLoading=!1,o.error(u("page.no.id")),U.error(u("page.no.id"));return}await S.initSiyuanPage(b);const P=S.getSiyuanPageData().dataObj;p.isPublished=Nt(d.apiType,S.getSiyuanPageData().dataObj.meta),T.initSlug(P),y.initDesc(P),V.initPublishTime(P),$.initTag(P);const z=E.getGithubPagesData();z.githubEnabled=p.apiStatus;let B;p.isPublished?(z.useDefaultPath=!1,B=E.getDocPath()):B=(M=g.defaultPath)!=null?M:"";const D=(v=g.defaultPath)!=null?v:"\u5C1A\u672A\u914D\u7F6E",A=T.getSlugData(),F=g.mdFilenameRule;let N;if(Re(F))N=(h=(O=P.page.content)!=null?O:A.customSlug)!=null?h:"no-slug";else{N=F,F.indexOf("filename")>-1&&(N=N.replace(/\[filename]/g,P.page.content)),F.indexOf("slug")>-1&&(N=N.replace(/\[slug]/g,A.customSlug));let ae=new Date;if(F.indexOf("yyyy")>-1){const Z=ae.getFullYear();N=N.replace(/\[yyyy]/g,Z.toString())}if(F.indexOf("MM")>-1||F.indexOf("mm")>-1){let Z,G=ae.getMonth()+1;Z=G.toString(),G<10&&(Z=Te("0",Z)),N=N.replace(/\[MM]/g,Z),N=N.replace(/\[mm]/g,Z)}if(F.indexOf("dd")>-1){let Z,G=ae.getDate();Z=G.toString(),G<10&&(Z=Te("0",Z)),N=N.replace(/\[dd]/g,Z)}}if(E.initGithubPages({cpath:B,defpath:D,fname:N}),Y.convertAttrToYAML(!0),p.isPublished){z.useDefaultPath=!1,B=E.getDocPath();const ae=(c=g.baseUrl)!=null?c:"https://terwer.space/",Z=(m=g.home)!=null?m:"https://terwer.space/";let G;G=Xe(g.githubUser,"/"+g.githubRepo),G=Xe(G,"/blob/"),G=Xe(G,"/"+g.defaultBranch),G=Xe(G,"/"+B),Re(g.previewMdUrl)||(G=g.previewMdUrl.replace(/\[user]/,g.githubUser),G=g.previewMdUrl.replace(/\[repo]/,g.githubRepo),G=g.previewMdUrl.replace(/\[branch]/,g.defaultBranch),G=g.previewMdUrl.replace(/\[docpath]/,B)),G=Xe(ae,G),p.previewMdUrl=G;let ee=I.getYamlData().yamlObj.permalink;if(!Re(g.previewUrl)){ee=g.previewUrl.replace(/\[postid]/g,T.getSlugData().customSlug);const Be=V.getPublishTime().created.split(" ")[0].split("-");o.debug("created numarr=>",Be);const W=Be[0],ze=Be[1],R=Be[2];ee=ee.replace(/\[yyyy]/g,W),ee=ee.replace(/\[MM]/g,ze),ee=ee.replace(/\[mm]/g,ze),ee=ee.replace(/\[dd]/g,R);const J=E.getGithubPagesData().publishPath,ne=Y.convertDocPathToCategories(J);ee=ee.replace(/\[cats]/,ne.join("/"))}p.previewUrl=Xe(Z,ee)}}catch(n){const w=Te(u("main.opt.failure"),"=>",n);o.error(w)}p.isInitLoading=!1}};return{initPublishData:p,initPublishMethods:Y}},uo=()=>{const d=ce({etype:pe.EditMode_simple,stype:Pe.YAML_CONTENT});return{pageModeData:d,pageModeMethods:{getPageModeData:()=>d}}},io={class:"github-tips"},ro={class:"github-form"},po={key:0,class:"form-post-title"},co={class:"form-edit-mode"},go={key:1,class:"normal-mode"},mo={key:0,class:"form-slug"},fo={class:"form-desc"},yo={class:"form-publish-time"},bo={class:"form-tags"},ho={class:"form-github-pages"},_o={key:0,class:"form-github-pages-items"},vo={key:2,class:"convert-option"},Co={key:3,class:"publish-action"},wo={key:4,class:"publish-status"},Eo=["href","title"],To=["href","title"],So={key:5,class:"source-mode"},Do={class:"source-opt"},ko={key:1,id:"yaml-detail-content"},Po={key:2,id:"yaml-edit-content"},Mo={key:3,id:"yaml-action"},Vo={id:"yaml-read-mode-tip"},$o=oe({__name:"GithubMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},apiType:{type:String,default:""},pageId:{type:String,default:void 0},yamlConverter:{type:bt}},setup(d){const e=d,a=me.getLogger("components/publish/tab/main/GithubMain.vue"),{pageModeData:o,pageModeMethods:u}=uo(),{siyuanPageMethods:p}=ca(e),{slugData:i,slugMethods:S}=zl(e,{siyuanPageMethods:p}),{descData:T,descMethods:y}=xl(e,{siyuanPageMethods:p}),{publishTimeData:V,publishTimeMethods:$}=eo(),{tagData:E,tagMethods:I}=ao(e),{githubPagesData:Y,githubPagesMethods:M}=lo(e,{siyuanPageMethods:p}),{yamlData:v,yamlMethods:O}=Xl(),{quickData:h,quickMethods:c}=Zl(e,{siyuanPageMethods:p,slugMethods:S,descMethods:y,tagMethods:I}),{initPublishData:m,initPublishMethods:n}=no(e,{pageModeMethods:u,siyuanPageMethods:p,slugMethods:S,descMethods:y,publishTimeMethods:$,tagMethods:I,githubPagesMethods:M,yamlMethods:O}),{publishData:w,publishMethods:g}=Ql(e,{siyuanPageMethods:p,yamlMethods:O,githubPagesMethods:M,quickMethods:c,initPublishMethods:n});return Ne(()=>e.isReload,async()=>{await n.initPage(),a.debug(e.apiType+"_Main\u68C0\u6D4B\u5230\u8BBE\u7F6E\u66F4\u65B0\u64CD\u4F5C\uFF0C\u5237\u65B0\u9875\u9762")}),Ne(()=>e.isMainReload,async()=>{await n.initPage(),a.debug(e.apiType+"_Main\u5DE6\u53F3\u5207\u6362tab\uFF0C\u5237\u65B0\u9875\u9762")}),Oe(async()=>{await n.initPage()}),(b,P)=>{const z=Ye,B=Je,D=je,A=qe,F=nt,N=ut,ae=Vt,Z=$t,G=ta,ee=We,x=ht,Le=_t,Be=At;return r(),te("div",null,[s(m).isInitLoading?C("",!0):(r(),f(Le,{key:0},{default:l(()=>[t(x,{class:"github-main"},{default:l(()=>[ve("div",io,[s(o).etype!==s(pe).EditMode_source?(r(),f(z,{key:0,closable:!1,title:s(m).apiTypeInfo,class:"top-version-tip",type:"info"},null,8,["title"])):C("",!0),!s(m).apiStatus&&s(o).etype!==s(pe).EditMode_source?(r(),f(z,{key:1,closable:!1,title:b.$t("main.publish.github.error.tip"),class:"top-version-tip",type:"error"},null,8,["title"])):C("",!0)]),ve("div",ro,[t(ee,{"label-width":"100px"},{default:l(()=>[s(o).etype!==s(pe).EditMode_source?(r(),te("div",po,[t(D,{label:b.$t("main.title")},{default:l(()=>[t(B,{modelValue:s(i).title,"onUpdate:modelValue":P[0]||(P[0]=W=>s(i).title=W),disabled:!0},null,8,["modelValue"])]),_:1},8,["label"])])):C("",!0),ve("div",co,[t(D,{label:b.$t("main.publish.editmode")},{default:l(()=>[t(F,null,{default:l(()=>[t(A,{type:s(o).etype===s(pe).EditMode_simple?"primary":"default",onClick:P[1]||(P[1]=W=>s(n).onEditModeChange(s(pe).EditMode_simple))},{default:l(()=>[H(K(b.$t("main.publish.editmode.simple")),1)]),_:1},8,["type"]),t(A,{type:s(o).etype===s(pe).EditMode_complex?"primary":"default",onClick:P[2]||(P[2]=W=>s(n).onEditModeChange(s(pe).EditMode_complex))},{default:l(()=>[H(K(b.$t("main.publish.editmode.complex")),1)]),_:1},8,["type"]),t(A,{type:s(o).etype===s(pe).EditMode_source?"primary":"default",onClick:P[3]||(P[3]=W=>s(n).onEditModeChange(s(pe).EditMode_source))},{default:l(()=>[H(K(b.$t("main.publish.editmode.source")),1)]),_:1},8,["type"])]),_:1})]),_:1},8,["label"])]),s(o).etype!==s(pe).EditMode_source?(r(),te("div",go,[s(o).etype!==s(pe).EditMode_simple?(r(),te("div",mo,[t(D,{label:b.$t("main.force.refresh")},{default:l(()=>[t(N,{modelValue:s(i).forceRefresh,"onUpdate:modelValue":P[4]||(P[4]=W=>s(i).forceRefresh=W)},null,8,["modelValue"])]),_:1},8,["label"]),t(D,{label:b.$t("main.use.hash")},{default:l(()=>[t(N,{modelValue:s(i).slugHashEnabled,"onUpdate:modelValue":P[5]||(P[5]=W=>s(i).slugHashEnabled=W)},null,8,["modelValue"]),s(i).slugHashEnabled?C("",!0):(r(),f(z,{key:0,closable:!1,title:b.$t("main.use.hash.tip"),type:"warning"},null,8,["title"]))]),_:1},8,["label"]),t(D,{label:b.$t("main.slug")},{default:l(()=>[t(B,{modelValue:s(i).customSlug,"onUpdate:modelValue":P[6]||(P[6]=W=>s(i).customSlug=W)},null,8,["modelValue"])]),_:1},8,["label"]),t(D,null,{default:l(()=>[t(A,{loading:s(i).isSlugLoading,class:"make-slug-btn",type:"primary",onClick:s(S).makeSlug},{default:l(()=>[H(K(s(i).isSlugLoading?b.$t("main.opt.loading"):b.$t("main.auto.fetch.slug")),1)]),_:1},8,["loading","onClick"])]),_:1})])):C("",!0),ve("div",fo,[s(o).etype!==s(pe).EditMode_simple?(r(),f(D,{key:0,label:b.$t("main.desc")},{default:l(()=>[t(B,{modelValue:s(T).desc,"onUpdate:modelValue":P[7]||(P[7]=W=>s(T).desc=W),autosize:{minRows:3,maxRows:16},type:"textarea"},null,8,["modelValue"])]),_:1},8,["label"])):C("",!0),s(o).etype!==s(pe).EditMode_simple?(r(),f(D,{key:1},{default:l(()=>[t(A,{loading:s(T).isDescLoading,type:"primary",onClick:s(y).makeDesc},{default:l(()=>[H(K(s(T).isDescLoading?b.$t("main.opt.loading"):b.$t("main.auto.fetch.desc")),1)]),_:1},8,["loading","onClick"])]),_:1})):C("",!0)]),ve("div",yo,[s(o).etype!==s(pe).EditMode_simple?(r(),f(D,{key:0,label:b.$t("main.create.time")},{default:l(()=>[t(ae,{modelValue:s(V).created,"onUpdate:modelValue":P[8]||(P[8]=W=>s(V).created=W),placeholder:b.$t("main.create.time.placeholder"),format:"YYYY-MM-DD HH:mm:ss",type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):C("",!0)]),ve("div",bo,[t(D,{label:b.$t("main.tag.auto.switch")},{default:l(()=>[t(N,{modelValue:s(E).tagSwitch,"onUpdate:modelValue":P[9]||(P[9]=W=>s(E).tagSwitch=W)},null,8,["modelValue"])]),_:1},8,["label"]),t(D,{label:b.$t("main.tag")},{default:l(()=>[(r(!0),te($e,null,Ve(s(E).tag.dynamicTags,W=>(r(),f(Z,{key:W,"disable-transitions":!1,class:"mx-1",closable:"",onClose:ze=>s(I).tagHandleClose(W)},{default:l(()=>[H(K(W),1)]),_:2},1032,["onClose"]))),128)),s(E).tag.inputVisible?(r(),f(B,{key:0,ref:"tagRefInput",modelValue:s(E).tag.inputValue,"onUpdate:modelValue":P[10]||(P[10]=W=>s(E).tag.inputValue=W),class:"ml-1 w-20",size:"small",onBlur:s(I).tagHandleInputConfirm,onKeyup:Ht(s(I).tagHandleInputConfirm,["enter"])},null,8,["modelValue","onBlur","onKeyup"])):(r(),f(A,{key:1,class:"button-new-tag ml-1 el-tag",size:"small",onClick:s(I).tagShowInput},{default:l(()=>[H(K(b.$t("main.tag.new")),1)]),_:1},8,["onClick"]))]),_:1},8,["label"]),s(o).etype!==s(pe).EditMode_simple?(r(),f(D,{key:0},{default:l(()=>[t(A,{loading:s(E).isTagLoading,type:"primary",onClick:s(I).fetchTag},{default:l(()=>[H(K(s(E).isTagLoading?b.$t("main.opt.loading"):b.$t("main.auto.fetch.tag")),1)]),_:1},8,["loading","onClick"])]),_:1})):C("",!0)]),ve("div",ho,[t(D,{label:b.$t("main.publish.github")},{default:l(()=>[t(N,{modelValue:s(Y).githubEnabled,"onUpdate:modelValue":P[11]||(P[11]=W=>s(Y).githubEnabled=W),onChange:s(M).githubOnChange},null,8,["modelValue","onChange"]),s(Y).githubEnabled?C("",!0):(r(),f(z,{key:0,closable:!1,title:b.$t("main.publish.github.no.tip"),type:"warning"},null,8,["title"]))]),_:1},8,["label"]),s(Y).githubEnabled?(r(),te("div",_o,[s(m).isPublished?C("",!0):(r(),f(D,{key:0,label:b.$t("main.publish.github.choose.path.use.default")},{default:l(()=>[t(N,{modelValue:s(Y).useDefaultPath,"onUpdate:modelValue":P[12]||(P[12]=W=>s(Y).useDefaultPath=W),onChange:s(M).defaultPathOnChange},null,8,["modelValue","onChange"]),s(Y).useDefaultPath?(r(),f(z,{key:0,closable:!1,title:b.$t("main.publish.github.choose.path.use.default.tip")+s(Y).currentDefaultPath,type:"info"},null,8,["title"])):C("",!0)]),_:1},8,["label"])),!s(Y).useDefaultPath&&!s(m).isPublished?(r(),f(D,{key:1,label:b.$t("main.publish.github.choose.path")},{default:l(()=>[t(G,{modelValue:s(Y).customPath,"onUpdate:modelValue":P[13]||(P[13]=W=>s(Y).customPath=W),"check-strictly":!0,"empty-text":b.$t("main.cat.empty"),load:s(M).customLoad,"no-data-text":b.$t("main.cat.empty"),placeholder:b.$t("main.cat.select"),props:s(Y).path.customProps,lazy:"",style:{width:"100%"},onNodeClick:s(M).onSelectChange},null,8,["modelValue","empty-text","load","no-data-text","placeholder","props","onNodeClick"])]),_:1},8,["label"])):C("",!0),s(m).isPublished?C("",!0):(r(),f(D,{key:2,label:b.$t("main.publish.github.choose.title")},{default:l(()=>[t(B,{modelValue:s(Y).mdTitle,"onUpdate:modelValue":P[14]||(P[14]=W=>s(Y).mdTitle=W)},null,8,["modelValue"])]),_:1},8,["label"])),t(D,{label:b.$t("main.publish.github.published.path")},{default:l(()=>[t(B,{modelValue:s(Y).publishPath,"onUpdate:modelValue":P[15]||(P[15]=W=>s(Y).publishPath=W),disabled:s(m).isPublished},null,8,["modelValue","disabled"])]),_:1},8,["label"])])):C("",!0)])])):C("",!0),s(o).etype!==s(pe).EditMode_source?(r(),te("div",vo,[t(D,{label:b.$t("main.opt.quick")},{default:l(()=>[t(A,{loading:s(h).isGenLoading,type:"primary",onClick:s(c).oneclickAttr},{default:l(()=>[H(K(s(h).isGenLoading?b.$t("main.opt.loading"):b.$t("main.publish.oneclick.attr")),1)]),_:1},8,["loading","onClick"])]),_:1},8,["label"]),t(D,null,{default:l(()=>[s(o).etype!==s(pe).EditMode_simple?(r(),f(A,{key:0,type:"primary",onClick:s(c).saveAttrToSiyuan},{default:l(()=>[H(K(b.$t("main.save.attr.to.siyuan")),1)]),_:1},8,["onClick"])):C("",!0)]),_:1}),t(D,null,{default:l(()=>[s(o).etype!==s(pe).EditMode_simple?(r(),f(A,{key:0,type:"primary",onClick:P[16]||(P[16]=W=>s(n).onEditModeChange(s(pe).EditMode_source))},{default:l(()=>[H(K(b.$t("main.siyuan.to.yaml")),1)]),_:1})):C("",!0)]),_:1})])):C("",!0),s(o).etype!==s(pe).EditMode_source?(r(),te("div",Co,[t(D,null,{default:l(()=>[t(A,{loading:s(w).isPublishLoading,type:"primary",onClick:s(g).doPublish},{default:l(()=>[H(K(s(w).isPublishLoading?b.$t("main.publish.loading"):s(m).isPublished?b.$t("main.update"):b.$t("main.publish")),1)]),_:1},8,["loading","onClick"]),s(m).isPublished?(r(),f(A,{key:0,loading:s(w).isCancelLoading,onClick:s(g).cancelPublish},{default:l(()=>[H(K(b.$t("main.cancel")),1)]),_:1},8,["loading","onClick"])):C("",!0)]),_:1})])):C("",!0),s(o).etype!==s(pe).EditMode_source?(r(),te("div",wo,[t(D,null,{default:l(()=>[t(A,{disabled:"",text:"",type:"danger"},{default:l(()=>[H(K(s(m).isPublished?b.$t("main.publish.status.published"):b.$t("main.publish.status.unpublish")),1)]),_:1}),s(m).isPublished?(r(),te("a",{key:0,href:s(m).previewMdUrl,title:s(m).previewMdUrl,target:"_blank"},K(b.$t("main.publish.see.md.preview")),9,Eo)):C("",!0)]),_:1}),t(D,null,{default:l(()=>[s(m).isPublished?(r(),te("a",{key:0,href:s(m).previewUrl,title:s(m).previewUrl,target:"_blank"},K(b.$t("main.publish.see.real.preview")),9,To)):C("",!0)]),_:1})])):C("",!0),s(o).etype===s(pe).EditMode_source?(r(),te("div",So,[t(D,null,{default:l(()=>[t(z,{closable:!1,title:s(Ia)(e.apiType)+" "+b.$t("main.yaml.formatter"),class:"top-yaml-tip",type:"info"},null,8,["title"])]),_:1}),s(o).etype.toString()!==s(pe).EditMode_simple.toString()?(r(),f(D,{key:0,label:s(v).readMode?b.$t("main.read.mode"):b.$t("main.edit.mode")},{default:l(()=>[t(N,{modelValue:s(v).readMode,"onUpdate:modelValue":P[17]||(P[17]=W=>s(v).readMode=W)},null,8,["modelValue"])]),_:1},8,["label"])):C("",!0),ve("div",Do,[t(D,null,{default:l(()=>[ve("a",{class:yt({current:s(o).stype===s(Pe).YAML}),onClick:P[18]||(P[18]=W=>s(n).onYamlShowTypeChange(s(Pe).YAML))},K(b.$t("yaml.show.type.yaml")),3),ve("a",{class:yt({current:s(o).stype===s(Pe).CONTENT,middle:!0}),onClick:P[19]||(P[19]=W=>s(n).onYamlShowTypeChange(s(Pe).CONTENT))},K(b.$t("yaml.show.type.md")),3),ve("a",{class:yt({current:s(o).stype===s(Pe).YAML_CONTENT,middle:!0}),onClick:P[20]||(P[20]=W=>s(n).onYamlShowTypeChange(s(Pe).YAML_CONTENT))},K(b.$t("yaml.show.type.yamlmd")),3),ve("a",{class:yt({current:s(o).stype===s(Pe).HTML_CONTENT}),onClick:P[21]||(P[21]=W=>s(n).onYamlShowTypeChange(s(Pe).HTML_CONTENT))},K(b.$t("yaml.show.type.html")),3)]),_:1})]),s(v).readMode?(r(),te("div",ko,[t(D,null,{default:l(()=>[t(B,{id:"yaml-detail-preview",modelValue:s(v).yamlPreviewContent,"onUpdate:modelValue":P[22]||(P[22]=W=>s(v).yamlPreviewContent=W),autosize:{minRows:4,maxRows:16},readonly:"",type:"textarea",onClick:s(O).onYamlContentFocus,onContextmenu:s(O).onYamlContextMenu},null,8,["modelValue","onClick","onContextmenu"])]),_:1})])):C("",!0),s(v).readMode?C("",!0):(r(),te("div",Po,[t(D,null,{default:l(()=>[t(B,{modelValue:s(v).yamlContent,"onUpdate:modelValue":P[23]||(P[23]=W=>s(v).yamlContent=W),autosize:{minRows:4,maxRows:16},type:"textarea",onInput:s(O).onYamlContentInput},null,8,["modelValue","onInput"])]),_:1})])),s(v).readMode?C("",!0):(r(),te("div",Mo,[t(D,null,{default:l(()=>[t(A,{type:"primary",onClick:s(n).convertYAMLToAttr},{default:l(()=>[H(K(b.$t("main.yaml.to.siyuan")),1)]),_:1},8,["onClick"]),t(A,{type:"primary",onClick:P[24]||(P[24]=W=>s(O).copyYamlToClipboard())},{default:l(()=>[H(K(b.$t("main.copy")),1)]),_:1})]),_:1})])),ve("div",Vo,[t(D,null,{default:l(()=>[t(z,{closable:!1,title:b.$t("main.read.mode.tip"),type:"info"},null,8,["title"])]),_:1})])])):C("",!0)]),_:1})])]),_:1})]),_:1})),t(Be,{loading:s(m).isInitLoading,rows:5,animated:""},null,8,["loading"])])}}});const ft=et($o,[["__scopeId","data-v-444bcf63"]]);class Ao extends bt{constructor(){super(...arguments);le(this,"logger",me.getLogger("utils/platform/github/vuepress/VuepressYamlConvertAdaptor.ts"))}convertToYaml(a,o){let u=new ma;this.logger.debug("\u60A8\u6B63\u5728\u4F7F\u7528 Vuepress Yaml Converter",a),u.yamlObj.title=a.formData.title;let p="/post/"+a.formData.customSlug+".html";o&&!Re(o.previewUrl)&&(p=o.previewUrl.replace("[postid]",a.formData.customSlug)),this.logger.debug("link=>",p),u.yamlObj.permalink=p,u.yamlObj.date=pa(a.formData.created),u.yamlObj.meta=[{name:"keywords",content:a.formData.tag.dynamicTags.join(" ")},{name:"description",content:a.formData.desc}],u.yamlObj.tags=a.formData.tag.dynamicTags,u.yamlObj.categories=a.formData.categories;let i=so(u.yamlObj);return i=Qt(i,!0),u.formatter=i,u.mdContent=a.formData.mdContent,u.mdFullContent=u.formatter+`
`+u.mdContent,u.htmlContent=a.formData.htmlContent,u}convertToAttr(a,o){const u=a.yamlObj,p=new ga;p.formData.title=u.title,p.formData.customSlug=u.permalink.replace("/pages/","").replace("/post/","").replace(".html","").replace("/",""),p.formData.created=Qt(u.date.toISOString(),!1);const i=u.meta;for(let S=0;S<i.length;S++){const T=i[S];if(T.name==="description"){p.formData.desc=T.content;break}}for(let S=0;S<u.tags.length;S++){const T=u.tags[S];!p.formData.tag.dynamicTags.includes(T)&&T!==""&&p.formData.tag.dynamicTags.push(T)}return p.formData.categories=u.categories,p}}const Io=oe({__name:"VuepressMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(d){const e=d,a=_(ye.API_TYPE_VUEPRESS),o=new Ao,u=_(o);return(p,i)=>(r(),f(ft,{"is-reload":e.isReload,"is-main-reload":e.isMainReload,"api-type":a.value,"page-id":e.pageId,"yaml-converter":u.value},null,8,["is-reload","is-main-reload","api-type","page-id","yaml-converter"]))}}),Bo=oe({__name:"HugoMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(d){const e=d,a=_(ye.API_TYPE_HUGO);return(o,u)=>(r(),f(ft,{"is-reload":e.isReload,"is-main-reload":e.isMainReload,"api-type":a.value,"page-id":e.pageId},null,8,["is-reload","is-main-reload","api-type","page-id"]))}}),Fo=oe({__name:"HexoMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(d){const e=d,a=_(ye.API_TYPE_HEXO);return(o,u)=>(r(),f(ft,{"api-type":a.value,"is-reload":e.isReload,"is-main-reload":e.isMainReload,"page-id":e.pageId},null,8,["api-type","is-reload","is-main-reload","page-id"]))}}),Uo=oe({__name:"JekyllMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(d){const e=d,a=_(ye.API_TYPE_JEKYLL);return(o,u)=>(r(),f(ft,{"is-reload":e.isReload,"api-type":a.value,"is-main-reload":e.isMainReload,"page-id":e.pageId},null,8,["is-reload","api-type","is-main-reload","page-id"]))}}),Yo={class:"form-post-title"},Oo=["href","title"],Lo=oe({__name:"MetaweblogMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},apiType:{type:String,default:""},useAdaptor:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(d){const e=d,a=me.getLogger("components/publish/tab/main/MetaweblogMain.vue"),o=new Ke,{t:u}=Se(),p=_(""),i=_(u("setting.blog.platform.support.metaweblog")+e.apiType+" "),S=_(!1),T=_(!1),y=_(!1),V=_(!1),$=_(!1),E=_(!1),I=_(!1),Y=_(!1),M=_(!1),v=_(!1),O=_(!1),h=_(!1),c=_(""),m=_(!1),n=ce({postid:"",title:"",customSlug:"",desc:"",created:"",checkList:["1"],tag:{inputValue:"",dynamicTags:[],inputVisible:!1},cat:{categorySelected:[],categoryList:[]},categories:["\u9ED8\u8BA4\u5206\u7C7B"]}),w=ce({pageId:"",meta:{tags:""}}),g=()=>{M.value=!1},b=()=>{M.value=!0},P=async()=>{Y.value=!0;const R=await rt(!0,e.pageId);if(!R||R==="")return;const J=_e(e.apiType);pt(J)||(p.value=J.blogName);const ne=Ue();O.value=!0,w.pageId=R,w.meta=await o.getBlockAttrs(R);const k=await o.getBlockByID(R);if(!k)throw Y.value=!1,U.error(u("config.error.msg")+"_"+e.apiType),new Error(u("config.error.msg")+"_"+e.apiType);a.debug("MetaweblogMain\u521D\u59CB\u5316\u9875\u9762,meta=>",w.meta);let L=k.content;ne.fixTitle&&(L=Ut(k.content)),n.title=L,n.customSlug=w.meta[Me.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY],n.desc=w.meta[Me.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY],n.created=wt(k.created),n.tag.dynamicTags=[];const q=(w.meta.tags||"").split(",");for(let ge=0;ge<q.length;ge++)q[ge]!==""&&n.tag.dynamicTags.push(q[ge]);h.value=Nt(e.apiType,w.meta);const X=_e(e.apiType),Q=new Ge(e.apiType);let Ce=[];if(h.value){const ge=w.meta;n.postid=ge[X.posidKey],c.value=await Q.getPreviewUrl(n.postid.toString());try{const de=await Q.getPost(n.postid.toString());Ce=de.categories,a.debug("postid=>",n.postid),a.debug("post=>",de),a.debug("\u521D\u59CB\u5316\u9009\u62E9\u8FC7\u7684\u5206\u7C7B,catData=>",Ce)}catch(de){U.error(u("post.delete.by.platform")),Y.value=!1,a.error("\u6587\u7AE0\u65B0\u83B7\u53D6\u5931\u8D25",de)}}let he=[];try{he=await Q.getCategories()}catch(ge){Y.value=!1,a.error(u("main.cat.list.error"),ge)}const fe=[];he&&he.length&&he.length>0&&(he.forEach(ge=>{const de={value:ge.description,label:ge.description};fe.push(de)}),n.cat.categoryList=fe),n.cat.categorySelected=Ce,n.categories=Ce,S.value=J.apiStatus,Y.value=!1};Oe(async()=>{await P()});function z(){return Re(n.customSlug)||v.value?!0:(a.debug(u("main.force.refresh.tip")),!1)}const B=async R=>{if(!z())return;T.value=!0;const J=await o.getBlockByID(w.pageId);a.debug("page=>",J);let ne=J.content;if(ne.indexOf(".")>-1&&(ne=ne.replace(/\d*\./g,"")),a.debug("fmtTitle=>",ne),n.checkList.length>0){const k=await Ft(ne);a.debug("result=>",k),k?n.customSlug=k:U.success(u("main.opt.failure"))}else n.customSlug=at(ne);if(O.value){const k=J.content+new Date().toISOString(),L="-"+Gt(k).toLowerCase();n.customSlug+=L}T.value=!1,R!==!0&&U.success(u("main.opt.success"))},D=async R=>{y.value=!0;const ne=(await o.exportMdContent(w.pageId)).content,k=na(ne);n.desc=Yt(k,Ot.MAX_PREVIEW_LENGTH,!0),y.value=!1,R!==!0&&U.success(u("main.opt.success"))},A=R=>{n.tag.dynamicTags.splice(n.tag.dynamicTags.indexOf(R),1)},F=_(),N=()=>{n.tag.inputVisible=!0,ra(()=>{F.value.focus()})},ae=()=>{n.tag.inputValue&&n.tag.dynamicTags.push(n.tag.inputValue),n.tag.inputVisible=!1,n.tag.inputValue=""};async function Z(R){if(!m.value){U.warning(u("main.tag.auto.switch.no.tip"));return}V.value=!0;const ne=(await o.exportMdContent(w.pageId)).content,k=await Lt(ne);a.debug("genTags=>",k);const L=Rt(k,5);a.debug("hotTags=>",L);for(let j=0;j<L.length;j++)n.tag.dynamicTags.includes(L[j])||n.tag.dynamicTags.push(L[j]);V.value=!1,R!==!0&&U.success(u("main.opt.success"))}const G=async R=>{const J={[Me.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY]:n.customSlug,[Me.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY]:n.desc,tags:n.tag.dynamicTags.join(",")};await o.setBlockAttrs(w.pageId,J),a.debug("MetaweblogMain\u4FDD\u5B58\u5C5E\u6027\u5230\u601D\u6E90\u7B14\u8BB0,meta=>",J),R!==!0&&(await P(),U.success(u("main.opt.success")))},ee=(R,J,ne,k)=>{},x=(R,J)=>{console.log("data=>",R),console.log("status=>",J);const ne=[];J.checkedKeys.forEach(L=>{ne.push(L.toString())}),n.categories=ne,a.debug(" formData.categories=>",n.categories)},Le=async R=>{$.value=!0,await B(!0),await D(!0),await Z(!0),await G(!0),a.debug("\u53D1\u5E03\u5C5E\u6027\u5B8C\u6210"),$.value=!1,R!==!0&&U.success(u("main.publish.oneclick.attr.finish"))},Be=async()=>{if(!S.value){U.error(u("setting.blog.vali.tip.metaweblog"));return}E.value=!0;try{await Le(!0);const R=_e(e.apiType),J=new Ge(e.apiType),ne=Ue();let k;const j=(await o.exportMdContent(w.pageId)).content;if(De.Html===R.pageType){const Ce=vt(j);k=ua(Ce),ne.removeH1&&(k=Ct(k))}else k=ia(j),ne.removeH1&&(k=Kt(k));const q=new Bt;q.title=n.title,q.wp_slug=n.customSlug,q.description=k,q.categories=n.categories,q.mt_keywords=n.tag.dynamicTags.join(","),e.apiType===ye.API_TYPE_CNBLOGS&&q.categories.push("[Markdown]"),q.dateCreated=new Date;const X=!0;let Q;if(h.value){if(Q=n.postid,!await J.editPost(Q,q,!0))throw U.error("\u6587\u7AE0\u66F4\u65B0\u5931\u8D25"),new Error("\u6587\u7AE0\u66F4\u65B0\u5931\u8D25=>"+Q);a.debug("\u6587\u7AE0\u5DF2\u66F4\u65B0\uFF0Cpostid=>",Q)}else{Q=await J.newPost(q,X),a.debug("\u5F53\u524D\u4FDD\u5B58\u7684posidKey=>",R.posidKey);const Ce={[R.posidKey]:Q};await o.setBlockAttrs(w.pageId,Ce),a.debug("MetaweblogMain\u53D1\u5E03\u6210\u529F\uFF0C\u4FDD\u5B58postid,meta=>",Ce),a.info("\u6587\u7AE0\u53D1\u5E03\u6210\u529F\uFF0Cpostid=>",Q)}await P(),U.success(u("main.opt.success"))}catch(R){throw a.error("\u53D1\u5E03\u5F02\u5E38"),U.error(u("main.opt.failure")),R}E.value=!1},W=async()=>{I.value=!0,xe.confirm(u("main.opt.warning.tip"),u("main.opt.warning"),{confirmButtonText:u("main.opt.ok"),cancelButtonText:u("main.opt.cancel"),type:"warning"}).then(async()=>{await ze(!0),I.value=!1,U.warning(u("main.opt.status.cancel"))}).catch(R=>{throw U({type:"error",message:u("main.opt.failure")}),I.value=!1,new Error(R)})},ze=async R=>{const J=_e(e.apiType);a.debug("\u51C6\u5907\u53D6\u6D88\u53D1\u5E03\uFF0Cpostid=>",n.postid);const ne={[J.posidKey]:""};await o.setBlockAttrs(w.pageId,ne),a.debug("MetaweblogMain\u53D6\u6D88\u53D1\u5E03,meta=>",ne);try{await new Ge(e.apiType).deletePost(n.postid)||U.error("\u6587\u7AE0\u5220\u9664\u5931\u8D25")}catch(k){a.error("\u5F3A\u884C\u5220\u9664\u4E00\u6B21",k)}R&&await P()};return Ne(()=>e.isReload,async()=>{await P(),a.debug(e.apiType+"_Main\u68C0\u6D4B\u5230\u8BBE\u7F6E\u66F4\u65B0\u64CD\u4F5C\uFF0C\u5237\u65B0\u9875\u9762")}),Ne(()=>e.isMainReload,async()=>{await P(),a.debug(e.apiType+"_Main\u5DE6\u53F3\u5207\u6362tab\uFF0C\u5237\u65B0\u9875\u9762")}),(R,J)=>{const ne=Ye,k=Je,L=je,j=qe,q=nt,X=ut,Q=aa,Ce=la,he=Vt,fe=$t,ge=ta,de=We,ie=ht,we=At,He=_t;return r(),f(He,null,{default:l(()=>[Y.value?C("",!0):(r(),f(ie,{key:0,class:"blog-main"},{default:l(()=>[t(ne,{class:"top-version-tip",title:i.value+p.value,type:"info",closable:!1},null,8,["title"]),S.value?C("",!0):(r(),f(ne,{key:0,class:"top-version-tip",title:R.$t("setting.blog.vali.tip.metaweblog"),type:"error",closable:!1},null,8,["title"])),d.useAdaptor?(r(),f(ne,{key:1,class:"top-version-tip",title:R.$t("setting.conf.tip"),type:"info",closable:!1},null,8,["title"])):C("",!0),t(de,{"label-width":"120px"},{default:l(()=>[ve("div",Yo,[t(L,{label:R.$t("main.title")},{default:l(()=>[t(k,{modelValue:n.title,"onUpdate:modelValue":J[0]||(J[0]=re=>n.title=re),disabled:!0},null,8,["modelValue"])]),_:1},8,["label"])]),t(L,{label:R.$t("main.publish.editmode")},{default:l(()=>[t(q,null,{default:l(()=>[t(j,{type:M.value?"default":"primary",onClick:g},{default:l(()=>[H(K(R.$t("main.publish.editmode.simple")),1)]),_:1},8,["type"]),t(j,{type:M.value?"primary":"default",onClick:b},{default:l(()=>[H(K(R.$t("main.publish.editmode.complex")),1)]),_:1},8,["type"])]),_:1})]),_:1},8,["label"]),M.value?(r(),f(L,{key:0,label:R.$t("main.force.refresh")},{default:l(()=>[t(X,{modelValue:v.value,"onUpdate:modelValue":J[1]||(J[1]=re=>v.value=re)},null,8,["modelValue"]),v.value?C("",!0):(r(),f(ne,{key:0,title:R.$t("main.force.refresh.tip"),type:"warning",closable:!1},null,8,["title"]))]),_:1},8,["label"])):C("",!0),M.value?(r(),f(L,{key:1,label:R.$t("main.slug")},{default:l(()=>[t(k,{modelValue:n.customSlug,"onUpdate:modelValue":J[2]||(J[2]=re=>n.customSlug=re)},null,8,["modelValue"])]),_:1},8,["label"])):C("",!0),M.value?(r(),f(L,{key:2},{default:l(()=>[t(Ce,{modelValue:n.checkList,"onUpdate:modelValue":J[3]||(J[3]=re=>n.checkList=re)},{default:l(()=>[t(Q,{label:"1"},{default:l(()=>[H(K(R.$t("main.use.google.translate")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})):C("",!0),M.value?(r(),f(L,{key:3},{default:l(()=>[t(j,{type:"primary",class:"make-slug-btn",onClick:B,loading:T.value},{default:l(()=>[H(K(T.value?R.$t("main.opt.loading"):R.$t("main.auto.fetch.slug")),1)]),_:1},8,["loading"])]),_:1})):C("",!0),M.value?(r(),f(L,{key:4,label:R.$t("main.use.hash")},{default:l(()=>[t(X,{modelValue:O.value,"onUpdate:modelValue":J[4]||(J[4]=re=>O.value=re)},null,8,["modelValue"]),O.value?C("",!0):(r(),f(ne,{key:0,title:R.$t("main.use.hash.tip"),type:"warning",closable:!1},null,8,["title"]))]),_:1},8,["label"])):C("",!0),M.value?(r(),f(L,{key:5,label:R.$t("main.desc")},{default:l(()=>[t(k,{type:"textarea",modelValue:n.desc,"onUpdate:modelValue":J[5]||(J[5]=re=>n.desc=re)},null,8,["modelValue"])]),_:1},8,["label"])):C("",!0),M.value?(r(),f(L,{key:6},{default:l(()=>[t(j,{type:"primary",onClick:D,loading:y.value},{default:l(()=>[H(K(y.value?R.$t("main.opt.loading"):R.$t("main.auto.fetch.desc")),1)]),_:1},8,["loading"])]),_:1})):C("",!0),M.value?(r(),f(L,{key:7,label:R.$t("main.create.time")},{default:l(()=>[t(he,{type:"datetime",modelValue:n.created,"onUpdate:modelValue":J[6]||(J[6]=re=>n.created=re),format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:R.$t("main.create.time.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):C("",!0),t(L,{label:R.$t("main.tag")},{default:l(()=>[(r(!0),te($e,null,Ve(n.tag.dynamicTags,re=>(r(),f(fe,{key:re,class:"mx-1",closable:"","disable-transitions":!1,onClose:qt=>A(re)},{default:l(()=>[H(K(re),1)]),_:2},1032,["onClose"]))),128)),n.tag.inputVisible?(r(),f(k,{key:0,ref_key:"tagRefInput",ref:F,modelValue:n.tag.inputValue,"onUpdate:modelValue":J[7]||(J[7]=re=>n.tag.inputValue=re),class:"ml-1 w-20",size:"small",onKeyup:Ht(ae,["enter"]),onBlur:ae},null,8,["modelValue","onKeyup"])):(r(),f(j,{key:1,class:"button-new-tag ml-1 el-tag",size:"small",onClick:N},{default:l(()=>[H(K(R.$t("main.tag.new")),1)]),_:1}))]),_:1},8,["label"]),M.value?(r(),f(L,{key:8},{default:l(()=>[t(j,{type:"primary",onClick:Z,loading:V.value},{default:l(()=>[H(K(V.value?R.$t("main.opt.loading"):R.$t("main.auto.fetch.tag")),1)]),_:1},8,["loading"])]),_:1})):C("",!0),t(L,{label:R.$t("main.tag.auto.switch")},{default:l(()=>[t(X,{modelValue:m.value,"onUpdate:modelValue":J[8]||(J[8]=re=>m.value=re)},null,8,["modelValue"])]),_:1},8,["label"]),t(L,{label:R.$t("main.cat"),style:{width:"100%"}},{default:l(()=>[t(ge,{style:{width:"100%"},modelValue:n.cat.categorySelected,"onUpdate:modelValue":J[9]||(J[9]=re=>n.cat.categorySelected=re),data:n.cat.categoryList,multiple:"","tag-type":"info","check-on-click-node":!0,"render-after-expand":!1,"show-checkbox":"",placeholder:R.$t("main.cat.select"),"empty-text":R.$t("main.cat.empty"),"no-data-text":R.$t("main.cat.empty"),onNodeClick:ee,onCheck:x},null,8,["modelValue","data","placeholder","empty-text","no-data-text"])]),_:1},8,["label"]),t(L,{label:R.$t("main.opt.quick")},{default:l(()=>[t(j,{type:"primary",onClick:Le,loading:$.value},{default:l(()=>[H(K($.value?R.$t("main.opt.loading"):R.$t("main.publish.oneclick.attr")),1)]),_:1},8,["loading"]),M.value?(r(),f(j,{key:0,type:"primary",onClick:G},{default:l(()=>[H(K(R.$t("main.save.attr.to.siyuan")),1)]),_:1})):C("",!0)]),_:1},8,["label"]),t(L,{label:""},{default:l(()=>[t(j,{type:"primary",onClick:Be,loading:E.value},{default:l(()=>[H(K(E.value?R.$t("main.publish.loading"):h.value?R.$t("main.update"):R.$t("main.publish")),1)]),_:1},8,["loading"]),h.value?(r(),f(j,{key:0,loading:I.value,onClick:W},{default:l(()=>[H(K(R.$t("main.cancel")),1)]),_:1},8,["loading"])):C("",!0)]),_:1}),t(L,null,{default:l(()=>[t(j,{type:"danger",text:"",disabled:""},{default:l(()=>[H(K(h.value?R.$t("main.publish.status.published"):R.$t("main.publish.status.unpublish")),1)]),_:1}),h.value?(r(),te("a",{key:0,href:c.value,title:c.value,target:"_blank"},K(R.$t("main.publish.see.preview")),9,Oo)):C("",!0)]),_:1})]),_:1})]),_:1})),t(we,{loading:Y.value,rows:5,animated:""},null,8,["loading"])]),_:1})}}});const lt=et(Lo,[["__scopeId","data-v-4000a845"]]),Ro=oe({__name:"JVueMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(d){const e=d,a=_(ye.API_TYPE_JVUE);return(o,u)=>(r(),f(lt,{"api-type":a.value,"is-main-reload":e.isMainReload,"is-reload":e.isReload,"page-id":e.pageId},null,8,["api-type","is-main-reload","is-reload","page-id"]))}}),Ko=oe({__name:"ConfluenceMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(d){const e=d,a=_(ye.API_TYPE_CONFLUENCE);return(o,u)=>(r(),f(lt,{"is-main-reload":e.isMainReload,"is-reload":e.isReload,"api-type":a.value,"use-adaptor":!0,"page-id":e.pageId},null,8,["is-main-reload","is-reload","api-type","page-id"]))}}),No=oe({__name:"CnblogsMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(d){const e=d,a=_(ye.API_TYPE_CNBLOGS);return(o,u)=>(r(),f(lt,{"api-type":a.value,"is-main-reload":e.isMainReload,"is-reload":e.isReload,"page-id":e.pageId},null,8,["api-type","is-main-reload","is-reload","page-id"]))}}),Ho=oe({__name:"WordpressMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(d){const e=d,a=_(ye.API_TYPE_WORDPRESS);return(o,u)=>(r(),f(lt,{"api-type":a.value,"is-main-reload":e.isMainReload,"is-reload":e.isReload,"page-id":e.pageId},null,8,["api-type","is-main-reload","is-reload","page-id"]))}}),Go=/.(gif|jpe?g|tiff?|png|webp|bmp|ico)$/i;async function jo(d){let e="";if(d.uri){const a=new URL(d.uri);e=(await(await Ga(a)).buffer()).toString("base64")}else if(d.path&&Go.test(d.path))(await(void 0)(d.path)).isFile()&&(e=(await(void 0)(Ha(d.path))).toString("base64"));else throw new Error("Didn't get an image or a good uri for the appropriate param");return{base64:e}}class Wo{constructor(){le(this,"logger",me.getLogger("utils/parser/imageParser.ts"))}hasExternalImages(e){const o=/!\[.*]\((http|https):\/.*\/.*\)/g,u=e.match(o);if(u!=null&&u.length>0)return!0;const p=/!\[.*]\((data:image):\/.*\/.*\)/g,i=e.match(p);return i!=null&&i.length>0}removeImages(e){let a=e;return a=a.replace(/!\[.*]\((http|https):\/.*\/.*\)/g,""),a}async replaceImagesWithBase64(e){var p,i,S;let a=e;const o=/!\[.*]\((http|https):\/.*\/.*\)/g,u=a.match(o);if(u==null||u.length===0)return a;for(let T=0;T<u.length;T++){const y=u[T];this.logger.debug("img=>",y);const V=y.replace(/!\[]\(/g,"").replace(/\)/,"");this.logger.debug("src=>",V);let $;if(Ba()){const E=await jo({uri:V});$=(p=E==null?void 0:E.base64)!=null?p:"no pic"}else{const I=Fa("VITE_MIDDLEWARE_URL","/api/middleware")+"/imageToBase64",Y={fetchParams:{imgUrl:V}},M={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Y)};this.logger.debug("middleApiUrl=>",I),this.logger.debug("middleFetchOption=>",M);const O=await(await fetch(I,M)).json();this.logger.debug("resJson=>",O),$=(S=(i=O==null?void 0:O.body)==null?void 0:i.base64str)!=null?S:"parse error"}$=Te('<img src="data:image/png;base64,',$,'"  alt="base64Image"/>'),a=a.replace(y,$)}return a}replaceImagesWithAscii(e){return e}replaceImagesWithColorAscii(e){return e}async uploadImageToBeds(e){return e}async downloadMdWithImages(){}async downloadImagesToSiyuan(){throw new Error("\u601D\u6E90\u7B14\u8BB0\u5DF2\u7ECF\u6709\u6B64\u529F\u80FD\uFF0C\u65E0\u9700\u91CD\u65B0\u5B9E\u73B0")}}const qo={class:"form-post-title"},Jo=["href","title"],zo=oe({__name:"CommonBlogMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},useCat:{type:Boolean,default:!1},apiType:{type:String,default:""},cfg:{type:mt,default:null},pageId:{type:String,default:void 0},limitRate:{type:Boolean,default:!1},limitSeconds:{type:Number,default:5},imageToBase64:{type:Boolean,default:!1},removeImage:{type:Boolean,default:!1}},setup(d){const e=d,a=me.getLogger("components/publish/tab/main/CommonBlogMain.vue"),o=new Ke,u=new Wo,{t:p}=Se(),i=_(""),S=_(p("setting.blog.platform.support.common")+e.apiType+" "),T=_(!1),y=_(!1),V=_(!1),$=_(!1),E=_(!1),I=_(!1),Y=_(!1),M=_(!1),v=_(!1),O=_(!1),h=_(!1),c=_(!1),m=_(""),n=_(!1),w=_(!1),g=ce({postid:"",title:"",customSlug:"",desc:"",created:"",checkList:["1"],tag:{inputValue:"",dynamicTags:[],inputVisible:!1},cat:{categorySelected:"",categoryList:[]},categories:["\u9ED8\u8BA4\u5206\u7C7B"],cat_slugs:[]}),b=ce({pageId:"",meta:{tags:""}}),P=()=>{v.value=!1},z=()=>{v.value=!0},B=async()=>{M.value=!0;const k=await rt(!0,e.pageId);if(!k||k==="")return;const L=_e(e.apiType);pt(L)||(i.value=L.blogName||"");const j=Ue();h.value=!0,b.pageId=k,b.meta=await o.getBlockAttrs(k);let q;try{q=await o.getBlockByID(k)}catch(ie){throw M.value=!1,a.error("\u9875\u9762\u4FE1\u606F\u83B7\u53D6\u5931\u8D25",ie),new Error("\u9875\u9762\u4FE1\u606F\u83B7\u53D6\u5931\u8D25")}if(!q)throw M.value=!1,U.error(p("config.error.msg")+"_"+e.apiType),new Error(p("config.error.msg")+"_"+e.apiType);a.debug("CommonblogMain\u521D\u59CB\u5316\u9875\u9762,meta=>",b.meta);let X=q.content;j.fixTitle&&(X=Ut(q.content)),g.title=X,g.customSlug=b.meta[Me.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY],g.desc=b.meta[Me.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY],g.created=wt(q.created),g.tag.dynamicTags=[];const Ce=(b.meta.tags||"").split(",");for(let ie=0;ie<Ce.length;ie++)Ce[ie]!==""&&g.tag.dynamicTags.push(Ce[ie]);c.value=Nt(e.apiType,b.meta),w.value=!c.value;const he=_e(e.apiType),fe=new Ge(e.apiType);let ge=[],de=[];if(c.value){const ie=b.meta;if(g.postid=ie[he.posidKey||""],m.value=await fe.getPreviewUrl(g.postid.toString()),e.useCat)try{const we=await fe.getPost(g.postid.toString());ge=we.categories,de=we.cate_slugs,a.debug("postid=>",g.postid),a.debug("post=>",we),a.debug("\u521D\u59CB\u5316\u9009\u62E9\u8FC7\u7684\u5206\u7C7B,catData=>",ge)}catch(we){U.error(p("post.delete.by.platform")),M.value=!1,a.error("\u5E73\u53F0\u6587\u7AE0\u65B0\u83B7\u53D6\u5931\u8D25",we)}}else if(e.useCat&&!Re(he.blogName)){const ie=[],we=[];ie.push(he.blogName),ge=ie,we.push(he.blogid),de=we}if(e.useCat){let ie=[];try{ie=await fe.getCategories()}catch(He){M.value=!1,a.error(p("main.cat.list.error"),He)}const we=[];ie&&ie.length&&ie.length>0&&(ie.forEach(He=>{const re={value:He.categoryId,label:He.description};we.push(re)}),g.cat.categoryList=we),g.cat.categorySelected=ge.length>0?ge[0]:"",i.value=g.cat.categorySelected,g.categories=ge,g.cat_slugs=de}T.value=L.apiStatus||!1,M.value=!1};Oe(async()=>{await B()});function D(){return Re(g.customSlug)||O.value?!0:(a.debug(p("main.force.refresh.tip")),!1)}const A=async k=>{if(!D())return;y.value=!0;const L=await o.getBlockByID(b.pageId);a.debug("page=>",L);let j=L.content;if(j.indexOf(".")>-1&&(j=j.replace(/\d*\./g,"")),a.debug("fmtTitle=>",j),g.checkList.length>0){const q=await Ft(j);a.debug("result=>",q),q?g.customSlug=q:U.success(p("main.opt.failure"))}else g.customSlug=at(j);if(h.value){const q=L.content+new Date().toISOString(),X="-"+Gt(q).toLowerCase();g.customSlug+=X}y.value=!1,k!==!0&&U.success(p("main.opt.success"))},F=async k=>{V.value=!0;const j=(await o.exportMdContent(b.pageId)).content,q=na(j);g.desc=Yt(q,Ot.MAX_PREVIEW_LENGTH,!0),V.value=!1,k!==!0&&U.success(p("main.opt.success"))},N=k=>{g.tag.dynamicTags.splice(g.tag.dynamicTags.indexOf(k),1)},ae=_(),Z=()=>{g.tag.inputVisible=!0,ra(()=>{ae.value.focus()})},G=()=>{g.tag.inputValue&&g.tag.dynamicTags.push(g.tag.inputValue),g.tag.inputVisible=!1,g.tag.inputValue=""};async function ee(k){if(!n.value){U.warning(p("main.tag.auto.switch.no.tip"));return}$.value=!0;const j=(await o.exportMdContent(b.pageId)).content,q=await Lt(j);a.debug("genTags=>",q);const X=Rt(q,5);a.debug("hotTags=>",X);for(let Q=0;Q<X.length;Q++)g.tag.dynamicTags.includes(X[Q])||g.tag.dynamicTags.push(X[Q]);$.value=!1,k!==!0&&U.success(p("main.opt.success"))}const x=k=>{a.debug("val=>",k);const L=_e(e.apiType),j=[],q=[];j.push(k.label),g.categories=j,q.push(L.username+"/"+k.value),g.cat_slugs=q,i.value=k.label,a.debug(" formData.categories=>",g.categories),a.debug(" formData.cat_slugs=>",g.cat_slugs)},Le=async k=>{const L={[Me.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY]:g.customSlug,[Me.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY]:g.desc,tags:g.tag.dynamicTags.join(",")};await o.setBlockAttrs(b.pageId,L),a.debug("CommonblogMain\u4FDD\u5B58\u5C5E\u6027\u5230\u601D\u6E90\u7B14\u8BB0,meta=>",L),k!==!0&&(await B(),U.success(p("main.opt.success")))},Be=async k=>{E.value=!0,await A(!0),await F(!0),await ee(!0),await Le(!0),a.debug("\u53D1\u5E03\u5C5E\u6027\u5B8C\u6210"),E.value=!1,k!==!0&&U.success(p("main.publish.oneclick.attr.finish"))},W=k=>{const j=oa(k);if(Re(j))return!1;a.debug("checkLimit lastmodKey=>",k),a.debug("checkLimit lastmodDate=>",j);const q=qa(j);return q<=e.limitSeconds?(U.error("\u7531\u4E8E\u3010"+e.apiType+"\u3011\u5E73\u53F0\u7684\u9650\u5236\uFF0C\u6BCF6\u5206\u949F\u4E4B\u5185\u53EA\u80FD\u53D1\u5E03\u6216\u8005\u66F4\u65B0\u4E00\u6B21\u6587\u7AE0\uFF0C\u8DDD\u79BB\u4E0A\u4E00\u6B21\u53D1\u5E03\u65F6\u95F4\u4E3A\uFF1A"+q+"\u79D2\uFF0C\u4ECD\u9700\u7B49\u5F85\uFF1A"+(e.limitSeconds-q)+"\u79D2"),!0):!1},ze=async()=>{const L=(await o.exportMdContent(b.pageId)).content;e.removeImage&&u.hasExternalImages(L)?xe.confirm("\u68C0\u6D4B\u5230\u5916\u94FE\u56FE\u7247\uFF0C\u7531\u4E8E\u5E73\u53F0\u9650\u5236\uFF0C\u7EE7\u7EED\u53D1\u5E03\u5C06\u5254\u9664\u8FD9\u4E9B\u56FE\u7247\uFF0C\u4EE5\u7EAF\u6587\u672C\u53D1\u5E03\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F",p("main.opt.warning"),{confirmButtonText:p("main.opt.ok"),cancelButtonText:p("main.opt.cancel"),type:"warning"}).then(async()=>{await R()}).catch(()=>{}):await R()},R=async()=>{if(!T.value){U.error(p("setting.blog.vali.tip.metaweblog"));return}I.value=!0;try{const k=e.apiType+"_PUBLISH_LIMIT";if(W(k)){I.value=!1;return}a.debug("\u9A8C\u8BC1\u901A\u8FC7\uFF0C\u66F4\u65B0\u53D1\u5E03\u65F6\u95F4");const L=new Date().toISOString();Ua(k,L),await Be(!0);const j=_e(e.apiType),q=new Ge(e.apiType),X=Ue();let Q,he=(await o.exportMdContent(b.pageId)).content;if(e.removeImage&&(he=u.removeImages(he)),De.Html===j.pageType){const ie=vt(he);Q=ua(ie),X.removeH1&&(Q=Ct(Q))}else Q=ia(he),X.removeH1&&(Q=Kt(Q));const fe=new Bt;fe.title=g.title,fe.wp_slug=g.customSlug,fe.description=Q,fe.categories=g.categories,fe.cate_slugs=g.cat_slugs,fe.mt_keywords=g.tag.dynamicTags.join(","),fe.dateCreated=new Date;const ge=!0;let de;if(c.value){if(de=g.postid,!await q.editPost(de,fe,!0))throw U.error("\u6587\u7AE0\u66F4\u65B0\u5931\u8D25"),new Error("\u6587\u7AE0\u66F4\u65B0\u5931\u8D25=>"+de);a.debug("\u6587\u7AE0\u5DF2\u66F4\u65B0\uFF0Cpostid=>",de)}else{if(de=await q.newPost(fe,ge),fe.cate_slugs&&fe.cate_slugs.length>0){const we=fe.cate_slugs[0];de=de+"_"+we}a.debug("\u5F53\u524D\u4FDD\u5B58\u7684posidKey=>",j.posidKey);const ie={[j.posidKey||""]:de};await o.setBlockAttrs(b.pageId,ie),a.debug("CommonblogMain\u53D1\u5E03\u6210\u529F\uFF0C\u4FDD\u5B58postid,meta=>",ie),a.debug("\u6587\u7AE0\u53D1\u5E03\u6210\u529F\uFF0Cpostid=>",de)}await B(),U.success(p("main.opt.success"))}catch(k){I.value=!1,a.error("\u53D1\u5E03\u5F02\u5E38",k),U.error({dangerouslyUseHTMLString:!0,message:p("main.opt.failure")+"=>"+k})}I.value=!1},J=async()=>{Y.value=!0,xe.confirm(p("main.opt.warning.tip"),p("main.opt.warning"),{confirmButtonText:p("main.opt.ok"),cancelButtonText:p("main.opt.cancel"),type:"warning"}).then(async()=>{await ne(!0),Y.value=!1,U.warning(p("main.opt.status.cancel"))}).catch(k=>{throw U({type:"error",message:p("main.opt.failure")}),Y.value=!1,new Error(k)})},ne=async k=>{const L=_e(e.apiType);a.debug("\u51C6\u5907\u53D6\u6D88\u53D1\u5E03\uFF0Cpostid=>",g.postid);const j={[L.posidKey||""]:""};await o.setBlockAttrs(b.pageId,j),a.debug("MetaweblogMain\u53D6\u6D88\u53D1\u5E03,meta=>",j);try{if(!await new Ge(e.apiType).deletePost(g.postid))throw U.error("\u6587\u7AE0\u5220\u9664\u5931\u8D25"),new Error("\u6587\u7AE0\u5220\u9664\u5931\u8D25")}catch(q){a.error("\u5F3A\u884C\u5220\u9664\u4E00\u6B21",q)}k&&await B()};return Ne(()=>e.isReload,async()=>{await B(),a.debug(e.apiType+"_Main\u68C0\u6D4B\u5230\u8BBE\u7F6E\u66F4\u65B0\u64CD\u4F5C\uFF0C\u5237\u65B0\u9875\u9762")}),Ne(()=>e.isMainReload,async()=>{await B(),a.debug(e.apiType+"_Main\u5DE6\u53F3\u5207\u6362tab\uFF0C\u5237\u65B0\u9875\u9762")}),(k,L)=>{const j=Ye,q=Je,X=je,Q=qe,Ce=nt,he=ut,fe=aa,ge=la,de=Vt,ie=$t,we=xt,He=ea,re=We,qt=ht,fa=At,ya=_t;return r(),f(ya,null,{default:l(()=>[M.value?C("",!0):(r(),f(qt,{key:0,class:"common-main"},{default:l(()=>[t(j,{class:"top-version-tip",title:S.value+i.value,type:"info",closable:!1},null,8,["title"]),d.useCat&&c.value?(r(),f(j,{key:0,class:"top-version-tip",title:"\u4EC5\u652F\u6301\u65B0\u5EFA\u4FEE\u6539\uFF0C\u6682\u65F6\u4E0D\u652F\u6301\u7F16\u8F91\u6240\u5C5E\u77E5\u8BC6\u5E93\u3002\u5982\u679C\u60A8\u60F3\u79FB\u52A8\u6587\u6863\uFF0C\u8BF7\u5148\u70B9\u51FB\u53D6\u6D88\u5220\u9664\u8BE5\u6587\u6863\uFF0C\u7136\u540E\u91CD\u65B0\u9009\u62E9\u65B0\u7684\u77E5\u8BC6\u5E93\u53D1\u5E03\u3002",type:"warning",closable:!1})):C("",!0),T.value?C("",!0):(r(),f(j,{key:1,class:"top-version-tip",title:k.$t("setting.blog.vali.tip.metaweblog"),type:"error",closable:!1},null,8,["title"])),t(re,{"label-width":"120px"},{default:l(()=>[ve("div",qo,[t(X,{label:k.$t("main.title")},{default:l(()=>[t(q,{modelValue:g.title,"onUpdate:modelValue":L[0]||(L[0]=se=>g.title=se),disabled:!0},null,8,["modelValue"])]),_:1},8,["label"])]),t(X,{label:k.$t("main.publish.editmode")},{default:l(()=>[t(Ce,null,{default:l(()=>[t(Q,{type:v.value?"default":"primary",onClick:P},{default:l(()=>[H(K(k.$t("main.publish.editmode.simple")),1)]),_:1},8,["type"]),t(Q,{type:v.value?"primary":"default",onClick:z},{default:l(()=>[H(K(k.$t("main.publish.editmode.complex")),1)]),_:1},8,["type"])]),_:1})]),_:1},8,["label"]),v.value?(r(),f(X,{key:0,label:k.$t("main.force.refresh")},{default:l(()=>[t(he,{modelValue:O.value,"onUpdate:modelValue":L[1]||(L[1]=se=>O.value=se)},null,8,["modelValue"]),O.value?C("",!0):(r(),f(j,{key:0,title:k.$t("main.force.refresh.tip"),type:"warning",closable:!1},null,8,["title"]))]),_:1},8,["label"])):C("",!0),v.value?(r(),f(X,{key:1,label:k.$t("main.slug")},{default:l(()=>[t(q,{modelValue:g.customSlug,"onUpdate:modelValue":L[2]||(L[2]=se=>g.customSlug=se)},null,8,["modelValue"])]),_:1},8,["label"])):C("",!0),v.value?(r(),f(X,{key:2},{default:l(()=>[t(ge,{modelValue:g.checkList,"onUpdate:modelValue":L[3]||(L[3]=se=>g.checkList=se)},{default:l(()=>[t(fe,{label:"1"},{default:l(()=>[H(K(k.$t("main.use.google.translate")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})):C("",!0),v.value?(r(),f(X,{key:3},{default:l(()=>[t(Q,{type:"primary",class:"make-slug-btn",onClick:A,loading:y.value},{default:l(()=>[H(K(y.value?k.$t("main.opt.loading"):k.$t("main.auto.fetch.slug")),1)]),_:1},8,["loading"])]),_:1})):C("",!0),v.value?(r(),f(X,{key:4,label:k.$t("main.use.hash")},{default:l(()=>[t(he,{modelValue:h.value,"onUpdate:modelValue":L[4]||(L[4]=se=>h.value=se)},null,8,["modelValue"]),h.value?C("",!0):(r(),f(j,{key:0,title:k.$t("main.use.hash.tip"),type:"warning",closable:!1},null,8,["title"]))]),_:1},8,["label"])):C("",!0),v.value?(r(),f(X,{key:5,label:k.$t("main.desc")},{default:l(()=>[t(q,{type:"textarea",modelValue:g.desc,"onUpdate:modelValue":L[5]||(L[5]=se=>g.desc=se)},null,8,["modelValue"])]),_:1},8,["label"])):C("",!0),v.value?(r(),f(X,{key:6},{default:l(()=>[t(Q,{type:"primary",onClick:F,loading:V.value},{default:l(()=>[H(K(V.value?k.$t("main.opt.loading"):k.$t("main.auto.fetch.desc")),1)]),_:1},8,["loading"])]),_:1})):C("",!0),v.value?(r(),f(X,{key:7,label:k.$t("main.create.time")},{default:l(()=>[t(de,{type:"datetime",modelValue:g.created,"onUpdate:modelValue":L[6]||(L[6]=se=>g.created=se),format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:k.$t("main.create.time.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):C("",!0),t(X,{label:k.$t("main.tag")},{default:l(()=>[(r(!0),te($e,null,Ve(g.tag.dynamicTags,se=>(r(),f(ie,{key:se,class:"mx-1",closable:"","disable-transitions":!1,onClose:as=>N(se)},{default:l(()=>[H(K(se),1)]),_:2},1032,["onClose"]))),128)),g.tag.inputVisible?(r(),f(q,{key:0,ref_key:"tagRefInput",ref:ae,modelValue:g.tag.inputValue,"onUpdate:modelValue":L[7]||(L[7]=se=>g.tag.inputValue=se),class:"ml-1 w-20",size:"small",onKeyup:Ht(G,["enter"]),onBlur:G},null,8,["modelValue","onKeyup"])):(r(),f(Q,{key:1,class:"button-new-tag ml-1 el-tag",size:"small",onClick:Z},{default:l(()=>[H(K(k.$t("main.tag.new")),1)]),_:1}))]),_:1},8,["label"]),v.value?(r(),f(X,{key:8},{default:l(()=>[t(Q,{type:"primary",onClick:ee,loading:$.value},{default:l(()=>[H(K($.value?k.$t("main.opt.loading"):k.$t("main.auto.fetch.tag")),1)]),_:1},8,["loading"])]),_:1})):C("",!0),t(X,{label:k.$t("main.tag.auto.switch")},{default:l(()=>[t(he,{modelValue:n.value,"onUpdate:modelValue":L[8]||(L[8]=se=>n.value=se)},null,8,["modelValue"])]),_:1},8,["label"]),e.useCat?(r(),f(X,{key:9,label:k.$t("main.cat"),style:{width:"100%"}},{default:l(()=>[w.value?(r(),f(He,{key:0,modelValue:g.cat.categorySelected,"onUpdate:modelValue":L[9]||(L[9]=se=>g.cat.categorySelected=se),placeholder:"\u8BF7\u9009\u62E9","no-data-text":"\u6682\u65E0\u6570\u636E",class:"m-2",size:"default",onChange:x},{default:l(()=>[(r(!0),te($e,null,Ve(g.cat.categoryList,se=>(r(),f(we,{key:se.value,label:se.label,value:se},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(r(),f(He,{key:1,modelValue:g.cat.categorySelected,"onUpdate:modelValue":L[10]||(L[10]=se=>g.cat.categorySelected=se),disabled:"",placeholder:"\u8BF7\u9009\u62E9","no-data-text":"\u6682\u65E0\u6570\u636E",class:"m-2",size:"default",onChange:x},{default:l(()=>[(r(!0),te($e,null,Ve(g.cat.categoryList,se=>(r(),f(we,{key:se.value,label:se.label,value:se},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]))]),_:1},8,["label"])):C("",!0),t(X,{label:k.$t("main.opt.quick")},{default:l(()=>[t(Q,{type:"primary",onClick:Be,loading:E.value},{default:l(()=>[H(K(E.value?k.$t("main.opt.loading"):k.$t("main.publish.oneclick.attr")),1)]),_:1},8,["loading"]),v.value?(r(),f(Q,{key:0,type:"primary",onClick:Le},{default:l(()=>[H(K(k.$t("main.save.attr.to.siyuan")),1)]),_:1})):C("",!0)]),_:1},8,["label"]),t(X,{label:""},{default:l(()=>[t(Q,{type:"primary",onClick:ze,loading:I.value},{default:l(()=>[H(K(I.value?k.$t("main.publish.loading"):c.value?k.$t("main.update"):k.$t("main.publish")),1)]),_:1},8,["loading"]),c.value?(r(),f(Q,{key:0,loading:Y.value,onClick:J},{default:l(()=>[H(K(k.$t("main.cancel")),1)]),_:1},8,["loading"])):C("",!0)]),_:1}),t(X,null,{default:l(()=>[t(Q,{type:"danger",text:"",disabled:""},{default:l(()=>[H(K(c.value?k.$t("main.publish.status.published"):k.$t("main.publish.status.unpublish")),1)]),_:1}),c.value?(r(),te("a",{key:0,href:m.value,title:m.value,target:"_blank"},K(k.$t("main.publish.see.preview")),9,Jo)):C("",!0)]),_:1})]),_:1})]),_:1})),t(fa,{loading:M.value,rows:5,animated:""},null,8,["loading"])]),_:1})}}});const Wt=et(zo,[["__scopeId","data-v-b437e295"]]),Xo=oe({__name:"LiandiMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(d){const e=d,a=_(ye.API_TYPE_LIANDI);return(o,u)=>(r(),f(Wt,{"is-main-reload":e.isMainReload,"is-reload":e.isReload,"api-type":a.value,"page-id":e.pageId,"limit-rate":!0,"limit-seconds":360,"remove-image":!0},null,8,["is-main-reload","is-reload","api-type","page-id"]))}}),Qo=oe({__name:"YuqueMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(d){const e=d,a=_(ye.API_TYPE_YUQUE);return(o,u)=>(r(),f(Wt,{"api-type":a.value,"is-main-reload":e.isMainReload,"is-reload":e.isReload,"page-id":e.pageId,"use-cat":!0},null,8,["api-type","is-main-reload","is-reload","page-id"]))}}),Zo=oe({__name:"KmsMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(d){const e=d,a=_(ye.API_TYPE_KMS);return(o,u)=>(r(),f(Wt,{"api-type":a.value,"is-main-reload":e.isMainReload,"is-reload":e.isReload,"page-id":e.pageId},null,8,["api-type","is-main-reload","is-reload","page-id"]))}}),xo={key:1},es=oe({__name:"PlatformMain",props:{isReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(d){const e=d,a=me.getLogger("components/publish/tab/PlatformMain.vue"),{tabCountStore:o,vuepressEnabled:u,hugoEnabled:p,hexoEnabled:i,jekyllEnabled:S,jvueEnabled:T,confEnabled:y,cnblogsEnabled:V,wordpressEnabled:$,liandiEnabled:E,yuqueEnabled:I,kmsEnabled:Y,doCount:M}=Et(),v=_(!1),O=ce({dynamicConfigArray:[],githubArray:[],metaweblogArray:[],wordpressArray:[]}),h=n=>{const w=[];return n.forEach(g=>{const b=new ot(g.platformType,g.platformKey,g.platformName),P="switch-"+g.platformKey,z=Ee(P);b.modelValue=z,z&&w.push(b)}),w},c=()=>{M();const n=it();O.dynamicConfigArray=h(n.totalCfg||[]),O.githubArray=h(n.githubCfg||[]),O.metaweblogArray=h(n.metaweblogCfg||[]),O.wordpressArray=h(n.wordpressCfg||[]),a.debug("dynamicJsonCfg=>",JSON.stringify(n)),a.debug("\u5E73\u53F0\u8BBE\u7F6E\u521D\u59CB\u5316")},m=()=>{v.value=!v.value};return Ne(()=>e.isReload,(n,w)=>{c()}),Oe(()=>{c()}),(n,w)=>{const g=Pt,b=Mt,P=Ye;return s(o).tabCount>0?(r(),f(b,{key:0,type:"border-card",onTabClick:m},{default:l(()=>[s(u)?(r(),f(g,{key:0,label:n.$t("main.publish.to.vuepress")},{default:l(()=>[t(Io,{"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):C("",!0),s(p)?(r(),f(g,{key:1,label:n.$t("main.publish.to.hugo")},{default:l(()=>[t(Bo,{"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):C("",!0),s(i)?(r(),f(g,{key:2,label:n.$t("main.publish.to.hexo")},{default:l(()=>[t(Fo,{"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):C("",!0),s(S)?(r(),f(g,{key:3,label:n.$t("main.publish.to.jekyll")},{default:l(()=>[t(Uo,{"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):C("",!0),s(T)?(r(),f(g,{key:4,label:n.$t("main.publish.to.jvue")},{default:l(()=>[t(Ro,{"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):C("",!0),s(y)?(r(),f(g,{key:5,label:n.$t("main.publish.to.conf")},{default:l(()=>[t(Ko,{"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):C("",!0),s(V)?(r(),f(g,{key:6,label:n.$t("main.publish.to.cnblogs")},{default:l(()=>[t(No,{"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):C("",!0),s($)?(r(),f(g,{key:7,label:n.$t("main.publish.to.wordpress")},{default:l(()=>[t(Ho,{"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):C("",!0),s(E)?(r(),f(g,{key:8,label:n.$t("main.publish.to.liandi")},{default:l(()=>[t(Xo,{"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):C("",!0),s(I)?(r(),f(g,{key:9,label:n.$t("main.publish.to.yuque")},{default:l(()=>[t(Qo,{"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):C("",!0),s(Y)?(r(),f(g,{key:10,label:n.$t("main.publish.to.kms")},{default:l(()=>[t(Zo,{"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):C("",!0),(r(!0),te($e,null,Ve(O.githubArray,z=>(r(),f(g,{key:z.platformKey,label:z.platformName},{default:l(()=>[t(ft,{"is-reload":e.isReload,"api-type":z.platformKey,"is-main-reload":v.value,"page-id":e.pageId},null,8,["is-reload","api-type","is-main-reload","page-id"])]),_:2},1032,["label"]))),128)),(r(!0),te($e,null,Ve(O.metaweblogArray,z=>(r(),f(g,{key:z.platformKey,label:z.platformName},{default:l(()=>[t(lt,{"api-type":z.platformKey,"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["api-type","is-main-reload","is-reload","page-id"])]),_:2},1032,["label"]))),128)),(r(!0),te($e,null,Ve(O.wordpressArray,z=>(r(),f(g,{key:z.platformKey,label:z.platformName},{default:l(()=>[t(lt,{"api-type":z.platformKey,"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["api-type","is-main-reload","is-reload","page-id"])]),_:2},1032,["label"]))),128))]),_:1})):(r(),te("div",xo,[t(P,{class:"top-version-tip",title:n.$t("config.platform.none"),type:"error",closable:!1},null,8,["title"])]))}}}),ts=oe({__name:"PublishService",props:{isReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(d){const e=d,a=me.getLogger("components/publish/PublishService.vue"),o=_("platform-main"),u=_(!1),p=_(!1),i=_(!1),S=_(!1),T=_(!1),y=V=>{const $=V.paneName;a.debug("serviceTabChange=>",$),$==="platform-main"&&(u.value=!u.value),$==="platform-setting"&&(p.value=!p.value),$==="post-bind"&&(i.value=!i.value),$==="service-switch"&&(S.value=!S.value),$==="general-setting"&&(T.value=!T.value)};return(V,$)=>{const E=Pt,I=Mt;return r(),f(I,{"model-value":o.value,"tab-position":"left",onTabClick:y},{default:l(()=>[t(E,{class:"pane-platform-main-body",name:"platform-main",label:V.$t("service.tab.publish.service")},{default:l(()=>[t(es,{"is-reload":u.value,"page-id":e.pageId},null,8,["is-reload","page-id"])]),_:1},8,["label"]),t(E,{name:"platform-setting",label:V.$t("service.tab.publish.setting")},{default:l(()=>[t(Gl,{"is-reload":u.value},null,8,["is-reload"])]),_:1},8,["label"]),t(E,{name:"post-bind",label:V.$t("service.tab.post.bind")},{default:l(()=>[t(ml,{"is-reload":p.value,"page-id":e.pageId},null,8,["is-reload","page-id"])]),_:1},8,["label"]),t(E,{name:"service-switch",label:V.$t("service.tab.service.switch")},{default:l(()=>[t(dl,{"is-reload":S.value},null,8,["is-reload"])]),_:1},8,["label"]),t(E,{name:"dynamic-platform",label:V.$t("dynamic.platform.new")},{default:l(()=>[t(za)]),_:1},8,["label"]),t(E,{label:V.$t("service.tab.change.local"),name:"general-setting"},{default:l(()=>[t(Ya,{"is-reload":T.value},null,8,["is-reload"])]),_:1},8,["label"])]),_:1},8,["model-value"])}}});const ms=et(ts,[["__scopeId","data-v-2096d788"]]);export{ms as P,Qt as f};
